import{ au as _r,a7 as _t,V as Ap,J as Cp,aA as Du,a as fr,M as gi,d as gs,ar as Kn,a2 as kp,L as Mu,ah as ns,b as Or,ao as Rn,G as Tp,F as vs,o as wr,aw as yi }from'./index-BISJuDPG.js';const Fr=function ({ regl:e,precision:t,label:r='',chanNum:i,hydraSynth:n,width:o,height:u }){this.regl=e,this.precision=t,this.label=r,this.chanNum=i,this.hydraSynth=n,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=Array(2).fill().map(()=>this.regl.framebuffer({ color:this.regl.texture({ mag:'nearest',width:o,height:u,format:'rgba' }),depthStencil:!1 }))};Fr.prototype.resize=function (e,t){this.fbos.forEach(r=>{r.resize(e,t)})};Fr.prototype.getCurrent=function (){return this.fbos[this.pingPongIndex]};Fr.prototype.getTexture=function (){const e=this.pingPongIndex?0:1;return this.fbos[e]};Fr.prototype.init=function (){return this.transformIndex=0,this.fragHeader=`
  precision ${this.precision} float;

  uniform float time;
  varying vec2 uv;
  `,this.fragBody='',this.vert=`
  precision ${this.precision} float;
  attribute vec2 position;
  varying vec2 uv;

  void main () {
    uv = position;
    gl_Position = vec4(2.0 * position - 1.0, 0, 1);
  }`,this.attributes={ position:this.positionBuffer },this.uniforms={ time:this.regl.prop('time'),resolution:this.regl.prop('resolution') },this.frag=`
       ${this.fragHeader}

      void main () {
        vec4 c = vec4(0, 0, 0, 0);
        vec2 st = uv;
        ${this.fragBody}
        gl_FragColor = c;
      }
  `,this};Fr.prototype.render=function (e){const t=e[0];const r=this,i=Object.assign(t.uniforms,{ prevBuffer:()=>r.fbos[r.pingPongIndex] });r.draw=r.regl({ frag:t.frag,vert:r.vert,attributes:r.attributes,uniforms:i,count:3,framebuffer:()=>(r.pingPongIndex=r.pingPongIndex?0:1,r.fbos[r.pingPongIndex]) })};Fr.prototype.tick=function (e){this.draw(e)};class ll{constructor ({ wgslHydra:t,hydraSynth:r,chanNum:i,label:n='',width:o,height:u }){this.wgslHydra=t,this.hydraSynth=r,this.chanNum=i,this.label=n,this.draw=()=>{},this.init()}resize (t,r){}getCurrent (){return this.getCurrentTextureView()}getTexture (){return this.getOppositeTextureView()}init (){return this}async render (t){const r=t[0];const i=this,n=Object.assign(r.uniforms,{ prevBuffer:()=>i.getCurrentTextureView() });this.hydraChan=await this.wgslHydra.setupHydraChain(this.chanNum,n,r.frag)}tick (t){}flipPingPong (){const t=this.pingPongs===0?1:0;this.pingPongs=t}createTexturesAndViews (t,r){this.textures=new Array(2),this.views=new Array(2);for(let i=0;i<2;++i)this.textures[i]=t.createTexture(r),this.views[i]=this.textures[i].createView()}getCurrentTextureView (){const t=this.pingPongs;return this.views[t]}getCurrentTexture (){const t=this.pingPongs;return this.textures[t]}getOppositeTextureView (){const r=this.pingPongs===0?1:0;return this.views[r]}}function Qn (e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,'default')?e.default:e}let Pn={ exports:{} },Gu;function Lp (){return Gu||(Gu=1,typeof Object.create=='function'?Pn.exports=function (t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{ constructor:{ value:t,enumerable:!1,writable:!0,configurable:!0 } }))}:Pn.exports=function (t,r){if(r){t.super_=r;const i=function (){};i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t}}),Pn.exports}const Ip=Lp();const Rp=Qn(Ip);let as,Vu;function Pp (){if(Vu)return as;Vu=1;function e (){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}as=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function (o){if(!r(o)||o<0||isNaN(o))throw TypeError('n must be a positive number');return this._maxListeners=o,this},e.prototype.emit=function (o){let u,m,_,P,k,y;if(this._events||(this._events={}),o==='error'&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(u=arguments[1],u instanceof Error)throw u;const T=new Error('Uncaught, unspecified "error" event. ('+u+')');throw T.context=u,T}if(m=this._events[o],n(m))return!1;if(t(m))switch(arguments.length){case 1:m.call(this);break;case 2:m.call(this,arguments[1]);break;case 3:m.call(this,arguments[1],arguments[2]);break;default:P=Array.prototype.slice.call(arguments,1),m.apply(this,P)}else if(i(m))for(P=Array.prototype.slice.call(arguments,1),y=m.slice(),_=y.length,k=0;k<_;k++)y[k].apply(this,P);return!0},e.prototype.addListener=function (o,u){let m;if(!t(u))throw TypeError('listener must be a function');return this._events||(this._events={}),this._events.newListener&&this.emit('newListener',o,t(u.listener)?u.listener:u),this._events[o]?i(this._events[o])?this._events[o].push(u):this._events[o]=[this._events[o],u]:this._events[o]=u,i(this._events[o])&&!this._events[o].warned&&(n(this._maxListeners)?m=e.defaultMaxListeners:m=this._maxListeners,m&&m>0&&this._events[o].length>m&&(this._events[o].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[o].length),typeof console.trace=='function'&&console.trace())),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function (o,u){if(!t(u))throw TypeError('listener must be a function');let m=!1;function _ (){this.removeListener(o,_),m||(m=!0,u.apply(this,arguments))}return _.listener=u,this.on(o,_),this},e.prototype.removeListener=function (o,u){let m,_,P,k;if(!t(u))throw TypeError('listener must be a function');if(!this._events||!this._events[o])return this;if(m=this._events[o],P=m.length,_=-1,m===u||t(m.listener)&&m.listener===u)delete this._events[o],this._events.removeListener&&this.emit('removeListener',o,u);else if(i(m)){for(k=P;k-- >0;)if(m[k]===u||m[k].listener&&m[k].listener===u){_=k;break}if(_<0)return this;m.length===1?(m.length=0,delete this._events[o]):m.splice(_,1),this._events.removeListener&&this.emit('removeListener',o,u)}return this},e.prototype.removeAllListeners=function (o){let u,m;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[o]&&delete this._events[o],this;if(arguments.length===0){for(u in this._events)u!=='removeListener'&&this.removeAllListeners(u);return this.removeAllListeners('removeListener'),this._events={},this}if(m=this._events[o],t(m))this.removeListener(o,m);else if(m)for(;m.length;)this.removeListener(o,m[m.length-1]);return delete this._events[o],this},e.prototype.listeners=function (o){let u;return!this._events||!this._events[o]?u=[]:t(this._events[o])?u=[this._events[o]]:u=this._events[o].slice(),u},e.prototype.listenerCount=function (o){if(this._events){const u=this._events[o];if(t(u))return 1;if(u)return u.length}return 0},e.listenerCount=function (o,u){return o.listenerCount(u)};function t (o){return typeof o=='function'}function r (o){return typeof o=='number'}function i (o){return typeof o=='object'&&o!==null}function n (o){return o===void 0}return as}const Op=Pp();const Np=Qn(Op);function Fp (){return performance.now()}let ss=0,Uu=0,Kr=[],Bp=1e3/60;function fl (e){if(Kr.length===0){const t=Fp(),r=Math.max(0,Bp-(t-ss));ss=r+t,setTimeout(function (){const i=Kr.slice(0);Kr.length=0;for(let n=0;n<i.length;n++)if(!i[n].cancelled)try{i[n].callback(ss)}catch(o){setTimeout(function (){throw o},0)}},Math.round(r))}return Kr.push({ handle:++Uu,callback:e,cancelled:!1 }),Uu}function Mp (e){for(let t=0;t<Kr.length;t++)Kr[t].handle===e&&(Kr[t].cancelled=!0)}const Dp=Np.EventEmitter;function Es (){return performance.now()}function Qr (e){if(!(this instanceof Qr))return new Qr(e);this.running=!1,this.last=Es(),this._frame=0,this._tick=this.tick.bind(this),e&&this.on('tick',e)}Rp(Qr,Dp);Qr.prototype.start=function (){if(!this.running)return this.running=!0,this.last=Es(),this._frame=fl(this._tick),this};Qr.prototype.stop=function (){return this.running=!1,this._frame!==0&&Mp(this._frame),this._frame=0,this};Qr.prototype.tick=function (){this._frame=fl(this._tick);const e=Es(),t=e-this.last;this.emit('tick',t),this.last=e};const zu=Qr;function cl (e){return navigator.mediaDevices.enumerateDevices().then(t=>t.filter(r=>r.kind==='videoinput')).then(t=>{const r={ audio:!1,video:!0 };return t[e]&&(r.video={ deviceId:{ exact:t[e].deviceId } }),window.navigator.mediaDevices.getUserMedia(r)}).then(t=>{const r=document.createElement('video');return r.setAttribute('autoplay',''),r.setAttribute('muted',''),r.setAttribute('playsinline',''),r.srcObject=t,new Promise((i,n)=>{r.addEventListener('loadedmetadata',()=>{r.play().then(()=>i({ video:r }))})})}).catch(console.log.bind(console))}function hl (e){return new Promise(function (t,r){navigator.mediaDevices.getDisplayMedia(e).then(i=>{const n=document.createElement('video');n.srcObject=i,n.addEventListener('loadedmetadata',()=>{n.play(),t({ video:n })})}).catch(i=>r(i))})}class pl{constructor ({ regl:t,wgsl:r,hydraSynth:i,webWorker:n,proxy:o,width:u,height:m,chanNum:_,pb:P,label:k='' }){this.label=k,this.regl=t,this.wgsl=r,this.hydraSynth=i,this.webWorker=n,this.proxy=n!==void 0,this.src=null,this.dynamic=!0,this.width=u,this.height=m,this.chanNum=_,this.indirect=!1,this.active=!1,this.pb=P,this.tex=this.makeTexture({ width:u,height:m })}noteTime (){this.modTime=performance.now()}makeTexture (t){const r=t.width,i=t.height;if(this.wgsl){const n=this.wgsl.device.createTexture({ size:[r,i,1],format:this.wgsl.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT });return this.lastTexture=void 0,n}else return this.regl.texture({ shape:[r,i],...t })}activate (t,r){this.offscreencanvas=new OffscreenCanvas(t,r),this.bmr=this.offscreencanvas.getContext('bitmaprenderer'),this.wgsl?this.tex=this.makeTexture({ width:t,height:r }):(this.src=this.offscreencanvas,this.tex=this.makeTexture({ data:this.src,dynamic:!0,width:t,height:r })),console.log('activate complete')}init (t,r){this.what='init',this.noteTime(),'src'in t&&(this.src=t.src,this.wgsl?(this.indirect=!0,this.tex=t.src.tex):this.tex=this.regl.texture({ data:this.src,...r })),'dynamic'in t&&(this.dynamic=t.dynamic),this.active=!0}setupString (){const t=[],r=this.what;return t.push(this.label),t.push('.'),t.push(r),t.push('('),r==='initVideo'||r==='initImage'?(t.push('"'),t.push(this.url),t.push('"')):r==='initStream'?(t.push('"'),t.push(this.streamName),t.push('"')):(r==='initCam'||r==='initScreen')&&this.index!==void 0&&t.push(String.valueOf(this.index)),t.push(')'),t.join('')}initCam (t,r){if(this.what='initCam',this.noteTime(),this.webWorker){this.webWorker.openSourceProxy('webcam',this.chanNum,t,r);return}const i=this;i.index=t,cl(t).then(n=>{i.src=n.video,i.dynamic=!0,i.width=i.src.videoWidth,i.height=i.src.videoHeight,i.tex=this.makeTexture({ width:i.width,height:i.height,data:i.src,...r }),i.active=!0}).catch(n=>console.log('could not get camera',n))}initVideo (t='',r){if(this.what='initVideo',this.url=t,this.noteTime(),this.webWorker){this.webWorker.openSourceProxy('video',this.chanNum,t,r);return}const i=document.createElement('video');i.crossOrigin='anonymous',i.autoplay=!0,i.loop=!0,i.muted=!0,i.addEventListener('loadeddata',()=>{this.src=i,this.width=i.videoWidth,this.height=i.videoHeight,i.play(),self.tex=this.makeTexture({ width:this.width,height:this.height,data:this.src,...r }),this.dynamic=!0,this.active=!0}),i.src=t}initImage (t='',r){if(this.what='initImage',this.url=t,this.noteTime(),this.webWorker){this.webWorker.openSourceProxy('image',this.chanNum,t,r);return}const i=document.createElement('img');i.crossOrigin='anonymous',i.src=t,this.oneShotDone=!1;const n=this;i.onload=()=>{n.src=i,n.dynamic=!1,n.active=!0,n.tex=this.makeTexture({ width:n.width,height:n.height,data:n.src,...r })}}initStream (t,r){const i=this;i.what='initStream',this.noteTime(),i.steamName=t,t&&this.pb&&(this.pb.initSource(t),this.pb.on('got video',function (n,o){n===t&&(i.src=o,i.dynamic=!0,i.active=!0,i.tex=this.makeTexture({ width:i.width,height:i.height,data:i.src,...r }))}))}initScreen (t=0,r){const i=this;i.what='initScreen',i.index=t,i.noteTime(),hl().then(function (n){i.src=n.video,i.tex=i.regl.texture({ data:i.src,...r }),this.active=!0,i.dynamic=!0}).catch(n=>console.log('could not get screen',n))}resize (t,r){this.width=t,this.height=r}clear (){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach(t=>t.stop()),this.offscreencanvas=void 0,this.bmr=void 0,this.src=null,this.active=!1,this.what='',this.wgsl?this.tex=this.makeTexture({ width:1,height:1 }):this.tex=this.regl.texture({ shape:[1,1] })}resizeTex (t,r){this.wgsl?this.tex=this.makeTexture({ width:t,height:r }):this.tex.resize(t,r),this.width=t,this.height=r}tick (t){this.src!==null&&this.dynamic===!0&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.resizeTex(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.width&&this.resizeTex(this.src.width,this.src.height),this.wgsl?this.updateTextureWGSL():this.tex.subimage(this.src))}updateTextureWGSL (){if(!this.src)return;let t=this.width,r=this.height;if(this.src.videoWidth&&(t=this.src.videoWidth,r=this.src.videoHeight),!this.dynamic){this.oneShotDone||(this.wgsl.device.queue.copyExternalImageToTexture({ source:this.src,flipY:!0 },{ texture:this.tex },[t,r]),this.oneShotDone=!0);return}this.wgsl.device.queue.copyExternalImageToTexture({ source:this.src,flipY:!0 },{ texture:this.tex },[t,r])}getTexture (){return this.proxy?this.getProxiedTexture():this.wgsl?this.getTextureWGSL():this.tex}getTextureWGSL (){if(this.tex&&((this.lastTexture!==this.tex||!this.lastTextureView)&&(this.lastTextureView=this.tex.createView()),this.lastTextureView))return this.lastTextureView}getProxiedTexture (){return this.wgsl?this.offscreencanvas?(this.wgsl.device.queue.copyExternalImageToTexture({ source:this.offscreencanvas,flipY:!0 },{ texture:this.tex },[this.tex.width,this.tex.height]),this.getTextureWGSL()):this.tex.createView():this.tex}injectImage (t){this.offscreencanvas||this.activate(t.width,t.height),(this.tex.width!==t.width||this.tex.height!==t.height)&&this.activate(t.width,t.height),this.bmr.transferFromImageBitmap(t)}}const xr={};function Gp (e){if(typeof e=='object'){if('buttons'in e)return e.buttons;if('which'in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}else if('button'in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}}return 0}xr.buttons=Gp;function Vp (e){return e.target||e.srcElement||window}xr.element=Vp;function Up (e){return typeof e=='object'&&'pageX'in e?e.pageX:0}xr.x=Up;function zp (e){return typeof e=='object'&&'pageY'in e?e.pageY:0}xr.y=zp;function jp (e,t){t||(t=e,e=window);let r=0,i=0,n=0,o={ shift:!1,alt:!1,control:!1,meta:!1 },u=!1;function m (ze){let ot=!1;return'altKey'in ze&&(ot=ot||ze.altKey!==o.alt,o.alt=!!ze.altKey),'shiftKey'in ze&&(ot=ot||ze.shiftKey!==o.shift,o.shift=!!ze.shiftKey),'ctrlKey'in ze&&(ot=ot||ze.ctrlKey!==o.control,o.control=!!ze.ctrlKey),'metaKey'in ze&&(ot=ot||ze.metaKey!==o.meta,o.meta=!!ze.metaKey),ot}function _ (ze,ot){const pr=xr.x(ot),wt=xr.y(ot);'buttons'in ot&&(ze=ot.buttons|0),(ze!==r||pr!==i||wt!==n||m(ot))&&(r=ze|0,i=pr||0,n=wt||0,t&&t(r,i,n,o))}function P (ze){_(0,ze)}function k (){(r||i||n||o.shift||o.alt||o.meta||o.control)&&(i=n=0,r=0,o.shift=o.alt=o.control=o.meta=!1,t&&t(0,0,0,o))}function y (ze){m(ze)&&t&&t(r,i,n,o)}function T (ze){xr.buttons(ze)===0?_(0,ze):_(r,ze)}function ie (ze){_(r|xr.buttons(ze),ze)}function Ae (ze){_(r&~xr.buttons(ze),ze)}function Q (){u||(u=!0,e.addEventListener('mousemove',T),e.addEventListener('mousedown',ie),e.addEventListener('mouseup',Ae),e.addEventListener('mouseleave',P),e.addEventListener('mouseenter',P),e.addEventListener('mouseout',P),e.addEventListener('mouseover',P),e.addEventListener('blur',k),e.addEventListener('keyup',y),e.addEventListener('keydown',y),e.addEventListener('keypress',y),e!==window&&(window.addEventListener('blur',k),window.addEventListener('keyup',y),window.addEventListener('keydown',y),window.addEventListener('keypress',y)))}function Je (){u&&(u=!1,e.removeEventListener('mousemove',T),e.removeEventListener('mousedown',ie),e.removeEventListener('mouseup',Ae),e.removeEventListener('mouseleave',P),e.removeEventListener('mouseenter',P),e.removeEventListener('mouseout',P),e.removeEventListener('mouseover',P),e.removeEventListener('blur',k),e.removeEventListener('keyup',y),e.removeEventListener('keydown',y),e.removeEventListener('keypress',y),e!==window&&(window.removeEventListener('blur',k),window.removeEventListener('keyup',y),window.removeEventListener('keydown',y),window.removeEventListener('keypress',y)))}Q();const it={ element:e };return Object.defineProperties(it,{ enabled:{ get (){return u},set (ze){ze?Q():Je()},enumerable:!0 },buttons:{ get (){return r},enumerable:!0 },x:{ get (){return i},enumerable:!0 },y:{ get (){return n},enumerable:!0 },mods:{ get (){return o},enumerable:!0 } }),it}let Gn={ exports:{} },Wp=Gn.exports,ju;function Hp (){return ju||(ju=1,function (e,t){(function (r,i){e.exports=i()})(Wp,function (){function r (F,C,X){for(var D,se=0,Le=C.length;se<Le;se++)!D&&se in C||(D||(D=Array.prototype.slice.call(C,0,se)),D[se]=C[se]);return F.concat(D||Array.prototype.slice.call(C))}const i=Object.freeze({ __proto__:null,blackman (F){for(var C=new Float32Array(F),X=2*Math.PI/(F-1),D=2*X,se=0;se<F/2;se++)C[se]=.42-.5*Math.cos(se*X)+.08*Math.cos(se*D);for(se=Math.ceil(F/2);se>0;se--)C[F-se]=C[se-1];return C},hamming (F){for(var C=new Float32Array(F),X=0;X<F;X++)C[X]=.54-.46*Math.cos(2*Math.PI*(X/F-1));return C},hanning (F){for(var C=new Float32Array(F),X=0;X<F;X++)C[X]=.5-.5*Math.cos(2*Math.PI*X/(F-1));return C},sine (F){for(var C=Math.PI/(F-1),X=new Float32Array(F),D=0;D<F;D++)X[D]=Math.sin(C*D);return X} }),n={};function o (F){for(;F%2==0&&F>1;)F/=2;return F===1}function u (F,C){if(C!=='rect'){if(C!==''&&C||(C='hanning'),n[C]||(n[C]={}),!n[C][F.length])try{n[C][F.length]=i[C](F.length)}catch{throw new Error('Invalid windowing function')}F=function (X,D){for(var se=[],Le=0;Le<Math.min(X.length,D.length);Le++)se[Le]=X[Le]*D[Le];return se}(F,n[C][F.length])}return F}function m (F,C,X){for(var D=new Float32Array(F),se=0;se<D.length;se++)D[se]=se*C/X,D[se]=13*Math.atan(D[se]/1315.8)+3.5*Math.atan(Math.pow(D[se]/7518,2));return D}function _ (F){return Float32Array.from(F)}function P (F){return 1125*Math.log(1+F/700)}function k (F,C,X){for(var D,se=new Float32Array(F+2),Le=new Float32Array(F+2),je=C/2,Xe=P(0),Ge=(P(je)-Xe)/(F+1),De=new Array(F+2),Qe=0;Qe<se.length;Qe++)se[Qe]=Qe*Ge,Le[Qe]=(D=se[Qe],700*(Math.exp(D/1125)-1)),De[Qe]=Math.floor((X+1)*Le[Qe]/C);for(var Rt=new Array(F),Ke=0;Ke<Rt.length;Ke++){for(Rt[Ke]=new Array(X/2+1).fill(0),Qe=De[Ke];Qe<De[Ke+1];Qe++)Rt[Ke][Qe]=(Qe-De[Ke])/(De[Ke+1]-De[Ke]);for(Qe=De[Ke+1];Qe<De[Ke+2];Qe++)Rt[Ke][Qe]=(De[Ke+2]-Qe)/(De[Ke+2]-De[Ke+1])}return Rt}function y (F,C,X,D,se,Le,je){D===void 0&&(D=5),se===void 0&&(se=2),Le===void 0&&(Le=!0),je===void 0&&(je=440);const Xe=Math.floor(X/2)+1,Ge=new Array(X).fill(0).map(function (gt,It){return F*function (Pt,Jt){return Math.log2(16*Pt/Jt)}(C*It/X,je)});Ge[0]=Ge[1]-1.5*F;let De,Qe,Rt,Ke=Ge.slice(1).map(function (gt,It){return Math.max(gt-Ge[It])},1).concat([1]),Wt=Math.round(F/2),Dt=new Array(F).fill(0).map(function (gt,It){return Ge.map(function (Pt){return(10*F+Wt+Pt-It)%F-Wt})}),Gt=Dt.map(function (gt,It){return gt.map(function (Pt,Jt){return Math.exp(-.5*Math.pow(2*Dt[It][Jt]/Ke[Jt],2))})});if(Qe=(De=Gt)[0].map(function (){return 0}),Rt=De.reduce(function (gt,It){return It.forEach(function (Pt,Jt){gt[Jt]+=Math.pow(Pt,2)}),gt},Qe).map(Math.sqrt),Gt=De.map(function (gt,It){return gt.map(function (Pt,Jt){return Pt/(Rt[Jt]||1)})}),se){const Ci=Ge.map(function (gt){return Math.exp(-.5*Math.pow((gt/F-D)/se,2))});Gt=Gt.map(function (gt){return gt.map(function (It,Pt){return It*Ci[Pt]})})}return Le&&(Gt=r(r([],Gt.slice(3),!0),Gt.slice(0,3))),Gt.map(function (gt){return gt.slice(0,Xe)})}function T (F,C){for(var X=0,D=0,se=0;se<C.length;se++)X+=Math.pow(se,F)*Math.abs(C[se]),D+=C[se];return X/D}function ie (F){const C=F.ampSpectrum,X=F.barkScale,D=F.numberOfBarkBands,se=D===void 0?24:D;if(typeof C!='object'||typeof X!='object')throw new TypeError;let Le=se,je=new Float32Array(Le),Xe=0,Ge=C,De=new Int32Array(Le+1);De[0]=0;for(var Qe=X[Ge.length-1]/Le,Rt=1,Ke=0;Ke<Ge.length;Ke++)for(;X[Ke]>Qe;)De[Rt++]=Ke,Qe=Rt*X[Ge.length-1]/Le;for(De[Le]=Ge.length-1,Ke=0;Ke<Le;Ke++){for(var Wt=0,Dt=De[Ke];Dt<De[Ke+1];Dt++)Wt+=Ge[Dt];je[Ke]=Math.pow(Wt,.23)}for(Ke=0;Ke<je.length;Ke++)Xe+=je[Ke];return{ specific:je,total:Xe }}function Ae (F){const C=F.ampSpectrum;if(typeof C!='object')throw new TypeError;for(var X=new Float32Array(C.length),D=0;D<X.length;D++)X[D]=Math.pow(C[D],2);return X}function Q (F){const C=F.ampSpectrum,X=F.melFilterBank,D=F.bufferSize;if(typeof C!='object')throw new TypeError('Valid ampSpectrum is required to generate melBands');if(typeof X!='object')throw new TypeError('Valid melFilterBank is required to generate melBands');for(var se=Ae({ ampSpectrum:C }),Le=X.length,je=Array(Le),Xe=new Float32Array(Le),Ge=0;Ge<Xe.length;Ge++){je[Ge]=new Float32Array(D/2),Xe[Ge]=0;for(let De=0;De<D/2;De++)je[Ge][De]=X[Ge][De]*se[De],Xe[Ge]+=je[Ge][De];Xe[Ge]=Math.log(Xe[Ge]+1)}return Array.prototype.slice.call(Xe)}function Je (F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,'default')?F.default:F}let it=null,ze=Je(function (F,C){const X=F.length;return C=C||2,it&&it[X]||function (D){(it=it||{})[D]=new Array(D*D);for(let se=Math.PI/D,Le=0;Le<D;Le++)for(let je=0;je<D;je++)it[D][je+Le*D]=Math.cos(se*(je+.5)*Le)}(X),F.map(function (){return 0}).map(function (D,se){return C*F.reduce(function (Le,je,Xe,Ge){return Le+je*it[X][Xe+se*X]},0)})}),ot=Object.freeze({ __proto__:null,amplitudeSpectrum (F){return F.ampSpectrum},buffer (F){return F.signal},chroma (F){const C=F.ampSpectrum,X=F.chromaFilterBank;if(typeof C!='object')throw new TypeError('Valid ampSpectrum is required to generate chroma');if(typeof X!='object')throw new TypeError('Valid chromaFilterBank is required to generate chroma');const D=X.map(function (Le,je){return C.reduce(function (Xe,Ge,De){return Xe+Ge*Le[De]},0)}),se=Math.max.apply(Math,D);return se?D.map(function (Le){return Le/se}):D},complexSpectrum (F){return F.complexSpectrum},energy (F){const C=F.signal;if(typeof C!='object')throw new TypeError;for(var X=0,D=0;D<C.length;D++)X+=Math.pow(Math.abs(C[D]),2);return X},loudness:ie,melBands:Q,mfcc (F){const C=F.ampSpectrum,X=F.melFilterBank,D=F.numberOfMFCCCoefficients,se=F.bufferSize,Le=Math.min(40,Math.max(1,D||13));if(X.length<Le)throw new Error('Insufficient filter bank for requested number of coefficients');const je=Q({ ampSpectrum:C,melFilterBank:X,bufferSize:se });return ze(je).slice(0,Le)},perceptualSharpness (F){for(var C=ie({ ampSpectrum:F.ampSpectrum,barkScale:F.barkScale }),X=C.specific,D=0,se=0;se<X.length;se++)D+=se<15?(se+1)*X[se+1]:.066*Math.exp(.171*(se+1));return D*=.11/C.total},perceptualSpread (F){for(var C=ie({ ampSpectrum:F.ampSpectrum,barkScale:F.barkScale }),X=0,D=0;D<C.specific.length;D++)C.specific[D]>X&&(X=C.specific[D]);return Math.pow((C.total-X)/C.total,2)},powerSpectrum:Ae,rms (F){const C=F.signal;if(typeof C!='object')throw new TypeError;for(var X=0,D=0;D<C.length;D++)X+=Math.pow(C[D],2);return X/=C.length,X=Math.sqrt(X)},spectralCentroid (F){const C=F.ampSpectrum;if(typeof C!='object')throw new TypeError;return T(1,C)},spectralCrest (F){const C=F.ampSpectrum;if(typeof C!='object')throw new TypeError;let X=0,D=-1/0;return C.forEach(function (se){X+=Math.pow(se,2),D=se>D?se:D}),X/=C.length,X=Math.sqrt(X),D/X},spectralFlatness (F){const C=F.ampSpectrum;if(typeof C!='object')throw new TypeError;for(var X=0,D=0,se=0;se<C.length;se++)X+=Math.log(C[se]),D+=C[se];return Math.exp(X/C.length)*C.length/D},spectralFlux (F){const C=F.signal,X=F.previousSignal,D=F.bufferSize;if(typeof C!='object'||typeof X!='object')throw new TypeError;for(var se=0,Le=-D/2;Le<C.length/2-1;Le++)x=Math.abs(C[Le])-Math.abs(X[Le]),se+=(x+Math.abs(x))/2;return se},spectralKurtosis (F){const C=F.ampSpectrum;if(typeof C!='object')throw new TypeError;const X=C,D=T(1,X),se=T(2,X),Le=T(3,X),je=T(4,X);return(-3*Math.pow(D,4)+6*D*se-4*D*Le+je)/Math.pow(Math.sqrt(se-Math.pow(D,2)),4)},spectralRolloff (F){const C=F.ampSpectrum,X=F.sampleRate;if(typeof C!='object')throw new TypeError;for(var D=C,se=X/(2*(D.length-1)),Le=0,je=0;je<D.length;je++)Le+=D[je];for(var Xe=.99*Le,Ge=D.length-1;Le>Xe&&Ge>=0;)Le-=D[Ge],--Ge;return(Ge+1)*se},spectralSkewness (F){const C=F.ampSpectrum;if(typeof C!='object')throw new TypeError;const X=T(1,C),D=T(2,C),se=T(3,C);return(2*Math.pow(X,3)-3*X*D+se)/Math.pow(Math.sqrt(D-Math.pow(X,2)),3)},spectralSlope (F){const C=F.ampSpectrum,X=F.sampleRate,D=F.bufferSize;if(typeof C!='object')throw new TypeError;for(var se=0,Le=0,je=new Float32Array(C.length),Xe=0,Ge=0,De=0;De<C.length;De++){se+=C[De];const Qe=De*X/D;je[De]=Qe,Xe+=Qe*Qe,Le+=Qe,Ge+=Qe*C[De]}return(C.length*Ge-Le*se)/(se*(Xe-Math.pow(Le,2)))},spectralSpread (F){const C=F.ampSpectrum;if(typeof C!='object')throw new TypeError;return Math.sqrt(T(2,C)-Math.pow(T(1,C),2))},zcr (F){const C=F.signal;if(typeof C!='object')throw new TypeError;for(var X=0,D=1;D<C.length;D++)(C[D-1]>=0&&C[D]<0||C[D-1]<0&&C[D]>=0)&&X++;return X} });function pr (F){if(Array.isArray(F)){for(var C=0,X=Array(F.length);C<F.length;C++)X[C]=F[C];return X}return Array.from(F)}var wt={},Jr={},ar={ bitReverseArray (F){if(wt[F]===void 0){for(var C=(F-1).toString(2).length,X='0'.repeat(C),D={},se=0;se<F;se++){let Le=se.toString(2);Le=X.substr(Le.length)+Le,Le=[].concat(pr(Le)).reverse().join(''),D[se]=parseInt(Le,2)}wt[F]=D}return wt[F]},multiply (F,C){return{ real:F.real*C.real-F.imag*C.imag,imag:F.real*C.imag+F.imag*C.real }},add (F,C){return{ real:F.real+C.real,imag:F.imag+C.imag }},subtract (F,C){return{ real:F.real-C.real,imag:F.imag-C.imag }},euler (F,C){const X=-2*Math.PI*F/C;return{ real:Math.cos(X),imag:Math.sin(X) }},conj (F){return F.imag*=-1,F},constructComplexArray (F){const C={};C.real=F.real===void 0?F.slice():F.real.slice();const X=C.real.length;return Jr[X]===void 0&&(Jr[X]=Array.apply(null,Array(X)).map(Number.prototype.valueOf,0)),C.imag=Jr[X].slice(),C} },na=function (F){let C={};F.real===void 0||F.imag===void 0?C=ar.constructComplexArray(F):(C.real=F.real.slice(),C.imag=F.imag.slice());const X=C.real.length,D=Math.log2(X);if(Math.round(D)!=D)throw new Error('Input size must be a power of 2.');if(C.real.length!=C.imag.length)throw new Error('Real and imaginary components must have the same length.');for(var se=ar.bitReverseArray(X),Le={ real:[],imag:[] },je=0;je<X;je++)Le.real[se[je]]=C.real[je],Le.imag[se[je]]=C.imag[je];for(let Xe=0;Xe<X;Xe++)C.real[Xe]=Le.real[Xe],C.imag[Xe]=Le.imag[Xe];for(let Ge=1;Ge<=D;Ge++)for(let De=Math.pow(2,Ge),Qe=0;Qe<De/2;Qe++)for(let Rt=ar.euler(Qe,De),Ke=0;Ke<X/De;Ke++){const Wt=De*Ke+Qe,Dt=De*Ke+Qe+De/2,Gt={ real:C.real[Wt],imag:C.imag[Wt] },Ci={ real:C.real[Dt],imag:C.imag[Dt] },gt=ar.multiply(Rt,Ci),It=ar.subtract(Gt,gt);C.real[Dt]=It.real,C.imag[Dt]=It.imag;const Pt=ar.add(gt,Gt);C.real[Wt]=Pt.real,C.imag[Wt]=Pt.imag}return C},aa=na,sa=function (){function F (C,X){const D=this;if(this._m=X,!C.audioContext)throw this._m.errors.noAC;if(C.bufferSize&&!o(C.bufferSize))throw this._m._errors.notPow2;if(!C.source)throw this._m._errors.noSource;this._m.audioContext=C.audioContext,this._m.bufferSize=C.bufferSize||this._m.bufferSize||256,this._m.hopSize=C.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=C.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=C.callback,this._m.windowingFunction=C.windowingFunction||'hanning',this._m.featureExtractors=ot,this._m.EXTRACTION_STARTED=C.startImmediately||!1,this._m.channel=typeof C.channel=='number'?C.channel:0,this._m.inputs=C.inputs||1,this._m.outputs=C.outputs||1,this._m.numberOfMFCCCoefficients=C.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=C.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=C.featureExtractors||[],this._m.barkScale=m(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=k(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(C.source),this._m.spn.onaudioprocess=function (se){let Le;D._m.inputData!==null&&(D._m.previousInputData=D._m.inputData),D._m.inputData=se.inputBuffer.getChannelData(D._m.channel),D._m.previousInputData?((Le=new Float32Array(D._m.previousInputData.length+D._m.inputData.length-D._m.hopSize)).set(D._m.previousInputData.slice(D._m.hopSize)),Le.set(D._m.inputData,D._m.previousInputData.length-D._m.hopSize)):Le=D._m.inputData;const je=function (Xe,Ge,De){if(Xe.length<Ge)throw new Error('Buffer is too short for frame length');if(De<1)throw new Error('Hop length cannot be less that 1');if(Ge<1)throw new Error('Frame length cannot be less that 1');const Qe=1+Math.floor((Xe.length-Ge)/De);return new Array(Qe).fill(0).map(function (Rt,Ke){return Xe.slice(Ke*De,Ke*De+Ge)})}(Le,D._m.bufferSize,D._m.hopSize);je.forEach(function (Xe){D._m.frame=Xe;const Ge=D._m.extract(D._m._featuresToExtract,D._m.frame,D._m.previousFrame);typeof D._m.callback=='function'&&D._m.EXTRACTION_STARTED&&D._m.callback(Ge),D._m.previousFrame=D._m.frame})}}return F.prototype.start=function (C){this._m._featuresToExtract=C||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},F.prototype.stop=function (){this._m.EXTRACTION_STARTED=!1},F.prototype.setSource=function (C){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=C,this._m.source.connect(this._m.spn)},F.prototype.setChannel=function (C){C<=this._m.inputs?this._m.channel=C:console.error('Channel '.concat(C," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(C,' when instantiating the MeydaAnalyzer'))},F.prototype.get=function (C){return this._m.inputData?this._m.extract(C||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},F}(),Ai={ audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:'hanning',featureExtractors:ot,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:u,_errors:{ notPow2:new Error('Meyda: Buffer size must be a power of 2, e.g. 64 or 512'),featureUndef:new Error('Meyda: No features defined.'),invalidFeatureFmt:new Error('Meyda: Invalid feature format'),invalidInput:new Error('Meyda: Invalid input.'),noAC:new Error('Meyda: No AudioContext specified.'),noSource:new Error('Meyda: No source node specified.') },createMeydaAnalyzer (F){return new sa(F,Object.assign({},Ai))},listAvailableFeatureExtractors (){return Object.keys(this.featureExtractors)},extract (F,C,X){const D=this;if(!C)throw this._errors.invalidInput;if(typeof C!='object')throw this._errors.invalidInput;if(!F)throw this._errors.featureUndef;if(!o(C.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=m(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=k(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=y(this.chromaBands,this.sampleRate,this.bufferSize)),'buffer'in C&&C.buffer===void 0?this.signal=_(C):this.signal=C;const se=Ti(C,this.windowingFunction,this.bufferSize);if(this.signal=se.windowedSignal,this.complexSpectrum=se.complexSpectrum,this.ampSpectrum=se.ampSpectrum,X){const Le=Ti(X,this.windowingFunction,this.bufferSize);this.previousSignal=Le.windowedSignal,this.previousComplexSpectrum=Le.complexSpectrum,this.previousAmpSpectrum=Le.ampSpectrum}const je=function (Xe){return D.featureExtractors[Xe]({ ampSpectrum:D.ampSpectrum,chromaFilterBank:D.chromaFilterBank,complexSpectrum:D.complexSpectrum,signal:D.signal,bufferSize:D.bufferSize,sampleRate:D.sampleRate,barkScale:D.barkScale,melFilterBank:D.melFilterBank,previousSignal:D.previousSignal,previousAmpSpectrum:D.previousAmpSpectrum,previousComplexSpectrum:D.previousComplexSpectrum,numberOfMFCCCoefficients:D.numberOfMFCCCoefficients,numberOfBarkBands:D.numberOfBarkBands })};if(typeof F=='object')return F.reduce(function (Xe,Ge){let De;return Object.assign({},Xe,((De={})[Ge]=je(Ge),De))},{});if(typeof F=='string')return je(F);throw this._errors.invalidFeatureFmt} },Ti=function (F,C,X){const D={};F.buffer===void 0?D.signal=_(F):D.signal=F,D.windowedSignal=u(D.signal,C),D.complexSpectrum=aa(D.windowedSignal),D.ampSpectrum=new Float32Array(X/2);for(let se=0;se<X/2;se++)D.ampSpectrum[se]=Math.sqrt(Math.pow(D.complexSpectrum.real[se],2)+Math.pow(D.complexSpectrum.imag[se],2));return D};return typeof window<'u'&&(window.Meyda=Ai),Ai})}(Gn)),Gn.exports}const qp=Hp();const $p=Qn(qp);class dl{constructor ({ numBins:t=4,cutoff:r=2,smooth:i=.4,max:n=15,scale:o=10,isDrawing:u=!1,parentEl:m=document.body }){this.vol=0,this.scale=o,this.max=n,this.cutoff=r,this.smooth=i,this.setBins(t),this.beat={ holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0 },this.onBeat=()=>{},this.canvas=document.createElement('canvas'),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width='100px',this.canvas.style.height='80px',this.canvas.style.position='absolute',this.canvas.style.right='0px',this.canvas.style.bottom='0px',m.appendChild(this.canvas),this.isDrawing=u,this.ctx=this.canvas.getContext('2d'),this.ctx.fillStyle='#DFFFFF',this.ctx.strokeStyle='#0ff',this.ctx.lineWidth=.5,window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia({ video:!1,audio:!0 }).then(_=>{this.stream=_,this.context=new AudioContext;const P=this.context.createMediaStreamSource(_);this.meyda=$p.createMeydaAnalyzer({ audioContext:this.context,source:P,featureExtractors:['loudness'] })}).catch(_=>console.log('ERROR',_))}destroy (){this.context&&(this.context.close(),this.context=void 0,this.meyda&&(this.meyda=void 0))}detectBeat (t){t>this.beat._cutoff&&t>this.beat.threshold?(this.onBeat(),this.beat._cutoff=t*1.2,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick (){if(this.meyda){const t=this.meyda.get();if(t&&t!==null){this.vol=t.loudness.total,this.detectBeat(this.vol);const r=(n,o)=>n+o;const i=Math.floor(t.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map((n,o)=>t.loudness.specific.slice(o*i,(o+1)*i).reduce(r)).map((n,o)=>n*(1-this.settings[o].smooth)+this.prevBins[o]*this.settings[o].smooth),this.fft=this.bins.map((n,o)=>Math.max(0,(n-this.settings[o].cutoff)/this.settings[o].scale)),this.isDrawing&&this.draw()}}}setCutoff (t){this.cutoff=t,this.settings=this.settings.map(r=>(r.cutoff=t,r))}setSmooth (t){this.smooth=t,this.settings=this.settings.map(r=>(r.smooth=t,r))}setBins (t){this.bins=Array(t).fill(0),this.prevBins=Array(t).fill(0),this.fft=Array(t).fill(0),this.settings=Array(t).fill(0).map(()=>({ cutoff:this.cutoff,scale:this.scale,smooth:this.smooth })),this.bins.forEach((r,i)=>{window['a'+i]=(n=1,o=0)=>()=>a.fft[i]*n+o})}setScale (t){this.scale=t,this.settings=this.settings.map(r=>(r.scale=t,r))}setMax (t){this.max=t,console.log('set max is deprecated')}hide (){this.isDrawing=!1,this.canvas.style.display='none'}show (){this.isDrawing=!0,this.canvas.style.display='block'}draw (){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.canvas.width/this.bins.length,r=this.canvas.height/(this.max*2);this.bins.forEach((i,n)=>{const o=i*r;this.ctx.fillRect(n*t,this.canvas.height-o,t,o);const u=this.canvas.height-r*this.settings[n].cutoff;this.ctx.beginPath(),this.ctx.moveTo(n*t,u),this.ctx.lineTo((n+1)*t,u),this.ctx.stroke();const m=this.canvas.height-r*(this.settings[n].scale+this.settings[n].cutoff);this.ctx.beginPath(),this.ctx.moveTo(n*t,m),this.ctx.lineTo((n+1)*t,m),this.ctx.stroke()})}}class Xp{constructor (t){this.mediaSource=new MediaSource,this.stream=t,this.output=document.createElement('video'),this.output.autoplay=!0,this.output.loop=!0;const r=this;this.mediaSource.addEventListener('sourceopen',()=>{console.log('MediaSource opened'),r.sourceBuffer=r.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log('Source buffer: ',sourceBuffer)})}start (){let t={ mimeType:'video/webm;codecs=vp9' };this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,t)}catch(r){console.log('Unable to create MediaRecorder with options Object: ',r);try{t={ mimeType:'video/webm,codecs=vp9' },this.mediaRecorder=new MediaRecorder(this.stream,t)}catch(i){console.log('Unable to create MediaRecorder with options Object: ',i);try{t='video/vp8',this.mediaRecorder=new MediaRecorder(this.stream,t)}catch(n){alert(`MediaRecorder is not supported by this browser.

Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.`),console.error('Exception while creating MediaRecorder:',n);return}}}console.log('Created MediaRecorder',this.mediaRecorder,'with options',t),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log('MediaRecorder started',this.mediaRecorder)}stop (){this.mediaRecorder.stop()}_handleStop (){const t=new Blob(this.recordedBlobs,{ type:this.mediaRecorder.mimeType }),r=window.URL.createObjectURL(t);this.output.src=r;const i=document.createElement('a');i.style.display='none',i.href=r;const n=new Date;i.download=`hydra-${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}-${n.getHours()}.${n.getMinutes()}.${n.getSeconds()}.webm`,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(r)},300)}_handleDataAvailable (t){t.data&&t.data.size>0&&this.recordedBlobs.push(t.data)}}const os={ linear (e){return e},easeInQuad (e){return e*e},easeOutQuad (e){return e*(2-e)},easeInOutQuad (e){return e<.5?2*e*e:-1+(4-2*e)*e},easeInCubic (e){return e*e*e},easeOutCubic (e){return--e*e*e+1},easeInOutCubic (e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart (e){return e*e*e*e},easeOutQuart (e){return 1- --e*e*e*e},easeInOutQuart (e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint (e){return e*e*e*e*e},easeOutQuint (e){return 1+--e*e*e*e*e},easeInOutQuint (e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},sin (e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2} };const Yp=(e,t,r,i,n)=>(e-t)*(n-i)/(r-t)+i;const ml={ init:()=>{Array.prototype.fast=function (e=1){return this._speed=e,this},Array.prototype.smooth=function (e=1){return this._smooth=e,this},Array.prototype.ease=function (e='linear'){return typeof e=='function'?(this._smooth=1,this._ease=e):os[e]&&(this._smooth=1,this._ease=os[e]),this},Array.prototype.offset=function (e=.5){return this._offset=e%1,this},Array.prototype.fit=function (e=0,t=1){const r=Math.min(...this),i=Math.max(...this);const n=this.map(o=>Yp(o,r,i,e,t));return n._speed=this._speed,n._smooth=this._smooth,n._ease=this._ease,n}},getValue:(e=[])=>({ time:t,bpm:r })=>{const i=e._speed?e._speed:1,n=e._smooth?e._smooth:0,o=t*i*(r/60)+(e._offset||0);if(n!==0){const u=e._ease?e._ease:os.linear,m=o-n/2,_=e[Math.floor(m%e.length)],P=e[Math.floor((m+1)%e.length)],k=Math.min(m%1/n,1);return u(k)*(P-_)+_}else return e[Math.floor(o%e.length)],e[Math.floor(o%e.length)]} },Kp=e=>{let t='',r=n(t),i=(o,u)=>{t+=`
      var ${o} = ${u}
    `,r=n(t)};return{ addToContext:i,eval:o=>r.eval(o) };function n (o){globalThis.eval(o);const u=function (m){globalThis.eval(m)};return{ eval:u }}};class us{constructor (t,r,i=[]){this.makeGlobal=r,this.sandbox=Kp(),this.parent=t;const n=Object.keys(t);n.forEach(o=>this.add(o)),this.userProps=i}add (t){this.makeGlobal&&(window[t]=this.parent[t])}set (t,r){this.makeGlobal&&(window[t]=r),this.parent[t]=r}tick (){this.makeGlobal&&this.userProps.forEach(t=>{this.parent[t]=window[t]})}eval (t){this.sandbox.eval(t)}}const Qp={ float:{ vec4:{ name:'sum',args:[[1,1,1,1]] },vec2:{ name:'sum',args:[[1,1]] } } },ls=e=>(e=e.toString(),e.indexOf('.')<0&&(e+='.'),e);function Zp (e,t,r){const i=e.transform.inputs,n=e.userArgs,{ generators:o }=e.synth,{ src:u }=o;return i.map((m,_)=>{const P={ value:m.default,type:m.type,isUniform:!1,name:m.name,vecLen:0 };if(P.type==='float'&&(P.value=ls(m.default)),m.type.startsWith('vec'))try{P.vecLen=Number.parseInt(m.type.substr(3))}catch{console.log(`Error determining length of vector input type ${m.type} (${m.name})`)}if(n.length>_&&(P.value=n[_],typeof n[_]=='function'?(P.value=(T,ie,Ae)=>{try{const Q=n[_](ie);return typeof Q=='number'?Q:(console.warn('function does not return a number',n[_]),m.default)}catch(Q){return console.warn('ERROR',Q),m.default}},P.isUniform=!0):n[_].constructor===Array&&(P.value=(T,ie,Ae)=>ml.getValue(n[_])(ie),P.isUniform=!0)),!(t<0)){if(P.value&&P.value.transforms){const T=P.value.transforms[P.value.transforms.length-1];if(T.transform.glsl_return_type!==m.type){const ie=Qp[m.type];if(typeof ie<'u'){const Ae=ie[T.transform.glsl_return_type];if(typeof Ae<'u'){const{ name:Q,args:Je }=Ae;P.value=P.value[Q](...Je)}}}P.isUniform=!1}else if(P.type==='float'&&typeof P.value=='number')P.value=ls(P.value);else if(P.type.startsWith('vec')&&typeof P.value=='object'&&Array.isArray(P.value))P.isUniform=!1,P.value=`${P.type}(${P.value.map(ls).join(', ')})`;else if(m.type==='sampler2D'){const k=P.value;P.value=()=>k.getTexture(),P.isUniform=!0}else if(P.value.getTexture&&m.type==='vec4'){const y=P.value;P.value=u(y),P.isUniform=!1}P.isUniform&&(P.name+=t)}return P})}function Jp (e,t){const r={ uniforms:[],glslFunctions:[],fragColor:'',wgsl:t&&t.isWGSL },i=zn(e,r)('st');r.fragColor=i;const n={};return r.uniforms.forEach(o=>n[o.name]=o),r.uniforms=Object.values(n),r}function zn (e,t){let r=()=>'';return e.forEach(i=>{const n=Zp(i,t.uniforms.length);n.forEach(m=>{m.isUniform&&t.uniforms.push(m)}),ed(i,t.glslFunctions)||t.glslFunctions.push(i);const o=r;if(i.transform.type==='src')if(t.wgsl&&n[0].type==='sampler2D'){const m=n[0].name,_='samp'+m;r=P=>`textureSample( ${m}, ${_}, fract(${P}))`}else r=m=>`${qi(m,i.name,n,t)}`;else if(i.transform.type==='coord')r=m=>`${o(`${qi(m,i.name,n,t)}`)}`;else if(i.transform.type==='color')r=m=>`${qi(`${o(m)}`,i.name,n,t)}`;else if(i.transform.type==='combine'){var u=n[0].value&&n[0].value.transforms?m=>`${zn(n[0].value.transforms,t)(m)}`:n[0].isUniform?()=>n[0].name:()=>n[0].value;r=m=>`${qi(`${o(m)}, ${u(m)}`,i.name,n.slice(1),t)}`}else if(i.transform.type==='combineCoord'){var u=n[0].value&&n[0].value.transforms?_=>`${zn(n[0].value.transforms,t)(_)}`:n[0].isUniform?()=>n[0].name:()=>n[0].value;r=_=>`${o(`${qi(`${_}, ${u(_)}`,i.name,n.slice(1),t)}`)}`}}),r}function qi (e,t,r,i){const n=r.map(o=>o.isUniform?i.wgsl?'uf.'+o.name:o.name:o.value&&o.value.transforms?`${zn(o.value.transforms,i)('st')}`:o.value).reduce((o,u)=>`${o}, ${u}`,'');return`${t}(${e}${n})`}function ed (e,t){for(let r=0;r<t.length;r++)if(e.name==t[r].name)return!0;return!1}function td (e){return typeof e=='object'&&!Array.isArray(e)&&e!==null}function Wu (e){return!!e&&e.constructor===Array}function rd (e){return typeof e=='function'}class id{constructor (t,r,i){this.glslSource=t,this.output=r,this.hydra=i,this.outs=[],this.depth=0}gen (t){for(let r=0;r<t.length;++r){const i=t[r];r>0&&this.outs.push('.'),this.outs.push(i.name),this.outs.push('(');const n=i.userArgs;if(n&&n.length>0)for(let o=0;o<n.length;++o){const u=n[o];if(o>0&&this.outs.push(','),rd(u))this.outs.push(u.toString());else if(typeof u=='string'||u instanceof String)this.outs.push(u);else if(td(u))u instanceof pl?this.outs.push(u.label):(u instanceof xi||u instanceof Fr||u instanceof ll)&&(this.depth++,Wu(u.transforms)?this.gen(u.transforms):this.outs.push(u.label),this.depth--);else if(typeof u=='number'&&!isNaN(u))this.outs.push(u);else if(Wu(u)){this.outs.push('[');for(let m=0;m<u.length;++m)m>0&&this.outs.push(', '),this.outs.push(u[m]);this.outs.push(']')}else console.log('Unknown item type used in arglist '+u),this.outs.push(u)}this.outs.push(')')}}generate (){const t=this.glslSource.transforms;return this.gen(t),this.outs.push('.out('),this.output.label!=='o0'&&this.outs.push(this.output.label),this.outs.push(');'),this.outs.join('')}}function nd (e,t){const r=t.hydraSynth;if(r.regen)try{const i=new id(e,t,r),n=i.generate();r.noteRegenString(i.output.chanNum,n)}catch(i){console.log(i)}}const ad={ _luminance:{ type:'util',glsl:`float _luminance(vec3 rgb){
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }` },_noise:{ type:'util',glsl:`
    //	Simplex 3D Noise
    //	by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

  float _noise(vec3 v){
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    vec3 x1 = x0 - i1 + 1.0 * C.xxx;
    vec3 x2 = x0 - i2 + 2.0 * C.xxx;
    vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i = mod(i, 289.0 );
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    float n_ = 1.0/7.0; // N=7
    vec3  ns = n_ * D.wyz - D.xzx;

    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);

    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );

    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));

    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);

  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }
    ` },_rgbToHsv:{ type:'util',glsl:`vec3 _rgbToHsv(vec3 c){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }` },_hsvToRgb:{ type:'util',glsl:`vec3 _hsvToRgb(vec3 c){
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }` } },sd={ _mod:{ type:'util',wgsl:`fn _mod(x : f32, y: f32) -> f32 {
				return x - y * floor(x / y);
    }` },_luminance:{ type:'util',wgsl:`fn _luminance(rgb : vec3<f32>) -> f32 {
      const  W = vec3<f32>(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }` },_noise:{ type:'util',wgsl:`
  fn mod4v(x : vec4<f32>, y : f32) -> vec4<f32> {
  		return x - y * floor (x / y); // exact match for glsl
  		// return x % y; // wgsl uses trunc instead of floor.
  }

// vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  fn permute(xp :vec4<f32>)->vec4<f32> {
  		return  mod4v(((xp*34.0)+1.0)*xp, 289.0);
  	}

  fn taylorInvSqrt(r: vec4<f32>)->vec4<f32>{return 1.79284291400159 - 0.85373472095314 * r;}

  fn _noise(v: vec3<f32>)-> f32 {
    const  C = vec2<f32>(1.0/6.0, 1.0/3.0) ;
    const  D = vec4<f32>(0.0, 0.5, 1.0, 2.0);

  // First corner
    var i : vec3<f32> = floor(v + dot(v, C.yyy) );
    let x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    let g = step(x0.yzx, x0.xyz);
    let l = 1.0 - g;
    let i1 = min( g.xyz, l.zxy );
    let i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    let x1 = x0 - i1 + 1.0 * C.xxx;
    let x2 = x0 - i2 + 2.0 * C.xxx;
    let x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i.x = i.x % 289.0;
    i.y = i.y % 289.0;
    i.z = i.z % 289.0;
    let p = permute( permute( permute(
               i.z + vec4<f32>(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4<f32>(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4<f32>(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    let n_ = 1.0/7.0; // N=7
    let ns = n_ * D.wyz - D.xzx;

    let j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    let x_ = floor(j * ns.z);
    let y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    let x = x_ *ns.x + ns.yyyy;
    let y = y_ *ns.x + ns.yyyy;
    let h = 1.0 - abs(x) - abs(y);

    let b0 = vec4<f32>( x.xy, y.xy );
    let b1 = vec4<f32>( x.zw, y.zw );

    let s0 = floor(b0)*2.0 + 1.0;
    let s1 = floor(b1)*2.0 + 1.0;
    let sh = -step(h, vec4<f32>(0.0));

    let a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    let a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    var p0 = vec3<f32>(a0.xy,h.x);
    var p1 = vec3<f32>(a0.zw,h.y);
    var p2 = vec3<f32>(a1.xy,h.z);
    var p3 = vec3<f32>(a1.zw,h.w);

  //Normalise gradients
    let norm = taylorInvSqrt(vec4<f32>(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

    var m = max(0.6 - vec4<f32>(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), vec4<f32>(0.0));
    m = m * m;

    return 42.0 * dot( m*m, vec4<f32>( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }` },_rgbToHsv:{ type:'util',wgsl:`fn _rgbToHsv(c: vec3<f32>) -> vec3<f32> {
            let K = vec4<f32>(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            let p = mix(vec4<f32>(c.bg, K.wz), vec4<f32>(c.gb, K.xy), step(c.b, c.g));
            let q = mix(vec4<f32>(p.xyw, c.r), vec4<f32>(c.r, p.yzx), step(p.x, c.r));

            let d = q.x - min(q.w, q.y);
            let e = 1.0e-10;
            return vec3<f32>(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }` },_hsvToRgb:{ type:'util',wgsl:`fn _hsvToRgb(c: vec3<f32>) -> vec3<f32> {
        let K = vec4<f32>(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        let p : vec3<f32> = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        let cv : vec3<f32> = p - K.xxx;
        let cvmin =  vec3<f32>(0.0, 0.0, 0.0);
        let cvmax =  vec3<f32>(1.0, 1.0, 1.0);
        return  vec3<f32> (c.z * mix(K.xxx, clamp(cv, cvmin, cvmax), c.y));
    }` } };var xi=function (e){return this.transforms=[],this.transforms.push(e),this.defaultOutput=e.defaultOutput,this.synth=e.synth,this.type='GlslSource',this.defaultUniforms=e.defaultUniforms,this.isWGSL=e.synth.isWGSL,this};xi.prototype.addTransform=function (e){this.transforms.push(e)};xi.prototype.out=function (e){const t=e||this.defaultOutput,r=this.glsl(t);if(this.synth.currentFunctions=[],t)try{t.render(r)}catch(i){console.log('shader could not compile',i)}nd(this,t)};xi.prototype.glsl=function (){const e=[],t=[];return this.transforms.forEach(r=>{r.transform.type==='renderpass'?console.warn('no support for renderpass'):t.push(r)}),t.length>0&&e.push(this.compile(t)),e};xi.prototype.compile=function (e){const t=Jp(e,this.synth),r={};t.uniforms.forEach(n=>{r[n.name]=n.value});let i;return this.isWGSL?i=`${Object.values(sd).map(n=>`
            ${n.wgsl}
          `).join('')}

 ${t.glslFunctions.map(n=>this.isWGSL&&n.transform.strange?'':`
            ${n.transform.wgsl}
          `).join('')}

  @fragment
  	 fn main(ourIn: VertexOutput) -> @location(0) vec4<f32> {
     let c : vec4<f32> = vec4<f32>(1.0, 0.0, 0.0, 1);
     let st : vec2<f32> = ourIn.position.xy / resolution.xy;
     return ${t.fragColor};
  }
		`:i=`
  precision ${this.defaultOutput.precision} float;
  ${Object.values(t.uniforms).map(n=>{let o=n.type;switch(n.type){case'texture':o='sampler2D';break}return`
      uniform ${o} ${n.name};`}).join('')}
  uniform float time;
  uniform vec2 resolution;
  varying vec2 uv;
  uniform sampler2D prevBuffer;

  ${Object.values(ad).map(n=>`
            ${n.glsl}
          `).join('')}

  ${t.glslFunctions.map(n=>`
            ${n.transform.glsl}
          `).join('')}

  void main () {
    vec4 c = vec4(1, 0, 0, 1);
    vec2 st = gl_FragCoord.xy/resolution.xy;
    gl_FragColor = ${t.fragColor};
  }
  `,{ frag:i,uniforms:Object.assign({},this.defaultUniforms,r) }};const od=()=>[{ name:'noise',type:'src',inputs:[{ type:'float',name:'scale',default:10 },{ type:'float',name:'offset',default:.1 }],glsl:'   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);',wgsl:'   return vec4<f32>(vec3<f32>(_noise(vec3(_st*scale, offset*time))), 1.0);',needs:['_noise'] },{ name:'voronoi',type:'src',inputs:[{ type:'float',name:'scale',default:5 },{ type:'float',name:'speed',default:.3 },{ type:'float',name:'blending',default:.3 }],glsl:`   vec3 color = vec3(.0);
   // Scale
   _st *= scale;
   // Tile the space
   vec2 i_st = floor(_st);
   vec2 f_st = fract(_st);
   float m_dist = 10.;  // minimun distance
   vec2 m_point;        // minimum point
   for (int j=-1; j<=1; j++ ) {
   for (int i=-1; i<=1; i++ ) {
   vec2 neighbor = vec2(float(i),float(j));
   vec2 p = i_st + neighbor;
   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   vec2 diff = neighbor + point - f_st;
   float dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color += dot(m_point,vec2(.3,.6));
   color *= 1.0 - blending*m_dist;
   return vec4(color, 1.0);`,wgsl:`
	 var color = vec3<f32>(.0);
   // Scale
   var st = _st * scale;
   // Tile the space
   let i_st = floor(st);
   let f_st = fract(st);
   var m_dist : f32 = 10.;  // minimun distance
   var m_point : vec2<f32>; // minimum point
   for (var j=-1; j<=1; j++ ) {
   for (var i=-1; i<=1; i++ ) {
   var neighbor = vec2<f32>(f32(i),f32(j));
   var p = i_st + neighbor;
   var point = fract(sin(vec2<f32>(dot(p,vec2<f32>(127.1,311.7)),dot(p,vec2<f32>(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   let diff = neighbor + point - f_st;
   let dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color = color + dot(m_point,vec2<f32>(.3,.6));
   color = color * (1.0 - blending*m_dist);
 return vec4<f32>(color, 1.0);
` },{ name:'osc',type:'src',inputs:[{ type:'float',name:'frequency',default:60 },{ type:'float',name:'sync',default:.1 },{ type:'float',name:'offset',default:0 }],glsl:`   vec2 st = _st;
   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;
   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   return vec4(r, g, b, 1.0);`,wgsl:`  var st = vec2<f32>(_st);
   let r = f32(sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5);
   let g = f32(sin((st.x+time*sync)*frequency)*0.5 + 0.5);
   let b = f32(sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5);
   return vec4<f32>(r, g, b, 1.0);` },{ name:'shape',type:'src',inputs:[{ type:'float',name:'sides',default:3 },{ type:'float',name:'radius',default:.3 },{ type:'float',name:'smoothing',default:.01 }],glsl:`   vec2 st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   float a = atan(st.x,st.y)+3.1416;
   float r = (2.*3.1416)/sides;
   float d = cos(floor(.5+a/r)*r-a)*length(st);
   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);`,wgsl:`  var st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   let a = f32(atan2(st.x,st.y)+3.1416);
   let r = f32((2.*3.1416)/sides);
   let d = f32(cos(floor(.5+a/r)*r-a)*length(st));
   return vec4<f32>(vec3<f32>(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);` },{ name:'gradient',type:'src',inputs:[{ type:'float',name:'speed',default:0 }],glsl:'   return vec4(_st, sin(time*speed), 1.0);',wgsl:'   return vec4<f32>(_st, sin(time*speed), 1.0);' },{ name:'src',type:'src',inputs:[{ type:'sampler2D',name:'tex',default:NaN }],strange:!0,glsl:`   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);
   return texture2D(tex, fract(_st));`,wgsl:`
//		return texture2D(tex, fract(_st));` },{ name:'solid',type:'src',inputs:[{ type:'float',name:'r',default:0 },{ type:'float',name:'g',default:0 },{ type:'float',name:'b',default:0 },{ type:'float',name:'a',default:1 }],glsl:'   return vec4(r, g, b, a);',wgsl:'   return vec4<f32>(r, g, b, a);' },{ name:'rotate',type:'coord',inputs:[{ type:'float',name:'angle',default:10 },{ type:'float',name:'speed',default:0 }],glsl:`   vec2 xy = _st - vec2(0.5);
   float ang = angle + speed *time;
   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy += 0.5;
   return xy;`,wgsl:`  var xy = _st - vec2<f32>(0.5);
   let ang = f32(angle + speed *time);
   xy = mat2x2<f32>(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy = xy + 0.5;
   return xy;` },{ name:'scale',type:'coord',inputs:[{ type:'float',name:'amount',default:1.5 },{ type:'float',name:'xMult',default:1 },{ type:'float',name:'yMult',default:1 },{ type:'float',name:'offsetX',default:.5 },{ type:'float',name:'offsetY',default:.5 }],glsl:`   vec2 xy = _st - vec2(offsetX, offsetY);
   xy*=(1.0/vec2(amount*xMult, amount*yMult));
   xy+=vec2(offsetX, offsetY);
   return xy;
   `,wgsl:`  var xy = _st - vec2<f32>(offsetX, offsetY);
   xy = xy * (1.0/vec2<f32>(amount*xMult, amount*yMult));
   xy = xy + vec2<f32>(offsetX, offsetY);
   return xy;
   ` },{ name:'pixelate',type:'coord',inputs:[{ type:'float',name:'pixelX',default:20 },{ type:'float',name:'pixelY',default:20 }],glsl:`   vec2 xy = vec2(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;`,wgsl:`  let xy = vec2<f32>(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;` },{ name:'posterize',type:'color',inputs:[{ type:'float',name:'bins',default:3 },{ type:'float',name:'gamma',default:.6 }],glsl:`   vec4 c2 = pow(_c0, vec4(gamma));
   c2 *= vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4(1.0/gamma));
   return vec4(c2.xyz, _c0.a);`,wgsl:`  var c2 : vec4<f32> = pow(_c0, vec4<f32>(gamma));
   c2 = c2 * vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4<f32>(1.0/gamma));
   return vec4<f32>(c2.xyz, _c0.a);` },{ name:'shift',type:'color',inputs:[{ type:'float',name:'r',default:.5 },{ type:'float',name:'g',default:0 },{ type:'float',name:'b',default:0 },{ type:'float',name:'a',default:0 }],glsl:`   vec4 c2 = vec4(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4(c2.rgba);`,wgsl:`  var c2 = vec4<f32>(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4<f32>(c2.rgba);` },{ name:'repeat',type:'coord',inputs:[{ type:'float',name:'repeatX',default:3 },{ type:'float',name:'repeatY',default:3 },{ type:'float',name:'offsetX',default:0 },{ type:'float',name:'offsetY',default:0 }],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) * offsetX;
   st.y += step(1., mod(st.x,2.0)) * offsetY;
   return fract(st);`,wgsl:`  var st = _st * vec2<f32>(repeatX, repeatY);
   st.x = st.x + (step(1., _mod(st.y, 2.0)) * offsetX);
   st.y = st.y + (step(1., _mod(st.x, 2.0)) * offsetY);
   return fract(st);` },{ name:'modulateRepeat',type:'combineCoord',inputs:[{ type:'float',name:'repeatX',default:3 },{ type:'float',name:'repeatY',default:3 },{ type:'float',name:'offsetX',default:.5 },{ type:'float',name:'offsetY',default:.5 }],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;
   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;
   return fract(st);`,wgsl:`  var st = _st * vec2<f32>(repeatX, repeatY);
   st.x = st.x + (step(1., _mod(st.y, 2.0)) + _c0.r * offsetX);
   st.y = st.y + (step(1., _mod(st.x, 2.0)) + _c0.g * offsetY);
   return fract(st);` },{ name:'repeatX',type:'coord',inputs:[{ type:'float',name:'reps',default:3 },{ type:'float',name:'offset',default:0 }],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0))* offset;
   return fract(st);`,wgsl:`   var st = _st * vec2<f32>(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y = st.y + (step(1., _mod(st.x, 2.0))* offset);
   return fract(st);` },{ name:'modulateRepeatX',type:'combineCoord',inputs:[{ type:'float',name:'reps',default:3 },{ type:'float',name:'offset',default:.5 }],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;
   return fract(st);`,wgsl:`  var st = _st * vec2<f32>(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y = st.y + (step(1., _mod(st.x, 2.0)) + _c0.r * offset);
   return fract(st);` },{ name:'repeatY',type:'coord',inputs:[{ type:'float',name:'reps',default:3 },{ type:'float',name:'offset',default:0 }],glsl:`   vec2 st = _st * vec2(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0))* offset;
   return fract(st);`,wgsl:`   var st = _st * vec2<f32>(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x = st.x + (step(1., _mod(st.y, 2.0))* offset);
   return fract(st);` },{ name:'modulateRepeatY',type:'combineCoord',inputs:[{ type:'float',name:'reps',default:3 },{ type:'float',name:'offset',default:.5 }],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;
   return fract(st);`,wgsl:`   var st = _st * vec2<f32>(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x = st.x + (step(1., _mod(st.y,2.0)) + _c0.r * offset);
   return fract(st);` },{ name:'kaleid',type:'coord',inputs:[{ type:'float',name:'nSides',default:4 }],glsl:`   vec2 st = _st;
   st -= 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2(cos(a), sin(a));`,wgsl:`  var st = _st;
   st = st - 0.5;
   let r : f32 = length(st);
   var a : f32 = atan2(st.y, st.x);
   let pi : f32 = 2.*3.1416;
   a = _mod(a, pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2<f32>(cos(a), sin(a));` },{ name:'modulateKaleid',type:'combineCoord',inputs:[{ type:'float',name:'nSides',default:4 }],glsl:`   vec2 st = _st - 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2(cos(a), sin(a));`,wgsl:`  var st = _st - 0.5;
   let r : f32= length(st);
   var a : f32 = atan2(st.y, st.x);
   let pi : f32= 2.*3.1416;
   a = _mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2<f32>(cos(a), sin(a));` },{ name:'scroll',type:'coord',inputs:[{ type:'float',name:'scrollX',default:.5 },{ type:'float',name:'scrollY',default:.5 },{ type:'float',name:'speedX',default:0 },{ type:'float',name:'speedY',default:0 }],glsl:`
   _st.x += scrollX + time*speedX;
   _st.y += scrollY + time*speedY;
   return fract(_st);`,wgsl:`
	 var st : vec2<f32> = _st;
   st.x = st.x + (scrollX + time*speedX);
   st.y =  st.y + (scrollY + time*speedY);
   return fract(st);` },{ name:'scrollX',type:'coord',inputs:[{ type:'float',name:'scrollX',default:.5 },{ type:'float',name:'speed',default:0 }],glsl:`   _st.x += scrollX + time*speed;
   return fract(_st);`,wgsl:`  var st : vec2<f32>  = _st;
	 st.x = st.x + (scrollX + time*speed);
   return fract(st);` },{ name:'modulateScrollX',type:'combineCoord',inputs:[{ type:'float',name:'scrollX',default:.5 },{ type:'float',name:'speed',default:0 }],glsl:`   _st.x += _c0.r*scrollX + time*speed;
   return fract(_st);`,wgsl:`   var st : vec2<f32>  = _st; 
	  st.x = st.x + (_c0.r*scrollX + time*speed);
   return fract(st);` },{ name:'scrollY',type:'coord',inputs:[{ type:'float',name:'scrollY',default:.5 },{ type:'float',name:'speed',default:0 }],glsl:`   _st.y += scrollY + time*speed;
   return fract(_st);`,wgsl:`  var st : vec2<f32>  = _st;
   st.y = st.y + (scrollY + time*speed);
   return fract(st);` },{ name:'modulateScrollY',type:'combineCoord',inputs:[{ type:'float',name:'scrollY',default:.5 },{ type:'float',name:'speed',default:0 }],glsl:`   _st.y += _c0.r*scrollY + time*speed;
   return fract(_st);`,wgsl:`  var st : vec2<f32>  = _st;
   st.y = st.y + (_c0.r*scrollY + time*speed);
   return fract(st);` },{ name:'add',type:'combine',inputs:[{ type:'float',name:'amount',default:1 }],glsl:'   return (_c0+_c1)*amount + _c0*(1.0-amount);',wgsl:'   return (_c0+_c1)*amount + _c0*(1.0-amount);' },{ name:'sub',type:'combine',inputs:[{ type:'float',name:'amount',default:1 }],glsl:'   return (_c0-_c1)*amount + _c0*(1.0-amount);',wgsl:'   return (_c0-_c1)*amount + _c0*(1.0-amount);' },{ name:'layer',type:'combine',inputs:[],glsl:'   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));',wgsl:'   return vec4<f32>(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));' },{ name:'blend',type:'combine',inputs:[{ type:'float',name:'amount',default:.5 }],glsl:'   return _c0*(1.0-amount)+_c1*amount;',wgsl:'   return _c0*(1.0-amount)+_c1*amount;' },{ name:'mult',type:'combine',inputs:[{ type:'float',name:'amount',default:1 }],glsl:'   return _c0*(1.0-amount)+(_c0*_c1)*amount;',wgsl:'   return _c0*(1.0-amount)+(_c0*_c1)*amount;' },{ name:'diff',type:'combine',inputs:[],glsl:'   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));',wgsl:'   return vec4<f32>(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));' },{ name:'modulate',type:'combineCoord',inputs:[{ type:'float',name:'amount',default:.1 }],glsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;`,wgsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;` },{ name:'modulateScale',type:'combineCoord',inputs:[{ type:'float',name:'multiple',default:1 },{ type:'float',name:'offset',default:1 }],glsl:`   vec2 xy = _st - vec2(0.5);
   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy+=vec2(0.5);
   return xy;`,wgsl:`  var xy : vec2<f32> = _st - vec2<f32>(0.5);
   xy =xy *(1.0/vec2<f32>(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy= xy + vec2<f32>(0.5);
   return xy;` },{ name:'modulatePixelate',type:'combineCoord',inputs:[{ type:'float',name:'multiple',default:10 },{ type:'float',name:'offset',default:3 }],glsl:`   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;`,wgsl:`   let xy : vec2<f32> = vec2<f32>(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;` },{ name:'modulateRotate',type:'combineCoord',inputs:[{ type:'float',name:'multiple',default:1 },{ type:'float',name:'offset',default:0 }],glsl:`   vec2 xy = _st - vec2(0.5);
   float angle = offset + _c0.x * multiple;
   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy += 0.5;
   return xy;`,wgsl:`  var xy : vec2<f32> = _st - vec2<f32>(0.5);
   let angle = offset + _c0.x * multiple;
   xy = mat2x2<f32>(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy = xy +  0.5;
   return xy;` },{ name:'modulateHue',type:'combineCoord',inputs:[{ type:'float',name:'amount',default:1 }],glsl:'   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);',wgsl:'   return _st + (vec2<f32>(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);' },{ name:'invert',type:'color',inputs:[{ type:'float',name:'amount',default:1 }],glsl:'   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);',wgsl:'   return vec4<f32>((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);' },{ name:'contrast',type:'color',inputs:[{ type:'float',name:'amount',default:1.6 }],glsl:`   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);
   return vec4(c.rgb, _c0.a);`,wgsl:`   let c = vec4<f32> ((_c0-vec4(0.5))*vec4(amount) + vec4(0.5));
   return vec4<f32>(c.rgb, _c0.a);` },{ name:'brightness',type:'color',inputs:[{ type:'float',name:'amount',default:.4 }],glsl:'   return vec4(_c0.rgb + vec3(amount), _c0.a);',wgsl:'   return vec4<f32>(_c0.rgb + vec3<f32>(amount), _c0.a);' },{ name:'mask',type:'combine',inputs:[],glsl:`   float a = _luminance(_c1.rgb);
  return vec4(_c0.rgb*a, a*_c0.a);`,wgsl:`   let a = _luminance(_c1.rgb);
  return vec4<f32>(_c0.rgb*a, a*_c0.a);` },{ name:'luma',type:'color',inputs:[{ type:'float',name:'threshold',default:.5 },{ type:'float',name:'tolerance',default:.1 }],glsl:`   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4(_c0.rgb*a, a);`,wgsl:`   let a : f32 = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4<f32>(_c0.rgb*a, a);` },{ name:'thresh',type:'color',inputs:[{ type:'float',name:'threshold',default:.5 },{ type:'float',name:'tolerance',default:.04 }],glsl:'   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);',wgsl:'   return vec4<f32>(vec3<f32>(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);' },{ name:'color',type:'color',inputs:[{ type:'float',name:'r',default:1 },{ type:'float',name:'g',default:1 },{ type:'float',name:'b',default:1 },{ type:'float',name:'a',default:1 }],glsl:`   vec4 c = vec4(r, g, b, a);
   vec4 pos = step(0.0, c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));`,wgsl:`  let c = vec4<f32>(r, g, b, a);
   let pos : vec4<f32> = step(vec4<f32>(0.0), c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4<f32>(mix((1.0-_c0)*abs(c), c*_c0, pos));` },{ name:'saturate',type:'color',inputs:[{ type:'float',name:'amount',default:2 }],glsl:`   const vec3 W = vec3(0.2125, 0.7154, 0.0721);
   vec3 intensity = vec3(dot(_c0.rgb, W));
   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);`,wgsl:`   const W = vec3<f32>(0.2125, 0.7154, 0.0721);
    let intensity = vec3<f32>(dot(_c0.rgb, W));
   return vec4<f32>(mix(intensity, _c0.rgb, amount), _c0.a);` },{ name:'hue',type:'color',inputs:[{ type:'float',name:'hue',default:.4 }],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c.r += hue;
   //  c.r = fract(c.r);
   return vec4(_hsvToRgb(c), _c0.a);`,wgsl:`   var c  = _rgbToHsv(_c0.rgb);
   c.r = c.r + hue;
   //  c.r = fract(c.r);
   return vec4<f32>(_hsvToRgb(c), _c0.a);`,needs:['_rgbToHsv','_hsvToRgb'] },{ name:'colorama',type:'color',inputs:[{ type:'float',name:'amount',default:.005 }],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c += vec3(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4(c, _c0.a);`,wgsl:`  var c : vec3<f32> = _rgbToHsv(_c0.rgb);
   c = c + vec3<f32>(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4<f32>(c, _c0.a);`,needs:['_rgbToHsv','_hsvToRgb'] },{ name:'prev',type:'src',inputs:[],glsl:'   return texture2D(prevBuffer, fract(_st));',wgsl:'   return samplerprev(prevBuffer, fract(_st));' },{ name:'sum',type:'color',inputs:[{ type:'vec4',name:'scale',default:1 }],glsl:`   vec4 v = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded
   vec2 v = _st.xy * s.xy;
   return v.x + v.y;`,wgsl:`  let v = vec4<f32> = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   fn sum( _st : vec2<f32>, s : vec4<f32>) -> f32 { // vec4 is not a typo, because argument type is not overloaded
   v : vec2<f32> = _st.xy * s.xy;
   return v.x + v.y;` },{ name:'r',type:'color',inputs:[{ type:'float',name:'scale',default:1 },{ type:'float',name:'offset',default:0 }],glsl:'   return vec4(_c0.r * scale + offset);',wgsl:'   return vec4<f32>(_c0.r * scale + offset);' },{ name:'g',type:'color',inputs:[{ type:'float',name:'scale',default:1 },{ type:'float',name:'offset',default:0 }],glsl:'   return vec4(_c0.g * scale + offset);',wgsl:'   return vec4<f32>(_c0.g * scale + offset);' },{ name:'b',type:'color',inputs:[{ type:'float',name:'scale',default:1 },{ type:'float',name:'offset',default:0 }],glsl:'   return vec4(_c0.b * scale + offset);',wgsl:'   return vec4<f32>(_c0.b * scale + offset);' },{ name:'a',type:'color',inputs:[{ type:'float',name:'scale',default:1 },{ type:'float',name:'offset',default:0 }],glsl:'   return vec4(_c0.a * scale + offset);',wgsl:'   return vec4<f32>(_c0.a * scale + offset);' }];class ud{constructor ({ genWGSL:t,defaultUniforms:r,defaultOutput:i,extendTransforms:n=[],changeListener:o=()=>{} }={}){this.defaultOutput=i,this.defaultUniforms=r,this.changeListener=o,this.extendTransforms=n,this.generators={},this.isWGSL=t,this.init()}init (){const t=od();return this.glslTransforms={},this.generators=Object.entries(this.generators).reduce((r,[i,n])=>(this.changeListener({ type:'remove',synth:this,method:i }),r),{}),this.sourceClass=class extends xi{},Array.isArray(this.extendTransforms)?t.concat(this.extendTransforms):typeof this.extendTransforms=='object'&&this.extendTransforms.type&&t.push(this.extendTransforms),t.map(r=>this.setFunction(r))}_addMethod (t,r){const i=this;if(this.glslTransforms[t]=r,r.type==='src'){const n=(...o)=>new this.sourceClass({ name:t,transform:r,userArgs:o,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:i });return this.generators[t]=n,this.changeListener({ type:'add',synth:this,method:t }),n}else this.sourceClass.prototype[t]=function (...n){return this.transforms.push({ name:t,transform:r,userArgs:n,synth:i }),this}}setFunction (t){const r=this.isWGSL?pd(t):hd(t);r&&this._addMethod(t.name,r)}}const ld={ src:{ returnType:'vec4',args:['vec2 _st'] },coord:{ returnType:'vec2',args:['vec2 _st'] },color:{ returnType:'vec4',args:['vec4 _c0'] },combine:{ returnType:'vec4',args:['vec4 _c0','vec4 _c1'] },combineCoord:{ returnType:'vec2',args:['vec2 _st','vec4 _c0'] } },fd={ src:{ returnType:'vec4<f32>',args:['_st : vec2<f32>'] },coord:{ returnType:'vec2<f32>',args:['_st : vec2<f32>'] },color:{ returnType:'vec4<f32>',args:['_c0 : vec4<f32>'] },combine:{ returnType:'vec4<f32>',args:[' _c0 : vec4<f32>','_c1 : vec4<f32>'] },combineCoord:{ returnType:'vec2<f32>',args:['_st : vec2<f32>','_c0 : vec4<f32>'] } };function cd (e){return e==='float'?'f32':e}function hd (e){const t=ld[e.type];if(t){const r=t.args.map(u=>u).join(', '),i=e.inputs.map(u=>`${u.type} ${u.name}`).join(', '),n=`${r}${i.length>0?', '+i:''}`,o=`
  ${t.returnType} ${e.name}(${n}) {
      ${e.glsl}
  }
`;return(e.type==='combine'||e.type==='combineCoord')&&e.inputs.unshift({ name:'color',type:'vec4' }),Object.assign({},e,{ glsl:o })}else console.warn(`type ${e.type} not recognized`,e)}function pd (e){const t=fd[e.type];if(t){const r=t.args.map(u=>u).join(', '),i=e.inputs.map(u=>` ${u.name} : ${cd(u.type)}`).join(', '),n=`${r}${i.length>0?', '+i:''}`,o=`
   fn ${e.name}(${n})->${t.returnType}{
      ${e.wgsl}
  }
`;return(e.type==='combine'||e.type==='combineCoord')&&e.inputs.unshift({ name:'color',type:'vec4' }),Object.assign({},e,{ wgsl:o })}else console.warn(`type ${e.type} not recognized`,e)}let Vn={ exports:{} },dd=Vn.exports,Hu;function md (){return Hu||(Hu=1,function (e,t){(function (r,i){e.exports=i()})(dd,function (){const r=function (s){return s instanceof Uint8Array||s instanceof Uint16Array||s instanceof Uint32Array||s instanceof Int8Array||s instanceof Int16Array||s instanceof Int32Array||s instanceof Float32Array||s instanceof Float64Array||s instanceof Uint8ClampedArray},i=function (s,c){for(let b=Object.keys(c),V=0;V<b.length;++V)s[b[V]]=c[b[V]];return s},n=`
`;function o (s){return typeof atob<'u'?atob(s):'base64:'+s}function u (s){const c=new Error('(regl) '+s);throw console.error(c),c}function m (s,c){s||u(c)}function _ (s){return s?': '+s:''}function P (s,c,b){s in c||u('unknown parameter ('+s+')'+_(b)+'. possible values: '+Object.keys(c).join())}function k (s,c){r(s)||u('invalid parameter type'+_(c)+'. must be a typed array')}function y (s,c){switch(c){case'number':return typeof s=='number';case'object':return typeof s=='object';case'string':return typeof s=='string';case'boolean':return typeof s=='boolean';case'function':return typeof s=='function';case'undefined':return typeof s>'u';case'symbol':return typeof s=='symbol'}}function T (s,c,b){y(s,c)||u('invalid parameter type'+_(b)+'. expected '+c+', got '+typeof s)}function ie (s,c){s>=0&&(s|0)===s||u('invalid parameter type, ('+s+')'+_(c)+'. must be a nonnegative integer')}function Ae (s,c,b){c.indexOf(s)<0&&u('invalid value'+_(b)+'. must be one of: '+c)}const Q=['gl','canvas','container','attributes','pixelRatio','extensions','optionalExtensions','profile','onDone'];function Je (s){Object.keys(s).forEach(function (c){Q.indexOf(c)<0&&u('invalid regl constructor argument "'+c+'". must be one of '+Q)})}function it (s,c){for(s=s+'';s.length<c;)s=' '+s;return s}function ze (){this.name='unknown',this.lines=[],this.index={},this.hasErrors=!1}function ot (s,c){this.number=s,this.line=c,this.errors=[]}function pr (s,c,b){this.file=s,this.line=c,this.message=b}function wt (){const s=new Error,c=(s.stack||s).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(c);if(b)return b[1];const V=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(c);return V?V[1]:'unknown'}function Jr (){const s=new Error,c=(s.stack||s).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(c);if(b)return b[1];const V=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(c);return V?V[1]:'unknown'}function ar (s,c){let b=s.split(`
`),V=1,H=0,G={ unknown:new ze,0:new ze };G.unknown.name=G[0].name=c||wt(),G.unknown.lines.push(new ot(0,''));for(let j=0;j<b.length;++j){const Z=b[j],K=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Z);if(K)switch(K[1]){case'line':var ne=/(\d+)(\s+\d+)?/.exec(K[2]);ne&&(V=ne[1]|0,ne[2]&&(H=ne[2]|0,H in G||(G[H]=new ze)));break;case'define':var oe=/SHADER_NAME(_B64)?\s+(.*)$/.exec(K[2]);oe&&(G[H].name=oe[1]?o(oe[2]):oe[2]);break}G[H].lines.push(new ot(V++,Z))}return Object.keys(G).forEach(function (ae){const ce=G[ae];ce.lines.forEach(function (J){ce.index[J.number]=J})}),G}function na (s){const c=[];return s.split(`
`).forEach(function (b){if(!(b.length<5)){const V=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(b);V?c.push(new pr(V[1]|0,V[2]|0,V[3].trim())):b.length>0&&c.push(new pr('unknown',0,b))}}),c}function aa (s,c){c.forEach(function (b){const V=s[b.file];if(V){const H=V.index[b.line];if(H){H.errors.push(b),V.hasErrors=!0;return}}s.unknown.hasErrors=!0,s.unknown.lines[0].errors.push(b)})}function sa (s,c,b,V,H){if(!s.getShaderParameter(c,s.COMPILE_STATUS)){const G=s.getShaderInfoLog(c),j=V===s.FRAGMENT_SHADER?'fragment':'vertex';se(b,'string',j+' shader source must be a string',H);const Z=ar(b,H),K=na(G);aa(Z,K),Object.keys(Z).forEach(function (ne){const oe=Z[ne];if(!oe.hasErrors)return;const ae=[''],ce=[''];function J (re,R){ae.push(re),ce.push(R||'')}J('file number '+ne+': '+oe.name+`
`,'color:red;text-decoration:underline;font-weight:bold'),oe.lines.forEach(function (re){if(re.errors.length>0){J(it(re.number,4)+'|  ','background-color:yellow; font-weight:bold'),J(re.line+n,'color:red; background-color:yellow; font-weight:bold');let R=0;re.errors.forEach(function (z){let te=z.message,xe=/^\s*'(.*)'\s*:\s*(.*)$/.exec(te);if(xe){let Y=xe[1];switch(te=xe[2],Y){case'assign':Y='=';break}R=Math.max(re.line.indexOf(Y,R),0)}else R=0;J(it('| ',6)),J(it('^^^',R+3)+n,'font-weight:bold'),J(it('| ',6)),J(te+n,'font-weight:bold')}),J(it('| ',6)+n)}else J(it(re.number,4)+'|  '),J(re.line+n,'color:red')}),typeof document<'u'&&!window.chrome?(ce[0]=ae.join('%c'),console.log.apply(console,ce)):console.log(ae.join(''))}),m.raise('Error compiling '+j+' shader, '+Z[0].name)}}function Ai (s,c,b,V,H){if(!s.getProgramParameter(c,s.LINK_STATUS)){const G=s.getProgramInfoLog(c),j=ar(b,H),Z=ar(V,H),K='Error linking program with vertex shader, "'+Z[0].name+'", and fragment shader "'+j[0].name+'"';typeof document<'u'?console.log('%c'+K+n+'%c'+G,'color:red;text-decoration:underline;font-weight:bold','color:red'):console.log(K+n+G),m.raise(K)}}function Ti (s){s._commandRef=wt()}function F (s,c,b,V){Ti(s);function H (K){return K?V.id(K):0}s._fragId=H(s.static.frag),s._vertId=H(s.static.vert);function G (K,ne){Object.keys(ne).forEach(function (oe){K[V.id(oe)]=!0})}const j=s._uniformSet={};G(j,c.static),G(j,c.dynamic);const Z=s._attributeSet={};G(Z,b.static),G(Z,b.dynamic),s._hasCount='count'in s.static||'count'in s.dynamic||'elements'in s.static||'elements'in s.dynamic}function C (s,c){const b=Jr();u(s+' in command '+(c||wt())+(b==='unknown'?'':' called from '+b))}function X (s,c,b){s||C(c,b||wt())}function D (s,c,b,V){s in c||C('unknown parameter ('+s+')'+_(b)+'. possible values: '+Object.keys(c).join(),V||wt())}function se (s,c,b,V){y(s,c)||C('invalid parameter type'+_(b)+'. expected '+c+', got '+typeof s,V||wt())}function Le (s){s()}function je (s,c,b){s.texture?Ae(s.texture._texture.internalformat,c,'unsupported texture format for attachment'):Ae(s.renderbuffer._renderbuffer.format,b,'unsupported renderbuffer format for attachment')}const Xe=33071,Ge=9728,De=9984,Qe=9985,Rt=9986,Ke=9987,Wt=5120,Dt=5121,Gt=5122,Ci=5123,gt=5124,It=5125,Pt=5126,Jt=32819,Ns=32820,Fs=33635,Bs=34042,uf=36193,Vt={};Vt[Wt]=Vt[Dt]=1,Vt[Gt]=Vt[Ci]=Vt[uf]=Vt[Fs]=Vt[Jt]=Vt[Ns]=2,Vt[gt]=Vt[It]=Vt[Pt]=Vt[Bs]=4;function Ms (s,c){return s===Ns||s===Jt||s===Fs?2:s===Bs?4:Vt[s]*c}function Ji (s){return!(s&s-1)&&!!s}function lf (s,c,b){let V,H=c.width,G=c.height,j=c.channels;m(H>0&&H<=b.maxTextureSize&&G>0&&G<=b.maxTextureSize,'invalid texture shape'),(s.wrapS!==Xe||s.wrapT!==Xe)&&m(Ji(H)&&Ji(G),'incompatible wrap mode for texture, both width and height must be power of 2'),c.mipmask===1?H!==1&&G!==1&&m(s.minFilter!==De&&s.minFilter!==Rt&&s.minFilter!==Qe&&s.minFilter!==Ke,'min filter requires mipmap'):(m(Ji(H)&&Ji(G),'texture must be a square power of 2 to support mipmapping'),m(c.mipmask===(H<<1)-1,'missing or incomplete mipmap data')),c.type===Pt&&(b.extensions.indexOf('oes_texture_float_linear')<0&&m(s.minFilter===Ge&&s.magFilter===Ge,'filter not supported, must enable oes_texture_float_linear'),m(!s.genMipmaps,'mipmap generation not supported with float textures'));const Z=c.images;for(V=0;V<16;++V)if(Z[V]){const K=H>>V,ne=G>>V;m(c.mipmask&1<<V,'missing mipmap data');const oe=Z[V];if(m(oe.width===K&&oe.height===ne,'invalid shape for mip images'),m(oe.format===c.format&&oe.internalformat===c.internalformat&&oe.type===c.type,'incompatible type for mip image'),!oe.compressed)if(oe.data){const ae=Math.ceil(Ms(oe.type,j)*K/oe.unpackAlignment)*oe.unpackAlignment;m(oe.data.byteLength===ae*ne,'invalid data for image, buffer size is inconsistent with image format')}else oe.element||oe.copy}else s.genMipmaps||m((c.mipmask&1<<V)===0,'extra mipmap data');c.compressed&&m(!s.genMipmaps,'mipmap generation for compressed images not supported')}function ff (s,c,b,V){const H=s.width,G=s.height,j=s.channels;m(H>0&&H<=V.maxTextureSize&&G>0&&G<=V.maxTextureSize,'invalid texture shape'),m(H===G,'cube map must be square'),m(c.wrapS===Xe&&c.wrapT===Xe,'wrap mode not supported by cube map');for(let Z=0;Z<b.length;++Z){const K=b[Z];m(K.width===H&&K.height===G,'inconsistent cube map face shape'),c.genMipmaps&&(m(!K.compressed,'can not generate mipmap for compressed textures'),m(K.mipmask===1,'can not specify mipmaps and generate mipmaps'));for(let ne=K.images,oe=0;oe<16;++oe){const ae=ne[oe];if(ae){const ce=H>>oe,J=G>>oe;m(K.mipmask&1<<oe,'missing mipmap data'),m(ae.width===ce&&ae.height===J,'invalid shape for mip images'),m(ae.format===s.format&&ae.internalformat===s.internalformat&&ae.type===s.type,'incompatible type for mip image'),ae.compressed||(ae.data?m(ae.data.byteLength===ce*J*Math.max(Ms(ae.type,j),ae.unpackAlignment),'invalid data for image, buffer size is inconsistent with image format'):ae.element||ae.copy)}}}}let p=i(m,{ optional:Le,raise:u,commandRaise:C,command:X,parameter:P,commandParameter:D,constructor:Je,type:T,commandType:se,isTypedArray:k,nni:ie,oneOf:Ae,shaderError:sa,linkError:Ai,callSite:Jr,saveCommandRef:Ti,saveDrawInfo:F,framebufferFormat:je,guessCommand:wt,texture2D:lf,textureCube:ff }),cf=0,hf=0,pf=5,df=6;function Mr (s,c){this.id=cf++,this.type=s,this.data=c}function Ds (s){return s.replace(/\\/g,'\\\\').replace(/"/g,'\\"')}function ki (s){if(s.length===0)return[];const c=s.charAt(0),b=s.charAt(s.length-1);if(s.length>1&&c===b&&(c==='"'||c==="'"))return['"'+Ds(s.substr(1,s.length-2))+'"'];const V=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(s);if(V)return ki(s.substr(0,V.index)).concat(ki(V[1])).concat(ki(s.substr(V.index+V[0].length)));const H=s.split('.');if(H.length===1)return['"'+Ds(s)+'"'];for(var G=[],j=0;j<H.length;++j)G=G.concat(ki(H[j]));return G}function Gs (s){return'['+ki(s).join('][')+']'}function mf (s,c){return new Mr(s,Gs(c+''))}function vf (s){return typeof s=='function'&&!s._reglType||s instanceof Mr}function Vs (s,c){if(typeof s=='function')return new Mr(hf,s);if(typeof s=='number'||typeof s=='boolean')return new Mr(pf,s);if(Array.isArray(s))return new Mr(df,s.map(function (b,V){return Vs(b,c+'['+V+']')}));if(s instanceof Mr)return s;p(!1,'invalid option type in uniform '+c)}const Ut={ DynamicVariable:Mr,define:mf,isDynamic:vf,unbox:Vs,accessor:Gs },oa={ next:typeof requestAnimationFrame=='function'?function (s){return requestAnimationFrame(s)}:function (s){return setTimeout(s,16)},cancel:typeof cancelAnimationFrame=='function'?function (s){return cancelAnimationFrame(s)}:clearTimeout },Us=typeof performance<'u'&&performance.now?function (){return performance.now()}:function (){return+new Date};function gf (){const s={ '':0 },c=[''];return{ id (b){let V=s[b];return V||(V=s[b]=c.length,c.push(b),V)},str (b){return c[b]} }}function yf (s,c,b){const V=document.createElement('canvas');i(V.style,{ border:0,margin:0,padding:0,top:0,left:0,width:'100%',height:'100%' }),s.appendChild(V),s===document.body&&(V.style.position='absolute',i(s.style,{ margin:0,padding:0 }));function H (){let Z=window.innerWidth,K=window.innerHeight;if(s!==document.body){const ne=V.getBoundingClientRect();Z=ne.right-ne.left,K=ne.bottom-ne.top}V.width=b*Z,V.height=b*K}let G;s!==document.body&&typeof ResizeObserver=='function'?(G=new ResizeObserver(function (){setTimeout(H)}),G.observe(s)):window.addEventListener('resize',H,!1);function j (){G?G.disconnect():window.removeEventListener('resize',H),s.removeChild(V)}return H(),{ canvas:V,onDestroy:j }}function bf (s,c){function b (V){try{return s.getContext(V,c)}catch{return null}}return b('webgl')||b('experimental-webgl')||b('webgl-experimental')}function xf (s){return typeof s.nodeName=='string'&&typeof s.appendChild=='function'&&typeof s.getBoundingClientRect=='function'}function _f (s){return typeof s.drawArrays=='function'||typeof s.drawElements=='function'}function zs (s){return typeof s=='string'?s.split():(p(Array.isArray(s),'invalid extension array'),s)}function js (s){return typeof s=='string'?(p(typeof document<'u','not supported outside of DOM'),document.querySelector(s)):s}function wf (s){let c=s||{},b,V,H,G,j={},Z=[],K=[],ne=typeof window>'u'?1:window.devicePixelRatio,oe=!1,ae=function (re){re&&p.raise(re)},ce=function (){};if(typeof c=='string'?(p(typeof document<'u','selector queries only supported in DOM environments'),b=document.querySelector(c),p(b,'invalid query string for element')):typeof c=='object'?xf(c)?b=c:_f(c)?(G=c,H=G.canvas):(p.constructor(c),'gl'in c?G=c.gl:'canvas'in c?H=js(c.canvas):'container'in c&&(V=js(c.container)),'attributes'in c&&(j=c.attributes,p.type(j,'object','invalid context attributes')),'extensions'in c&&(Z=zs(c.extensions)),'optionalExtensions'in c&&(K=zs(c.optionalExtensions)),'onDone'in c&&(p.type(c.onDone,'function','invalid or missing onDone callback'),ae=c.onDone),'profile'in c&&(oe=!!c.profile),'pixelRatio'in c&&(ne=+c.pixelRatio,p(ne>0,'invalid pixel ratio'))):p.raise('invalid arguments to regl'),b&&(b.nodeName.toLowerCase()==='canvas'?H=b:V=b),!G){if(!H){p(typeof document<'u','must manually specify webgl context outside of DOM environments');const J=yf(V||document.body,ae,ne);if(!J)return null;H=J.canvas,ce=J.onDestroy}j.premultipliedAlpha===void 0&&(j.premultipliedAlpha=!0),G=bf(H,j)}return G?{ gl:G,canvas:H,container:V,extensions:Z,optionalExtensions:K,pixelRatio:ne,profile:oe,onDone:ae,onDestroy:ce }:(ce(),ae('webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org'),null)}function Sf (s,c){const b={};function V (j){p.type(j,'string','extension name must be string');let Z=j.toLowerCase(),K;try{K=b[Z]=s.getExtension(Z)}catch{}return!!K}for(let H=0;H<c.extensions.length;++H){const G=c.extensions[H];if(!V(G))return c.onDestroy(),c.onDone('"'+G+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return c.optionalExtensions.forEach(V),{ extensions:b,restore (){Object.keys(b).forEach(function (j){if(b[j]&&!V(j))throw new Error('(regl): error restoring extension '+j)})} }}function zt (s,c){for(var b=Array(s),V=0;V<s;++V)b[V]=c(V);return b}const Ef=5120,Af=5121,Tf=5122,Cf=5123,kf=5124,Lf=5125,If=5126;function Rf (s){for(let c=16;c<=1<<28;c*=16)if(s<=c)return c;return 0}function Ws (s){let c,b;return c=(s>65535)<<4,s>>>=c,b=(s>255)<<3,s>>>=b,c|=b,b=(s>15)<<2,s>>>=b,c|=b,b=(s>3)<<1,s>>>=b,c|=b,c|s>>1}function Hs (){const s=zt(8,function (){return[]});function c (G){const j=Rf(G),Z=s[Ws(j)>>2];return Z.length>0?Z.pop():new ArrayBuffer(j)}function b (G){s[Ws(G.byteLength)>>2].push(G)}function V (G,j){let Z=null;switch(G){case Ef:Z=new Int8Array(c(j),0,j);break;case Af:Z=new Uint8Array(c(j),0,j);break;case Tf:Z=new Int16Array(c(2*j),0,j);break;case Cf:Z=new Uint16Array(c(2*j),0,j);break;case kf:Z=new Int32Array(c(4*j),0,j);break;case Lf:Z=new Uint32Array(c(4*j),0,j);break;case If:Z=new Float32Array(c(4*j),0,j);break;default:return null}return Z.length!==j?Z.subarray(0,j):Z}function H (G){b(G.buffer)}return{ alloc:c,free:b,allocType:V,freeType:H }}const dt=Hs();dt.zero=Hs();const Pf=3408,Of=3410,Nf=3411,Ff=3412,Bf=3413,Mf=3414,Df=3415,Gf=33901,Vf=33902,Uf=3379,zf=3386,jf=34921,Wf=36347,Hf=36348,qf=35661,$f=35660,Xf=34930,Yf=36349,Kf=34076,Qf=34024,Zf=7936,Jf=7937,ec=7938,tc=35724,rc=34047,ic=36063,nc=34852,en=3553,qs=34067,ac=34069,sc=33984,Li=6408,ua=5126,$s=5121,la=36160,oc=36053,uc=36064,lc=16384,fc=function (s,c){let b=1;c.ext_texture_filter_anisotropic&&(b=s.getParameter(rc));let V=1,H=1;c.webgl_draw_buffers&&(V=s.getParameter(nc),H=s.getParameter(ic));let G=!!c.oes_texture_float;if(G){const j=s.createTexture();s.bindTexture(en,j),s.texImage2D(en,0,Li,1,1,0,Li,ua,null);const Z=s.createFramebuffer();if(s.bindFramebuffer(la,Z),s.framebufferTexture2D(la,uc,en,j,0),s.bindTexture(en,null),s.checkFramebufferStatus(la)!==oc)G=!1;else{s.viewport(0,0,1,1),s.clearColor(1,0,0,1),s.clear(lc);const K=dt.allocType(ua,4);s.readPixels(0,0,1,1,Li,ua,K),s.getError()?G=!1:(s.deleteFramebuffer(Z),s.deleteTexture(j),G=K[0]===1),dt.freeType(K)}}let ne=typeof navigator<'u'&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),oe=!0;if(!ne){const ae=s.createTexture(),ce=dt.allocType($s,36);s.activeTexture(sc),s.bindTexture(qs,ae),s.texImage2D(ac,0,Li,3,3,0,Li,$s,ce),dt.freeType(ce),s.bindTexture(qs,null),s.deleteTexture(ae),oe=!s.getError()}return{ colorBits:[s.getParameter(Of),s.getParameter(Nf),s.getParameter(Ff),s.getParameter(Bf)],depthBits:s.getParameter(Mf),stencilBits:s.getParameter(Df),subpixelBits:s.getParameter(Pf),extensions:Object.keys(c).filter(function (J){return!!c[J]}),maxAnisotropic:b,maxDrawbuffers:V,maxColorAttachments:H,pointSizeDims:s.getParameter(Gf),lineWidthDims:s.getParameter(Vf),maxViewportDims:s.getParameter(zf),maxCombinedTextureUnits:s.getParameter(qf),maxCubeMapSize:s.getParameter(Kf),maxRenderbufferSize:s.getParameter(Qf),maxTextureUnits:s.getParameter(Xf),maxTextureSize:s.getParameter(Uf),maxAttributes:s.getParameter(jf),maxVertexUniforms:s.getParameter(Wf),maxVertexTextureUnits:s.getParameter($f),maxVaryingVectors:s.getParameter(Hf),maxFragmentUniforms:s.getParameter(Yf),glsl:s.getParameter(tc),renderer:s.getParameter(Jf),vendor:s.getParameter(Zf),version:s.getParameter(ec),readFloat:G,npotTextureCube:oe }};function er (s){return!!s&&typeof s=='object'&&Array.isArray(s.shape)&&Array.isArray(s.stride)&&typeof s.offset=='number'&&s.shape.length===s.stride.length&&(Array.isArray(s.data)||r(s.data))}const jt=function (s){return Object.keys(s).map(function (c){return s[c]})},tn={ shape:dc,flatten:pc };function cc (s,c,b){for(let V=0;V<c;++V)b[V]=s[V]}function hc (s,c,b,V){for(let H=0,G=0;G<c;++G)for(let j=s[G],Z=0;Z<b;++Z)V[H++]=j[Z]}function Xs (s,c,b,V,H,G){for(let j=G,Z=0;Z<c;++Z)for(let K=s[Z],ne=0;ne<b;++ne)for(let oe=K[ne],ae=0;ae<V;++ae)H[j++]=oe[ae]}function Ys (s,c,b,V,H){for(var G=1,j=b+1;j<c.length;++j)G*=c[j];const Z=c[b];if(c.length-b===4){const K=c[b+1],ne=c[b+2],oe=c[b+3];for(j=0;j<Z;++j)Xs(s[j],K,ne,oe,V,H),H+=G}else for(j=0;j<Z;++j)Ys(s[j],c,b+1,V,H),H+=G}function pc (s,c,b,V){let H=1;if(c.length)for(let G=0;G<c.length;++G)H*=c[G];else H=0;const j=V||dt.allocType(b,H);switch(c.length){case 0:break;case 1:cc(s,c[0],j);break;case 2:hc(s,c[0],c[1],j);break;case 3:Xs(s,c[0],c[1],c[2],j,0);break;default:Ys(s,c,0,j,0)}return j}function dc (s){for(var c=[],b=s;b.length;b=b[0])c.push(b.length);return c}const fa={ '[object Int8Array]':5120,'[object Int16Array]':5122,'[object Int32Array]':5124,'[object Uint8Array]':5121,'[object Uint8ClampedArray]':5121,'[object Uint16Array]':5123,'[object Uint32Array]':5125,'[object Float32Array]':5126,'[object Float64Array]':5121,'[object ArrayBuffer]':5121 },mc=5120,vc=5122,gc=5124,yc=5121,bc=5123,xc=5125,_c=5126,wc=5126,Dr={ int8:mc,int16:vc,int32:gc,uint8:yc,uint16:bc,uint32:xc,float:_c,float32:wc },Sc=35048,Ec=35040,rn={ dynamic:Sc,stream:Ec,static:35044 },ca=tn.flatten,Ks=tn.shape,Qs=35044,Ac=35040,ha=5121,pa=5126,Cr=[];Cr[5120]=1,Cr[5122]=2,Cr[5124]=4,Cr[5121]=1,Cr[5123]=2,Cr[5125]=4,Cr[5126]=4;function nn (s){return fa[Object.prototype.toString.call(s)]|0}function Zs (s,c){for(let b=0;b<c.length;++b)s[b]=c[b]}function Js (s,c,b,V,H,G,j){for(let Z=0,K=0;K<b;++K)for(let ne=0;ne<V;++ne)s[Z++]=c[H*K+G*ne+j]}function Tc (s,c,b,V){let H=0,G={};function j (R){this.id=H++,this.buffer=s.createBuffer(),this.type=R,this.usage=Qs,this.byteLength=0,this.dimension=1,this.dtype=ha,this.persistentData=null,b.profile&&(this.stats={ size:0 })}j.prototype.bind=function (){s.bindBuffer(this.type,this.buffer)},j.prototype.destroy=function (){ce(this)};const Z=[];function K (R,z){let te=Z.pop();return te||(te=new j(R)),te.bind(),ae(te,z,Ac,0,1,!1),te}function ne (R){Z.push(R)}function oe (R,z,te){R.byteLength=z.byteLength,s.bufferData(R.type,z,te)}function ae (R,z,te,xe,Y,ye){let me;if(R.usage=te,Array.isArray(z)){if(R.dtype=xe||pa,z.length>0){let Ie;if(Array.isArray(z[0])){me=Ks(z);for(var q=1,W=1;W<me.length;++W)q*=me[W];R.dimension=q,Ie=ca(z,me,R.dtype),oe(R,Ie,te),ye?R.persistentData=Ie:dt.freeType(Ie)}else if(typeof z[0]=='number'){R.dimension=Y;const Se=dt.allocType(R.dtype,z.length);Zs(Se,z),oe(R,Se,te),ye?R.persistentData=Se:dt.freeType(Se)}else r(z[0])?(R.dimension=z[0].length,R.dtype=xe||nn(z[0])||pa,Ie=ca(z,[z.length,z[0].length],R.dtype),oe(R,Ie,te),ye?R.persistentData=Ie:dt.freeType(Ie)):p.raise('invalid buffer data')}}else if(r(z))R.dtype=xe||nn(z),R.dimension=Y,oe(R,z,te),ye&&(R.persistentData=new Uint8Array(new Uint8Array(z.buffer)));else if(er(z)){me=z.shape;let he=z.stride,ee=z.offset,pe=0,de=0,Ve=0,Be=0;me.length===1?(pe=me[0],de=1,Ve=he[0],Be=0):me.length===2?(pe=me[0],de=me[1],Ve=he[0],Be=he[1]):p.raise('invalid shape'),R.dtype=xe||nn(z.data)||pa,R.dimension=de;const ve=dt.allocType(R.dtype,pe*de);Js(ve,z.data,pe,de,Ve,Be,ee),oe(R,ve,te),ye?R.persistentData=ve:dt.freeType(ve)}else z instanceof ArrayBuffer?(R.dtype=ha,R.dimension=Y,oe(R,z,te),ye&&(R.persistentData=new Uint8Array(new Uint8Array(z)))):p.raise('invalid buffer data')}function ce (R){c.bufferCount--,V(R);const z=R.buffer;p(z,'buffer must not be deleted already'),s.deleteBuffer(z),R.buffer=null,delete G[R.id]}function J (R,z,te,xe){c.bufferCount++;const Y=new j(z);G[Y.id]=Y;function ye (q){let W=Qs,Se=null,he=0,ee=0,pe=1;return Array.isArray(q)||r(q)||er(q)||q instanceof ArrayBuffer?Se=q:typeof q=='number'?he=q|0:q&&(p.type(q,'object','buffer arguments must be an object, a number or an array'),'data'in q&&(p(Se===null||Array.isArray(Se)||r(Se)||er(Se),'invalid data for buffer'),Se=q.data),'usage'in q&&(p.parameter(q.usage,rn,'invalid buffer usage'),W=rn[q.usage]),'type'in q&&(p.parameter(q.type,Dr,'invalid buffer type'),ee=Dr[q.type]),'dimension'in q&&(p.type(q.dimension,'number','invalid dimension'),pe=q.dimension|0),'length'in q&&(p.nni(he,'buffer length must be a nonnegative integer'),he=q.length|0)),Y.bind(),Se?ae(Y,Se,W,ee,pe,xe):(he&&s.bufferData(Y.type,he,W),Y.dtype=ee||ha,Y.usage=W,Y.dimension=pe,Y.byteLength=he),b.profile&&(Y.stats.size=Y.byteLength*Cr[Y.dtype]),ye}function me (q,W){p(W+q.byteLength<=Y.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+q.byteLength+' starting from offset '+W+' to a buffer of size '+Y.byteLength),s.bufferSubData(Y.type,W,q)}function Ie (q,W){let Se=(W||0)|0,he;if(Y.bind(),r(q)||q instanceof ArrayBuffer)me(q,Se);else if(Array.isArray(q)){if(q.length>0)if(typeof q[0]=='number'){const ee=dt.allocType(Y.dtype,q.length);Zs(ee,q),me(ee,Se),dt.freeType(ee)}else if(Array.isArray(q[0])||r(q[0])){he=Ks(q);const pe=ca(q,he,Y.dtype);me(pe,Se),dt.freeType(pe)}else p.raise('invalid buffer data')}else if(er(q)){he=q.shape;let de=q.stride,Ve=0,Be=0,ve=0,be=0;he.length===1?(Ve=he[0],Be=1,ve=de[0],be=0):he.length===2?(Ve=he[0],Be=he[1],ve=de[0],be=de[1]):p.raise('invalid shape');const Oe=Array.isArray(q.data)?Y.dtype:nn(q.data),Me=dt.allocType(Oe,Ve*Be);Js(Me,q.data,Ve,Be,ve,be,q.offset),me(Me,Se),dt.freeType(Me)}else p.raise('invalid data for buffer subdata');return ye}return te||ye(R),ye._reglType='buffer',ye._buffer=Y,ye.subdata=Ie,b.profile&&(ye.stats=Y.stats),ye.destroy=function (){ce(Y)},ye}function re (){jt(G).forEach(function (R){R.buffer=s.createBuffer(),s.bindBuffer(R.type,R.buffer),s.bufferData(R.type,R.persistentData||R.byteLength,R.usage)})}return b.profile&&(c.getTotalBufferSize=function (){let R=0;return Object.keys(G).forEach(function (z){R+=G[z].stats.size}),R}),{ create:J,createStream:K,destroyStream:ne,clear (){jt(G).forEach(ce),Z.forEach(ce)},getBuffer (R){return R&&R._buffer instanceof j?R._buffer:null},restore:re,_initBuffer:ae }}const Cc=0,kc=0,Lc=1,Ic=1,Rc=4,Pc=4,kr={ points:Cc,point:kc,lines:Lc,line:Ic,triangles:Rc,triangle:Pc,'line loop':2,'line strip':3,'triangle strip':5,'triangle fan':6 },Oc=0,Nc=1,Ii=4,Fc=5120,ei=5121,eo=5122,ti=5123,to=5124,Gr=5125,da=34963,Bc=35040,Mc=35044;function Dc (s,c,b,V){let H={},G=0,j={ uint8:ei,uint16:ti };c.oes_element_index_uint&&(j.uint32=Gr);function Z (re){this.id=G++,H[this.id]=this,this.buffer=re,this.primType=Ii,this.vertCount=0,this.type=0}Z.prototype.bind=function (){this.buffer.bind()};const K=[];function ne (re){let R=K.pop();return R||(R=new Z(b.create(null,da,!0,!1)._buffer)),ae(R,re,Bc,-1,-1,0,0),R}function oe (re){K.push(re)}function ae (re,R,z,te,xe,Y,ye){re.buffer.bind();let me;if(R){let Ie=ye;!ye&&(!r(R)||er(R)&&!r(R.data))&&(Ie=c.oes_element_index_uint?Gr:ti),b._initBuffer(re.buffer,R,z,Ie,3)}else s.bufferData(da,Y,z),re.buffer.dtype=me||ei,re.buffer.usage=z,re.buffer.dimension=3,re.buffer.byteLength=Y;if(me=ye,!ye){switch(re.buffer.dtype){case ei:case Fc:me=ei;break;case ti:case eo:me=ti;break;case Gr:case to:me=Gr;break;default:p.raise('unsupported type for element array')}re.buffer.dtype=me}re.type=me,p(me!==Gr||!!c.oes_element_index_uint,'32 bit element buffers not supported, enable oes_element_index_uint first');let q=xe;q<0&&(q=re.buffer.byteLength,me===ti?q>>=1:me===Gr&&(q>>=2)),re.vertCount=q;let W=te;if(te<0){W=Ii;const Se=re.buffer.dimension;Se===1&&(W=Oc),Se===2&&(W=Nc),Se===3&&(W=Ii)}re.primType=W}function ce (re){V.elementsCount--,p(re.buffer!==null,'must not double destroy elements'),delete H[re.id],re.buffer.destroy(),re.buffer=null}function J (re,R){const z=b.create(null,da,!0),te=new Z(z._buffer);V.elementsCount++;function xe (Y){if(!Y)z(),te.primType=Ii,te.vertCount=0,te.type=ei;else if(typeof Y=='number')z(Y),te.primType=Ii,te.vertCount=Y|0,te.type=ei;else{let ye=null,me=Mc,Ie=-1,q=-1,W=0,Se=0;Array.isArray(Y)||r(Y)||er(Y)?ye=Y:(p.type(Y,'object','invalid arguments for elements'),'data'in Y&&(ye=Y.data,p(Array.isArray(ye)||r(ye)||er(ye),'invalid data for element buffer')),'usage'in Y&&(p.parameter(Y.usage,rn,'invalid element buffer usage'),me=rn[Y.usage]),'primitive'in Y&&(p.parameter(Y.primitive,kr,'invalid element buffer primitive'),Ie=kr[Y.primitive]),'count'in Y&&(p(typeof Y.count=='number'&&Y.count>=0,'invalid vertex count for elements'),q=Y.count|0),'type'in Y&&(p.parameter(Y.type,j,'invalid buffer type'),Se=j[Y.type]),'length'in Y?W=Y.length|0:(W=q,Se===ti||Se===eo?W*=2:(Se===Gr||Se===to)&&(W*=4))),ae(te,ye,me,Ie,q,W,Se)}return xe}return xe(re),xe._reglType='elements',xe._elements=te,xe.subdata=function (Y,ye){return z.subdata(Y,ye),xe},xe.destroy=function (){ce(te)},xe}return{ create:J,createStream:ne,destroyStream:oe,getElements (re){return typeof re=='function'&&re._elements instanceof Z?re._elements:null},clear (){jt(H).forEach(ce)} }}const ro=new Float32Array(1),Gc=new Uint32Array(ro.buffer),Vc=5123;function io (s){for(var c=dt.allocType(Vc,s.length),b=0;b<s.length;++b)if(isNaN(s[b]))c[b]=65535;else if(s[b]===1/0)c[b]=31744;else if(s[b]===-1/0)c[b]=64512;else{ro[0]=s[b];const V=Gc[0],H=V>>>31<<15,G=(V<<1>>>24)-127,j=V>>13&1023;if(G<-24)c[b]=H;else if(G<-14){const Z=-14-G;c[b]=H+(j+1024>>Z)}else G>15?c[b]=H+31744:c[b]=H+(G+15<<10)+j}return c}function ct (s){return Array.isArray(s)||r(s)}const no=function (s){return!(s&s-1)&&!!s},Uc=34467,sr=3553,ma=34067,an=34069,Vr=6408,va=6406,sn=6407,Ri=6409,on=6410,ao=32854,ga=32855,so=36194,zc=32819,jc=32820,Wc=33635,Hc=34042,ya=6402,un=34041,ba=35904,xa=35906,ri=36193,_a=33776,wa=33777,Sa=33778,Ea=33779,oo=35986,uo=35987,lo=34798,fo=35840,co=35841,ho=35842,po=35843,mo=36196,ii=5121,Aa=5123,Ta=5125,Pi=5126,qc=10242,$c=10243,Xc=10497,Ca=33071,Yc=33648,Kc=10240,Qc=10241,ka=9728,Zc=9729,La=9984,vo=9985,go=9986,Ia=9987,Jc=33170,ln=4352,eh=4353,th=4354,rh=34046,ih=3317,nh=37440,ah=37441,sh=37443,yo=37444,Oi=33984,oh=[La,go,vo,Ia],fn=[0,Ri,on,sn,Vr],Ht={};Ht[Ri]=Ht[va]=Ht[ya]=1,Ht[un]=Ht[on]=2,Ht[sn]=Ht[ba]=3,Ht[Vr]=Ht[xa]=4;function ni (s){return'[object '+s+']'}const bo=ni('HTMLCanvasElement'),xo=ni('OffscreenCanvas'),_o=ni('CanvasRenderingContext2D'),wo=ni('ImageBitmap'),So=ni('HTMLImageElement'),Eo=ni('HTMLVideoElement'),uh=Object.keys(fa).concat([bo,xo,_o,wo,So,Eo]),ai=[];ai[ii]=1,ai[Pi]=4,ai[ri]=2,ai[Aa]=2,ai[Ta]=4;const Ct=[];Ct[ao]=2,Ct[ga]=2,Ct[so]=2,Ct[un]=4,Ct[_a]=.5,Ct[wa]=.5,Ct[Sa]=1,Ct[Ea]=1,Ct[oo]=.5,Ct[uo]=1,Ct[lo]=1,Ct[fo]=.5,Ct[co]=.25,Ct[ho]=.5,Ct[po]=.25,Ct[mo]=.5;function Ao (s){return Array.isArray(s)&&(s.length===0||typeof s[0]=='number')}function To (s){if(!Array.isArray(s))return!1;const c=s.length;return!(c===0||!ct(s[0]))}function Ur (s){return Object.prototype.toString.call(s)}function Co (s){return Ur(s)===bo}function ko (s){return Ur(s)===xo}function lh (s){return Ur(s)===_o}function fh (s){return Ur(s)===wo}function ch (s){return Ur(s)===So}function hh (s){return Ur(s)===Eo}function Ra (s){if(!s)return!1;const c=Ur(s);return uh.indexOf(c)>=0?!0:Ao(s)||To(s)||er(s)}function Lo (s){return fa[Object.prototype.toString.call(s)]|0}function ph (s,c){const b=c.length;switch(s.type){case ii:case Aa:case Ta:case Pi:var V=dt.allocType(s.type,b);V.set(c),s.data=V;break;case ri:s.data=io(c);break;default:p.raise('unsupported texture type, must specify a typed array')}}function Io (s,c){return dt.allocType(s.type===ri?Pi:s.type,c)}function Ro (s,c){s.type===ri?(s.data=io(c),dt.freeType(c)):s.data=c}function dh (s,c,b,V,H,G){for(var j=s.width,Z=s.height,K=s.channels,ne=j*Z*K,oe=Io(s,ne),ae=0,ce=0;ce<Z;++ce)for(let J=0;J<j;++J)for(let re=0;re<K;++re)oe[ae++]=c[b*J+V*ce+H*re+G];Ro(s,oe)}function cn (s,c,b,V,H,G){let j;if(typeof Ct[s]<'u'?j=Ct[s]:j=Ht[s]*ai[c],G&&(j*=6),H){for(var Z=0,K=b;K>=1;)Z+=j*K*K,K/=2;return Z}else return j*b*V}function mh (s,c,b,V,H,G,j){const Z={ "don't care":ln,'dont care':ln,nice:th,fast:eh },K={ repeat:Xc,clamp:Ca,mirror:Yc },ne={ nearest:ka,linear:Zc },oe=i({ mipmap:Ia,'nearest mipmap nearest':La,'linear mipmap nearest':vo,'nearest mipmap linear':go,'linear mipmap linear':Ia },ne),ae={ none:0,browser:yo },ce={ uint8:ii,rgba4:zc,rgb565:Wc,'rgb5 a1':jc },J={ alpha:va,luminance:Ri,'luminance alpha':on,rgb:sn,rgba:Vr,rgba4:ao,'rgb5 a1':ga,rgb565:so },re={};c.ext_srgb&&(J.srgb=ba,J.srgba=xa),c.oes_texture_float&&(ce.float32=ce.float=Pi),c.oes_texture_half_float&&(ce.float16=ce['half float']=ri),c.webgl_depth_texture&&(i(J,{ depth:ya,'depth stencil':un }),i(ce,{ uint16:Aa,uint32:Ta,'depth stencil':Hc })),c.webgl_compressed_texture_s3tc&&i(re,{ 'rgb s3tc dxt1':_a,'rgba s3tc dxt1':wa,'rgba s3tc dxt3':Sa,'rgba s3tc dxt5':Ea }),c.webgl_compressed_texture_atc&&i(re,{ 'rgb atc':oo,'rgba atc explicit alpha':uo,'rgba atc interpolated alpha':lo }),c.webgl_compressed_texture_pvrtc&&i(re,{ 'rgb pvrtc 4bppv1':fo,'rgb pvrtc 2bppv1':co,'rgba pvrtc 4bppv1':ho,'rgba pvrtc 2bppv1':po }),c.webgl_compressed_texture_etc1&&(re['rgb etc1']=mo);const R=Array.prototype.slice.call(s.getParameter(Uc));Object.keys(re).forEach(function (g){const U=re[g];R.indexOf(U)>=0&&(J[g]=U)});const z=Object.keys(J);b.textureFormats=z;const te=[];Object.keys(J).forEach(function (g){const U=J[g];te[U]=g});const xe=[];Object.keys(ce).forEach(function (g){const U=ce[g];xe[U]=g});const Y=[];Object.keys(ne).forEach(function (g){const U=ne[g];Y[U]=g});const ye=[];Object.keys(oe).forEach(function (g){const U=oe[g];ye[U]=g});const me=[];Object.keys(K).forEach(function (g){const U=K[g];me[U]=g});const Ie=z.reduce(function (g,U){const M=J[U];return M===Ri||M===va||M===Ri||M===on||M===ya||M===un||c.ext_srgb&&(M===ba||M===xa)?g[M]=M:M===ga||U.indexOf('rgba')>=0?g[M]=Vr:g[M]=sn,g},{});function q (){this.internalformat=Vr,this.format=Vr,this.type=ii,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=yo,this.width=0,this.height=0,this.channels=0}function W (g,U){g.internalformat=U.internalformat,g.format=U.format,g.type=U.type,g.compressed=U.compressed,g.premultiplyAlpha=U.premultiplyAlpha,g.flipY=U.flipY,g.unpackAlignment=U.unpackAlignment,g.colorSpace=U.colorSpace,g.width=U.width,g.height=U.height,g.channels=U.channels}function Se (g,U){if(!(typeof U!='object'||!U)){if('premultiplyAlpha'in U&&(p.type(U.premultiplyAlpha,'boolean','invalid premultiplyAlpha'),g.premultiplyAlpha=U.premultiplyAlpha),'flipY'in U&&(p.type(U.flipY,'boolean','invalid texture flip'),g.flipY=U.flipY),'alignment'in U&&(p.oneOf(U.alignment,[1,2,4,8],'invalid texture unpack alignment'),g.unpackAlignment=U.alignment),'colorSpace'in U&&(p.parameter(U.colorSpace,ae,'invalid colorSpace'),g.colorSpace=ae[U.colorSpace]),'type'in U){const M=U.type;p(c.oes_texture_float||!(M==='float'||M==='float32'),'you must enable the OES_texture_float extension in order to use floating point textures.'),p(c.oes_texture_half_float||!(M==='half float'||M==='float16'),'you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.'),p(c.webgl_depth_texture||!(M==='uint16'||M==='uint32'||M==='depth stencil'),'you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.'),p.parameter(M,ce,'invalid texture type'),g.type=ce[M]}let we=g.width,We=g.height,d=g.channels,l=!1;'shape'in U?(p(Array.isArray(U.shape)&&U.shape.length>=2,'shape must be an array'),we=U.shape[0],We=U.shape[1],U.shape.length===3&&(d=U.shape[2],p(d>0&&d<=4,'invalid number of channels'),l=!0),p(we>=0&&we<=b.maxTextureSize,'invalid width'),p(We>=0&&We<=b.maxTextureSize,'invalid height')):('radius'in U&&(we=We=U.radius,p(we>=0&&we<=b.maxTextureSize,'invalid radius')),'width'in U&&(we=U.width,p(we>=0&&we<=b.maxTextureSize,'invalid width')),'height'in U&&(We=U.height,p(We>=0&&We<=b.maxTextureSize,'invalid height')),'channels'in U&&(d=U.channels,p(d>0&&d<=4,'invalid number of channels'),l=!0)),g.width=we|0,g.height=We|0,g.channels=d|0;let S=!1;if('format'in U){const I=U.format;p(c.webgl_depth_texture||!(I==='depth'||I==='depth stencil'),'you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.'),p.parameter(I,J,'invalid texture format');const N=g.internalformat=J[I];g.format=Ie[N],I in ce&&('type'in U||(g.type=ce[I])),I in re&&(g.compressed=!0),S=!0}!l&&S?g.channels=Ht[g.format]:l&&!S?g.channels!==fn[g.format]&&(g.format=g.internalformat=fn[g.channels]):S&&l&&p(g.channels===Ht[g.format],'number of channels inconsistent with specified format')}}function he (g){s.pixelStorei(nh,g.flipY),s.pixelStorei(ah,g.premultiplyAlpha),s.pixelStorei(sh,g.colorSpace),s.pixelStorei(ih,g.unpackAlignment)}function ee (){q.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function pe (g,U){let M=null;if(Ra(U)?M=U:U&&(p.type(U,'object','invalid pixel data type'),Se(g,U),'x'in U&&(g.xOffset=U.x|0),'y'in U&&(g.yOffset=U.y|0),Ra(U.data)&&(M=U.data)),p(!g.compressed||M instanceof Uint8Array,'compressed texture data must be stored in a uint8array'),U.copy){p(!M,'can not specify copy and data field for the same texture');const we=H.viewportWidth,We=H.viewportHeight;g.width=g.width||we-g.xOffset,g.height=g.height||We-g.yOffset,g.needsCopy=!0,p(g.xOffset>=0&&g.xOffset<we&&g.yOffset>=0&&g.yOffset<We&&g.width>0&&g.width<=we&&g.height>0&&g.height<=We,'copy texture read out of bounds')}else if(!M)g.width=g.width||1,g.height=g.height||1,g.channels=g.channels||4;else if(r(M))g.channels=g.channels||4,g.data=M,!('type'in U)&&g.type===ii&&(g.type=Lo(M));else if(Ao(M))g.channels=g.channels||4,ph(g,M),g.alignment=1,g.needsFree=!0;else if(er(M)){const d=M.data;!Array.isArray(d)&&g.type===ii&&(g.type=Lo(d));let l=M.shape,S=M.stride,I,N,A,E,L,h;l.length===3?(A=l[2],h=S[2]):(p(l.length===2,'invalid ndarray pixel data, must be 2 or 3D'),A=1,h=1),I=l[0],N=l[1],E=S[0],L=S[1],g.alignment=1,g.width=I,g.height=N,g.channels=A,g.format=g.internalformat=fn[A],g.needsFree=!0,dh(g,d,E,L,h,M.offset)}else if(Co(M)||ko(M)||lh(M))Co(M)||ko(M)?g.element=M:g.element=M.canvas,g.width=g.element.width,g.height=g.element.height,g.channels=4;else if(fh(M))g.element=M,g.width=M.width,g.height=M.height,g.channels=4;else if(ch(M))g.element=M,g.width=M.naturalWidth,g.height=M.naturalHeight,g.channels=4;else if(hh(M))g.element=M,g.width=M.videoWidth,g.height=M.videoHeight,g.channels=4;else if(To(M)){let w=g.width||M[0].length,v=g.height||M.length,O=g.channels;ct(M[0][0])?O=O||M[0][0].length:O=O||1;for(var B=tn.shape(M),$=1,le=0;le<B.length;++le)$*=B[le];const fe=Io(g,$);tn.flatten(M,B,'',fe),Ro(g,fe),g.alignment=1,g.width=w,g.height=v,g.channels=O,g.format=g.internalformat=fn[O],g.needsFree=!0}g.type===Pi?p(b.extensions.indexOf('oes_texture_float')>=0,'oes_texture_float extension not enabled'):g.type===ri&&p(b.extensions.indexOf('oes_texture_half_float')>=0,'oes_texture_half_float extension not enabled')}function de (g,U,M){const we=g.element,We=g.data,d=g.internalformat,l=g.format,S=g.type,I=g.width,N=g.height;he(g),we?s.texImage2D(U,M,l,l,S,we):g.compressed?s.compressedTexImage2D(U,M,d,I,N,0,We):g.needsCopy?(V(),s.copyTexImage2D(U,M,l,g.xOffset,g.yOffset,I,N,0)):s.texImage2D(U,M,l,I,N,0,l,S,We||null)}function Ve (g,U,M,we,We){const d=g.element,l=g.data,S=g.internalformat,I=g.format,N=g.type,A=g.width,E=g.height;he(g),d?s.texSubImage2D(U,We,M,we,I,N,d):g.compressed?s.compressedTexSubImage2D(U,We,M,we,S,A,E,l):g.needsCopy?(V(),s.copyTexSubImage2D(U,We,M,we,g.xOffset,g.yOffset,A,E)):s.texSubImage2D(U,We,M,we,A,E,I,N,l)}const Be=[];function ve (){return Be.pop()||new ee}function be (g){g.needsFree&&dt.freeType(g.data),ee.call(g),Be.push(g)}function Oe (){q.call(this),this.genMipmaps=!1,this.mipmapHint=ln,this.mipmask=0,this.images=Array(16)}function Me (g,U,M){const we=g.images[0]=ve();g.mipmask=1,we.width=g.width=U,we.height=g.height=M,we.channels=g.channels=4}function qe (g,U){let M=null;if(Ra(U))M=g.images[0]=ve(),W(M,g),pe(M,U),g.mipmask=1;else if(Se(g,U),Array.isArray(U.mipmap))for(let we=U.mipmap,We=0;We<we.length;++We)M=g.images[We]=ve(),W(M,g),M.width>>=We,M.height>>=We,pe(M,we[We]),g.mipmask|=1<<We;else M=g.images[0]=ve(),W(M,g),pe(M,U),g.mipmask=1;W(g,g.images[0]),g.compressed&&(g.internalformat===_a||g.internalformat===wa||g.internalformat===Sa||g.internalformat===Ea)&&p(g.width%4===0&&g.height%4===0,'for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4')}function ut (g,U){for(let M=g.images,we=0;we<M.length;++we){if(!M[we])return;de(M[we],U,we)}}const lt=[];function Ye (){const g=lt.pop()||new Oe;q.call(g),g.mipmask=0;for(let U=0;U<16;++U)g.images[U]=null;return g}function yt (g){for(let U=g.images,M=0;M<U.length;++M)U[M]&&be(U[M]),U[M]=null;lt.push(g)}function st (){this.minFilter=ka,this.magFilter=ka,this.wrapS=Ca,this.wrapT=Ca,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ln}function vt (g,U){if('min'in U){const M=U.min;p.parameter(M,oe),g.minFilter=oe[M],oh.indexOf(g.minFilter)>=0&&!('faces'in U)&&(g.genMipmaps=!0)}if('mag'in U){const we=U.mag;p.parameter(we,ne),g.magFilter=ne[we]}let We=g.wrapS,d=g.wrapT;if('wrap'in U){const l=U.wrap;typeof l=='string'?(p.parameter(l,K),We=d=K[l]):Array.isArray(l)&&(p.parameter(l[0],K),p.parameter(l[1],K),We=K[l[0]],d=K[l[1]])}else{if('wrapS'in U){const S=U.wrapS;p.parameter(S,K),We=K[S]}if('wrapT'in U){const I=U.wrapT;p.parameter(I,K),d=K[I]}}if(g.wrapS=We,g.wrapT=d,'anisotropic'in U){const N=U.anisotropic;p(typeof N=='number'&&N>=1&&N<=b.maxAnisotropic,'aniso samples must be between 1 and '),g.anisotropic=U.anisotropic}if('mipmap'in U){let A=!1;switch(typeof U.mipmap){case'string':p.parameter(U.mipmap,Z,'invalid mipmap hint'),g.mipmapHint=Z[U.mipmap],g.genMipmaps=!0,A=!0;break;case'boolean':A=g.genMipmaps=U.mipmap;break;case'object':p(Array.isArray(U.mipmap),'invalid mipmap type'),g.genMipmaps=!1,A=!0;break;default:p.raise('invalid mipmap type')}A&&!('min'in U)&&(g.minFilter=La)}}function bt (g,U){s.texParameteri(U,Qc,g.minFilter),s.texParameteri(U,Kc,g.magFilter),s.texParameteri(U,qc,g.wrapS),s.texParameteri(U,$c,g.wrapT),c.ext_texture_filter_anisotropic&&s.texParameteri(U,rh,g.anisotropic),g.genMipmaps&&(s.hint(Jc,g.mipmapHint),s.generateMipmap(U))}let xt=0,Et={},kt=b.maxTextureUnits,ht=Array(kt).map(function (){return null});function Ue (g){q.call(this),this.mipmask=0,this.internalformat=Vr,this.id=xt++,this.refCount=1,this.target=g,this.texture=s.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new st,j.profile&&(this.stats={ size:0 })}function Lt (g){s.activeTexture(Oi),s.bindTexture(g.target,g.texture)}function et (){const g=ht[0];g?s.bindTexture(g.target,g.texture):s.bindTexture(sr,null)}function Pe (g){const U=g.texture;p(U,'must not double destroy texture');const M=g.unit,we=g.target;M>=0&&(s.activeTexture(Oi+M),s.bindTexture(we,null),ht[M]=null),s.deleteTexture(U),g.texture=null,g.params=null,g.pixels=null,g.refCount=0,delete Et[g.id],G.textureCount--}i(Ue.prototype,{ bind (){const g=this;g.bindCount+=1;let U=g.unit;if(U<0){for(let M=0;M<kt;++M){const we=ht[M];if(we){if(we.bindCount>0)continue;we.unit=-1}ht[M]=g,U=M;break}U>=kt&&p.raise('insufficient number of texture units'),j.profile&&G.maxTextureUnits<U+1&&(G.maxTextureUnits=U+1),g.unit=U,s.activeTexture(Oi+U),s.bindTexture(g.target,g.texture)}return U},unbind (){this.bindCount-=1},decRef (){--this.refCount<=0&&Pe(this)} });function $e (g,U){const M=new Ue(sr);Et[M.id]=M,G.textureCount++;function we (l,S){const I=M.texInfo;st.call(I);const N=Ye();return typeof l=='number'?typeof S=='number'?Me(N,l|0,S|0):Me(N,l|0,l|0):l?(p.type(l,'object','invalid arguments to regl.texture'),vt(I,l),qe(N,l)):Me(N,1,1),I.genMipmaps&&(N.mipmask=(N.width<<1)-1),M.mipmask=N.mipmask,W(M,N),p.texture2D(I,N,b),M.internalformat=N.internalformat,we.width=N.width,we.height=N.height,Lt(M),ut(N,sr),bt(I,sr),et(),yt(N),j.profile&&(M.stats.size=cn(M.internalformat,M.type,N.width,N.height,I.genMipmaps,!1)),we.format=te[M.internalformat],we.type=xe[M.type],we.mag=Y[I.magFilter],we.min=ye[I.minFilter],we.wrapS=me[I.wrapS],we.wrapT=me[I.wrapT],we}function We (l,S,I,N){p(!!l,'must specify image data');const A=S|0,E=I|0,L=N|0,h=ve();return W(h,M),h.width=0,h.height=0,pe(h,l),h.width=h.width||(M.width>>L)-A,h.height=h.height||(M.height>>L)-E,p(M.type===h.type&&M.format===h.format&&M.internalformat===h.internalformat,'incompatible format for texture.subimage'),p(A>=0&&E>=0&&A+h.width<=M.width&&E+h.height<=M.height,'texture.subimage write out of bounds'),p(M.mipmask&1<<L,'missing mipmap data'),p(h.data||h.element||h.needsCopy,'missing image data'),Lt(M),Ve(h,sr,A,E,L),et(),be(h),we}function d (l,S){const I=l|0,N=S|0||I;if(I===M.width&&N===M.height)return we;we.width=M.width=I,we.height=M.height=N,Lt(M);for(let A=0;M.mipmask>>A;++A){const E=I>>A,L=N>>A;if(!E||!L)break;s.texImage2D(sr,A,M.format,E,L,0,M.format,M.type,null)}return et(),j.profile&&(M.stats.size=cn(M.internalformat,M.type,I,N,!1,!1)),we}return we(g,U),we.subimage=We,we.resize=d,we._reglType='texture2d',we._texture=M,j.profile&&(we.stats=M.stats),we.destroy=function (){M.decRef()},we}function Ze (g,U,M,we,We,d){const l=new Ue(ma);Et[l.id]=l,G.cubeCount++;const S=new Array(6);function I (E,L,h,w,v,O){let B,$=l.texInfo;for(st.call($),B=0;B<6;++B)S[B]=Ye();if(typeof E=='number'||!E){const le=E|0||1;for(B=0;B<6;++B)Me(S[B],le,le)}else if(typeof E=='object')if(L)qe(S[0],E),qe(S[1],L),qe(S[2],h),qe(S[3],w),qe(S[4],v),qe(S[5],O);else if(vt($,E),Se(l,E),'faces'in E){const fe=E.faces;for(p(Array.isArray(fe)&&fe.length===6,'cube faces must be a length 6 array'),B=0;B<6;++B)p(typeof fe[B]=='object'&&!!fe[B],'invalid input for cube map face'),W(S[B],l),qe(S[B],fe[B])}else for(B=0;B<6;++B)qe(S[B],E);else p.raise('invalid arguments to cube map');for(W(l,S[0]),p.optional(function (){b.npotTextureCube||p(no(l.width)&&no(l.height),'your browser does not support non power or two texture dimensions')}),$.genMipmaps?l.mipmask=(S[0].width<<1)-1:l.mipmask=S[0].mipmask,p.textureCube(l,$,S,b),l.internalformat=S[0].internalformat,I.width=S[0].width,I.height=S[0].height,Lt(l),B=0;B<6;++B)ut(S[B],an+B);for(bt($,ma),et(),j.profile&&(l.stats.size=cn(l.internalformat,l.type,I.width,I.height,$.genMipmaps,!0)),I.format=te[l.internalformat],I.type=xe[l.type],I.mag=Y[$.magFilter],I.min=ye[$.minFilter],I.wrapS=me[$.wrapS],I.wrapT=me[$.wrapT],B=0;B<6;++B)yt(S[B]);return I}function N (E,L,h,w,v){p(!!L,'must specify image data'),p(typeof E=='number'&&E===(E|0)&&E>=0&&E<6,'invalid face');const O=h|0,B=w|0,$=v|0,le=ve();return W(le,l),le.width=0,le.height=0,pe(le,L),le.width=le.width||(l.width>>$)-O,le.height=le.height||(l.height>>$)-B,p(l.type===le.type&&l.format===le.format&&l.internalformat===le.internalformat,'incompatible format for texture.subimage'),p(O>=0&&B>=0&&O+le.width<=l.width&&B+le.height<=l.height,'texture.subimage write out of bounds'),p(l.mipmask&1<<$,'missing mipmap data'),p(le.data||le.element||le.needsCopy,'missing image data'),Lt(l),Ve(le,an+E,O,B,$),et(),be(le),I}function A (E){const L=E|0;if(L!==l.width){I.width=l.width=L,I.height=l.height=L,Lt(l);for(let h=0;h<6;++h)for(let w=0;l.mipmask>>w;++w)s.texImage2D(an+h,w,l.format,L>>w,L>>w,0,l.format,l.type,null);return et(),j.profile&&(l.stats.size=cn(l.internalformat,l.type,I.width,I.height,!1,!0)),I}}return I(g,U,M,we,We,d),I.subimage=N,I.resize=A,I._reglType='textureCube',I._texture=l,j.profile&&(I.stats=l.stats),I.destroy=function (){l.decRef()},I}function pt (){for(let g=0;g<kt;++g)s.activeTexture(Oi+g),s.bindTexture(sr,null),ht[g]=null;jt(Et).forEach(Pe),G.cubeCount=0,G.textureCount=0}j.profile&&(G.getTotalTextureSize=function (){let g=0;return Object.keys(Et).forEach(function (U){g+=Et[U].stats.size}),g});function ur (){for(let g=0;g<kt;++g){const U=ht[g];U&&(U.bindCount=0,U.unit=-1,ht[g]=null)}jt(Et).forEach(function (M){M.texture=s.createTexture(),s.bindTexture(M.target,M.texture);for(let we=0;we<32;++we)if((M.mipmask&1<<we)!==0)if(M.target===sr)s.texImage2D(sr,we,M.internalformat,M.width>>we,M.height>>we,0,M.internalformat,M.type,null);else for(let We=0;We<6;++We)s.texImage2D(an+We,we,M.internalformat,M.width>>we,M.height>>we,0,M.internalformat,M.type,null);bt(M.texInfo,M.target)})}function Xr (){for(let g=0;g<kt;++g){const U=ht[g];U&&(U.bindCount=0,U.unit=-1,ht[g]=null),s.activeTexture(Oi+g),s.bindTexture(sr,null),s.bindTexture(ma,null)}}return{ create2D:$e,createCube:Ze,clear:pt,getTexture (g){return null},restore:ur,refresh:Xr }}const Lr=36161,hn=32854,Po=32855,Oo=36194,No=33189,Fo=36168,Bo=34041,Mo=35907,Do=34836,Go=34842,Vo=34843,tr=[];tr[hn]=2,tr[Po]=2,tr[Oo]=2,tr[No]=2,tr[Fo]=1,tr[Bo]=4,tr[Mo]=4,tr[Do]=16,tr[Go]=8,tr[Vo]=6;function Uo (s,c,b){return tr[s]*c*b}const vh=function (s,c,b,V,H){const G={ rgba4:hn,rgb565:Oo,'rgb5 a1':Po,depth:No,stencil:Fo,'depth stencil':Bo };c.ext_srgb&&(G.srgba=Mo),c.ext_color_buffer_half_float&&(G.rgba16f=Go,G.rgb16f=Vo),c.webgl_color_buffer_float&&(G.rgba32f=Do);const j=[];Object.keys(G).forEach(function (J){const re=G[J];j[re]=J});let Z=0,K={};function ne (J){this.id=Z++,this.refCount=1,this.renderbuffer=J,this.format=hn,this.width=0,this.height=0,H.profile&&(this.stats={ size:0 })}ne.prototype.decRef=function (){--this.refCount<=0&&oe(this)};function oe (J){const re=J.renderbuffer;p(re,'must not double destroy renderbuffer'),s.bindRenderbuffer(Lr,null),s.deleteRenderbuffer(re),J.renderbuffer=null,J.refCount=0,delete K[J.id],V.renderbufferCount--}function ae (J,re){const R=new ne(s.createRenderbuffer());K[R.id]=R,V.renderbufferCount++;function z (xe,Y){let ye=0,me=0,Ie=hn;if(typeof xe=='object'&&xe){const q=xe;if('shape'in q){const W=q.shape;p(Array.isArray(W)&&W.length>=2,'invalid renderbuffer shape'),ye=W[0]|0,me=W[1]|0}else'radius'in q&&(ye=me=q.radius|0),'width'in q&&(ye=q.width|0),'height'in q&&(me=q.height|0);'format'in q&&(p.parameter(q.format,G,'invalid renderbuffer format'),Ie=G[q.format])}else typeof xe=='number'?(ye=xe|0,typeof Y=='number'?me=Y|0:me=ye):xe?p.raise('invalid arguments to renderbuffer constructor'):ye=me=1;if(p(ye>0&&me>0&&ye<=b.maxRenderbufferSize&&me<=b.maxRenderbufferSize,'invalid renderbuffer size'),!(ye===R.width&&me===R.height&&Ie===R.format))return z.width=R.width=ye,z.height=R.height=me,R.format=Ie,s.bindRenderbuffer(Lr,R.renderbuffer),s.renderbufferStorage(Lr,Ie,ye,me),p(s.getError()===0,'invalid render buffer format'),H.profile&&(R.stats.size=Uo(R.format,R.width,R.height)),z.format=j[R.format],z}function te (xe,Y){const ye=xe|0,me=Y|0||ye;return ye===R.width&&me===R.height||(p(ye>0&&me>0&&ye<=b.maxRenderbufferSize&&me<=b.maxRenderbufferSize,'invalid renderbuffer size'),z.width=R.width=ye,z.height=R.height=me,s.bindRenderbuffer(Lr,R.renderbuffer),s.renderbufferStorage(Lr,R.format,ye,me),p(s.getError()===0,'invalid render buffer format'),H.profile&&(R.stats.size=Uo(R.format,R.width,R.height))),z}return z(J,re),z.resize=te,z._reglType='renderbuffer',z._renderbuffer=R,H.profile&&(z.stats=R.stats),z.destroy=function (){R.decRef()},z}H.profile&&(V.getTotalRenderbufferSize=function (){let J=0;return Object.keys(K).forEach(function (re){J+=K[re].stats.size}),J});function ce (){jt(K).forEach(function (J){J.renderbuffer=s.createRenderbuffer(),s.bindRenderbuffer(Lr,J.renderbuffer),s.renderbufferStorage(Lr,J.format,J.width,J.height)}),s.bindRenderbuffer(Lr,null)}return{ create:ae,clear (){jt(K).forEach(oe)},restore:ce }},dr=36160,Pa=36161,zr=3553,pn=34069,zo=36064,jo=36096,Wo=36128,Ho=33306,qo=36053,gh=36054,yh=36055,bh=36057,xh=36061,_h=36193,wh=5121,Sh=5126,$o=6407,Xo=6408,Eh=6402,Ah=[$o,Xo],Oa=[];Oa[Xo]=4,Oa[$o]=3;const dn=[];dn[wh]=1,dn[Sh]=4,dn[_h]=2;const Th=32854,Ch=32855,kh=36194,Lh=33189,Ih=36168,Yo=34041,Rh=35907,Ph=34836,Oh=34842,Nh=34843,Fh=[Th,Ch,kh,Rh,Oh,Nh,Ph],si={};si[qo]='complete',si[gh]='incomplete attachment',si[bh]='incomplete dimensions',si[yh]='incomplete, missing attachment',si[xh]='unsupported';function Bh (s,c,b,V,H,G){const j={ cur:null,next:null,dirty:!1,setFBO:null },Z=['rgba'],K=['rgba4','rgb565','rgb5 a1'];c.ext_srgb&&K.push('srgba'),c.ext_color_buffer_half_float&&K.push('rgba16f','rgb16f'),c.webgl_color_buffer_float&&K.push('rgba32f');const ne=['uint8'];c.oes_texture_half_float&&ne.push('half float','float16'),c.oes_texture_float&&ne.push('float','float32');function oe (ee,pe,de){this.target=ee,this.texture=pe,this.renderbuffer=de;let Ve=0,Be=0;pe?(Ve=pe.width,Be=pe.height):de&&(Ve=de.width,Be=de.height),this.width=Ve,this.height=Be}function ae (ee){ee&&(ee.texture&&ee.texture._texture.decRef(),ee.renderbuffer&&ee.renderbuffer._renderbuffer.decRef())}function ce (ee,pe,de){if(ee)if(ee.texture){const Ve=ee.texture._texture,Be=Math.max(1,Ve.width),ve=Math.max(1,Ve.height);p(Be===pe&&ve===de,'inconsistent width/height for supplied texture'),Ve.refCount+=1}else{const be=ee.renderbuffer._renderbuffer;p(be.width===pe&&be.height===de,'inconsistent width/height for renderbuffer'),be.refCount+=1}}function J (ee,pe){pe&&(pe.texture?s.framebufferTexture2D(dr,ee,pe.target,pe.texture._texture.texture,0):s.framebufferRenderbuffer(dr,ee,Pa,pe.renderbuffer._renderbuffer.renderbuffer))}function re (ee){let pe=zr,de=null,Ve=null,Be=ee;typeof ee=='object'&&(Be=ee.data,'target'in ee&&(pe=ee.target|0)),p.type(Be,'function','invalid attachment data');const ve=Be._reglType;return ve==='texture2d'?(de=Be,p(pe===zr)):ve==='textureCube'?(de=Be,p(pe>=pn&&pe<pn+6,'invalid cube map target')):ve==='renderbuffer'?(Ve=Be,pe=Pa):p.raise('invalid regl object for attachment'),new oe(pe,de,Ve)}function R (ee,pe,de,Ve,Be){if(de){const ve=V.create2D({ width:ee,height:pe,format:Ve,type:Be });return ve._texture.refCount=0,new oe(zr,ve,null)}else{const be=H.create({ width:ee,height:pe,format:Ve });return be._renderbuffer.refCount=0,new oe(Pa,null,be)}}function z (ee){return ee&&(ee.texture||ee.renderbuffer)}function te (ee,pe,de){ee&&(ee.texture?ee.texture.resize(pe,de):ee.renderbuffer&&ee.renderbuffer.resize(pe,de),ee.width=pe,ee.height=de)}let xe=0,Y={};function ye (){this.id=xe++,Y[this.id]=this,this.framebuffer=s.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function me (ee){ee.colorAttachments.forEach(ae),ae(ee.depthAttachment),ae(ee.stencilAttachment),ae(ee.depthStencilAttachment)}function Ie (ee){const pe=ee.framebuffer;p(pe,'must not double destroy framebuffer'),s.deleteFramebuffer(pe),ee.framebuffer=null,G.framebufferCount--,delete Y[ee.id]}function q (ee){let pe;s.bindFramebuffer(dr,ee.framebuffer);const de=ee.colorAttachments;for(pe=0;pe<de.length;++pe)J(zo+pe,de[pe]);for(pe=de.length;pe<b.maxColorAttachments;++pe)s.framebufferTexture2D(dr,zo+pe,zr,null,0);s.framebufferTexture2D(dr,Ho,zr,null,0),s.framebufferTexture2D(dr,jo,zr,null,0),s.framebufferTexture2D(dr,Wo,zr,null,0),J(jo,ee.depthAttachment),J(Wo,ee.stencilAttachment),J(Ho,ee.depthStencilAttachment);const Ve=s.checkFramebufferStatus(dr);!s.isContextLost()&&Ve!==qo&&p.raise('framebuffer configuration not supported, status = '+si[Ve]),s.bindFramebuffer(dr,j.next?j.next.framebuffer:null),j.cur=j.next,s.getError()}function W (ee,pe){const de=new ye;G.framebufferCount++;function Ve (ve,be){let Oe;p(j.next!==de,'can not update framebuffer which is currently in use');let Me=0,qe=0,ut=!0,lt=!0,Ye=null,yt=!0,st='rgba',vt='uint8',bt=1,xt=null,Et=null,kt=null,ht=!1;if(typeof ve=='number')Me=ve|0,qe=be|0||Me;else if(!ve)Me=qe=1;else{p.type(ve,'object','invalid arguments for framebuffer');const Ue=ve;if('shape'in Ue){const Lt=Ue.shape;p(Array.isArray(Lt)&&Lt.length>=2,'invalid shape for framebuffer'),Me=Lt[0],qe=Lt[1]}else'radius'in Ue&&(Me=qe=Ue.radius),'width'in Ue&&(Me=Ue.width),'height'in Ue&&(qe=Ue.height);('color'in Ue||'colors'in Ue)&&(Ye=Ue.color||Ue.colors,Array.isArray(Ye)&&p(Ye.length===1||c.webgl_draw_buffers,'multiple render targets not supported')),Ye||('colorCount'in Ue&&(bt=Ue.colorCount|0,p(bt>0,'invalid color buffer count')),'colorTexture'in Ue&&(yt=!!Ue.colorTexture,st='rgba4'),'colorType'in Ue&&(vt=Ue.colorType,yt?(p(c.oes_texture_float||!(vt==='float'||vt==='float32'),'you must enable OES_texture_float in order to use floating point framebuffer objects'),p(c.oes_texture_half_float||!(vt==='half float'||vt==='float16'),'you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects')):vt==='half float'||vt==='float16'?(p(c.ext_color_buffer_half_float,'you must enable EXT_color_buffer_half_float to use 16-bit render buffers'),st='rgba16f'):(vt==='float'||vt==='float32')&&(p(c.webgl_color_buffer_float,'you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers'),st='rgba32f'),p.oneOf(vt,ne,'invalid color type')),'colorFormat'in Ue&&(st=Ue.colorFormat,Z.indexOf(st)>=0?yt=!0:K.indexOf(st)>=0?yt=!1:p.optional(function (){yt?p.oneOf(Ue.colorFormat,Z,'invalid color format for texture'):p.oneOf(Ue.colorFormat,K,'invalid color format for renderbuffer')}))),('depthTexture'in Ue||'depthStencilTexture'in Ue)&&(ht=!!(Ue.depthTexture||Ue.depthStencilTexture),p(!ht||c.webgl_depth_texture,'webgl_depth_texture extension not supported')),'depth'in Ue&&(typeof Ue.depth=='boolean'?ut=Ue.depth:(xt=Ue.depth,lt=!1)),'stencil'in Ue&&(typeof Ue.stencil=='boolean'?lt=Ue.stencil:(Et=Ue.stencil,ut=!1)),'depthStencil'in Ue&&(typeof Ue.depthStencil=='boolean'?ut=lt=Ue.depthStencil:(kt=Ue.depthStencil,ut=!1,lt=!1))}let et=null,Pe=null,$e=null,Ze=null;if(Array.isArray(Ye))et=Ye.map(re);else if(Ye)et=[re(Ye)];else for(et=new Array(bt),Oe=0;Oe<bt;++Oe)et[Oe]=R(Me,qe,yt,st,vt);p(c.webgl_draw_buffers||et.length<=1,'you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.'),p(et.length<=b.maxColorAttachments,'too many color attachments, not supported'),Me=Me||et[0].width,qe=qe||et[0].height,xt?Pe=re(xt):ut&&!lt&&(Pe=R(Me,qe,ht,'depth','uint32')),Et?$e=re(Et):lt&&!ut&&($e=R(Me,qe,!1,'stencil','uint8')),kt?Ze=re(kt):!xt&&!Et&&lt&&ut&&(Ze=R(Me,qe,ht,'depth stencil','depth stencil')),p(!!xt+!!Et+!!kt<=1,'invalid framebuffer configuration, can specify exactly one depth/stencil attachment');let pt=null;for(Oe=0;Oe<et.length;++Oe)if(ce(et[Oe],Me,qe),p(!et[Oe]||et[Oe].texture&&Ah.indexOf(et[Oe].texture._texture.format)>=0||et[Oe].renderbuffer&&Fh.indexOf(et[Oe].renderbuffer._renderbuffer.format)>=0,'framebuffer color attachment '+Oe+' is invalid'),et[Oe]&&et[Oe].texture){const ur=Oa[et[Oe].texture._texture.format]*dn[et[Oe].texture._texture.type];pt===null?pt=ur:p(pt===ur,'all color attachments much have the same number of bits per pixel.')}return ce(Pe,Me,qe),p(!Pe||Pe.texture&&Pe.texture._texture.format===Eh||Pe.renderbuffer&&Pe.renderbuffer._renderbuffer.format===Lh,'invalid depth attachment for framebuffer object'),ce($e,Me,qe),p(!$e||$e.renderbuffer&&$e.renderbuffer._renderbuffer.format===Ih,'invalid stencil attachment for framebuffer object'),ce(Ze,Me,qe),p(!Ze||Ze.texture&&Ze.texture._texture.format===Yo||Ze.renderbuffer&&Ze.renderbuffer._renderbuffer.format===Yo,'invalid depth-stencil attachment for framebuffer object'),me(de),de.width=Me,de.height=qe,de.colorAttachments=et,de.depthAttachment=Pe,de.stencilAttachment=$e,de.depthStencilAttachment=Ze,Ve.color=et.map(z),Ve.depth=z(Pe),Ve.stencil=z($e),Ve.depthStencil=z(Ze),Ve.width=de.width,Ve.height=de.height,q(de),Ve}function Be (ve,be){p(j.next!==de,'can not resize a framebuffer which is currently in use');const Oe=Math.max(ve|0,1),Me=Math.max(be|0||Oe,1);if(Oe===de.width&&Me===de.height)return Ve;for(let qe=de.colorAttachments,ut=0;ut<qe.length;++ut)te(qe[ut],Oe,Me);return te(de.depthAttachment,Oe,Me),te(de.stencilAttachment,Oe,Me),te(de.depthStencilAttachment,Oe,Me),de.width=Ve.width=Oe,de.height=Ve.height=Me,q(de),Ve}return Ve(ee,pe),i(Ve,{ resize:Be,_reglType:'framebuffer',_framebuffer:de,destroy (){Ie(de),me(de)},use (ve){j.setFBO({ framebuffer:Ve },ve)} })}function Se (ee){const pe=Array(6);function de (Be){let ve;p(pe.indexOf(j.next)<0,'can not update framebuffer which is currently in use');let be={ color:null },Oe=0,Me=null,qe='rgba',ut='uint8',lt=1;if(typeof Be=='number')Oe=Be|0;else if(!Be)Oe=1;else{p.type(Be,'object','invalid arguments for framebuffer');const Ye=Be;if('shape'in Ye){const yt=Ye.shape;p(Array.isArray(yt)&&yt.length>=2,'invalid shape for framebuffer'),p(yt[0]===yt[1],'cube framebuffer must be square'),Oe=yt[0]}else'radius'in Ye&&(Oe=Ye.radius|0),'width'in Ye?(Oe=Ye.width|0,'height'in Ye&&p(Ye.height===Oe,'must be square')):'height'in Ye&&(Oe=Ye.height|0);('color'in Ye||'colors'in Ye)&&(Me=Ye.color||Ye.colors,Array.isArray(Me)&&p(Me.length===1||c.webgl_draw_buffers,'multiple render targets not supported')),Me||('colorCount'in Ye&&(lt=Ye.colorCount|0,p(lt>0,'invalid color buffer count')),'colorType'in Ye&&(p.oneOf(Ye.colorType,ne,'invalid color type'),ut=Ye.colorType),'colorFormat'in Ye&&(qe=Ye.colorFormat,p.oneOf(Ye.colorFormat,Z,'invalid color format for texture'))),'depth'in Ye&&(be.depth=Ye.depth),'stencil'in Ye&&(be.stencil=Ye.stencil),'depthStencil'in Ye&&(be.depthStencil=Ye.depthStencil)}let st;if(Me)if(Array.isArray(Me))for(st=[],ve=0;ve<Me.length;++ve)st[ve]=Me[ve];else st=[Me];else{st=Array(lt);const vt={ radius:Oe,format:qe,type:ut };for(ve=0;ve<lt;++ve)st[ve]=V.createCube(vt)}for(be.color=Array(st.length),ve=0;ve<st.length;++ve){const bt=st[ve];p(typeof bt=='function'&&bt._reglType==='textureCube','invalid cube map'),Oe=Oe||bt.width,p(bt.width===Oe&&bt.height===Oe,'invalid cube map shape'),be.color[ve]={ target:pn,data:st[ve] }}for(ve=0;ve<6;++ve){for(let xt=0;xt<st.length;++xt)be.color[xt].target=pn+ve;ve>0&&(be.depth=pe[0].depth,be.stencil=pe[0].stencil,be.depthStencil=pe[0].depthStencil),pe[ve]?pe[ve](be):pe[ve]=W(be)}return i(de,{ width:Oe,height:Oe,color:st })}function Ve (Be){let ve,be=Be|0;if(p(be>0&&be<=b.maxCubeMapSize,'invalid radius for cube fbo'),be===de.width)return de;const Oe=de.color;for(ve=0;ve<Oe.length;++ve)Oe[ve].resize(be);for(ve=0;ve<6;++ve)pe[ve].resize(be);return de.width=de.height=be,de}return de(ee),i(de,{ faces:pe,resize:Ve,_reglType:'framebufferCube',destroy (){pe.forEach(function (Be){Be.destroy()})} })}function he (){j.cur=null,j.next=null,j.dirty=!0,jt(Y).forEach(function (ee){ee.framebuffer=s.createFramebuffer(),q(ee)})}return i(j,{ getFramebuffer (ee){if(typeof ee=='function'&&ee._reglType==='framebuffer'){const pe=ee._framebuffer;if(pe instanceof ye)return pe}return null},create:W,createCube:Se,clear (){jt(Y).forEach(Ie)},restore:he })}const Mh=5126,Ko=34962,mn=34963,Qo=['attributes','elements','offset','count','primitive','instances'];function Na (){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Mh,this.offset=0,this.stride=0,this.divisor=0}function Dh (s,c,b,V,H,G,j){for(var Z=b.maxAttributes,K=new Array(Z),ne=0;ne<Z;++ne)K[ne]=new Na;let oe=0,ae={},ce={ Record:Na,scope:{},state:K,currentVAO:null,targetVAO:null,restore:re()?me:function (){},createVAO:Ie,getVAO:z,destroyBuffer:J,setVAO:re()?te:xe,clear:re()?Y:function (){} };function J (q){for(let W=0;W<K.length;++W){const Se=K[W];Se.buffer===q&&(s.disableVertexAttribArray(W),Se.buffer=null)}}function re (){return c.oes_vertex_array_object}function R (){return c.angle_instanced_arrays}function z (q){return typeof q=='function'&&q._vao?q._vao:null}function te (q){if(q!==ce.currentVAO){const W=re();q?W.bindVertexArrayOES(q.vao):W.bindVertexArrayOES(null),ce.currentVAO=q}}function xe (q){if(q!==ce.currentVAO){if(q)q.bindAttrs();else{for(let W=R(),Se=0;Se<K.length;++Se){const he=K[Se];he.buffer?(s.enableVertexAttribArray(Se),he.buffer.bind(),s.vertexAttribPointer(Se,he.size,he.type,he.normalized,he.stride,he.offfset),W&&he.divisor&&W.vertexAttribDivisorANGLE(Se,he.divisor)):(s.disableVertexAttribArray(Se),s.vertexAttrib4f(Se,he.x,he.y,he.z,he.w))}j.elements?s.bindBuffer(mn,j.elements.buffer.buffer):s.bindBuffer(mn,null)}ce.currentVAO=q}}function Y (){jt(ae).forEach(function (q){q.destroy()})}function ye (){this.id=++oe,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;const q=re();q?this.vao=q.createVertexArrayOES():this.vao=null,ae[this.id]=this,this.buffers=[]}ye.prototype.bindAttrs=function (){for(var q=R(),W=this.attributes,Se=0;Se<W.length;++Se){const he=W[Se];he.buffer?(s.enableVertexAttribArray(Se),s.bindBuffer(Ko,he.buffer.buffer),s.vertexAttribPointer(Se,he.size,he.type,he.normalized,he.stride,he.offset),q&&he.divisor&&q.vertexAttribDivisorANGLE(Se,he.divisor)):(s.disableVertexAttribArray(Se),s.vertexAttrib4f(Se,he.x,he.y,he.z,he.w))}for(let ee=W.length;ee<Z;++ee)s.disableVertexAttribArray(ee);const pe=G.getElements(this.elements);pe?s.bindBuffer(mn,pe.buffer.buffer):s.bindBuffer(mn,null)},ye.prototype.refresh=function (){const q=re();q&&(q.bindVertexArrayOES(this.vao),this.bindAttrs(),ce.currentVAO=null,q.bindVertexArrayOES(null))},ye.prototype.destroy=function (){if(this.vao){const q=re();this===ce.currentVAO&&(ce.currentVAO=null,q.bindVertexArrayOES(null)),q.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),ae[this.id]&&(delete ae[this.id],V.vaoCount-=1)};function me (){const q=re();q&&jt(ae).forEach(function (W){W.refresh()})}function Ie (q){const W=new ye;V.vaoCount+=1;function Se (he){let ee;if(Array.isArray(he))ee=he,W.elements&&W.ownsElements&&W.elements.destroy(),W.elements=null,W.ownsElements=!1,W.offset=0,W.count=0,W.instances=-1,W.primitive=4;else{if(p(typeof he=='object','invalid arguments for create vao'),p('attributes'in he,'must specify attributes for vao'),he.elements){const pe=he.elements;W.ownsElements?typeof pe=='function'&&pe._reglType==='elements'?(W.elements.destroy(),W.ownsElements=!1):(W.elements(pe),W.ownsElements=!1):G.getElements(he.elements)?(W.elements=he.elements,W.ownsElements=!1):(W.elements=G.create(he.elements),W.ownsElements=!0)}else W.elements=null,W.ownsElements=!1;ee=he.attributes,W.offset=0,W.count=-1,W.instances=-1,W.primitive=4,W.elements&&(W.count=W.elements._elements.vertCount,W.primitive=W.elements._elements.primType),'offset'in he&&(W.offset=he.offset|0),'count'in he&&(W.count=he.count|0),'instances'in he&&(W.instances=he.instances|0),'primitive'in he&&(p(he.primitive in kr,'bad primitive type: '+he.primitive),W.primitive=kr[he.primitive]),p.optional(()=>{for(let ut=Object.keys(he),lt=0;lt<ut.length;++lt)p(Qo.indexOf(ut[lt])>=0,'invalid option for vao: "'+ut[lt]+'" valid options are '+Qo)}),p(Array.isArray(ee),'attributes must be an array')}p(ee.length<Z,'too many attributes'),p(ee.length>0,'must specify at least one attribute');const de={},Ve=W.attributes;Ve.length=ee.length;for(let Be=0;Be<ee.length;++Be){const ve=ee[Be],be=Ve[Be]=new Na,Oe=ve.data||ve;if(Array.isArray(Oe)||r(Oe)||er(Oe)){var Me;W.buffers[Be]&&(Me=W.buffers[Be],r(Oe)&&Me._buffer.byteLength>=Oe.byteLength?Me.subdata(Oe):(Me.destroy(),W.buffers[Be]=null)),W.buffers[Be]||(Me=W.buffers[Be]=H.create(ve,Ko,!1,!0)),be.buffer=H.getBuffer(Me),be.size=be.buffer.dimension|0,be.normalized=!1,be.type=be.buffer.dtype,be.offset=0,be.stride=0,be.divisor=0,be.state=1,de[Be]=1}else H.getBuffer(ve)?(be.buffer=H.getBuffer(ve),be.size=be.buffer.dimension|0,be.normalized=!1,be.type=be.buffer.dtype,be.offset=0,be.stride=0,be.divisor=0,be.state=1):H.getBuffer(ve.buffer)?(be.buffer=H.getBuffer(ve.buffer),be.size=(+ve.size||be.buffer.dimension)|0,be.normalized=!!ve.normalized||!1,'type'in ve?(p.parameter(ve.type,Dr,'invalid buffer type'),be.type=Dr[ve.type]):be.type=be.buffer.dtype,be.offset=(ve.offset||0)|0,be.stride=(ve.stride||0)|0,be.divisor=(ve.divisor||0)|0,be.state=1,p(be.size>=1&&be.size<=4,'size must be between 1 and 4'),p(be.offset>=0,'invalid offset'),p(be.stride>=0&&be.stride<=255,'stride must be between 0 and 255'),p(be.divisor>=0,'divisor must be positive'),p(!be.divisor||!!c.angle_instanced_arrays,'ANGLE_instanced_arrays must be enabled to use divisor')):'x'in ve?(p(Be>0,'first attribute must not be a constant'),be.x=+ve.x||0,be.y=+ve.y||0,be.z=+ve.z||0,be.w=+ve.w||0,be.state=2):p(!1,'invalid attribute spec for location '+Be)}for(let qe=0;qe<W.buffers.length;++qe)!de[qe]&&W.buffers[qe]&&(W.buffers[qe].destroy(),W.buffers[qe]=null);return W.refresh(),Se}return Se.destroy=function (){for(let he=0;he<W.buffers.length;++he)W.buffers[he]&&W.buffers[he].destroy();W.buffers.length=0,W.ownsElements&&(W.elements.destroy(),W.elements=null,W.ownsElements=!1),W.destroy()},Se._vao=W,Se._reglType='vao',Se(q)}return ce}const Zo=35632,Gh=35633,Vh=35718,Uh=35721;function zh (s,c,b,V){let H={},G={};function j (R,z,te,xe){this.name=R,this.id=z,this.location=te,this.info=xe}function Z (R,z){for(let te=0;te<R.length;++te)if(R[te].id===z.id){R[te].location=z.location;return}R.push(z)}function K (R,z,te){let xe=R===Zo?H:G,Y=xe[z];if(!Y){const ye=c.str(z);Y=s.createShader(R),s.shaderSource(Y,ye),s.compileShader(Y),p.shaderError(s,Y,ye,R,te),xe[z]=Y}return Y}let ne={},oe=[],ae=0;function ce (R,z){this.id=ae++,this.fragId=R,this.vertId=z,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,V.profile&&(this.stats={ uniformsCount:0,attributesCount:0 })}function J (R,z,te){let xe,Y,ye=K(Zo,R.fragId),me=K(Gh,R.vertId),Ie=R.program=s.createProgram();if(s.attachShader(Ie,ye),s.attachShader(Ie,me),te)for(xe=0;xe<te.length;++xe){const q=te[xe];s.bindAttribLocation(Ie,q[0],q[1])}s.linkProgram(Ie),p.linkError(s,Ie,c.str(R.fragId),c.str(R.vertId),z);const W=s.getProgramParameter(Ie,Vh);V.profile&&(R.stats.uniformsCount=W);const Se=R.uniforms;for(xe=0;xe<W;++xe)if(Y=s.getActiveUniform(Ie,xe),Y)if(Y.size>1)for(let he=0;he<Y.size;++he){const ee=Y.name.replace('[0]','['+he+']');Z(Se,new j(ee,c.id(ee),s.getUniformLocation(Ie,ee),Y))}else Z(Se,new j(Y.name,c.id(Y.name),s.getUniformLocation(Ie,Y.name),Y));const pe=s.getProgramParameter(Ie,Uh);V.profile&&(R.stats.attributesCount=pe);const de=R.attributes;for(xe=0;xe<pe;++xe)Y=s.getActiveAttrib(Ie,xe),Y&&Z(de,new j(Y.name,c.id(Y.name),s.getAttribLocation(Ie,Y.name),Y))}V.profile&&(b.getMaxUniformsCount=function (){let R=0;return oe.forEach(function (z){z.stats.uniformsCount>R&&(R=z.stats.uniformsCount)}),R},b.getMaxAttributesCount=function (){let R=0;return oe.forEach(function (z){z.stats.attributesCount>R&&(R=z.stats.attributesCount)}),R});function re (){H={},G={};for(let R=0;R<oe.length;++R)J(oe[R],null,oe[R].attributes.map(function (z){return[z.location,z.name]}))}return{ clear (){const R=s.deleteShader.bind(s);jt(H).forEach(R),H={},jt(G).forEach(R),G={},oe.forEach(function (z){s.deleteProgram(z.program)}),oe.length=0,ne={},b.shaderCount=0},program (R,z,te,xe){p.command(R>=0,'missing vertex shader',te),p.command(z>=0,'missing fragment shader',te);let Y=ne[z];Y||(Y=ne[z]={});const ye=Y[R];if(ye&&(ye.refCount++,!xe))return ye;const me=new ce(z,R);return b.shaderCount++,J(me,te,xe),ye||(Y[R]=me),oe.push(me),i(me,{ destroy (){if(me.refCount--,me.refCount<=0){s.deleteProgram(me.program);const Ie=oe.indexOf(me);oe.splice(Ie,1),b.shaderCount--}Y[me.vertId].refCount<=0&&(s.deleteShader(G[me.vertId]),delete G[me.vertId],delete ne[me.fragId][me.vertId]),Object.keys(ne[me.fragId]).length||(s.deleteShader(H[me.fragId]),delete H[me.fragId],delete ne[me.fragId])} })},restore:re,shader:K,frag:-1,vert:-1 }}const jh=6408,Ni=5121,Wh=3333,vn=5126;function Hh (s,c,b,V,H,G,j){function Z (oe){let ae;c.next===null?(p(H.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ae=Ni):(p(c.next.colorAttachments[0].texture!==null,'You cannot read from a renderbuffer'),ae=c.next.colorAttachments[0].texture._texture.type,p.optional(function (){G.oes_texture_float?(p(ae===Ni||ae===vn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ae===vn&&p(j.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):p(ae===Ni,"Reading from a framebuffer is only allowed for the type 'uint8'")}));let ce=0,J=0,re=V.framebufferWidth,R=V.framebufferHeight,z=null;r(oe)?z=oe:oe&&(p.type(oe,'object','invalid arguments to regl.read()'),ce=oe.x|0,J=oe.y|0,p(ce>=0&&ce<V.framebufferWidth,'invalid x offset for regl.read'),p(J>=0&&J<V.framebufferHeight,'invalid y offset for regl.read'),re=(oe.width||V.framebufferWidth-ce)|0,R=(oe.height||V.framebufferHeight-J)|0,z=oe.data||null),z&&(ae===Ni?p(z instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ae===vn&&p(z instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),p(re>0&&re+ce<=V.framebufferWidth,'invalid width for read pixels'),p(R>0&&R+J<=V.framebufferHeight,'invalid height for read pixels'),b();const te=re*R*4;return z||(ae===Ni?z=new Uint8Array(te):ae===vn&&(z=z||new Float32Array(te))),p.isTypedArray(z,'data buffer for regl.read() must be a typedarray'),p(z.byteLength>=te,'data buffer for regl.read() too small'),s.pixelStorei(Wh,4),s.readPixels(ce,J,re,R,jh,ae,z),z}function K (oe){let ae;return c.setFBO({ framebuffer:oe.framebuffer },function (){ae=Z(oe)}),ae}function ne (oe){return!oe||!('framebuffer'in oe)?Z(oe):K(oe)}return ne}function oi (s){return Array.prototype.slice.call(s)}function ui (s){return oi(s).join('')}function qh (){let s=0,c=[],b=[];function V (ae){for(let ce=0;ce<b.length;++ce)if(b[ce]===ae)return c[ce];const J='g'+s++;return c.push(J),b.push(ae),J}function H (){const ae=[];function ce (){ae.push.apply(ae,oi(arguments))}const J=[];function re (){const R='v'+s++;return J.push(R),arguments.length>0&&(ae.push(R,'='),ae.push.apply(ae,oi(arguments)),ae.push(';')),R}return i(ce,{ def:re,toString (){return ui([J.length>0?'var '+J.join(',')+';':'',ui(ae)])} })}function G (){const ae=H(),ce=H(),J=ae.toString,re=ce.toString;function R (z,te){ce(z,te,'=',ae.def(z,te),';')}return i(function (){ae.apply(ae,oi(arguments))},{ def:ae.def,entry:ae,exit:ce,save:R,set (z,te,xe){R(z,te),ae(z,te,'=',xe,';')},toString (){return J()+re()} })}function j (){const ae=ui(arguments),ce=G(),J=G(),re=ce.toString,R=J.toString;return i(ce,{ then (){return ce.apply(ce,oi(arguments)),this},else (){return J.apply(J,oi(arguments)),this},toString (){let z=R();return z&&(z='else{'+z+'}'),ui(['if(',ae,'){',re(),'}',z])} })}const Z=H(),K={};function ne (ae,ce){const J=[];function re (){const Y='a'+J.length;return J.push(Y),Y}ce=ce||0;for(let R=0;R<ce;++R)re();const z=G(),te=z.toString,xe=K[ae]=i(z,{ arg:re,toString (){return ui(['function(',J.join(),'){',te(),'}'])} });return xe}function oe (){const ae=['"use strict";',Z,'return {'];Object.keys(K).forEach(function (re){ae.push('"',re,'":',K[re].toString(),',')}),ae.push('}');const ce=ui(ae).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),J=Function.apply(null,c.concat(ce));return J.apply(null,b)}return{ global:Z,link:V,block:H,proc:ne,scope:G,cond:j,compile:oe }}const li='xyzw'.split(''),Jo=5121,fi=1,Fa=2,Ba=0,Ma=1,Da=2,Ga=3,gn=4,eu=5,tu=6,ru='dither',iu='blend.enable',nu='blend.color',Va='blend.equation',Ua='blend.func',au='depth.enable',su='depth.func',ou='depth.range',uu='depth.mask',za='colorMask',lu='cull.enable',fu='cull.face',ja='frontFace',Wa='lineWidth',cu='polygonOffset.enable',Ha='polygonOffset.offset',hu='sample.alpha',pu='sample.enable',qa='sample.coverage',du='stencil.enable',mu='stencil.mask',$a='stencil.func',Xa='stencil.opFront',Fi='stencil.opBack',vu='scissor.enable',yn='scissor.box',mr='viewport',Bi='profile',jr='framebuffer',Mi='vert',Di='frag',Wr='elements',Hr='primitive',qr='count',bn='offset',xn='instances',Gi='vao',Ya='Width',Ka='Height',ci=jr+Ya,hi=jr+Ka,$h=mr+Ya,Xh=mr+Ka,gu='drawingBuffer',yu=gu+Ya,bu=gu+Ka,Yh=[Ua,Va,$a,Xa,Fi,qa,mr,yn,Ha],pi=34962,Qa=34963,Kh=35632,Qh=35633,xu=3553,Zh=34067,Jh=2884,ep=3042,tp=3024,rp=2960,ip=2929,np=3089,ap=32823,sp=32926,op=32928,Za=5126,_n=35664,wn=35665,Sn=35666,Ja=5124,En=35667,An=35668,Tn=35669,es=35670,Cn=35671,kn=35672,Ln=35673,Vi=35674,Ui=35675,zi=35676,ji=35678,Wi=35680,ts=4,Hi=1028,$r=1029,_u=2304,rs=2305,up=32775,lp=32776,fp=519,Ir=7680,wu=0,Su=1,Eu=32774,cp=513,Au=36160,hp=36064,or={ 0:0,1:1,zero:0,one:1,'src color':768,'one minus src color':769,'src alpha':770,'one minus src alpha':771,'dst color':774,'one minus dst color':775,'dst alpha':772,'one minus dst alpha':773,'constant color':32769,'one minus constant color':32770,'constant alpha':32771,'one minus constant alpha':32772,'src alpha saturate':776 },Tu=['constant color, constant alpha','one minus constant color, constant alpha','constant color, one minus constant alpha','one minus constant color, one minus constant alpha','constant alpha, constant color','constant alpha, one minus constant color','one minus constant alpha, constant color','one minus constant alpha, one minus constant color'],di={ never:512,less:513,'<':513,equal:514,'=':514,'==':514,'===':514,lequal:515,'<=':515,greater:516,'>':516,notequal:517,'!=':517,'!==':517,gequal:518,'>=':518,always:519 },Rr={ 0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,'increment wrap':34055,'decrement wrap':34056,invert:5386 },Cu={ frag:Kh,vert:Qh },is={ cw:_u,ccw:rs };function In (s){return Array.isArray(s)||r(s)||er(s)}function ku (s){return s.sort(function (c,b){return c===mr?-1:b===mr?1:c<b?-1:1})}function St (s,c,b,V){this.thisDep=s,this.contextDep=c,this.propDep=b,this.append=V}function Pr (s){return s&&!(s.thisDep||s.contextDep||s.propDep)}function mt (s){return new St(!1,!1,!1,s)}function Bt (s,c){const b=s.type;if(b===Ba){const V=s.data.length;return new St(!0,V>=1,V>=2,c)}else if(b===gn){const H=s.data;return new St(H.thisDep,H.contextDep,H.propDep,c)}else{if(b===eu)return new St(!1,!1,!1,c);if(b===tu){for(var G=!1,j=!1,Z=!1,K=0;K<s.data.length;++K){const ne=s.data[K];if(ne.type===Ma)Z=!0;else if(ne.type===Da)j=!0;else if(ne.type===Ga)G=!0;else if(ne.type===Ba){G=!0;const oe=ne.data;oe>=1&&(j=!0),oe>=2&&(Z=!0)}else ne.type===gn&&(G=G||ne.data.thisDep,j=j||ne.data.contextDep,Z=Z||ne.data.propDep)}return new St(G,j,Z,c)}else return new St(b===Ga,b===Da,b===Ma,c)}}const Lu=new St(!1,!1,!1,function (){});function pp (s,c,b,V,H,G,j,Z,K,ne,oe,ae,ce,J,re){const R=ne.Record,z={ add:32774,subtract:32778,'reverse subtract':32779 };b.ext_blend_minmax&&(z.min=up,z.max=lp);const te=b.angle_instanced_arrays,xe=b.webgl_draw_buffers,Y=b.oes_vertex_array_object,ye={ dirty:!0,profile:re.profile },me={},Ie=[],q={},W={};function Se (d){return d.replace('.','_')}function he (d,l,S){const I=Se(d);Ie.push(d),me[I]=ye[I]=!!S,q[I]=l}function ee (d,l,S){const I=Se(d);Ie.push(d),Array.isArray(S)?(ye[I]=S.slice(),me[I]=S.slice()):ye[I]=me[I]=S,W[I]=l}he(ru,tp),he(iu,ep),ee(nu,'blendColor',[0,0,0,0]),ee(Va,'blendEquationSeparate',[Eu,Eu]),ee(Ua,'blendFuncSeparate',[Su,wu,Su,wu]),he(au,ip,!0),ee(su,'depthFunc',cp),ee(ou,'depthRange',[0,1]),ee(uu,'depthMask',!0),ee(za,za,[!0,!0,!0,!0]),he(lu,Jh),ee(fu,'cullFace',$r),ee(ja,ja,rs),ee(Wa,Wa,1),he(cu,ap),ee(Ha,'polygonOffset',[0,0]),he(hu,sp),he(pu,op),ee(qa,'sampleCoverage',[1,!1]),he(du,rp),ee(mu,'stencilMask',-1),ee($a,'stencilFunc',[fp,0,-1]),ee(Xa,'stencilOpSeparate',[Hi,Ir,Ir,Ir]),ee(Fi,'stencilOpSeparate',[$r,Ir,Ir,Ir]),he(vu,np),ee(yn,'scissor',[0,0,s.drawingBufferWidth,s.drawingBufferHeight]),ee(mr,mr,[0,0,s.drawingBufferWidth,s.drawingBufferHeight]);const pe={ gl:s,context:ce,strings:c,next:me,current:ye,draw:ae,elements:G,buffer:H,shader:oe,attributes:ne.state,vao:ne,uniforms:K,framebuffer:Z,extensions:b,timer:J,isBufferArgs:In },de={ primTypes:kr,compareFuncs:di,blendFuncs:or,blendEquations:z,stencilOps:Rr,glTypes:Dr,orientationType:is };p.optional(function (){pe.isArrayLike=ct}),xe&&(de.backBuffer=[$r],de.drawBuffer=zt(V.maxDrawbuffers,function (d){return d===0?[0]:zt(d,function (l){return hp+l})}));let Ve=0;function Be (){const d=qh(),l=d.link,S=d.global;d.id=Ve++,d.batchId='0';const I=l(pe),N=d.shared={ props:'a0' };Object.keys(pe).forEach(function (w){N[w]=S.def(I,'.',w)}),p.optional(function (){d.CHECK=l(p),d.commandStr=p.guessCommand(),d.command=l(d.commandStr),d.assert=function (w,v,O){w('if(!(',v,'))',this.CHECK,'.commandRaise(',l(O),',',this.command,');')},de.invalidBlendCombinations=Tu});const A=d.next={},E=d.current={};Object.keys(W).forEach(function (w){Array.isArray(ye[w])&&(A[w]=S.def(N.next,'.',w),E[w]=S.def(N.current,'.',w))});const L=d.constants={};Object.keys(de).forEach(function (w){L[w]=S.def(JSON.stringify(de[w]))}),d.invoke=function (w,v){switch(v.type){case Ba:var O=['this',N.context,N.props,d.batchId];return w.def(l(v.data),'.call(',O.slice(0,Math.max(v.data.length+1,4)),')');case Ma:return w.def(N.props,v.data);case Da:return w.def(N.context,v.data);case Ga:return w.def('this',v.data);case gn:return v.data.append(d,w),v.data.ref;case eu:return v.data.toString();case tu:return v.data.map(function (B){return d.invoke(w,B)})}},d.attribCache={};const h={};return d.scopeAttrib=function (w){const v=c.id(w);if(v in h)return h[v];let O=ne.scope[v];O||(O=ne.scope[v]=new R);const B=h[v]=l(O);return B},d}function ve (d){let l=d.static,S=d.dynamic,I;if(Bi in l){const N=!!l[Bi];I=mt(function (E,L){return N}),I.enable=N}else if(Bi in S){const A=S[Bi];I=Bt(A,function (E,L){return E.invoke(L,A)})}return I}function be (d,l){const S=d.static,I=d.dynamic;if(jr in S){let N=S[jr];return N?(N=Z.getFramebuffer(N),p.command(N,'invalid framebuffer object'),mt(function (E,L){const h=E.link(N),w=E.shared;L.set(w.framebuffer,'.next',h);const v=w.context;return L.set(v,'.'+ci,h+'.width'),L.set(v,'.'+hi,h+'.height'),h})):mt(function (E,L){const h=E.shared;L.set(h.framebuffer,'.next','null');const w=h.context;return L.set(w,'.'+ci,w+'.'+yu),L.set(w,'.'+hi,w+'.'+bu),'null'})}else if(jr in I){const A=I[jr];return Bt(A,function (E,L){const h=E.invoke(L,A),w=E.shared,v=w.framebuffer,O=L.def(v,'.getFramebuffer(',h,')');p.optional(function (){E.assert(L,'!'+h+'||'+O,'invalid framebuffer object')}),L.set(v,'.next',O);const B=w.context;return L.set(B,'.'+ci,O+'?'+O+'.width:'+B+'.'+yu),L.set(B,'.'+hi,O+'?'+O+'.height:'+B+'.'+bu),O})}else return null}function Oe (d,l,S){const I=d.static,N=d.dynamic;function A (h){if(h in I){const w=I[h];p.commandType(w,'object','invalid '+h,S.commandStr);let v=!0,O=w.x|0,B=w.y|0,$,le;return'width'in w?($=w.width|0,p.command($>=0,'invalid '+h,S.commandStr)):v=!1,'height'in w?(le=w.height|0,p.command(le>=0,'invalid '+h,S.commandStr)):v=!1,new St(!v&&l&&l.thisDep,!v&&l&&l.contextDep,!v&&l&&l.propDep,function (ue,Ce){let _e=ue.shared.context,Ee=$;'width'in w||(Ee=Ce.def(_e,'.',ci,'-',O));let Te=le;return'height'in w||(Te=Ce.def(_e,'.',hi,'-',B)),[O,B,Ee,Te]})}else if(h in N){const fe=N[h],ge=Bt(fe,function (ue,Ce){const _e=ue.invoke(Ce,fe);p.optional(function (){ue.assert(Ce,_e+'&&typeof '+_e+'==="object"','invalid '+h)});const Ee=ue.shared.context,Te=Ce.def(_e,'.x|0'),ke=Ce.def(_e,'.y|0'),Ne=Ce.def('"width" in ',_e,'?',_e,'.width|0:','(',Ee,'.',ci,'-',Te,')'),at=Ce.def('"height" in ',_e,'?',_e,'.height|0:','(',Ee,'.',hi,'-',ke,')');return p.optional(function (){ue.assert(Ce,Ne+'>=0&&'+at+'>=0','invalid '+h)}),[Te,ke,Ne,at]});return l&&(ge.thisDep=ge.thisDep||l.thisDep,ge.contextDep=ge.contextDep||l.contextDep,ge.propDep=ge.propDep||l.propDep),ge}else return l?new St(l.thisDep,l.contextDep,l.propDep,function (ue,Ce){const _e=ue.shared.context;return[0,0,Ce.def(_e,'.',ci),Ce.def(_e,'.',hi)]}):null}let E=A(mr);if(E){const L=E;E=new St(E.thisDep,E.contextDep,E.propDep,function (h,w){const v=L.append(h,w),O=h.shared.context;return w.set(O,'.'+$h,v[2]),w.set(O,'.'+Xh,v[3]),v})}return{ viewport:E,scissor_box:A(yn) }}function Me (d,l){const S=d.static,I=typeof S[Di]=='string'&&typeof S[Mi]=='string';if(I){if(Object.keys(l.dynamic).length>0)return null;const N=l.static,A=Object.keys(N);if(A.length>0&&typeof N[A[0]]=='number'){for(var E=[],L=0;L<A.length;++L)p(typeof N[A[L]]=='number','must specify all vertex attribute locations when using vaos'),E.push([N[A[L]]|0,A[L]]);return E}}return null}function qe (d,l,S){const I=d.static,N=d.dynamic;function A (v){if(v in I){const O=c.id(I[v]);p.optional(function (){oe.shader(Cu[v],O,p.guessCommand())});const B=mt(function (){return O});return B.id=O,B}else if(v in N){const $=N[v];return Bt($,function (le,fe){const ge=le.invoke(fe,$),ue=fe.def(le.shared.strings,'.id(',ge,')');return p.optional(function (){fe(le.shared.shader,'.shader(',Cu[v],',',ue,',',le.command,');')}),ue})}return null}let E=A(Di),L=A(Mi),h=null,w;return Pr(E)&&Pr(L)?(h=oe.program(L.id,E.id,null,S),w=mt(function (v,O){return v.link(h)})):w=new St(E&&E.thisDep||L&&L.thisDep,E&&E.contextDep||L&&L.contextDep,E&&E.propDep||L&&L.propDep,function (v,O){let B=v.shared.shader,$;E?$=E.append(v,O):$=O.def(B,'.',Di);let le;L?le=L.append(v,O):le=O.def(B,'.',Mi);let fe=B+'.program('+le+','+$;return p.optional(function (){fe+=','+v.command}),O.def(fe+')')}),{ frag:E,vert:L,progVar:w,program:h }}function ut (d,l){let S=d.static,I=d.dynamic,N={},A=!1;function E (){if(Gi in S){let Ce=S[Gi];return Ce!==null&&ne.getVAO(Ce)===null&&(Ce=ne.createVAO(Ce)),A=!0,N.vao=Ce,mt(function (Ee){const Te=ne.getVAO(Ce);return Te?Ee.link(Te):'null'})}else if(Gi in I){A=!0;const _e=I[Gi];return Bt(_e,function (Ee,Te){const ke=Ee.invoke(Te,_e);return Te.def(Ee.shared.vao+'.getVAO('+ke+')')})}return null}let L=E(),h=!1;function w (){if(Wr in S){let Ce=S[Wr];if(N.elements=Ce,In(Ce)){const _e=N.elements=G.create(Ce,!0);Ce=G.getElements(_e),h=!0}else Ce&&(Ce=G.getElements(Ce),h=!0,p.command(Ce,'invalid elements',l.commandStr));const Ee=mt(function (ke,Ne){if(Ce){const at=ke.link(Ce);return ke.ELEMENTS=at,at}return ke.ELEMENTS=null,null});return Ee.value=Ce,Ee}else if(Wr in I){h=!0;const Te=I[Wr];return Bt(Te,function (ke,Ne){const at=ke.shared,At=at.isBufferArgs,vr=at.elements,gr=ke.invoke(Ne,Te),yr=Ne.def('null'),Ot=Ne.def(At,'(',gr,')'),lr=ke.cond(Ot).then(yr,'=',vr,'.createStream(',gr,');').else(yr,'=',vr,'.getElements(',gr,');');return p.optional(function (){ke.assert(lr.else,'!'+gr+'||'+yr,'invalid elements')}),Ne.entry(lr),Ne.exit(ke.cond(Ot).then(vr,'.destroyStream(',yr,');')),ke.ELEMENTS=yr,yr})}else if(A)return new St(L.thisDep,L.contextDep,L.propDep,function (ke,Ne){return Ne.def(ke.shared.vao+'.currentVAO?'+ke.shared.elements+'.getElements('+ke.shared.vao+'.currentVAO.elements):null')});return null}const v=w();function O (){if(Hr in S){const Ce=S[Hr];return N.primitive=Ce,p.commandParameter(Ce,kr,'invalid primitve',l.commandStr),mt(function (Ee,Te){return kr[Ce]})}else if(Hr in I){const _e=I[Hr];return Bt(_e,function (Ee,Te){const ke=Ee.constants.primTypes,Ne=Ee.invoke(Te,_e);return p.optional(function (){Ee.assert(Te,Ne+' in '+ke,'invalid primitive, must be one of '+Object.keys(kr))}),Te.def(ke,'[',Ne,']')})}else{if(h)return Pr(v)?v.value?mt(function (Ee,Te){return Te.def(Ee.ELEMENTS,'.primType')}):mt(function (){return ts}):new St(v.thisDep,v.contextDep,v.propDep,function (Ee,Te){const ke=Ee.ELEMENTS;return Te.def(ke,'?',ke,'.primType:',ts)});if(A)return new St(L.thisDep,L.contextDep,L.propDep,function (Ee,Te){return Te.def(Ee.shared.vao+'.currentVAO?'+Ee.shared.vao+'.currentVAO.primitive:'+ts)})}return null}function B (Ce,_e){if(Ce in S){const Ee=S[Ce]|0;return _e?N.offset=Ee:N.instances=Ee,p.command(!_e||Ee>=0,'invalid '+Ce,l.commandStr),mt(function (ke,Ne){return _e&&(ke.OFFSET=Ee),Ee})}else if(Ce in I){const Te=I[Ce];return Bt(Te,function (ke,Ne){const at=ke.invoke(Ne,Te);return _e&&(ke.OFFSET=at,p.optional(function (){ke.assert(Ne,at+'>=0','invalid '+Ce)})),at})}else if(_e){if(h)return mt(function (ke,Ne){return ke.OFFSET=0,0});if(A)return new St(L.thisDep,L.contextDep,L.propDep,function (ke,Ne){return Ne.def(ke.shared.vao+'.currentVAO?'+ke.shared.vao+'.currentVAO.offset:0')})}else if(A)return new St(L.thisDep,L.contextDep,L.propDep,function (ke,Ne){return Ne.def(ke.shared.vao+'.currentVAO?'+ke.shared.vao+'.currentVAO.instances:-1')});return null}const $=B(bn,!0);function le (){if(qr in S){const Ce=S[qr]|0;return N.count=Ce,p.command(typeof Ce=='number'&&Ce>=0,'invalid vertex count',l.commandStr),mt(function (){return Ce})}else if(qr in I){const _e=I[qr];return Bt(_e,function (Ne,at){const At=Ne.invoke(at,_e);return p.optional(function (){Ne.assert(at,'typeof '+At+'==="number"&&'+At+'>=0&&'+At+'===('+At+'|0)','invalid vertex count')}),At})}else if(h)if(Pr(v)){if(v)return $?new St($.thisDep,$.contextDep,$.propDep,function (Ne,at){const At=at.def(Ne.ELEMENTS,'.vertCount-',Ne.OFFSET);return p.optional(function (){Ne.assert(at,At+'>=0','invalid vertex offset/element buffer too small')}),At}):mt(function (Ne,at){return at.def(Ne.ELEMENTS,'.vertCount')});const Ee=mt(function (){return-1});return p.optional(function (){Ee.MISSING=!0}),Ee}else{const Te=new St(v.thisDep||$.thisDep,v.contextDep||$.contextDep,v.propDep||$.propDep,function (Ne,at){const At=Ne.ELEMENTS;return Ne.OFFSET?at.def(At,'?',At,'.vertCount-',Ne.OFFSET,':-1'):at.def(At,'?',At,'.vertCount:-1')});return p.optional(function (){Te.DYNAMIC=!0}),Te}else if(A){const ke=new St(L.thisDep,L.contextDep,L.propDep,function (Ne,at){return at.def(Ne.shared.vao,'.currentVAO?',Ne.shared.vao,'.currentVAO.count:-1')});return ke}return null}const fe=O(),ge=le(),ue=B(xn,!1);return{ elements:v,primitive:fe,count:ge,instances:ue,offset:$,vao:L,vaoActive:A,elementsActive:h,static:N }}function lt (d,l){const S=d.static,I=d.dynamic,N={};return Ie.forEach(function (A){const E=Se(A);function L (h,w){if(A in S){const v=h(S[A]);N[E]=mt(function (){return v})}else if(A in I){const O=I[A];N[E]=Bt(O,function (B,$){return w(B,$,B.invoke($,O))})}}switch(A){case lu:case iu:case ru:case du:case au:case vu:case cu:case hu:case pu:case uu:return L(function (h){return p.commandType(h,'boolean',A,l.commandStr),h},function (h,w,v){return p.optional(function (){h.assert(w,'typeof '+v+'==="boolean"','invalid flag '+A,h.commandStr)}),v});case su:return L(function (h){return p.commandParameter(h,di,'invalid '+A,l.commandStr),di[h]},function (h,w,v){const O=h.constants.compareFuncs;return p.optional(function (){h.assert(w,v+' in '+O,'invalid '+A+', must be one of '+Object.keys(di))}),w.def(O,'[',v,']')});case ou:return L(function (h){return p.command(ct(h)&&h.length===2&&typeof h[0]=='number'&&typeof h[1]=='number'&&h[0]<=h[1],'depth range is 2d array',l.commandStr),h},function (h,w,v){p.optional(function (){h.assert(w,h.shared.isArrayLike+'('+v+')&&'+v+'.length===2&&typeof '+v+'[0]==="number"&&typeof '+v+'[1]==="number"&&'+v+'[0]<='+v+'[1]','depth range must be a 2d array')});const O=w.def('+',v,'[0]'),B=w.def('+',v,'[1]');return[O,B]});case Ua:return L(function (h){p.commandType(h,'object','blend.func',l.commandStr);const w='srcRGB'in h?h.srcRGB:h.src,v='srcAlpha'in h?h.srcAlpha:h.src,O='dstRGB'in h?h.dstRGB:h.dst,B='dstAlpha'in h?h.dstAlpha:h.dst;return p.commandParameter(w,or,E+'.srcRGB',l.commandStr),p.commandParameter(v,or,E+'.srcAlpha',l.commandStr),p.commandParameter(O,or,E+'.dstRGB',l.commandStr),p.commandParameter(B,or,E+'.dstAlpha',l.commandStr),p.command(Tu.indexOf(w+', '+O)===-1,'unallowed blending combination (srcRGB, dstRGB) = ('+w+', '+O+')',l.commandStr),[or[w],or[O],or[v],or[B]]},function (h,w,v){const O=h.constants.blendFuncs;p.optional(function (){h.assert(w,v+'&&typeof '+v+'==="object"','invalid blend func, must be an object')});function B (_e,Ee){const Te=w.def('"',_e,Ee,'" in ',v,'?',v,'.',_e,Ee,':',v,'.',_e);return p.optional(function (){h.assert(w,Te+' in '+O,'invalid '+A+'.'+_e+Ee+', must be one of '+Object.keys(or))}),Te}const $=B('src','RGB'),le=B('dst','RGB');p.optional(function (){const _e=h.constants.invalidBlendCombinations;h.assert(w,_e+'.indexOf('+$+'+", "+'+le+') === -1 ','unallowed blending combination for (srcRGB, dstRGB)')});const fe=w.def(O,'[',$,']'),ge=w.def(O,'[',B('src','Alpha'),']'),ue=w.def(O,'[',le,']'),Ce=w.def(O,'[',B('dst','Alpha'),']');return[fe,ue,ge,Ce]});case Va:return L(function (h){if(typeof h=='string')return p.commandParameter(h,z,'invalid '+A,l.commandStr),[z[h],z[h]];if(typeof h=='object')return p.commandParameter(h.rgb,z,A+'.rgb',l.commandStr),p.commandParameter(h.alpha,z,A+'.alpha',l.commandStr),[z[h.rgb],z[h.alpha]];p.commandRaise('invalid blend.equation',l.commandStr)},function (h,w,v){const O=h.constants.blendEquations,B=w.def(),$=w.def(),le=h.cond('typeof ',v,'==="string"');return p.optional(function (){function fe (ge,ue,Ce){h.assert(ge,Ce+' in '+O,'invalid '+ue+', must be one of '+Object.keys(z))}fe(le.then,A,v),h.assert(le.else,v+'&&typeof '+v+'==="object"','invalid '+A),fe(le.else,A+'.rgb',v+'.rgb'),fe(le.else,A+'.alpha',v+'.alpha')}),le.then(B,'=',$,'=',O,'[',v,'];'),le.else(B,'=',O,'[',v,'.rgb];',$,'=',O,'[',v,'.alpha];'),w(le),[B,$]});case nu:return L(function (h){return p.command(ct(h)&&h.length===4,'blend.color must be a 4d array',l.commandStr),zt(4,function (w){return+h[w]})},function (h,w,v){return p.optional(function (){h.assert(w,h.shared.isArrayLike+'('+v+')&&'+v+'.length===4','blend.color must be a 4d array')}),zt(4,function (O){return w.def('+',v,'[',O,']')})});case mu:return L(function (h){return p.commandType(h,'number',E,l.commandStr),h|0},function (h,w,v){return p.optional(function (){h.assert(w,'typeof '+v+'==="number"','invalid stencil.mask')}),w.def(v,'|0')});case $a:return L(function (h){p.commandType(h,'object',E,l.commandStr);const w=h.cmp||'keep',v=h.ref||0,O='mask'in h?h.mask:-1;return p.commandParameter(w,di,A+'.cmp',l.commandStr),p.commandType(v,'number',A+'.ref',l.commandStr),p.commandType(O,'number',A+'.mask',l.commandStr),[di[w],v,O]},function (h,w,v){const O=h.constants.compareFuncs;p.optional(function (){function fe (){h.assert(w,Array.prototype.join.call(arguments,''),'invalid stencil.func')}fe(v+'&&typeof ',v,'==="object"'),fe('!("cmp" in ',v,')||(',v,'.cmp in ',O,')')});const B=w.def('"cmp" in ',v,'?',O,'[',v,'.cmp]',':',Ir),$=w.def(v,'.ref|0'),le=w.def('"mask" in ',v,'?',v,'.mask|0:-1');return[B,$,le]});case Xa:case Fi:return L(function (h){p.commandType(h,'object',E,l.commandStr);const w=h.fail||'keep',v=h.zfail||'keep',O=h.zpass||'keep';return p.commandParameter(w,Rr,A+'.fail',l.commandStr),p.commandParameter(v,Rr,A+'.zfail',l.commandStr),p.commandParameter(O,Rr,A+'.zpass',l.commandStr),[A===Fi?$r:Hi,Rr[w],Rr[v],Rr[O]]},function (h,w,v){const O=h.constants.stencilOps;p.optional(function (){h.assert(w,v+'&&typeof '+v+'==="object"','invalid '+A)});function B ($){return p.optional(function (){h.assert(w,'!("'+$+'" in '+v+')||('+v+'.'+$+' in '+O+')','invalid '+A+'.'+$+', must be one of '+Object.keys(Rr))}),w.def('"',$,'" in ',v,'?',O,'[',v,'.',$,']:',Ir)}return[A===Fi?$r:Hi,B('fail'),B('zfail'),B('zpass')]});case Ha:return L(function (h){p.commandType(h,'object',E,l.commandStr);const w=h.factor|0,v=h.units|0;return p.commandType(w,'number',E+'.factor',l.commandStr),p.commandType(v,'number',E+'.units',l.commandStr),[w,v]},function (h,w,v){p.optional(function (){h.assert(w,v+'&&typeof '+v+'==="object"','invalid '+A)});const O=w.def(v,'.factor|0'),B=w.def(v,'.units|0');return[O,B]});case fu:return L(function (h){let w=0;return h==='front'?w=Hi:h==='back'&&(w=$r),p.command(!!w,E,l.commandStr),w},function (h,w,v){return p.optional(function (){h.assert(w,v+'==="front"||'+v+'==="back"','invalid cull.face')}),w.def(v,'==="front"?',Hi,':',$r)});case Wa:return L(function (h){return p.command(typeof h=='number'&&h>=V.lineWidthDims[0]&&h<=V.lineWidthDims[1],'invalid line width, must be a positive number between '+V.lineWidthDims[0]+' and '+V.lineWidthDims[1],l.commandStr),h},function (h,w,v){return p.optional(function (){h.assert(w,'typeof '+v+'==="number"&&'+v+'>='+V.lineWidthDims[0]+'&&'+v+'<='+V.lineWidthDims[1],'invalid line width')}),v});case ja:return L(function (h){return p.commandParameter(h,is,E,l.commandStr),is[h]},function (h,w,v){return p.optional(function (){h.assert(w,v+'==="cw"||'+v+'==="ccw"','invalid frontFace, must be one of cw,ccw')}),w.def(v+'==="cw"?'+_u+':'+rs)});case za:return L(function (h){return p.command(ct(h)&&h.length===4,'color.mask must be length 4 array',l.commandStr),h.map(function (w){return!!w})},function (h,w,v){return p.optional(function (){h.assert(w,h.shared.isArrayLike+'('+v+')&&'+v+'.length===4','invalid color.mask')}),zt(4,function (O){return'!!'+v+'['+O+']'})});case qa:return L(function (h){p.command(typeof h=='object'&&h,E,l.commandStr);const w='value'in h?h.value:1,v=!!h.invert;return p.command(typeof w=='number'&&w>=0&&w<=1,'sample.coverage.value must be a number between 0 and 1',l.commandStr),[w,v]},function (h,w,v){p.optional(function (){h.assert(w,v+'&&typeof '+v+'==="object"','invalid sample.coverage')});const O=w.def('"value" in ',v,'?+',v,'.value:1'),B=w.def('!!',v,'.invert');return[O,B]})}}),N}function Ye (d,l){const S=d.static,I=d.dynamic,N={};return Object.keys(S).forEach(function (A){let E=S[A],L;if(typeof E=='number'||typeof E=='boolean')L=mt(function (){return E});else if(typeof E=='function'){const h=E._reglType;h==='texture2d'||h==='textureCube'?L=mt(function (w){return w.link(E)}):h==='framebuffer'||h==='framebufferCube'?(p.command(E.color.length>0,'missing color attachment for framebuffer sent to uniform "'+A+'"',l.commandStr),L=mt(function (w){return w.link(E.color[0])})):p.commandRaise('invalid data for uniform "'+A+'"',l.commandStr)}else ct(E)?L=mt(function (w){const v=w.global.def('[',zt(E.length,function (O){return p.command(typeof E[O]=='number'||typeof E[O]=='boolean','invalid uniform '+A,w.commandStr),E[O]}),']');return v}):p.commandRaise('invalid or missing data for uniform "'+A+'"',l.commandStr);L.value=E,N[A]=L}),Object.keys(I).forEach(function (A){const E=I[A];N[A]=Bt(E,function (L,h){return L.invoke(h,E)})}),N}function yt (d,l){const S=d.static,I=d.dynamic,N={};return Object.keys(S).forEach(function (A){const E=S[A],L=c.id(A),h=new R;if(In(E))h.state=fi,h.buffer=H.getBuffer(H.create(E,pi,!1,!0)),h.type=0;else{let w=H.getBuffer(E);if(w)h.state=fi,h.buffer=w,h.type=0;else if(p.command(typeof E=='object'&&E,'invalid data for attribute '+A,l.commandStr),'constant'in E){const v=E.constant;h.buffer='null',h.state=Fa,typeof v=='number'?h.x=v:(p.command(ct(v)&&v.length>0&&v.length<=4,'invalid constant for attribute '+A,l.commandStr),li.forEach(function (ue,Ce){Ce<v.length&&(h[ue]=v[Ce])}))}else{In(E.buffer)?w=H.getBuffer(H.create(E.buffer,pi,!1,!0)):w=H.getBuffer(E.buffer),p.command(!!w,'missing buffer for attribute "'+A+'"',l.commandStr);const O=E.offset|0;p.command(O>=0,'invalid offset for attribute "'+A+'"',l.commandStr);const B=E.stride|0;p.command(B>=0&&B<256,'invalid stride for attribute "'+A+'", must be integer betweeen [0, 255]',l.commandStr);const $=E.size|0;p.command(!('size'in E)||$>0&&$<=4,'invalid size for attribute "'+A+'", must be 1,2,3,4',l.commandStr);let le=!!E.normalized,fe=0;'type'in E&&(p.commandParameter(E.type,Dr,'invalid type for attribute '+A,l.commandStr),fe=Dr[E.type]);const ge=E.divisor|0;p.optional(function (){'divisor'in E&&(p.command(ge===0||te,'cannot specify divisor for attribute "'+A+'", instancing not supported',l.commandStr),p.command(ge>=0,'invalid divisor for attribute "'+A+'"',l.commandStr));const ue=l.commandStr,Ce=['buffer','offset','divisor','normalized','type','size','stride'];Object.keys(E).forEach(function (_e){p.command(Ce.indexOf(_e)>=0,'unknown parameter "'+_e+'" for attribute pointer "'+A+'" (valid parameters are '+Ce+')',ue)})}),h.buffer=w,h.state=fi,h.size=$,h.normalized=le,h.type=fe||w.dtype,h.offset=O,h.stride=B,h.divisor=ge}}N[A]=mt(function (ue,Ce){const _e=ue.attribCache;if(L in _e)return _e[L];const Ee={ isStream:!1 };return Object.keys(h).forEach(function (Te){Ee[Te]=h[Te]}),h.buffer&&(Ee.buffer=ue.link(h.buffer),Ee.type=Ee.type||Ee.buffer+'.dtype'),_e[L]=Ee,Ee})}),Object.keys(I).forEach(function (A){const E=I[A];function L (h,w){const v=h.invoke(w,E),O=h.shared,B=h.constants,$=O.isBufferArgs,le=O.buffer;p.optional(function (){h.assert(w,v+'&&(typeof '+v+'==="object"||typeof '+v+'==="function")&&('+$+'('+v+')||'+le+'.getBuffer('+v+')||'+le+'.getBuffer('+v+'.buffer)||'+$+'('+v+'.buffer)||("constant" in '+v+'&&(typeof '+v+'.constant==="number"||'+O.isArrayLike+'('+v+'.constant))))','invalid dynamic attribute "'+A+'"')});const fe={ isStream:w.def(!1) },ge=new R;ge.state=fi,Object.keys(ge).forEach(function (Ee){fe[Ee]=w.def(''+ge[Ee])});const ue=fe.buffer,Ce=fe.type;w('if(',$,'(',v,')){',fe.isStream,'=true;',ue,'=',le,'.createStream(',pi,',',v,');',Ce,'=',ue,'.dtype;','}else{',ue,'=',le,'.getBuffer(',v,');','if(',ue,'){',Ce,'=',ue,'.dtype;','}else if("constant" in ',v,'){',fe.state,'=',Fa,';','if(typeof '+v+'.constant === "number"){',fe[li[0]],'=',v,'.constant;',li.slice(1).map(function (Ee){return fe[Ee]}).join('='),'=0;','}else{',li.map(function (Ee,Te){return fe[Ee]+'='+v+'.constant.length>'+Te+'?'+v+'.constant['+Te+']:0;'}).join(''),'}}else{','if(',$,'(',v,'.buffer)){',ue,'=',le,'.createStream(',pi,',',v,'.buffer);','}else{',ue,'=',le,'.getBuffer(',v,'.buffer);','}',Ce,'="type" in ',v,'?',B.glTypes,'[',v,'.type]:',ue,'.dtype;',fe.normalized,'=!!',v,'.normalized;');function _e (Ee){w(fe[Ee],'=',v,'.',Ee,'|0;')}return _e('size'),_e('offset'),_e('stride'),_e('divisor'),w('}}'),w.exit('if(',fe.isStream,'){',le,'.destroyStream(',ue,');','}'),fe}N[A]=Bt(E,L)}),N}function st (d){const l=d.static,S=d.dynamic,I={};return Object.keys(l).forEach(function (N){const A=l[N];I[N]=mt(function (E,L){return typeof A=='number'||typeof A=='boolean'?''+A:E.link(A)})}),Object.keys(S).forEach(function (N){const A=S[N];I[N]=Bt(A,function (E,L){return E.invoke(L,A)})}),I}function vt (d,l,S,I,N){const A=d.static,E=d.dynamic;p.optional(function (){const _e=[jr,Mi,Di,Wr,Hr,bn,qr,xn,Bi,Gi].concat(Ie);function Ee (Te){Object.keys(Te).forEach(function (ke){p.command(_e.indexOf(ke)>=0,'unknown parameter "'+ke+'"',N.commandStr)})}Ee(A),Ee(E)});const L=Me(d,l),h=be(d),w=Oe(d,h,N),v=ut(d,N),O=lt(d,N),B=qe(d,N,L);function $ (_e){const Ee=w[_e];Ee&&(O[_e]=Ee)}$(mr),$(Se(yn));const le=Object.keys(O).length>0,fe={ framebuffer:h,draw:v,shader:B,state:O,dirty:le,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{} };if(fe.profile=ve(d),fe.uniforms=Ye(S,N),fe.drawVAO=fe.scopeVAO=v.vao,!fe.drawVAO&&B.program&&!L&&b.angle_instanced_arrays&&v.static.elements){let ge=!0,ue=B.program.attributes.map(function (_e){const Ee=l.static[_e];return ge=ge&&!!Ee,Ee});if(ge&&ue.length>0){const Ce=ne.getVAO(ne.createVAO({ attributes:ue,elements:v.static.elements }));fe.drawVAO=new St(null,null,null,function (_e,Ee){return _e.link(Ce)}),fe.useVAO=!0}}return L?fe.useVAO=!0:fe.attributes=yt(l,N),fe.context=st(I),fe}function bt (d,l,S){const I=d.shared,N=I.context,A=d.scope();Object.keys(S).forEach(function (E){l.save(N,'.'+E);const L=S[E],h=L.append(d,l);Array.isArray(h)?A(N,'.',E,'=[',h.join(),'];'):A(N,'.',E,'=',h,';')}),l(A)}function xt (d,l,S,I){let N=d.shared,A=N.gl,E=N.framebuffer,L;xe&&(L=l.def(N.extensions,'.webgl_draw_buffers'));let h=d.constants,w=h.drawBuffer,v=h.backBuffer,O;S?O=S.append(d,l):O=l.def(E,'.next'),I||l('if(',O,'!==',E,'.cur){'),l('if(',O,'){',A,'.bindFramebuffer(',Au,',',O,'.framebuffer);'),xe&&l(L,'.drawBuffersWEBGL(',w,'[',O,'.colorAttachments.length]);'),l('}else{',A,'.bindFramebuffer(',Au,',null);'),xe&&l(L,'.drawBuffersWEBGL(',v,');'),l('}',E,'.cur=',O,';'),I||l('}')}function Et (d,l,S){const I=d.shared,N=I.gl,A=d.current,E=d.next,L=I.current,h=I.next,w=d.cond(L,'.dirty');Ie.forEach(function (v){const O=Se(v);if(!(O in S.state)){let B,$;if(O in E){B=E[O],$=A[O];const le=zt(ye[O].length,function (ge){return w.def(B,'[',ge,']')});w(d.cond(le.map(function (ge,ue){return ge+'!=='+$+'['+ue+']'}).join('||')).then(N,'.',W[O],'(',le,');',le.map(function (ge,ue){return $+'['+ue+']='+ge}).join(';'),';'))}else{B=w.def(h,'.',O);const fe=d.cond(B,'!==',L,'.',O);w(fe),O in q?fe(d.cond(B).then(N,'.enable(',q[O],');').else(N,'.disable(',q[O],');'),L,'.',O,'=',B,';'):fe(N,'.',W[O],'(',B,');',L,'.',O,'=',B,';')}}}),Object.keys(S.state).length===0&&w(L,'.dirty=false;'),l(w)}function kt (d,l,S,I){const N=d.shared,A=d.current,E=N.current,L=N.gl;ku(Object.keys(S)).forEach(function (h){const w=S[h];if(!(I&&!I(w))){const v=w.append(d,l);if(q[h]){const O=q[h];Pr(w)?v?l(L,'.enable(',O,');'):l(L,'.disable(',O,');'):l(d.cond(v).then(L,'.enable(',O,');').else(L,'.disable(',O,');')),l(E,'.',h,'=',v,';')}else if(ct(v)){const B=A[h];l(L,'.',W[h],'(',v,');',v.map(function ($,le){return B+'['+le+']='+$}).join(';'),';')}else l(L,'.',W[h],'(',v,');',E,'.',h,'=',v,';')}})}function ht (d,l){te&&(d.instancing=l.def(d.shared.extensions,'.angle_instanced_arrays'))}function Ue (d,l,S,I,N){const A=d.shared,E=d.stats,L=A.current,h=A.timer,w=S.profile;function v (){return typeof performance>'u'?'Date.now()':'performance.now()'}let O,B;function $ (_e){O=l.def(),_e(O,'=',v(),';'),typeof N=='string'?_e(E,'.count+=',N,';'):_e(E,'.count++;'),J&&(I?(B=l.def(),_e(B,'=',h,'.getNumPendingQueries();')):_e(h,'.beginQuery(',E,');'))}function le (_e){_e(E,'.cpuTime+=',v(),'-',O,';'),J&&(I?_e(h,'.pushScopeStats(',B,',',h,'.getNumPendingQueries(),',E,');'):_e(h,'.endQuery();'))}function fe (_e){const Ee=l.def(L,'.profile');l(L,'.profile=',_e,';'),l.exit(L,'.profile=',Ee,';')}let ge;if(w){if(Pr(w)){w.enable?($(l),le(l.exit),fe('true')):fe('false');return}ge=w.append(d,l),fe(ge)}else ge=l.def(L,'.profile');const ue=d.block();$(ue),l('if(',ge,'){',ue,'}');const Ce=d.block();le(Ce),l.exit('if(',ge,'){',Ce,'}')}function Lt (d,l,S,I,N){const A=d.shared;function E (h){switch(h){case _n:case En:case Cn:return 2;case wn:case An:case kn:return 3;case Sn:case Tn:case Ln:return 4;default:return 1}}function L (h,w,v){const O=A.gl,B=l.def(h,'.location'),$=l.def(A.attributes,'[',B,']'),le=v.state,fe=v.buffer,ge=[v.x,v.y,v.z,v.w],ue=['buffer','normalized','offset','stride'];function Ce (){l('if(!',$,'.buffer){',O,'.enableVertexAttribArray(',B,');}');let Ee=v.type,Te;if(v.size?Te=l.def(v.size,'||',w):Te=w,l('if(',$,'.type!==',Ee,'||',$,'.size!==',Te,'||',ue.map(function (Ne){return $+'.'+Ne+'!=='+v[Ne]}).join('||'),'){',O,'.bindBuffer(',pi,',',fe,'.buffer);',O,'.vertexAttribPointer(',[B,Te,Ee,v.normalized,v.stride,v.offset],');',$,'.type=',Ee,';',$,'.size=',Te,';',ue.map(function (Ne){return $+'.'+Ne+'='+v[Ne]+';'}).join(''),'}'),te){const ke=v.divisor;l('if(',$,'.divisor!==',ke,'){',d.instancing,'.vertexAttribDivisorANGLE(',[B,ke],');',$,'.divisor=',ke,';}')}}function _e (){l('if(',$,'.buffer){',O,'.disableVertexAttribArray(',B,');',$,'.buffer=null;','}if(',li.map(function (Ee,Te){return $+'.'+Ee+'!=='+ge[Te]}).join('||'),'){',O,'.vertexAttrib4f(',B,',',ge,');',li.map(function (Ee,Te){return $+'.'+Ee+'='+ge[Te]+';'}).join(''),'}')}le===fi?Ce():le===Fa?_e():(l('if(',le,'===',fi,'){'),Ce(),l('}else{'),_e(),l('}'))}I.forEach(function (h){let w=h.name,v=S.attributes[w],O;if(v){if(!N(v))return;O=v.append(d,l)}else{if(!N(Lu))return;const B=d.scopeAttrib(w);p.optional(function (){d.assert(l,B+'.state','missing attribute '+w)}),O={},Object.keys(new R).forEach(function ($){O[$]=l.def(B,'.',$)})}L(d.link(h),E(h.info.type),O)})}function et (d,l,S,I,N,A){for(var E=d.shared,L=E.gl,h,w=0;w<I.length;++w){var v=I[w],O=v.name,B=v.info.type,$=S.uniforms[O],le=d.link(v),fe=le+'.location',ge;if($){if(!N($))continue;if(Pr($)){var ue=$.value;if(p.command(ue!==null&&typeof ue<'u','missing uniform "'+O+'"',d.commandStr),B===ji||B===Wi){p.command(typeof ue=='function'&&(B===ji&&(ue._reglType==='texture2d'||ue._reglType==='framebuffer')||B===Wi&&(ue._reglType==='textureCube'||ue._reglType==='framebufferCube')),'invalid texture for uniform '+O,d.commandStr);const Ce=d.link(ue._texture||ue.color[0]._texture);l(L,'.uniform1i(',fe,',',Ce+'.bind());'),l.exit(Ce,'.unbind();')}else if(B===Vi||B===Ui||B===zi){p.optional(function (){p.command(ct(ue),'invalid matrix for uniform '+O,d.commandStr),p.command(B===Vi&&ue.length===4||B===Ui&&ue.length===9||B===zi&&ue.length===16,'invalid length for matrix uniform '+O,d.commandStr)});let _e=d.global.def('new Float32Array(['+Array.prototype.slice.call(ue)+'])'),Ee=2;B===Ui?Ee=3:B===zi&&(Ee=4),l(L,'.uniformMatrix',Ee,'fv(',fe,',false,',_e,');')}else{switch(B){case Za:p.commandType(ue,'number','uniform '+O,d.commandStr),h='1f';break;case _n:p.command(ct(ue)&&ue.length===2,'uniform '+O,d.commandStr),h='2f';break;case wn:p.command(ct(ue)&&ue.length===3,'uniform '+O,d.commandStr),h='3f';break;case Sn:p.command(ct(ue)&&ue.length===4,'uniform '+O,d.commandStr),h='4f';break;case es:p.commandType(ue,'boolean','uniform '+O,d.commandStr),h='1i';break;case Ja:p.commandType(ue,'number','uniform '+O,d.commandStr),h='1i';break;case Cn:p.command(ct(ue)&&ue.length===2,'uniform '+O,d.commandStr),h='2i';break;case En:p.command(ct(ue)&&ue.length===2,'uniform '+O,d.commandStr),h='2i';break;case kn:p.command(ct(ue)&&ue.length===3,'uniform '+O,d.commandStr),h='3i';break;case An:p.command(ct(ue)&&ue.length===3,'uniform '+O,d.commandStr),h='3i';break;case Ln:p.command(ct(ue)&&ue.length===4,'uniform '+O,d.commandStr),h='4i';break;case Tn:p.command(ct(ue)&&ue.length===4,'uniform '+O,d.commandStr),h='4i';break}l(L,'.uniform',h,'(',fe,',',ct(ue)?Array.prototype.slice.call(ue):ue,');')}continue}else ge=$.append(d,l)}else{if(!N(Lu))continue;ge=l.def(E.uniforms,'[',c.id(O),']')}B===ji?(p(!Array.isArray(ge),'must specify a scalar prop for textures'),l('if(',ge,'&&',ge,'._reglType==="framebuffer"){',ge,'=',ge,'.color[0];','}')):B===Wi&&(p(!Array.isArray(ge),'must specify a scalar prop for cube maps'),l('if(',ge,'&&',ge,'._reglType==="framebufferCube"){',ge,'=',ge,'.color[0];','}')),p.optional(function (){function Ot (rr,Bu){d.assert(l,rr,'bad data or missing for uniform "'+O+'".  '+Bu)}function lr (rr){p(!Array.isArray(ge),'must not specify an array type for uniform'),Ot('typeof '+ge+'==="'+rr+'"','invalid type, expected '+rr)}function qt (rr,Bu){Array.isArray(ge)?p(ge.length===rr,'must have length '+rr):Ot(E.isArrayLike+'('+ge+')&&'+ge+'.length==='+rr,'invalid vector, should have length '+rr,d.commandStr)}function Fu (rr){p(!Array.isArray(ge),'must not specify a value type'),Ot('typeof '+ge+'==="function"&&'+ge+'._reglType==="texture'+(rr===xu?'2d':'Cube')+'"','invalid texture type',d.commandStr)}switch(B){case Ja:lr('number');break;case En:qt(2);break;case An:qt(3);break;case Tn:qt(4);break;case Za:lr('number');break;case _n:qt(2);break;case wn:qt(3);break;case Sn:qt(4);break;case es:lr('boolean');break;case Cn:qt(2);break;case kn:qt(3);break;case Ln:qt(4);break;case Vi:qt(4);break;case Ui:qt(9);break;case zi:qt(16);break;case ji:Fu(xu);break;case Wi:Fu(Zh);break}});let Te=1;switch(B){case ji:case Wi:var ke=l.def(ge,'._texture');l(L,'.uniform1i(',fe,',',ke,'.bind());'),l.exit(ke,'.unbind();');continue;case Ja:case es:h='1i';break;case En:case Cn:h='2i',Te=2;break;case An:case kn:h='3i',Te=3;break;case Tn:case Ln:h='4i',Te=4;break;case Za:h='1f';break;case _n:h='2f',Te=2;break;case wn:h='3f',Te=3;break;case Sn:h='4f',Te=4;break;case Vi:h='Matrix2fv';break;case Ui:h='Matrix3fv';break;case zi:h='Matrix4fv';break}if(h.charAt(0)==='M'){l(L,'.uniform',h,'(',fe,',');var Ne=Math.pow(B-Vi+2,2),at=d.global.def('new Float32Array(',Ne,')');Array.isArray(ge)?l('false,(',zt(Ne,function (Ot){return at+'['+Ot+']='+ge[Ot]}),',',at,')'):l('false,(Array.isArray(',ge,')||',ge,' instanceof Float32Array)?',ge,':(',zt(Ne,function (Ot){return at+'['+Ot+']='+ge+'['+Ot+']'}),',',at,')'),l(');')}else if(Te>1){for(var At=[],vr=[],gr=0;gr<Te;++gr)Array.isArray(ge)?vr.push(ge[gr]):vr.push(l.def(ge+'['+gr+']')),A&&At.push(l.def());A&&l('if(!',d.batchId,'||',At.map(function (Ot,lr){return Ot+'!=='+vr[lr]}).join('||'),'){',At.map(function (Ot,lr){return Ot+'='+vr[lr]+';'}).join('')),l(L,'.uniform',h,'(',fe,',',vr.join(','),');'),A&&l('}')}else{if(p(!Array.isArray(ge),'uniform value must not be an array'),A){const yr=l.def();l('if(!',d.batchId,'||',yr,'!==',ge,'){',yr,'=',ge,';')}l(L,'.uniform',h,'(',fe,',',ge,');'),A&&l('}')}}}function Pe (d,l,S,I){const N=d.shared,A=N.gl,E=N.draw,L=I.draw;function h (){let Te=L.elements,ke,Ne=l;return Te?((Te.contextDep&&I.contextDynamic||Te.propDep)&&(Ne=S),ke=Te.append(d,Ne),L.elementsActive&&Ne('if('+ke+')'+A+'.bindBuffer('+Qa+','+ke+'.buffer.buffer);')):(ke=Ne.def(),Ne(ke,'=',E,'.',Wr,';','if(',ke,'){',A,'.bindBuffer(',Qa,',',ke,'.buffer.buffer);}','else if(',N.vao,'.currentVAO){',ke,'=',d.shared.elements+'.getElements('+N.vao,'.currentVAO.elements);',Y?'':'if('+ke+')'+A+'.bindBuffer('+Qa+','+ke+'.buffer.buffer);','}')),ke}function w (){let Te=L.count,ke,Ne=l;return Te?((Te.contextDep&&I.contextDynamic||Te.propDep)&&(Ne=S),ke=Te.append(d,Ne),p.optional(function (){Te.MISSING&&d.assert(l,'false','missing vertex count'),Te.DYNAMIC&&d.assert(Ne,ke+'>=0','missing vertex count')})):(ke=Ne.def(E,'.',qr),p.optional(function (){d.assert(Ne,ke+'>=0','missing vertex count')})),ke}const v=h();function O (Te){const ke=L[Te];return ke?ke.contextDep&&I.contextDynamic||ke.propDep?ke.append(d,S):ke.append(d,l):l.def(E,'.',Te)}const B=O(Hr),$=O(bn),le=w();if(typeof le=='number'){if(le===0)return}else S('if(',le,'){'),S.exit('}');let fe,ge;te&&(fe=O(xn),ge=d.instancing);const ue=v+'.type',Ce=L.elements&&Pr(L.elements)&&!L.vaoActive;function _e (){function Te (){S(ge,'.drawElementsInstancedANGLE(',[B,le,ue,$+'<<(('+ue+'-'+Jo+')>>1)',fe],');')}function ke (){S(ge,'.drawArraysInstancedANGLE(',[B,$,le,fe],');')}v&&v!=='null'?Ce?Te():(S('if(',v,'){'),Te(),S('}else{'),ke(),S('}')):ke()}function Ee (){function Te (){S(A+'.drawElements('+[B,le,ue,$+'<<(('+ue+'-'+Jo+')>>1)']+');')}function ke (){S(A+'.drawArrays('+[B,$,le]+');')}v&&v!=='null'?Ce?Te():(S('if(',v,'){'),Te(),S('}else{'),ke(),S('}')):ke()}te&&(typeof fe!='number'||fe>=0)?typeof fe=='string'?(S('if(',fe,'>0){'),_e(),S('}else if(',fe,'<0){'),Ee(),S('}')):_e():Ee()}function $e (d,l,S,I,N){const A=Be(),E=A.proc('body',N);return p.optional(function (){A.commandStr=l.commandStr,A.command=A.link(l.commandStr)}),te&&(A.instancing=E.def(A.shared.extensions,'.angle_instanced_arrays')),d(A,E,S,I),A.compile().body}function Ze (d,l,S,I){ht(d,l),S.useVAO?S.drawVAO?l(d.shared.vao,'.setVAO(',S.drawVAO.append(d,l),');'):l(d.shared.vao,'.setVAO(',d.shared.vao,'.targetVAO);'):(l(d.shared.vao,'.setVAO(null);'),Lt(d,l,S,I.attributes,function (){return!0})),et(d,l,S,I.uniforms,function (){return!0},!1),Pe(d,l,l,S)}function pt (d,l){const S=d.proc('draw',1);ht(d,S),bt(d,S,l.context),xt(d,S,l.framebuffer),Et(d,S,l),kt(d,S,l.state),Ue(d,S,l,!1,!0);const I=l.shader.progVar.append(d,S);if(S(d.shared.gl,'.useProgram(',I,'.program);'),l.shader.program)Ze(d,S,l,l.shader.program);else{S(d.shared.vao,'.setVAO(null);');const N=d.global.def('{}'),A=S.def(I,'.id'),E=S.def(N,'[',A,']');S(d.cond(E).then(E,'.call(this,a0);').else(E,'=',N,'[',A,']=',d.link(function (L){return $e(Ze,d,l,L,1)}),'(',I,');',E,'.call(this,a0);'))}Object.keys(l.state).length>0&&S(d.shared.current,'.dirty=true;'),d.shared.vao&&S(d.shared.vao,'.setVAO(null);')}function ur (d,l,S,I){d.batchId='a1',ht(d,l);function N (){return!0}Lt(d,l,S,I.attributes,N),et(d,l,S,I.uniforms,N,!1),Pe(d,l,l,S)}function Xr (d,l,S,I){ht(d,l);const N=S.contextDep,A=l.def(),E='a0',L='a1',h=l.def();d.shared.props=h,d.batchId=A;const w=d.scope(),v=d.scope();l(w.entry,'for(',A,'=0;',A,'<',L,';++',A,'){',h,'=',E,'[',A,'];',v,'}',w.exit);function O (ue){return ue.contextDep&&N||ue.propDep}function B (ue){return!O(ue)}if(S.needsContext&&bt(d,v,S.context),S.needsFramebuffer&&xt(d,v,S.framebuffer),kt(d,v,S.state,O),S.profile&&O(S.profile)&&Ue(d,v,S,!1,!0),I)S.useVAO?S.drawVAO?O(S.drawVAO)?v(d.shared.vao,'.setVAO(',S.drawVAO.append(d,v),');'):w(d.shared.vao,'.setVAO(',S.drawVAO.append(d,w),');'):w(d.shared.vao,'.setVAO(',d.shared.vao,'.targetVAO);'):(w(d.shared.vao,'.setVAO(null);'),Lt(d,w,S,I.attributes,B),Lt(d,v,S,I.attributes,O)),et(d,w,S,I.uniforms,B,!1),et(d,v,S,I.uniforms,O,!0),Pe(d,w,v,S);else{const $=d.global.def('{}'),le=S.shader.progVar.append(d,v),fe=v.def(le,'.id'),ge=v.def($,'[',fe,']');v(d.shared.gl,'.useProgram(',le,'.program);','if(!',ge,'){',ge,'=',$,'[',fe,']=',d.link(function (ue){return $e(ur,d,S,ue,2)}),'(',le,');}',ge,'.call(this,a0[',A,'],',A,');')}}function g (d,l){const S=d.proc('batch',2);d.batchId='0',ht(d,S);let I=!1,N=!0;Object.keys(l.context).forEach(function ($){I=I||l.context[$].propDep}),I||(bt(d,S,l.context),N=!1);let A=l.framebuffer,E=!1;A?(A.propDep?I=E=!0:A.contextDep&&I&&(E=!0),E||xt(d,S,A)):xt(d,S,null),l.state.viewport&&l.state.viewport.propDep&&(I=!0);function L ($){return $.contextDep&&I||$.propDep}Et(d,S,l),kt(d,S,l.state,function ($){return!L($)}),(!l.profile||!L(l.profile))&&Ue(d,S,l,!1,'a1'),l.contextDep=I,l.needsContext=N,l.needsFramebuffer=E;const h=l.shader.progVar;if(h.contextDep&&I||h.propDep)Xr(d,S,l,null);else{const w=h.append(d,S);if(S(d.shared.gl,'.useProgram(',w,'.program);'),l.shader.program)Xr(d,S,l,l.shader.program);else{S(d.shared.vao,'.setVAO(null);');const v=d.global.def('{}'),O=S.def(w,'.id'),B=S.def(v,'[',O,']');S(d.cond(B).then(B,'.call(this,a0,a1);').else(B,'=',v,'[',O,']=',d.link(function ($){return $e(Xr,d,l,$,2)}),'(',w,');',B,'.call(this,a0,a1);'))}}Object.keys(l.state).length>0&&S(d.shared.current,'.dirty=true;'),d.shared.vao&&S(d.shared.vao,'.setVAO(null);')}function U (d,l){const S=d.proc('scope',3);d.batchId='a2';const I=d.shared,N=I.current;bt(d,S,l.context),l.framebuffer&&l.framebuffer.append(d,S),ku(Object.keys(l.state)).forEach(function (E){const L=l.state[E],h=L.append(d,S);ct(h)?h.forEach(function (w,v){S.set(d.next[E],'['+v+']',w)}):S.set(I.next,'.'+E,h)}),Ue(d,S,l,!0,!0),[Wr,bn,qr,xn,Hr].forEach(function (E){const L=l.draw[E];L&&S.set(I.draw,'.'+E,''+L.append(d,S))}),Object.keys(l.uniforms).forEach(function (E){let L=l.uniforms[E].append(d,S);Array.isArray(L)&&(L='['+L.join()+']'),S.set(I.uniforms,'['+c.id(E)+']',L)}),Object.keys(l.attributes).forEach(function (E){const L=l.attributes[E].append(d,S),h=d.scopeAttrib(E);Object.keys(new R).forEach(function (w){S.set(h,'.'+w,L[w])})}),l.scopeVAO&&S.set(I.vao,'.targetVAO',l.scopeVAO.append(d,S));function A (E){const L=l.shader[E];L&&S.set(I.shader,'.'+E,L.append(d,S))}A(Mi),A(Di),Object.keys(l.state).length>0&&(S(N,'.dirty=true;'),S.exit(N,'.dirty=true;')),S('a1(',d.shared.context,',a0,',d.batchId,');')}function M (d){if(!(typeof d!='object'||ct(d))){for(let l=Object.keys(d),S=0;S<l.length;++S)if(Ut.isDynamic(d[l[S]]))return!0;return!1}}function we (d,l,S){const I=l.static[S];if(!I||!M(I))return;let N=d.global,A=Object.keys(I),E=!1,L=!1,h=!1,w=d.global.def('{}');A.forEach(function (O){let B=I[O];if(Ut.isDynamic(B)){typeof B=='function'&&(B=I[O]=Ut.unbox(B));const $=Bt(B,null);E=E||$.thisDep,h=h||$.propDep,L=L||$.contextDep}else{switch(N(w,'.',O,'='),typeof B){case'number':N(B);break;case'string':N('"',B,'"');break;case'object':Array.isArray(B)&&N('[',B.join(),']');break;default:N(d.link(B));break}N(';')}});function v (O,B){A.forEach(function ($){const le=I[$];if(Ut.isDynamic(le)){const fe=O.invoke(B,le);B(w,'.',$,'=',fe,';')}})}l.dynamic[S]=new Ut.DynamicVariable(gn,{ thisDep:E,contextDep:L,propDep:h,ref:w,append:v }),delete l.static[S]}function We (d,l,S,I,N){const A=Be();A.stats=A.link(N),Object.keys(l.static).forEach(function (L){we(A,l,L)}),Yh.forEach(function (L){we(A,d,L)});const E=vt(d,l,S,I,A);return pt(A,E),U(A,E),g(A,E),i(A.compile(),{ destroy (){E.shader.program.destroy()} })}return{ next:me,current:ye,procs:function (){const d=Be(),l=d.proc('poll'),S=d.proc('refresh'),I=d.block();l(I),S(I);const N=d.shared,A=N.gl,E=N.next,L=N.current;I(L,'.dirty=false;'),xt(d,l),xt(d,S,null,!0);let h;te&&(h=d.link(te)),b.oes_vertex_array_object&&S(d.link(b.oes_vertex_array_object),'.bindVertexArrayOES(null);');for(let w=0;w<V.maxAttributes;++w){const v=S.def(N.attributes,'[',w,']'),O=d.cond(v,'.buffer');O.then(A,'.enableVertexAttribArray(',w,');',A,'.bindBuffer(',pi,',',v,'.buffer.buffer);',A,'.vertexAttribPointer(',w,',',v,'.size,',v,'.type,',v,'.normalized,',v,'.stride,',v,'.offset);').else(A,'.disableVertexAttribArray(',w,');',A,'.vertexAttrib4f(',w,',',v,'.x,',v,'.y,',v,'.z,',v,'.w);',v,'.buffer=null;'),S(O),te&&S(h,'.vertexAttribDivisorANGLE(',w,',',v,'.divisor);')}return S(d.shared.vao,'.currentVAO=null;',d.shared.vao,'.setVAO(',d.shared.vao,'.targetVAO);'),Object.keys(q).forEach(function (B){const $=q[B],le=I.def(E,'.',B),fe=d.block();fe('if(',le,'){',A,'.enable(',$,')}else{',A,'.disable(',$,')}',L,'.',B,'=',le,';'),S(fe),l('if(',le,'!==',L,'.',B,'){',fe,'}')}),Object.keys(W).forEach(function (B){let $=W[B],le=ye[B],fe,ge,ue=d.block();if(ue(A,'.',$,'('),ct(le)){const Ce=le.length;fe=d.global.def(E,'.',B),ge=d.global.def(L,'.',B),ue(zt(Ce,function (_e){return fe+'['+_e+']'}),');',zt(Ce,function (_e){return ge+'['+_e+']='+fe+'['+_e+'];'}).join('')),l('if(',zt(Ce,function (_e){return fe+'['+_e+']!=='+ge+'['+_e+']'}).join('||'),'){',ue,'}')}else fe=I.def(E,'.',B),ge=I.def(L,'.',B),ue(fe,');',L,'.',B,'=',fe,';'),l('if(',fe,'!==',ge,'){',ue,'}');S(ue)}),d.compile()}(),compile:We }}function dp (){return{ vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0 }}const mp=34918,vp=34919,Iu=35007,gp=function (s,c){if(!c.ext_disjoint_timer_query)return null;const b=[];function V (){return b.pop()||c.ext_disjoint_timer_query.createQueryEXT()}function H (te){b.push(te)}const G=[];function j (te){const xe=V();c.ext_disjoint_timer_query.beginQueryEXT(Iu,xe),G.push(xe),J(G.length-1,G.length,te)}function Z (){c.ext_disjoint_timer_query.endQueryEXT(Iu)}function K (){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}const ne=[];function oe (){return ne.pop()||new K}function ae (te){ne.push(te)}const ce=[];function J (te,xe,Y){const ye=oe();ye.startQueryIndex=te,ye.endQueryIndex=xe,ye.sum=0,ye.stats=Y,ce.push(ye)}const re=[],R=[];function z (){let te,xe,Y=G.length;if(Y!==0){R.length=Math.max(R.length,Y+1),re.length=Math.max(re.length,Y+1),re[0]=0,R[0]=0;let ye=0;for(te=0,xe=0;xe<G.length;++xe){const me=G[xe];c.ext_disjoint_timer_query.getQueryObjectEXT(me,vp)?(ye+=c.ext_disjoint_timer_query.getQueryObjectEXT(me,mp),H(me)):G[te++]=me,re[xe+1]=ye,R[xe+1]=te}for(G.length=te,te=0,xe=0;xe<ce.length;++xe){const Ie=ce[xe],q=Ie.startQueryIndex,W=Ie.endQueryIndex;Ie.sum+=re[W]-re[q];const Se=R[q],he=R[W];he===Se?(Ie.stats.gpuTime+=Ie.sum/1e6,ae(Ie)):(Ie.startQueryIndex=Se,Ie.endQueryIndex=he,ce[te++]=Ie)}ce.length=te}}return{ beginQuery:j,endQuery:Z,pushScopeStats:J,update:z,getNumPendingQueries (){return G.length},clear (){b.push.apply(b,G);for(let te=0;te<b.length;te++)c.ext_disjoint_timer_query.deleteQueryEXT(b[te]);G.length=0,b.length=0},restore (){G.length=0,b.length=0} }},yp=16384,bp=256,xp=1024,_p=34962,Ru='webglcontextlost',Pu='webglcontextrestored',Ou=1,wp=2,Sp=3;function Nu (s,c){for(let b=0;b<s.length;++b)if(s[b]===c)return b;return-1}function Ep (s){const c=wf(s);if(!c)return null;let b=c.gl,V=b.getContextAttributes(),H=b.isContextLost(),G=Sf(b,c);if(!G)return null;const j=gf(),Z=dp(),K=G.extensions,ne=gp(b,K),oe=Us(),ae=b.drawingBufferWidth,ce=b.drawingBufferHeight,J={ tick:0,time:0,viewportWidth:ae,viewportHeight:ce,framebufferWidth:ae,framebufferHeight:ce,drawingBufferWidth:ae,drawingBufferHeight:ce,pixelRatio:c.pixelRatio },re={},R={ elements:null,primitive:4,count:-1,offset:0,instances:-1 },z=fc(b,K),te=Tc(b,Z,c,ye),xe=Dc(b,K,te,Z),Y=Dh(b,K,z,Z,te,xe,R);function ye (Pe){return Y.destroyBuffer(Pe)}var me=zh(b,j,Z,c),Ie=mh(b,K,z,function (){Se.procs.poll()},J,Z,c),q=vh(b,K,z,Z,c),W=Bh(b,K,z,Ie,q,Z),Se=pp(b,j,K,z,te,xe,Ie,W,re,Y,me,R,J,ne,c),he=Hh(b,W,Se.procs.poll,J,V,K,z),ee=Se.next,pe=b.canvas,de=[],Ve=[],Be=[],ve=[c.onDestroy],be=null;function Oe (){if(de.length===0){ne&&ne.update(),be=null;return}be=oa.next(Oe),kt();for(let Pe=de.length-1;Pe>=0;--Pe){const $e=de[Pe];$e&&$e(J,null,0)}b.flush(),ne&&ne.update()}function Me (){!be&&de.length>0&&(be=oa.next(Oe))}function qe (){be&&(oa.cancel(Oe),be=null)}function ut (Pe){Pe.preventDefault(),H=!0,qe(),Ve.forEach(function ($e){$e()})}function lt (Pe){b.getError(),H=!1,G.restore(),me.restore(),te.restore(),Ie.restore(),q.restore(),W.restore(),Y.restore(),ne&&ne.restore(),Se.procs.refresh(),Me(),Be.forEach(function ($e){$e()})}pe&&(pe.addEventListener(Ru,ut,!1),pe.addEventListener(Pu,lt,!1));function Ye (){de.length=0,qe(),pe&&(pe.removeEventListener(Ru,ut),pe.removeEventListener(Pu,lt)),me.clear(),W.clear(),q.clear(),Y.clear(),Ie.clear(),xe.clear(),te.clear(),ne&&ne.clear(),ve.forEach(function (Pe){Pe()})}function yt (Pe){p(!!Pe,'invalid args to regl({...})'),p.type(Pe,'object','invalid args to regl({...})');function $e (N){const A=i({},N);delete A.uniforms,delete A.attributes,delete A.context,delete A.vao,'stencil'in A&&A.stencil.op&&(A.stencil.opBack=A.stencil.opFront=A.stencil.op,delete A.stencil.op);function E (L){if(L in A){const h=A[L];delete A[L],Object.keys(h).forEach(function (w){A[L+'.'+w]=h[w]})}}return E('blend'),E('depth'),E('cull'),E('stencil'),E('polygonOffset'),E('scissor'),E('sample'),'vao'in N&&(A.vao=N.vao),A}function Ze (N,A){const E={},L={};return Object.keys(N).forEach(function (h){const w=N[h];if(Ut.isDynamic(w)){L[h]=Ut.unbox(w,h);return}else if(A&&Array.isArray(w)){for(let v=0;v<w.length;++v)if(Ut.isDynamic(w[v])){L[h]=Ut.unbox(w,h);return}}E[h]=w}),{ dynamic:L,static:E }}const pt=Ze(Pe.context||{},!0),ur=Ze(Pe.uniforms||{},!0),Xr=Ze(Pe.attributes||{},!1),g=Ze($e(Pe),!1),U={ gpuTime:0,cpuTime:0,count:0 },M=Se.compile(g,Xr,ur,pt,U),we=M.draw,We=M.batch,d=M.scope,l=[];function S (N){for(;l.length<N;)l.push(null);return l}function I (N,A){let E;if(H&&p.raise('context lost'),typeof N=='function')return d.call(this,null,N,0);if(typeof A=='function')if(typeof N=='number')for(E=0;E<N;++E)d.call(this,null,A,E);else if(Array.isArray(N))for(E=0;E<N.length;++E)d.call(this,N[E],A,E);else return d.call(this,N,A,0);else if(typeof N=='number'){if(N>0)return We.call(this,S(N|0),N|0)}else if(Array.isArray(N)){if(N.length)return We.call(this,N,N.length)}else return we.call(this,N)}return i(I,{ stats:U,destroy (){M.destroy()} })}const st=W.setFBO=yt({ framebuffer:Ut.define.call(null,Ou,'framebuffer') });function vt (Pe,$e){let Ze=0;Se.procs.poll();const pt=$e.color;pt&&(b.clearColor(+pt[0]||0,+pt[1]||0,+pt[2]||0,+pt[3]||0),Ze|=yp),'depth'in $e&&(b.clearDepth(+$e.depth),Ze|=bp),'stencil'in $e&&(b.clearStencil($e.stencil|0),Ze|=xp),p(!!Ze,'called regl.clear with no buffer specified'),b.clear(Ze)}function bt (Pe){if(p(typeof Pe=='object'&&Pe,'regl.clear() takes an object as input'),'framebuffer'in Pe)if(Pe.framebuffer&&Pe.framebuffer_reglType==='framebufferCube')for(let $e=0;$e<6;++$e)st(i({ framebuffer:Pe.framebuffer.faces[$e] },Pe),vt);else st(Pe,vt);else vt(null,Pe)}function xt (Pe){p.type(Pe,'function','regl.frame() callback must be a function'),de.push(Pe);function $e (){const Ze=Nu(de,Pe);p(Ze>=0,'cannot cancel a frame twice');function pt (){const ur=Nu(de,pt);de[ur]=de[de.length-1],de.length-=1,de.length<=0&&qe()}de[Ze]=pt}return Me(),{ cancel:$e }}function Et (){const Pe=ee.viewport,$e=ee.scissor_box;Pe[0]=Pe[1]=$e[0]=$e[1]=0,J.viewportWidth=J.framebufferWidth=J.drawingBufferWidth=Pe[2]=$e[2]=b.drawingBufferWidth,J.viewportHeight=J.framebufferHeight=J.drawingBufferHeight=Pe[3]=$e[3]=b.drawingBufferHeight}function kt (){J.tick+=1,J.time=Ue(),Et(),Se.procs.poll()}function ht (){Ie.refresh(),Et(),Se.procs.refresh(),ne&&ne.update()}function Ue (){return(Us()-oe)/1e3}ht();function Lt (Pe,$e){p.type($e,'function','listener callback must be a function');let Ze;switch(Pe){case'frame':return xt($e);case'lost':Ze=Ve;break;case'restore':Ze=Be;break;case'destroy':Ze=ve;break;default:p.raise('invalid event, must be one of frame,lost,restore,destroy')}return Ze.push($e),{ cancel (){for(let pt=0;pt<Ze.length;++pt)if(Ze[pt]===$e){Ze[pt]=Ze[Ze.length-1],Ze.pop();return}} }}const et=i(yt,{ clear:bt,prop:Ut.define.bind(null,Ou),context:Ut.define.bind(null,wp),this:Ut.define.bind(null,Sp),draw:yt({}),buffer (Pe){return te.create(Pe,_p,!1,!1)},elements (Pe){return xe.create(Pe,!1)},texture:Ie.create2D,cube:Ie.createCube,renderbuffer:q.create,framebuffer:W.create,framebufferCube:W.createCube,vao:Y.createVAO,attributes:V,frame:xt,on:Lt,limits:z,hasExtension (Pe){return z.extensions.indexOf(Pe.toLowerCase())>=0},read:he,destroy:Ye,_gl:b,_refresh:ht,poll (){kt(),ne&&ne.update()},now:Ue,stats:Z });return c.onDone(null,et),et}return Ep})}(Vn)),Vn.exports}const vd=md();const gd=Qn(vd);class qu{constructor (t,r){this.canvas=t,this.device=r,this.context=this.canvas.getContext('webgpu'),this.aspect=this.canvas.width/this.canvas.height}async setupFromScratch (){if(!navigator.gpu){console.error('WebGPU is not supported on this browser.');return}const t=await navigator.gpu.requestAdapter();if(!t){console.error('Failed to get GPU adapter.');return}this.device=await t.requestDevice();const i=await createTextureFromImage(this.device,'./fritzpix.jpg',{ flipY:!0 });this.sourceTexture=i}async initializeFBOdrawing (){this.device||await this.setupFromScratch();const t=navigator.gpu.getPreferredCanvasFormat();this.context.configure({ device:this.device,format:t,alphaMode:'opaque' });const r=`
	 struct VertexOutput {
  	@builtin(position) position : vec4f,
  	@location(0) texcoord : vec2f,
	 };
   @group(0) @binding(0) var ourSamp: sampler;
	 @group(0) @binding(1) var ourTex:  texture_2d<f32>;
`,i=r+`
        @vertex
        fn main(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
          var positions = array<vec2<f32>, 6>(
            vec2<f32>(-1.0, -1.0),
            vec2<f32>(-1.0, 1.0),
            vec2<f32>(1.0, -1.0 ),

            vec2<f32>(1.0, -1.0),
            vec2<f32>(-1.0, 1.0),
            vec2<f32>(1.0, 1.0)
          );
         var output : VertexOutput;
         output.position = vec4<f32>( positions[vertexIndex], 0.0, 1);
         output.texcoord = positions[vertexIndex] / 2 + 0.5; // positions are -1.0 to 1.0, texcoords are 0.0 to 1.0.
         return output;
        }
      `,n=r+`
        @fragment
        fn main(ourIn: VertexOutput) -> @location(0) vec4<f32> {
          var uv :vec2<f32>;
          uv = ourIn.texcoord; //* ourStruct.scale + ourStruct.offset;
          return textureSample(ourTex, ourSamp, uv);
        }
      `,o=this.device.createShaderModule({ label:'vertFBO',code:i }),u=this.device.createShaderModule({ label:'fragFBO',code:n });this.textureBindGroupLayout=this.device.createBindGroupLayout({ label:'FBOtextureBindGroupLayout',entries:[{ binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{ type:'filtering' } },{ binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{ sampleType:'float',viewDimension:'2d',multisampled:!1 } }] }),this.pipelineLayout=this.device.createPipelineLayout({ bindGroupLayouts:[this.textureBindGroupLayout] }),this.pipeline=this.device.createRenderPipeline({ label:'FBOrenderpipeline',vertex:{ module:o,entryPoint:'main' },fragment:{ module:u,entryPoint:'main',targets:[{ format:t }] },primitive:{ topology:'triangle-list' },layout:this.pipelineLayout }),this.sampler=this.device.createSampler()}refreshCanvas (t){if(t&&(this.sourceTexture=t),!this.sourceTexture)return;this.textureBindGroup=this.device.createBindGroup({ label:'texture bind group',layout:this.textureBindGroupLayout,entries:[{ binding:0,resource:this.sampler },{ binding:1,resource:this.sourceTexture.createView() }] });const r=this.context.getCurrentTexture().createView();this.renderPassDescriptor={ label:'FBOrenderPassDescriptor',colorAttachments:[{ label:'FBO canvas textureView attachment',view:r,clearValue:{ r:1,g:1,b:1,a:1 },loadOp:'clear',storeOp:'store' }] };const i=this.device.createCommandEncoder(),n=i.beginRenderPass(this.renderPassDescriptor);n.setPipeline(this.pipeline),n.setBindGroup(0,this.textureBindGroup),n.draw(6),n.end(),this.device.queue.submit([i.finish()])}}class $u{constructor (t,r){this.canvas=t,this.device=r,this.context=this.canvas.getContext('webgpu'),this.aspect=this.canvas.width/this.canvas.height}async setupFromScratch (){if(!navigator.gpu){console.error('WebGPU is not supported on this browser.');return}const t=await navigator.gpu.requestAdapter();if(!t){console.error('Failed to get GPU adapter.');return}this.device=await t.requestDevice()}async initializeFBOdrawing (){this.device||await this.setupFromScratch();const t=navigator.gpu.getPreferredCanvasFormat();this.context.configure({ device:this.device,format:t,alphaMode:'opaque' });const r=`
	 struct VertexOutput {
  	@builtin(position) position : vec4f,
  	@location(0) texcoord : vec2f,
	 };
   @group(0) @binding(0) var ourSamp0: sampler;
	 @group(0) @binding(1) var ourTex0:  texture_2d<f32>;
   @group(0) @binding(2) var ourSamp1: sampler;
	 @group(0) @binding(3) var ourTex1:  texture_2d<f32>;
   @group(0) @binding(4) var ourSamp2: sampler;
	 @group(0) @binding(5) var ourTex2:  texture_2d<f32>;
	 @group(0) @binding(6) var ourSamp3: sampler;
	 @group(0) @binding(7) var ourTex3:  texture_2d<f32>;
`,i=r+`
        @vertex
        fn main(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
          var positions = array<vec2<f32>, 6>(
            vec2<f32>(-1.0, -1.0),
            vec2<f32>(-1.0, 1.0),
            vec2<f32>(1.0, -1.0 ),

            vec2<f32>(1.0, -1.0),
            vec2<f32>(-1.0, 1.0),
            vec2<f32>(1.0, 1.0)
          );
         var output : VertexOutput;
         output.position = vec4<f32>( positions[vertexIndex], 0.0, 1);
         output.texcoord = positions[vertexIndex] / 2 + 0.5; // positions are -1.0 to 1.0, texcoords are 0.0 to 1.0.
         return output;
        }
      `,n=r+`
        @fragment
        fn main(ourIn: VertexOutput) -> @location(0) vec4<f32> {
         var uv :vec2<f32>;
         uv = ourIn.texcoord; //* ourStruct.scale + ourStruct.offset;

        var st = vec2<f32>(uv.x, uv.y);
        st = st * vec2<f32>(2.0);
        let q = floor(st).xy*(vec2<f32>(2.0, 1.0));
        let quad : i32 = i32(q.x) + i32(q.y);
        st.x =  st.x + step(1., st.y % 2.0);
        st.y = st.y + step(1., st.x %2.0);
        st = fract(st);

        let val0 = textureSample(ourTex0, ourSamp0, st);
        let val1 = textureSample(ourTex1, ourSamp1, st);
        let val2 = textureSample(ourTex2, ourSamp2, st);
        let val3 = textureSample(ourTex3, ourSamp3, st);
   
        if(quad == 0){ // LLHC
					return val1;
        } else if (quad == 1) { // ULHC
					return val0;
        } else if (quad == 2){ // LRHC
					return val3;
        } else {
  				return val2; // URHC
        }
      }
`,o=this.device.createShaderModule({ label:'vertFBO',code:i }),u=this.device.createShaderModule({ label:'fragFBO',code:n });this.textureBindGroupLayout=this.device.createBindGroupLayout({ label:'FBOtextureBindGroupLayout',entries:[{ binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{ type:'filtering' } },{ binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{ sampleType:'float',viewDimension:'2d',multisampled:!1 } },{ binding:2,visibility:GPUShaderStage.FRAGMENT,sampler:{ type:'filtering' } },{ binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{ sampleType:'float',viewDimension:'2d',multisampled:!1 } },{ binding:4,visibility:GPUShaderStage.FRAGMENT,sampler:{ type:'filtering' } },{ binding:5,visibility:GPUShaderStage.FRAGMENT,texture:{ sampleType:'float',viewDimension:'2d',multisampled:!1 } },{ binding:6,visibility:GPUShaderStage.FRAGMENT,sampler:{ type:'filtering' } },{ binding:7,visibility:GPUShaderStage.FRAGMENT,texture:{ sampleType:'float',viewDimension:'2d',multisampled:!1 } }] }),this.pipelineLayout=this.device.createPipelineLayout({ bindGroupLayouts:[this.textureBindGroupLayout] }),this.pipeline=this.device.createRenderPipeline({ label:'FBOrenderpipeline',vertex:{ module:o,entryPoint:'main' },fragment:{ module:u,entryPoint:'main',targets:[{ format:t }] },primitive:{ topology:'triangle-list' },layout:this.pipelineLayout }),this.sampler0=this.device.createSampler(),this.sampler1=this.device.createSampler(),this.sampler2=this.device.createSampler(),this.sampler3=this.device.createSampler()}refreshCanvases (t,r,i,n){if(!t||!r||!i||!n)return;this.textureBindGroup=this.device.createBindGroup({ label:'texture bind group',layout:this.textureBindGroupLayout,entries:[{ binding:0,resource:this.sampler0 },{ binding:1,resource:t.createView() },{ binding:2,resource:this.sampler1 },{ binding:3,resource:r.createView() },{ binding:4,resource:this.sampler2 },{ binding:5,resource:i.createView() },{ binding:6,resource:this.sampler3 },{ binding:7,resource:n.createView() }] });const o=this.context.getCurrentTexture().createView();this.renderPassDescriptor={ label:'FBOrenderPassDescriptor',colorAttachments:[{ label:'FBO canvas textureView attachment',view:o,clearValue:{ r:1,g:1,b:1,a:1 },loadOp:'clear',storeOp:'store' }] };const u=this.device.createCommandEncoder(),m=u.beginRenderPass(this.renderPassDescriptor);m.setPipeline(this.pipeline),m.setBindGroup(0,this.textureBindGroup),m.draw(6),m.end(),this.device.queue.submit([u.finish()])}}const vl=`
	 struct VertexOutput {
  	@builtin(position) position : vec4f,
  	@location(0) texcoord : vec2f,
	 };
`,yd=`
   @group(0) @binding(0) var<uniform> time: f32;
   @group(0) @binding(1) var<uniform> resolution: vec2<f32>;
   @group(0) @binding(2) var<uniform> mouse: vec2<f32>;
`,bd=vl+`
    @vertex
    fn main(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
      var positions = array<vec2<f32>, 6>(
        vec2<f32>(-1.0, -1.0),
        vec2<f32>(-1.0, 1.0),
        vec2<f32>(1.0, -1.0),

        vec2<f32>(1.0, -1.0),
        vec2<f32>(-1.0, 1.0),
        vec2<f32>(1.0, 1.0)
      );

     var output : VertexOutput;
     output.position = vec4<f32>( positions[vertexIndex], 0.0, 1.0);
     output.texcoord = positions[vertexIndex] / 2.0 + 0.5; // positions are -1 to 1, texcoords are 0 
     return output;
    }
`;class xd{constructor (t){this.chan=t,this.channelTexInfo=[],this.reset()}reset (){this.pingPongs=0,this.fragmentShaderSource=void 0,this.fragmentShaderModule=void 0,this.pipelineLayout=void 0,this.pipeline=void 0,this.uniformList=void 0,this.channelUniforms=[],this.textureUniforms=[],this.valueUniforms=[],this.bindGroupHeader=void 0,this.bindGroupLayout=void 0,this.hasValueUniforms=!1,this.structString=void 0,this.valueStructView=void 0,this.structUniformBuffer=void 0}}class _d{constructor (t,r,i=4){this.hydra=t,this.canvas=r,this.context=this.canvas.getContext('webgpu'),this.aspect=this.canvas.width/this.canvas.height,this.numChannels=i||4,this.renderPassInfo=new Array(i);for(let n=0;n<i;++n)this.renderPassInfo[n]=new xd(n);this.time=0,this.mousePos={ x:0,y:0 },this.showQuad=!1,this.outChannel=0}relayUniformInfo (t){this.mousePos=t}async resizeOutputsTo (t,r){this.canvas.width=Math.max(1,Math.min(t,this.device.limits.maxTextureDimension2D)),this.canvas.height=Math.max(1,Math.min(r,this.device.limits.maxTextureDimension2D)),this.createOutputTextures(),this.fboRenderer=new qu(this.canvas,this.device),this.fbo4Renderer=new $u(this.canvas,this.device),await this.fboRenderer.initializeFBOdrawing(),await this.fbo4Renderer.initializeFBOdrawing()}createOutputTextures (){this.outputChannelObjects=this.hydra.o,this.destTextureDescriptor={ size:{ width:this.canvas.width,height:this.canvas.height },mipLevelCount:1,format:this.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT };for(let t=0;t<this.numChannels;++t)this.outputChannelObjects[t].createTexturesAndViews(this.device,this.destTextureDescriptor)}async setupHydra (){if(!navigator.gpu){console.error('WebGPU is not supported on this browser.');return}const t=await navigator.gpu.requestAdapter();if(!t){console.error('Failed to get GPU adapter.');return}const r=t.features.has('bgra8unorm-storage');this.device=await t.requestDevice({ requiredFeatures:r?['bgra8unorm-storage']:[] }),this.fboRenderer=new qu(this.canvas,this.device),this.fbo4Renderer=new $u(this.canvas,this.device),this.format=navigator.gpu.getPreferredCanvasFormat(),this.context.configure({ device:this.device,format:this.format,alphaMode:'opaque',usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT }),this.dummyTexture=await this.device.createTexture({ size:[320,240],format:this.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST }),this.sharedBindGroupLayout=this.device.createBindGroupLayout({ label:'',entries:[{ binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{ type:'uniform' } },{ binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{ type:'uniform' } },{ binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{ type:'uniform' } }] }),this.timeUniformBuffer=this.device.createBuffer({ label:'time uniform buffer',size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST }),this.timeUniformValues=new Float32Array(1),this.resolutionUniformBuffer=this.device.createBuffer({ label:'resolution uniform buffer',size:8,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST }),this.resolutionUniformValues=new Float32Array(2),this.mouseUniformBuffer=this.device.createBuffer({ label:'mouse uniform buffer',size:8,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST }),this.mouseUniformValues=new Float32Array(2),this.sharedBindGroup=this.device.createBindGroup({ label:'shared bind group',layout:this.sharedBindGroupLayout,entries:[{ binding:0,resource:{ buffer:this.timeUniformBuffer } },{ binding:1,resource:{ buffer:this.resolutionUniformBuffer } },{ binding:2,resource:{ buffer:this.mouseUniformBuffer } }] }),this.createOutputTextures(),this.vertexShaderModule=this.device.createShaderModule({ label:'wgslvertex',code:bd }),await this.fboRenderer.initializeFBOdrawing(),await this.fbo4Renderer.initializeFBOdrawing()}async setupHydraChain (t,r,i){const n=this.renderPassInfo[t];n.reset(),n.outputObject=this.outputChannelObjects[t],n.uniformList=r,this.generateUniformDeclarations(t),n.fragmentShaderSource=vl+yd+n.bindGroupHeader+i,n.fragmentShaderModule=this.device.createShaderModule({ label:'wgslsfrag',code:n.fragmentShaderSource }),n.pipelineLayout=this.device.createPipelineLayout({ bindGroupLayouts:[this.sharedBindGroupLayout,n.bindGroupLayout] }),n.pipeline=this.device.createRenderPipeline({ label:'pipeline '+t,vertex:{ module:this.vertexShaderModule,entryPoint:'main' },fragment:{ module:n.fragmentShaderModule,entryPoint:'main',targets:[{ format:this.format }] },primitive:{ topology:'triangle-list' },layout:n.pipelineLayout }),this.createSamplerOrBuffersForChan(t)}async animate (t){const r=this.device.createCommandEncoder();this.timeUniformValues[0]=this.time+=t/1e3,this.device.queue.writeBuffer(this.timeUniformBuffer,0,this.timeUniformValues),this.resolutionUniformValues[0]=this.canvas.width,this.resolutionUniformValues[1]=this.canvas.height,this.device.queue.writeBuffer(this.resolutionUniformBuffer,0,this.resolutionUniformValues),this.mouseUniformValues[0]=this.mousePos.x,this.mouseUniformValues[1]=this.mousePos.y,this.device.queue.writeBuffer(this.mouseUniformBuffer,0,this.mouseUniformValues);for(let i=0;i<this.numChannels;++i){const n=this.renderPassInfo[i];if(!n.pipeline)continue;n.outputObject.flipPingPong();const o={ label:'renderPassDescriptor',colorAttachments:[{ label:'canvas textureView attachment '+i,view:n.outputObject.getCurrentTextureView(),clearValue:{ r:1,g:1,b:1,a:1 },loadOp:'clear',storeOp:'store' }] };const u=await this.fillBindGroup(i),m=await this.device.createBindGroup(u);const _=r.beginRenderPass(o);_.setPipeline(n.pipeline),_.setBindGroup(0,this.sharedBindGroup),_.setBindGroup(1,m),_.draw(6),_.end()}this.device.queue.submit([r.finish()]),await this.device.queue.onSubmittedWorkDone(),this.showQuad?await this.fbo4Renderer.refreshCanvases(this.outputChannelObjects[0].getCurrentTexture(),this.outputChannelObjects[1].getCurrentTexture(),this.outputChannelObjects[2].getCurrentTexture(),this.outputChannelObjects[3].getCurrentTexture()):await this.fboRenderer.refreshCanvas(this.outputChannelObjects[this.outChannel].getCurrentTexture())}generateUniformDeclarations (t){const r=this.renderPassInfo[t];let i=r.uniformList,n=1,o=0;r.channelUniforms=[],Object.keys(i).forEach(k=>{if(k==='prevBuffer')return;let y;k.startsWith('tex')?(y=new wd(t,n,k,i[k]),r.textureUniforms.push(y),n+=y.indexesUsed):(y=new Sd(t,o,k,i[k],i),r.valueUniforms.push(y),o++),r.channelUniforms.push(y)}),r.channelUniforms;const u=r.valueUniforms;r.hasValueUniforms=u.length>0;let m='',_=[];if(r.hasValueUniforms){let k=`struct UF {
`;for(let y=0;y<u.length;++y)k=k+u[y].getStructLineItem();k=k+`};
    @group(1) @binding(0) var<uniform> uf : UF;
`,r.structString=k,m=k,_=[{ binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{ type:'uniform' } }]}const P=r.textureUniforms;for(let k=0;k<P.length;++k){const y=P[k],T=y.bindGroupString();m=m+T,_.push(...y.getBindGroupLayoutEntries())}r.bindGroupLayout=this.device.createBindGroupLayout({ label:'bg layout '+t,entries:_ }),r.bindGroupHeader=m}createSamplerOrBuffersForChan (t){const r=this.renderPassInfo[t];r.hasValueUniforms&&(r.valueStructView=new Float32Array(r.valueUniforms.length),r.valueStructBuffer=this.device.createBuffer({ size:r.valueStructView.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST }));const i=r.textureUniforms;for(let n=0;n<i.length;++n)i[n].createSamplerOrBuffers(this.device)}fillBindGroup (t){const r=this.renderPassInfo[t];const i=r.channelUniforms;if(!i||i.length===0)return{ label:'bg'+t,layout:r.bindGroupLayout,entries:[] };let n;r.hasValueUniforms?(this.setAllValueUniformValues(t,this.time),this.device.queue.writeBuffer(r.valueStructBuffer,0,r.valueStructView),n=[{ binding:0,resource:{ buffer:r.valueStructBuffer } }]):n=[];const o=r.textureUniforms;for(let m=0;m<o.length;++m){const _=o[m];n.push(..._.getBindGroupEntries(this,this.time))}return{ label:'bg'+t,layout:r.bindGroupLayout,entries:n }}setAllValueUniformValues (t,r){const i=this.renderPassInfo[t];const n=i.valueUniforms;for(let o=0;o<n.length;++o)n[o].setUniformValues(i,r)}}class wd{constructor (t,r,i,n){this.chan=t,this.index=r,this.name=i,this.valCallback=n,this.indexesUsed=2}indexesUsed (){return 2}bindGroupString (){return`@group(1) @binding(${this.index}) var samp${this.name}: sampler;
 @group(1) @binding(${this.index+1}) var ${this.name}:  texture_2d<f32>;
`}getBindGroupLayoutEntries (){const t={ binding:this.index,visibility:GPUShaderStage.FRAGMENT,sampler:{ type:'filtering' } },r={ binding:this.index+1,visibility:GPUShaderStage.FRAGMENT,texture:{ sampleType:'float',viewDimension:'2d',multisampled:!1 } };return[t,r]}createSamplerOrBuffers (t){return this.sampler=t.createSampler(),this.sampler}getBindGroupEntries (t){return this.cbValue=this.valCallback(),this.cbValue||(this.cbValue=t.dummyTexture.createView()),[{ binding:this.index,resource:this.sampler },{ binding:this.index+1,resource:this.cbValue }]}}class Sd{constructor (t,r,i,n){this.chan=t,this.index=r,this.name=i,this.valCallback=n,this.indexesUsed=0}getBindGroupLayoutEntries (){return[{ binding:this.index,visibility:GPUShaderStage.FRAGMENT,buffer:{ type:'uniform' } }]}getStructLineItem (){return`${this.name} : f32,
`}setUniformValues (t,r){const i={ time:r,bpm:120 };this.cbValue=this.valCallback(void 0,i),(!this.cbValue||this.cbValue===NaN)&&(this.cbValue=0),t.valueStructView[this.index]=this.cbValue}}const Ed=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],gl=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],Ad='‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࢗ-࢟࣊-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄ఼ా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ೳഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-໎໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜕ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠏-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿ-ᫎᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷿‌‍‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯・꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿･',yl='ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࡰ-ࢇࢉ-ࢎࢠ-ࣉऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౝౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೝೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜑᜟ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭌᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲊᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꟍꟐꟑꟓꟕ-Ƛꟲ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ',fs={ 3:'abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile',5:'class enum extends super const export import',6:'enum',strict:'implements interface let package private protected public static yield',strictBind:'eval arguments' },cs='break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this',Td={ 5:cs,'5module':cs+' export import',6:cs+' const class extends export import super' },Cd=/^in(stanceof)?$/,kd=new RegExp('['+yl+']'),Ld=new RegExp('['+yl+Ad+']');function ys (e,t){for(let r=65536,i=0;i<t.length;i+=2){if(r+=t[i],r>e)return!1;if(r+=t[i+1],r>=e)return!0}return!1}function Sr (e,t){return e<65?e===36:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&kd.test(String.fromCharCode(e)):t===!1?!1:ys(e,gl)}function bi (e,t){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&Ld.test(String.fromCharCode(e)):t===!1?!1:ys(e,gl)||ys(e,Ed)}const nt=function (t,r){r===void 0&&(r={}),this.label=t,this.keyword=r.keyword,this.beforeExpr=!!r.beforeExpr,this.startsExpr=!!r.startsExpr,this.isLoop=!!r.isLoop,this.isAssign=!!r.isAssign,this.prefix=!!r.prefix,this.postfix=!!r.postfix,this.binop=r.binop||null,this.updateContext=null};function $t (e,t){return new nt(e,{ beforeExpr:!0,binop:t })}const Xt={ beforeExpr:!0 },Mt={ startsExpr:!0 },As={};function rt (e,t){return t===void 0&&(t={}),t.keyword=e,As[e]=new nt(e,t)}const f={ num:new nt('num',Mt),regexp:new nt('regexp',Mt),string:new nt('string',Mt),name:new nt('name',Mt),privateId:new nt('privateId',Mt),eof:new nt('eof'),bracketL:new nt('[',{ beforeExpr:!0,startsExpr:!0 }),bracketR:new nt(']'),braceL:new nt('{',{ beforeExpr:!0,startsExpr:!0 }),braceR:new nt('}'),parenL:new nt('(',{ beforeExpr:!0,startsExpr:!0 }),parenR:new nt(')'),comma:new nt(',',Xt),semi:new nt(';',Xt),colon:new nt(':',Xt),dot:new nt('.'),question:new nt('?',Xt),questionDot:new nt('?.'),arrow:new nt('=>',Xt),template:new nt('template'),invalidTemplate:new nt('invalidTemplate'),ellipsis:new nt('...',Xt),backQuote:new nt('`',Mt),dollarBraceL:new nt('${',{ beforeExpr:!0,startsExpr:!0 }),eq:new nt('=',{ beforeExpr:!0,isAssign:!0 }),assign:new nt('_=',{ beforeExpr:!0,isAssign:!0 }),incDec:new nt('++/--',{ prefix:!0,postfix:!0,startsExpr:!0 }),prefix:new nt('!/~',{ beforeExpr:!0,prefix:!0,startsExpr:!0 }),logicalOR:$t('||',1),logicalAND:$t('&&',2),bitwiseOR:$t('|',3),bitwiseXOR:$t('^',4),bitwiseAND:$t('&',5),equality:$t('==/!=/===/!==',6),relational:$t('</>/<=/>=',7),bitShift:$t('<</>>/>>>',8),plusMin:new nt('+/-',{ beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0 }),modulo:$t('%',10),star:$t('*',10),slash:$t('/',10),starstar:new nt('**',{ beforeExpr:!0 }),coalesce:$t('??',1),_break:rt('break'),_case:rt('case',Xt),_catch:rt('catch'),_continue:rt('continue'),_debugger:rt('debugger'),_default:rt('default',Xt),_do:rt('do',{ isLoop:!0,beforeExpr:!0 }),_else:rt('else',Xt),_finally:rt('finally'),_for:rt('for',{ isLoop:!0 }),_function:rt('function',Mt),_if:rt('if'),_return:rt('return',Xt),_switch:rt('switch'),_throw:rt('throw',Xt),_try:rt('try'),_var:rt('var'),_const:rt('const'),_while:rt('while',{ isLoop:!0 }),_with:rt('with'),_new:rt('new',{ beforeExpr:!0,startsExpr:!0 }),_this:rt('this',Mt),_super:rt('super',Mt),_class:rt('class',Mt),_extends:rt('extends',Xt),_export:rt('export'),_import:rt('import',Mt),_null:rt('null',Mt),_true:rt('true',Mt),_false:rt('false',Mt),_in:rt('in',{ beforeExpr:!0,binop:7 }),_instanceof:rt('instanceof',{ beforeExpr:!0,binop:7 }),_typeof:rt('typeof',{ beforeExpr:!0,prefix:!0,startsExpr:!0 }),_void:rt('void',{ beforeExpr:!0,prefix:!0,startsExpr:!0 }),_delete:rt('delete',{ beforeExpr:!0,prefix:!0,startsExpr:!0 }) },Qt=/\r\n?|\n|\u2028|\u2029/,Id=new RegExp(Qt.source,'g');function _i (e){return e===10||e===13||e===8232||e===8233}function bl (e,t,r){r===void 0&&(r=e.length);for(let i=t;i<r;i++){const n=e.charCodeAt(i);if(_i(n))return i<r-1&&n===13&&e.charCodeAt(i+1)===10?i+2:i+1}return-1}const xl=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Yt=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,_l=Object.prototype,Rd=_l.hasOwnProperty,Pd=_l.toString,wi=Object.hasOwn||function (e,t){return Rd.call(e,t)},Xu=Array.isArray||function (e){return Pd.call(e)==='[object Array]'},Yu=Object.create(null);function Nr (e){return Yu[e]||(Yu[e]=new RegExp('^(?:'+e.replace(/ /g,'|')+')$'))}function Er (e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}const Od=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Yi=function (t,r){this.line=t,this.column=r};Yi.prototype.offset=function (t){return new Yi(this.line,this.column+t)};const Zn=function (t,r,i){this.start=r,this.end=i,t.sourceFile!==null&&(this.source=t.sourceFile)};function wl (e,t){for(let r=1,i=0;;){const n=bl(e,i,t);if(n<0)return new Yi(r,t-i);++r,i=n}}let bs={ ecmaVersion:null,sourceType:'script',onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1 },Ku=!1;function Nd (e){const t={};for(const r in bs)t[r]=e&&wi(e,r)?e[r]:bs[r];if(t.ecmaVersion==='latest'?t.ecmaVersion=1e8:t.ecmaVersion==null?(!Ku&&typeof console=='object'&&console.warn&&(Ku=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),t.ecmaVersion=11):t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),t.allowReserved==null&&(t.allowReserved=t.ecmaVersion<5),(!e||e.allowHashBang==null)&&(t.allowHashBang=t.ecmaVersion>=14),Xu(t.onToken)){const i=t.onToken;t.onToken=function (n){return i.push(n)}}return Xu(t.onComment)&&(t.onComment=Fd(t,t.onComment)),t}function Fd (e,t){return function (r,i,n,o,u,m){const _={ type:r?'Block':'Line',value:i,start:n,end:o };e.locations&&(_.loc=new Zn(this,u,m)),e.ranges&&(_.range=[n,o]),t.push(_)}}const Ki=1,Si=2,Ts=4,Sl=8,Cs=16,El=32,Jn=64,Al=128,Zr=256,Qi=512,ea=Ki|Si|Zr;function ks (e,t){return Si|(e?Ts:0)|(t?Sl:0)}const jn=0,Ls=1,Tr=2,Tl=3,Cl=4,kl=5,Tt=function (t,r,i){this.options=t=Nd(t),this.sourceFile=t.sourceFile,this.keywords=Nr(Td[t.ecmaVersion>=6?6:t.sourceType==='module'?'5module':5]);let n='';t.allowReserved!==!0&&(n=fs[t.ecmaVersion>=6?6:t.ecmaVersion===5?5:3],t.sourceType==='module'&&(n+=' await')),this.reservedWords=Nr(n);const o=(n?n+' ':'')+fs.strict;this.reservedWordsStrict=Nr(o),this.reservedWordsStrictBind=Nr(o+' '+fs.strictBind),this.input=String(r),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf(`
`,i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Qt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=f.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=t.sourceType==='module',this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&t.allowHashBang&&this.input.slice(0,2)==='#!'&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Ki),this.regexpState=null,this.privateNameStack=[]},cr={ inFunction:{ configurable:!0 },inGenerator:{ configurable:!0 },inAsync:{ configurable:!0 },canAwait:{ configurable:!0 },allowSuper:{ configurable:!0 },allowDirectSuper:{ configurable:!0 },treatFunctionsAsVar:{ configurable:!0 },allowNewDotTarget:{ configurable:!0 },inClassStaticBlock:{ configurable:!0 } };Tt.prototype.parse=function (){const t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)};cr.inFunction.get=function (){return(this.currentVarScope().flags&Si)>0};cr.inGenerator.get=function (){return(this.currentVarScope().flags&Sl)>0};cr.inAsync.get=function (){return(this.currentVarScope().flags&Ts)>0};cr.canAwait.get=function (){for(let e=this.scopeStack.length-1;e>=0;e--){const t=this.scopeStack[e],r=t.flags;if(r&(Zr|Qi))return!1;if(r&Si)return(r&Ts)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};cr.allowSuper.get=function (){const e=this.currentThisScope(),t=e.flags;return(t&Jn)>0||this.options.allowSuperOutsideMethod};cr.allowDirectSuper.get=function (){return(this.currentThisScope().flags&Al)>0};cr.treatFunctionsAsVar.get=function (){return this.treatFunctionsAsVarInScope(this.currentScope())};cr.allowNewDotTarget.get=function (){for(let e=this.scopeStack.length-1;e>=0;e--){const t=this.scopeStack[e],r=t.flags;if(r&(Zr|Qi)||r&Si&&!(r&Cs))return!0}return!1};cr.inClassStaticBlock.get=function (){return(this.currentVarScope().flags&Zr)>0};Tt.extend=function (){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];for(var i=this,n=0;n<t.length;n++)i=t[n](i);return i};Tt.parse=function (t,r){return new this(r,t).parse()};Tt.parseExpressionAt=function (t,r,i){const n=new this(i,t,r);return n.nextToken(),n.parseExpression()};Tt.tokenizer=function (t,r){return new this(r,t)};Object.defineProperties(Tt.prototype,cr);const Ft=Tt.prototype,Bd=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;Ft.strictDirective=function (e){if(this.options.ecmaVersion<5)return!1;for(;;){Yt.lastIndex=e,e+=Yt.exec(this.input)[0].length;const t=Bd.exec(this.input.slice(e));if(!t)return!1;if((t[1]||t[2])==='use strict'){Yt.lastIndex=e+t[0].length;const r=Yt.exec(this.input),i=r.index+r[0].length,n=this.input.charAt(i);return n===';'||n==='}'||Qt.test(r[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(n)||n==='!'&&this.input.charAt(i+1)==='=')}e+=t[0].length,Yt.lastIndex=e,e+=Yt.exec(this.input)[0].length,this.input[e]===';'&&e++}};Ft.eat=function (e){return this.type===e?(this.next(),!0):!1};Ft.isContextual=function (e){return this.type===f.name&&this.value===e&&!this.containsEsc};Ft.eatContextual=function (e){return this.isContextual(e)?(this.next(),!0):!1};Ft.expectContextual=function (e){this.eatContextual(e)||this.unexpected()};Ft.canInsertSemicolon=function (){return this.type===f.eof||this.type===f.braceR||Qt.test(this.input.slice(this.lastTokEnd,this.start))};Ft.insertSemicolon=function (){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};Ft.semicolon=function (){!this.eat(f.semi)&&!this.insertSemicolon()&&this.unexpected()};Ft.afterTrailingComma=function (e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0};Ft.expect=function (e){this.eat(e)||this.unexpected()};Ft.unexpected=function (e){this.raise(e??this.start,'Unexpected token')};const ta=function (){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};Ft.checkPatternErrors=function (e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,'Comma is not permitted after the rest element');const r=t?e.parenthesizedAssign:e.parenthesizedBind;r>-1&&this.raiseRecoverable(r,t?'Assigning to rvalue':'Parenthesized pattern')}};Ft.checkExpressionErrors=function (e,t){if(!e)return!1;const r=e.shorthandAssign,i=e.doubleProto;if(!t)return r>=0||i>=0;r>=0&&this.raise(r,'Shorthand property assignments are valid only in destructuring patterns'),i>=0&&this.raiseRecoverable(i,'Redefinition of __proto__ property')};Ft.checkYieldAwaitInDefaultParams=function (){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,'Yield expression cannot be a default value'),this.awaitPos&&this.raise(this.awaitPos,'Await expression cannot be a default value')};Ft.isSimpleAssignTarget=function (e){return e.type==='ParenthesizedExpression'?this.isSimpleAssignTarget(e.expression):e.type==='Identifier'||e.type==='MemberExpression'};const Fe=Tt.prototype;Fe.parseTopLevel=function (e){const t=Object.create(null);for(e.body||(e.body=[]);this.type!==f.eof;){const r=this.parseStatement(null,!0,t);e.body.push(r)}if(this.inModule)for(let i=0,n=Object.keys(this.undefinedExports);i<n.length;i+=1){const o=n[i];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,'Program')};const Is={ kind:'loop' },Md={ kind:'switch' };Fe.isLet=function (e){if(this.options.ecmaVersion<6||!this.isContextual('let'))return!1;Yt.lastIndex=this.pos;let t=Yt.exec(this.input),r=this.pos+t[0].length,i=this.input.charCodeAt(r);if(i===91||i===92)return!0;if(e)return!1;if(i===123||i>55295&&i<56320)return!0;if(Sr(i,!0)){for(var n=r+1;bi(i=this.input.charCodeAt(n),!0);)++n;if(i===92||i>55295&&i<56320)return!0;const o=this.input.slice(r,n);if(!Cd.test(o))return!0}return!1};Fe.isAsyncFunction=function (){if(this.options.ecmaVersion<8||!this.isContextual('async'))return!1;Yt.lastIndex=this.pos;let e=Yt.exec(this.input),t=this.pos+e[0].length,r;return!Qt.test(this.input.slice(this.pos,t))&&this.input.slice(t,t+8)==='function'&&(t+8===this.input.length||!(bi(r=this.input.charCodeAt(t+8))||r>55295&&r<56320))};Fe.parseStatement=function (e,t,r){let i=this.type,n=this.startNode(),o;switch(this.isLet(e)&&(i=f._var,o='let'),i){case f._break:case f._continue:return this.parseBreakContinueStatement(n,i.keyword);case f._debugger:return this.parseDebuggerStatement(n);case f._do:return this.parseDoStatement(n);case f._for:return this.parseForStatement(n);case f._function:return e&&(this.strict||e!=='if'&&e!=='label')&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(n,!1,!e);case f._class:return e&&this.unexpected(),this.parseClass(n,!0);case f._if:return this.parseIfStatement(n);case f._return:return this.parseReturnStatement(n);case f._switch:return this.parseSwitchStatement(n);case f._throw:return this.parseThrowStatement(n);case f._try:return this.parseTryStatement(n);case f._const:case f._var:return o=o||this.value,e&&o!=='var'&&this.unexpected(),this.parseVarStatement(n,o);case f._while:return this.parseWhileStatement(n);case f._with:return this.parseWithStatement(n);case f.braceL:return this.parseBlock(!0,n);case f.semi:return this.parseEmptyStatement(n);case f._export:case f._import:if(this.options.ecmaVersion>10&&i===f._import){Yt.lastIndex=this.pos;const u=Yt.exec(this.input),m=this.pos+u[0].length,_=this.input.charCodeAt(m);if(_===40||_===46)return this.parseExpressionStatement(n,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===f._import?this.parseImport(n):this.parseExport(n,r);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(n,!0,!e);var P=this.value,k=this.parseExpression();return i===f.name&&k.type==='Identifier'&&this.eat(f.colon)?this.parseLabeledStatement(n,P,k,e):this.parseExpressionStatement(n,k)}};Fe.parseBreakContinueStatement=function (e,t){const r=t==='break';this.next(),this.eat(f.semi)||this.insertSemicolon()?e.label=null:this.type!==f.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){const n=this.labels[i];if((e.label==null||n.name===e.label.name)&&(n.kind!=null&&(r||n.kind==='loop')||e.label&&r))break}return i===this.labels.length&&this.raise(e.start,'Unsyntactic '+t),this.finishNode(e,r?'BreakStatement':'ContinueStatement')};Fe.parseDebuggerStatement=function (e){return this.next(),this.semicolon(),this.finishNode(e,'DebuggerStatement')};Fe.parseDoStatement=function (e){return this.next(),this.labels.push(Is),e.body=this.parseStatement('do'),this.labels.pop(),this.expect(f._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(f.semi):this.semicolon(),this.finishNode(e,'DoWhileStatement')};Fe.parseForStatement=function (e){this.next();const t=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual('await')?this.lastTokStart:-1;if(this.labels.push(Is),this.enterScope(0),this.expect(f.parenL),this.type===f.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);const r=this.isLet();if(this.type===f._var||this.type===f._const||r){const i=this.startNode(),n=r?'let':this.value;return this.next(),this.parseVar(i,!0,n),this.finishNode(i,'VariableDeclaration'),(this.type===f._in||this.options.ecmaVersion>=6&&this.isContextual('of'))&&i.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===f._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,i)):(t>-1&&this.unexpected(t),this.parseFor(e,i))}let o=this.isContextual('let'),u=!1,m=this.containsEsc,_=new ta,P=this.start,k=t>-1?this.parseExprSubscripts(_,'await'):this.parseExpression(!0,_);return this.type===f._in||(u=this.options.ecmaVersion>=6&&this.isContextual('of'))?(t>-1?(this.type===f._in&&this.unexpected(t),e.await=!0):u&&this.options.ecmaVersion>=8&&(k.start===P&&!m&&k.type==='Identifier'&&k.name==='async'?this.unexpected():this.options.ecmaVersion>=9&&(e.await=!1)),o&&u&&this.raise(k.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(k,!1,_),this.checkLValPattern(k),this.parseForIn(e,k)):(this.checkExpressionErrors(_,!0),t>-1&&this.unexpected(t),this.parseFor(e,k))};Fe.parseFunctionStatement=function (e,t,r){return this.next(),this.parseFunction(e,$i|(r?0:xs),!1,t)};Fe.parseIfStatement=function (e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement('if'),e.alternate=this.eat(f._else)?this.parseStatement('if'):null,this.finishNode(e,'IfStatement')};Fe.parseReturnStatement=function (e){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(f.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,'ReturnStatement')};Fe.parseSwitchStatement=function (e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(f.braceL),this.labels.push(Md),this.enterScope(0);for(var t,r=!1;this.type!==f.braceR;)if(this.type===f._case||this.type===f._default){const i=this.type===f._case;t&&this.finishNode(t,'SwitchCase'),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),i?t.test=this.parseExpression():(r&&this.raiseRecoverable(this.lastTokStart,'Multiple default clauses'),r=!0,t.test=null),this.expect(f.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,'SwitchCase'),this.next(),this.labels.pop(),this.finishNode(e,'SwitchStatement')};Fe.parseThrowStatement=function (e){return this.next(),Qt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,'Illegal newline after throw'),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,'ThrowStatement')};const Dd=[];Fe.parseCatchClauseParam=function (){const e=this.parseBindingAtom(),t=e.type==='Identifier';return this.enterScope(t?El:0),this.checkLValPattern(e,t?Cl:Tr),this.expect(f.parenR),e};Fe.parseTryStatement=function (e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===f._catch){const t=this.startNode();this.next(),this.eat(f.parenL)?t.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0)),t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,'CatchClause')}return e.finalizer=this.eat(f._finally)?this.parseBlock():null,!e.handler&&!e.finalizer&&this.raise(e.start,'Missing catch or finally clause'),this.finishNode(e,'TryStatement')};Fe.parseVarStatement=function (e,t,r){return this.next(),this.parseVar(e,!1,t,r),this.semicolon(),this.finishNode(e,'VariableDeclaration')};Fe.parseWhileStatement=function (e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(Is),e.body=this.parseStatement('while'),this.labels.pop(),this.finishNode(e,'WhileStatement')};Fe.parseWithStatement=function (e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement('with'),this.finishNode(e,'WithStatement')};Fe.parseEmptyStatement=function (e){return this.next(),this.finishNode(e,'EmptyStatement')};Fe.parseLabeledStatement=function (e,t,r,i){for(let n=0,o=this.labels;n<o.length;n+=1){const u=o[n];u.name===t&&this.raise(r.start,"Label '"+t+"' is already declared")}for(var m=this.type.isLoop?'loop':this.type===f._switch?'switch':null,_=this.labels.length-1;_>=0;_--){const P=this.labels[_];if(P.statementStart===e.start)P.statementStart=this.start,P.kind=m;else break}return this.labels.push({ name:t,kind:m,statementStart:this.start }),e.body=this.parseStatement(i?i.indexOf('label')===-1?i+'label':i:'label'),this.labels.pop(),e.label=r,this.finishNode(e,'LabeledStatement')};Fe.parseExpressionStatement=function (e,t){return e.expression=t,this.semicolon(),this.finishNode(e,'ExpressionStatement')};Fe.parseBlock=function (e,t,r){for(e===void 0&&(e=!0),t===void 0&&(t=this.startNode()),t.body=[],this.expect(f.braceL),e&&this.enterScope(0);this.type!==f.braceR;){const i=this.parseStatement(null);t.body.push(i)}return r&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,'BlockStatement')};Fe.parseFor=function (e,t){return e.init=t,this.expect(f.semi),e.test=this.type===f.semi?null:this.parseExpression(),this.expect(f.semi),e.update=this.type===f.parenR?null:this.parseExpression(),this.expect(f.parenR),e.body=this.parseStatement('for'),this.exitScope(),this.labels.pop(),this.finishNode(e,'ForStatement')};Fe.parseForIn=function (e,t){const r=this.type===f._in;return this.next(),t.type==='VariableDeclaration'&&t.declarations[0].init!=null&&(!r||this.options.ecmaVersion<8||this.strict||t.kind!=='var'||t.declarations[0].id.type!=='Identifier')&&this.raise(t.start,(r?'for-in':'for-of')+' loop variable declaration may not have an initializer'),e.left=t,e.right=r?this.parseExpression():this.parseMaybeAssign(),this.expect(f.parenR),e.body=this.parseStatement('for'),this.exitScope(),this.labels.pop(),this.finishNode(e,r?'ForInStatement':'ForOfStatement')};Fe.parseVar=function (e,t,r,i){for(e.declarations=[],e.kind=r;;){const n=this.startNode();if(this.parseVarId(n,r),this.eat(f.eq)?n.init=this.parseMaybeAssign(t):!i&&r==='const'&&!(this.type===f._in||this.options.ecmaVersion>=6&&this.isContextual('of'))?this.unexpected():!i&&n.id.type!=='Identifier'&&!(t&&(this.type===f._in||this.isContextual('of')))?this.raise(this.lastTokEnd,'Complex binding patterns require an initialization value'):n.init=null,e.declarations.push(this.finishNode(n,'VariableDeclarator')),!this.eat(f.comma))break}return e};Fe.parseVarId=function (e,t){e.id=this.parseBindingAtom(),this.checkLValPattern(e.id,t==='var'?Ls:Tr,!1)};var $i=1,xs=2,Ll=4;Fe.parseFunction=function (e,t,r,i,n){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(this.type===f.star&&t&xs&&this.unexpected(),e.generator=this.eat(f.star)),this.options.ecmaVersion>=8&&(e.async=!!i),t&$i&&(e.id=t&Ll&&this.type!==f.name?null:this.parseIdent(),e.id&&!(t&xs)&&this.checkLValSimple(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?Ls:Tr:Tl));const o=this.yieldPos,u=this.awaitPos,m=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ks(e.async,e.generator)),t&$i||(e.id=this.type===f.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,r,!1,n),this.yieldPos=o,this.awaitPos=u,this.awaitIdentPos=m,this.finishNode(e,t&$i?'FunctionDeclaration':'FunctionExpression')};Fe.parseFunctionParams=function (e){this.expect(f.parenL),e.params=this.parseBindingList(f.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};Fe.parseClass=function (e,t){this.next();const r=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);let i=this.enterClassBody(),n=this.startNode(),o=!1;for(n.body=[],this.expect(f.braceL);this.type!==f.braceR;){const u=this.parseClassElement(e.superClass!==null);u&&(n.body.push(u),u.type==='MethodDefinition'&&u.kind==='constructor'?(o&&this.raiseRecoverable(u.start,'Duplicate constructor in the same class'),o=!0):u.key&&u.key.type==='PrivateIdentifier'&&Gd(i,u)&&this.raiseRecoverable(u.key.start,"Identifier '#"+u.key.name+"' has already been declared"))}return this.strict=r,this.next(),e.body=this.finishNode(n,'ClassBody'),this.exitClassBody(),this.finishNode(e,t?'ClassDeclaration':'ClassExpression')};Fe.parseClassElement=function (e){if(this.eat(f.semi))return null;let t=this.options.ecmaVersion,r=this.startNode(),i='',n=!1,o=!1,u='method',m=!1;if(this.eatContextual('static')){if(t>=13&&this.eat(f.braceL))return this.parseClassStaticBlock(r),r;this.isClassElementNameStart()||this.type===f.star?m=!0:i='static'}if(r.static=m,!i&&t>=8&&this.eatContextual('async')&&((this.isClassElementNameStart()||this.type===f.star)&&!this.canInsertSemicolon()?o=!0:i='async'),!i&&(t>=9||!o)&&this.eat(f.star)&&(n=!0),!i&&!o&&!n){const _=this.value;(this.eatContextual('get')||this.eatContextual('set'))&&(this.isClassElementNameStart()?u=_:i=_)}if(i?(r.computed=!1,r.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),r.key.name=i,this.finishNode(r.key,'Identifier')):this.parseClassElementName(r),t<13||this.type===f.parenL||u!=='method'||n||o){const P=!r.static&&Wn(r,'constructor'),k=P&&e;P&&u!=='method'&&this.raise(r.key.start,"Constructor can't have get/set modifier"),r.kind=P?'constructor':u,this.parseClassMethod(r,n,o,k)}else this.parseClassField(r);return r};Fe.isClassElementNameStart=function (){return this.type===f.name||this.type===f.privateId||this.type===f.num||this.type===f.string||this.type===f.bracketL||this.type.keyword};Fe.parseClassElementName=function (e){this.type===f.privateId?(this.value==='constructor'&&this.raise(this.start,"Classes can't have an element named '#constructor'"),e.computed=!1,e.key=this.parsePrivateIdent()):this.parsePropertyName(e)};Fe.parseClassMethod=function (e,t,r,i){const n=e.key;e.kind==='constructor'?(t&&this.raise(n.start,"Constructor can't be a generator"),r&&this.raise(n.start,"Constructor can't be an async method")):e.static&&Wn(e,'prototype')&&this.raise(n.start,'Classes may not have a static property named prototype');const o=e.value=this.parseMethod(t,r,i);return e.kind==='get'&&o.params.length!==0&&this.raiseRecoverable(o.start,'getter should have no params'),e.kind==='set'&&o.params.length!==1&&this.raiseRecoverable(o.start,'setter should have exactly one param'),e.kind==='set'&&o.params[0].type==='RestElement'&&this.raiseRecoverable(o.params[0].start,'Setter cannot use rest params'),this.finishNode(e,'MethodDefinition')};Fe.parseClassField=function (e){return Wn(e,'constructor')?this.raise(e.key.start,"Classes can't have a field named 'constructor'"):e.static&&Wn(e,'prototype')&&this.raise(e.key.start,"Classes can't have a static field named 'prototype'"),this.eat(f.eq)?(this.enterScope(Qi|Jn),e.value=this.parseMaybeAssign(),this.exitScope()):e.value=null,this.semicolon(),this.finishNode(e,'PropertyDefinition')};Fe.parseClassStaticBlock=function (e){e.body=[];const t=this.labels;for(this.labels=[],this.enterScope(Zr|Jn);this.type!==f.braceR;){const r=this.parseStatement(null);e.body.push(r)}return this.next(),this.exitScope(),this.labels=t,this.finishNode(e,'StaticBlock')};Fe.parseClassId=function (e,t){this.type===f.name?(e.id=this.parseIdent(),t&&this.checkLValSimple(e.id,Tr,!1)):(t===!0&&this.unexpected(),e.id=null)};Fe.parseClassSuper=function (e){e.superClass=this.eat(f._extends)?this.parseExprSubscripts(null,!1):null};Fe.enterClassBody=function (){const e={ declared:Object.create(null),used:[] };return this.privateNameStack.push(e),e.declared};Fe.exitClassBody=function (){const e=this.privateNameStack.pop(),t=e.declared,r=e.used;if(this.options.checkPrivateFields)for(let i=this.privateNameStack.length,n=i===0?null:this.privateNameStack[i-1],o=0;o<r.length;++o){const u=r[o];wi(t,u.name)||(n?n.used.push(u):this.raiseRecoverable(u.start,"Private field '#"+u.name+"' must be declared in an enclosing class"))}};function Gd (e,t){let r=t.key.name,i=e[r],n='true';return t.type==='MethodDefinition'&&(t.kind==='get'||t.kind==='set')&&(n=(t.static?'s':'i')+t.kind),i==='iget'&&n==='iset'||i==='iset'&&n==='iget'||i==='sget'&&n==='sset'||i==='sset'&&n==='sget'?(e[r]='true',!1):i?!0:(e[r]=n,!1)}function Wn (e,t){const r=e.computed,i=e.key;return!r&&(i.type==='Identifier'&&i.name===t||i.type==='Literal'&&i.value===t)}Fe.parseExportAllDeclaration=function (e,t){return this.options.ecmaVersion>=11&&(this.eatContextual('as')?(e.exported=this.parseModuleExportName(),this.checkExport(t,e.exported,this.lastTokStart)):e.exported=null),this.expectContextual('from'),this.type!==f.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,'ExportAllDeclaration')};Fe.parseExport=function (e,t){if(this.next(),this.eat(f.star))return this.parseExportAllDeclaration(e,t);if(this.eat(f._default))return this.checkExport(t,'default',this.lastTokStart),e.declaration=this.parseExportDefaultDeclaration(),this.finishNode(e,'ExportDefaultDeclaration');if(this.shouldParseExportStatement())e.declaration=this.parseExportDeclaration(e),e.declaration.type==='VariableDeclaration'?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id,e.declaration.id.start),e.specifiers=[],e.source=null,this.options.ecmaVersion>=16&&(e.attributes=[]);else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual('from'))this.type!==f.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause());else{for(let r=0,i=e.specifiers;r<i.length;r+=1){const n=i[r];this.checkUnreserved(n.local),this.checkLocalExport(n.local),n.local.type==='Literal'&&this.raise(n.local.start,'A string literal cannot be used as an exported binding without `from`.')}e.source=null,this.options.ecmaVersion>=16&&(e.attributes=[])}this.semicolon()}return this.finishNode(e,'ExportNamedDeclaration')};Fe.parseExportDeclaration=function (e){return this.parseStatement(null)};Fe.parseExportDefaultDeclaration=function (){let e;if(this.type===f._function||(e=this.isAsyncFunction())){const t=this.startNode();return this.next(),e&&this.next(),this.parseFunction(t,$i|Ll,!1,e)}else if(this.type===f._class){const r=this.startNode();return this.parseClass(r,'nullableID')}else{const i=this.parseMaybeAssign();return this.semicolon(),i}};Fe.checkExport=function (e,t,r){e&&(typeof t!='string'&&(t=t.type==='Identifier'?t.name:t.value),wi(e,t)&&this.raiseRecoverable(r,"Duplicate export '"+t+"'"),e[t]=!0)};Fe.checkPatternExport=function (e,t){const r=t.type;if(r==='Identifier')this.checkExport(e,t,t.start);else if(r==='ObjectPattern')for(let i=0,n=t.properties;i<n.length;i+=1){const o=n[i];this.checkPatternExport(e,o)}else if(r==='ArrayPattern')for(let u=0,m=t.elements;u<m.length;u+=1){const _=m[u];_&&this.checkPatternExport(e,_)}else r==='Property'?this.checkPatternExport(e,t.value):r==='AssignmentPattern'?this.checkPatternExport(e,t.left):r==='RestElement'&&this.checkPatternExport(e,t.argument)};Fe.checkVariableExport=function (e,t){if(e)for(let r=0,i=t;r<i.length;r+=1){const n=i[r];this.checkPatternExport(e,n.id)}};Fe.shouldParseExportStatement=function (){return this.type.keyword==='var'||this.type.keyword==='const'||this.type.keyword==='class'||this.type.keyword==='function'||this.isLet()||this.isAsyncFunction()};Fe.parseExportSpecifier=function (e){const t=this.startNode();return t.local=this.parseModuleExportName(),t.exported=this.eatContextual('as')?this.parseModuleExportName():t.local,this.checkExport(e,t.exported,t.exported.start),this.finishNode(t,'ExportSpecifier')};Fe.parseExportSpecifiers=function (e){let t=[],r=!0;for(this.expect(f.braceL);!this.eat(f.braceR);){if(r)r=!1;else if(this.expect(f.comma),this.afterTrailingComma(f.braceR))break;t.push(this.parseExportSpecifier(e))}return t};Fe.parseImport=function (e){return this.next(),this.type===f.string?(e.specifiers=Dd,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual('from'),e.source=this.type===f.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,'ImportDeclaration')};Fe.parseImportSpecifier=function (){const e=this.startNode();return e.imported=this.parseModuleExportName(),this.eatContextual('as')?e.local=this.parseIdent():(this.checkUnreserved(e.imported),e.local=e.imported),this.checkLValSimple(e.local,Tr),this.finishNode(e,'ImportSpecifier')};Fe.parseImportDefaultSpecifier=function (){const e=this.startNode();return e.local=this.parseIdent(),this.checkLValSimple(e.local,Tr),this.finishNode(e,'ImportDefaultSpecifier')};Fe.parseImportNamespaceSpecifier=function (){const e=this.startNode();return this.next(),this.expectContextual('as'),e.local=this.parseIdent(),this.checkLValSimple(e.local,Tr),this.finishNode(e,'ImportNamespaceSpecifier')};Fe.parseImportSpecifiers=function (){let e=[],t=!0;if(this.type===f.name&&(e.push(this.parseImportDefaultSpecifier()),!this.eat(f.comma)))return e;if(this.type===f.star)return e.push(this.parseImportNamespaceSpecifier()),e;for(this.expect(f.braceL);!this.eat(f.braceR);){if(t)t=!1;else if(this.expect(f.comma),this.afterTrailingComma(f.braceR))break;e.push(this.parseImportSpecifier())}return e};Fe.parseWithClause=function (){const e=[];if(!this.eat(f._with))return e;this.expect(f.braceL);for(let t={},r=!0;!this.eat(f.braceR);){if(r)r=!1;else if(this.expect(f.comma),this.afterTrailingComma(f.braceR))break;const i=this.parseImportAttribute(),n=i.key.type==='Identifier'?i.key.name:i.key.value;wi(t,n)&&this.raiseRecoverable(i.key.start,"Duplicate attribute key '"+n+"'"),t[n]=!0,e.push(i)}return e};Fe.parseImportAttribute=function (){const e=this.startNode();return e.key=this.type===f.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=='never'),this.expect(f.colon),this.type!==f.string&&this.unexpected(),e.value=this.parseExprAtom(),this.finishNode(e,'ImportAttribute')};Fe.parseModuleExportName=function (){if(this.options.ecmaVersion>=13&&this.type===f.string){const e=this.parseLiteral(this.value);return Od.test(e.value)&&this.raise(e.start,'An export name cannot include a lone surrogate.'),e}return this.parseIdent(!0)};Fe.adaptDirectivePrologue=function (e){for(let t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)};Fe.isDirectiveCandidate=function (e){return this.options.ecmaVersion>=5&&e.type==='ExpressionStatement'&&e.expression.type==='Literal'&&typeof e.expression.value=='string'&&(this.input[e.start]==='"'||this.input[e.start]==="'")};const Zt=Tt.prototype;Zt.toAssignable=function (e,t,r){if(this.options.ecmaVersion>=6&&e)switch(e.type){case'Identifier':this.inAsync&&e.name==='await'&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case'ObjectPattern':case'ArrayPattern':case'AssignmentPattern':case'RestElement':break;case'ObjectExpression':e.type='ObjectPattern',r&&this.checkPatternErrors(r,!0);for(let i=0,n=e.properties;i<n.length;i+=1){const o=n[i];this.toAssignable(o,t),o.type==='RestElement'&&(o.argument.type==='ArrayPattern'||o.argument.type==='ObjectPattern')&&this.raise(o.argument.start,'Unexpected token')}break;case'Property':e.kind!=='init'&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case'ArrayExpression':e.type='ArrayPattern',r&&this.checkPatternErrors(r,!0),this.toAssignableList(e.elements,t);break;case'SpreadElement':e.type='RestElement',this.toAssignable(e.argument,t),e.argument.type==='AssignmentPattern'&&this.raise(e.argument.start,'Rest elements cannot have a default value');break;case'AssignmentExpression':e.operator!=='='&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type='AssignmentPattern',delete e.operator,this.toAssignable(e.left,t);break;case'ParenthesizedExpression':this.toAssignable(e.expression,t,r);break;case'ChainExpression':this.raiseRecoverable(e.start,'Optional chaining cannot appear in left-hand side');break;case'MemberExpression':if(!t)break;default:this.raise(e.start,'Assigning to rvalue')}else r&&this.checkPatternErrors(r,!0);return e};Zt.toAssignableList=function (e,t){for(var r=e.length,i=0;i<r;i++){const n=e[i];n&&this.toAssignable(n,t)}if(r){const o=e[r-1];this.options.ecmaVersion===6&&t&&o&&o.type==='RestElement'&&o.argument.type!=='Identifier'&&this.unexpected(o.argument.start)}return e};Zt.parseSpread=function (e){const t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,'SpreadElement')};Zt.parseRestBinding=function (){const e=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==f.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,'RestElement')};Zt.parseBindingAtom=function (){if(this.options.ecmaVersion>=6)switch(this.type){case f.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(f.bracketR,!0,!0),this.finishNode(e,'ArrayPattern');case f.braceL:return this.parseObj(!0)}return this.parseIdent()};Zt.parseBindingList=function (e,t,r,i){for(var n=[],o=!0;!this.eat(e);)if(o?o=!1:this.expect(f.comma),t&&this.type===f.comma)n.push(null);else{if(r&&this.afterTrailingComma(e))break;if(this.type===f.ellipsis){const u=this.parseRestBinding();this.parseBindingListItem(u),n.push(u),this.type===f.comma&&this.raiseRecoverable(this.start,'Comma is not permitted after the rest element'),this.expect(e);break}else n.push(this.parseAssignableListItem(i))}return n};Zt.parseAssignableListItem=function (e){const t=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(t),t};Zt.parseBindingListItem=function (e){return e};Zt.parseMaybeDefault=function (e,t,r){if(r=r||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(f.eq))return r;const i=this.startNodeAt(e,t);return i.left=r,i.right=this.parseMaybeAssign(),this.finishNode(i,'AssignmentPattern')};Zt.checkLValSimple=function (e,t,r){t===void 0&&(t=jn);const i=t!==jn;switch(e.type){case'Identifier':this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(i?'Binding ':'Assigning to ')+e.name+' in strict mode'),i&&(t===Tr&&e.name==='let'&&this.raiseRecoverable(e.start,'let is disallowed as a lexically bound name'),r&&(wi(r,e.name)&&this.raiseRecoverable(e.start,'Argument name clash'),r[e.name]=!0),t!==kl&&this.declareName(e.name,t,e.start));break;case'ChainExpression':this.raiseRecoverable(e.start,'Optional chaining cannot appear in left-hand side');break;case'MemberExpression':i&&this.raiseRecoverable(e.start,'Binding member expression');break;case'ParenthesizedExpression':return i&&this.raiseRecoverable(e.start,'Binding parenthesized expression'),this.checkLValSimple(e.expression,t,r);default:this.raise(e.start,(i?'Binding':'Assigning to')+' rvalue')}};Zt.checkLValPattern=function (e,t,r){switch(t===void 0&&(t=jn),e.type){case'ObjectPattern':for(let i=0,n=e.properties;i<n.length;i+=1){const o=n[i];this.checkLValInnerPattern(o,t,r)}break;case'ArrayPattern':for(let u=0,m=e.elements;u<m.length;u+=1){const _=m[u];_&&this.checkLValInnerPattern(_,t,r)}break;default:this.checkLValSimple(e,t,r)}};Zt.checkLValInnerPattern=function (e,t,r){switch(t===void 0&&(t=jn),e.type){case'Property':this.checkLValInnerPattern(e.value,t,r);break;case'AssignmentPattern':this.checkLValPattern(e.left,t,r);break;case'RestElement':this.checkLValPattern(e.argument,t,r);break;default:this.checkLValPattern(e,t,r)}};const ir=function (t,r,i,n,o){this.token=t,this.isExpr=!!r,this.preserveSpace=!!i,this.override=n,this.generator=!!o},ft={ b_stat:new ir('{',!1),b_expr:new ir('{',!0),b_tmpl:new ir('${',!1),p_stat:new ir('(',!1),p_expr:new ir('(',!0),q_tmpl:new ir('`',!0,!0,function (e){return e.tryReadTemplateToken()}),f_stat:new ir('function',!1),f_expr:new ir('function',!0),f_expr_gen:new ir('function',!0,!1,null,!0),f_gen:new ir('function',!1,!1,null,!0) },Ei=Tt.prototype;Ei.initialContext=function (){return[ft.b_stat]};Ei.curContext=function (){return this.context[this.context.length-1]};Ei.braceIsBlock=function (e){const t=this.curContext();return t===ft.f_expr||t===ft.f_stat?!0:e===f.colon&&(t===ft.b_stat||t===ft.b_expr)?!t.isExpr:e===f._return||e===f.name&&this.exprAllowed?Qt.test(this.input.slice(this.lastTokEnd,this.start)):e===f._else||e===f.semi||e===f.eof||e===f.parenR||e===f.arrow?!0:e===f.braceL?t===ft.b_stat:e===f._var||e===f._const||e===f.name?!1:!this.exprAllowed};Ei.inGeneratorContext=function (){for(let e=this.context.length-1;e>=1;e--){const t=this.context[e];if(t.token==='function')return t.generator}return!1};Ei.updateContext=function (e){let t,r=this.type;r.keyword&&e===f.dot?this.exprAllowed=!1:(t=r.updateContext)?t.call(this,e):this.exprAllowed=r.beforeExpr};Ei.overrideContext=function (e){this.curContext()!==e&&(this.context[this.context.length-1]=e)};f.parenR.updateContext=f.braceR.updateContext=function (){if(this.context.length===1){this.exprAllowed=!0;return}let e=this.context.pop();e===ft.b_stat&&this.curContext().token==='function'&&(e=this.context.pop()),this.exprAllowed=!e.isExpr};f.braceL.updateContext=function (e){this.context.push(this.braceIsBlock(e)?ft.b_stat:ft.b_expr),this.exprAllowed=!0};f.dollarBraceL.updateContext=function (){this.context.push(ft.b_tmpl),this.exprAllowed=!0};f.parenL.updateContext=function (e){const t=e===f._if||e===f._for||e===f._with||e===f._while;this.context.push(t?ft.p_stat:ft.p_expr),this.exprAllowed=!0};f.incDec.updateContext=function (){};f._function.updateContext=f._class.updateContext=function (e){e.beforeExpr&&e!==f._else&&!(e===f.semi&&this.curContext()!==ft.p_stat)&&!(e===f._return&&Qt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((e===f.colon||e===f.braceL)&&this.curContext()===ft.b_stat)?this.context.push(ft.f_expr):this.context.push(ft.f_stat),this.exprAllowed=!1};f.colon.updateContext=function (){this.curContext().token==='function'&&this.context.pop(),this.exprAllowed=!0};f.backQuote.updateContext=function (){this.curContext()===ft.q_tmpl?this.context.pop():this.context.push(ft.q_tmpl),this.exprAllowed=!1};f.star.updateContext=function (e){if(e===f._function){const t=this.context.length-1;this.context[t]===ft.f_expr?this.context[t]=ft.f_expr_gen:this.context[t]=ft.f_gen}this.exprAllowed=!0};f.name.updateContext=function (e){let t=!1;this.options.ecmaVersion>=6&&e!==f.dot&&(this.value==='of'&&!this.exprAllowed||this.value==='yield'&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};const He=Tt.prototype;He.checkPropClash=function (e,t,r){if(!(this.options.ecmaVersion>=9&&e.type==='SpreadElement')&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){let i=e.key,n;switch(i.type){case'Identifier':n=i.name;break;case'Literal':n=String(i.value);break;default:return}const o=e.kind;if(this.options.ecmaVersion>=6){n==='__proto__'&&o==='init'&&(t.proto&&(r?r.doubleProto<0&&(r.doubleProto=i.start):this.raiseRecoverable(i.start,'Redefinition of __proto__ property')),t.proto=!0);return}n='$'+n;let u=t[n];if(u){let m;o==='init'?m=this.strict&&u.init||u.get||u.set:m=u.init||u[o],m&&this.raiseRecoverable(i.start,'Redefinition of property')}else u=t[n]={ init:!1,get:!1,set:!1 };u[o]=!0}};He.parseExpression=function (e,t){const r=this.start,i=this.startLoc,n=this.parseMaybeAssign(e,t);if(this.type===f.comma){const o=this.startNodeAt(r,i);for(o.expressions=[n];this.eat(f.comma);)o.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(o,'SequenceExpression')}return n};He.parseMaybeAssign=function (e,t,r){if(this.isContextual('yield')){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}let i=!1,n=-1,o=-1,u=-1;t?(n=t.parenthesizedAssign,o=t.trailingComma,u=t.doubleProto,t.parenthesizedAssign=t.trailingComma=-1):(t=new ta,i=!0);const m=this.start,_=this.startLoc;(this.type===f.parenL||this.type===f.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=e==='await');let P=this.parseMaybeConditional(e,t);if(r&&(P=r.call(this,P,m,_)),this.type.isAssign){const k=this.startNodeAt(m,_);return k.operator=this.value,this.type===f.eq&&(P=this.toAssignable(P,!1,t)),i||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=P.start&&(t.shorthandAssign=-1),this.type===f.eq?this.checkLValPattern(P):this.checkLValSimple(P),k.left=P,this.next(),k.right=this.parseMaybeAssign(e),u>-1&&(t.doubleProto=u),this.finishNode(k,'AssignmentExpression')}else i&&this.checkExpressionErrors(t,!0);return n>-1&&(t.parenthesizedAssign=n),o>-1&&(t.trailingComma=o),P};He.parseMaybeConditional=function (e,t){const r=this.start,i=this.startLoc,n=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return n;if(this.eat(f.question)){const o=this.startNodeAt(r,i);return o.test=n,o.consequent=this.parseMaybeAssign(),this.expect(f.colon),o.alternate=this.parseMaybeAssign(e),this.finishNode(o,'ConditionalExpression')}return n};He.parseExprOps=function (e,t){const r=this.start,i=this.startLoc,n=this.parseMaybeUnary(t,!1,!1,e);return this.checkExpressionErrors(t)||n.start===r&&n.type==='ArrowFunctionExpression'?n:this.parseExprOp(n,r,i,-1,e)};He.parseExprOp=function (e,t,r,i,n){let o=this.type.binop;if(o!=null&&(!n||this.type!==f._in)&&o>i){const u=this.type===f.logicalOR||this.type===f.logicalAND,m=this.type===f.coalesce;m&&(o=f.logicalAND.binop);const _=this.value;this.next();const P=this.start,k=this.startLoc,y=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,n),P,k,o,n),T=this.buildBinary(t,r,e,y,_,u||m);return(u&&this.type===f.coalesce||m&&(this.type===f.logicalOR||this.type===f.logicalAND))&&this.raiseRecoverable(this.start,'Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses'),this.parseExprOp(T,t,r,i,n)}return e};He.buildBinary=function (e,t,r,i,n,o){i.type==='PrivateIdentifier'&&this.raise(i.start,'Private identifier can only be left side of binary expression');const u=this.startNodeAt(e,t);return u.left=r,u.operator=n,u.right=i,this.finishNode(u,o?'LogicalExpression':'BinaryExpression')};He.parseMaybeUnary=function (e,t,r,i){let n=this.start,o=this.startLoc,u;if(this.isContextual('await')&&this.canAwait)u=this.parseAwait(i),t=!0;else if(this.type.prefix){const m=this.startNode(),_=this.type===f.incDec;m.operator=this.value,m.prefix=!0,this.next(),m.argument=this.parseMaybeUnary(null,!0,_,i),this.checkExpressionErrors(e,!0),_?this.checkLValSimple(m.argument):this.strict&&m.operator==='delete'&&Il(m.argument)?this.raiseRecoverable(m.start,'Deleting local variable in strict mode'):m.operator==='delete'&&_s(m.argument)?this.raiseRecoverable(m.start,'Private fields can not be deleted'):t=!0,u=this.finishNode(m,_?'UpdateExpression':'UnaryExpression')}else if(!t&&this.type===f.privateId)(i||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),u=this.parsePrivateIdent(),this.type!==f._in&&this.unexpected();else{if(u=this.parseExprSubscripts(e,i),this.checkExpressionErrors(e))return u;for(;this.type.postfix&&!this.canInsertSemicolon();){const P=this.startNodeAt(n,o);P.operator=this.value,P.prefix=!1,P.argument=u,this.checkLValSimple(u),this.next(),u=this.finishNode(P,'UpdateExpression')}}if(!r&&this.eat(f.starstar))if(t)this.unexpected(this.lastTokStart);else return this.buildBinary(n,o,u,this.parseMaybeUnary(null,!1,!1,i),'**',!1);else return u};function Il (e){return e.type==='Identifier'||e.type==='ParenthesizedExpression'&&Il(e.expression)}function _s (e){return e.type==='MemberExpression'&&e.property.type==='PrivateIdentifier'||e.type==='ChainExpression'&&_s(e.expression)||e.type==='ParenthesizedExpression'&&_s(e.expression)}He.parseExprSubscripts=function (e,t){const r=this.start,i=this.startLoc,n=this.parseExprAtom(e,t);if(n.type==='ArrowFunctionExpression'&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==')')return n;const o=this.parseSubscripts(n,r,i,!1,t);return e&&o.type==='MemberExpression'&&(e.parenthesizedAssign>=o.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=o.start&&(e.parenthesizedBind=-1),e.trailingComma>=o.start&&(e.trailingComma=-1)),o};He.parseSubscripts=function (e,t,r,i,n){for(let o=this.options.ecmaVersion>=8&&e.type==='Identifier'&&e.name==='async'&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start===5&&this.potentialArrowAt===e.start,u=!1;;){let m=this.parseSubscript(e,t,r,i,o,u,n);if(m.optional&&(u=!0),m===e||m.type==='ArrowFunctionExpression'){if(u){const _=this.startNodeAt(t,r);_.expression=m,m=this.finishNode(_,'ChainExpression')}return m}e=m}};He.shouldParseAsyncArrow=function (){return!this.canInsertSemicolon()&&this.eat(f.arrow)};He.parseSubscriptAsyncArrow=function (e,t,r,i){return this.parseArrowExpression(this.startNodeAt(e,t),r,!0,i)};He.parseSubscript=function (e,t,r,i,n,o,u){const m=this.options.ecmaVersion>=11,_=m&&this.eat(f.questionDot);i&&_&&this.raise(this.lastTokStart,'Optional chaining cannot appear in the callee of new expressions');const P=this.eat(f.bracketL);if(P||_&&this.type!==f.parenL&&this.type!==f.backQuote||this.eat(f.dot)){const k=this.startNodeAt(t,r);k.object=e,P?(k.property=this.parseExpression(),this.expect(f.bracketR)):this.type===f.privateId&&e.type!=='Super'?k.property=this.parsePrivateIdent():k.property=this.parseIdent(this.options.allowReserved!=='never'),k.computed=!!P,m&&(k.optional=_),e=this.finishNode(k,'MemberExpression')}else if(!i&&this.eat(f.parenL)){const y=new ta,T=this.yieldPos,ie=this.awaitPos,Ae=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;const Q=this.parseExprList(f.parenR,this.options.ecmaVersion>=8,!1,y);if(n&&!_&&this.shouldParseAsyncArrow())return this.checkPatternErrors(y,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=T,this.awaitPos=ie,this.awaitIdentPos=Ae,this.parseSubscriptAsyncArrow(t,r,Q,u);this.checkExpressionErrors(y,!0),this.yieldPos=T||this.yieldPos,this.awaitPos=ie||this.awaitPos,this.awaitIdentPos=Ae||this.awaitIdentPos;const Je=this.startNodeAt(t,r);Je.callee=e,Je.arguments=Q,m&&(Je.optional=_),e=this.finishNode(Je,'CallExpression')}else if(this.type===f.backQuote){(_||o)&&this.raise(this.start,'Optional chaining cannot appear in the tag of tagged template expressions');const it=this.startNodeAt(t,r);it.tag=e,it.quasi=this.parseTemplate({ isTagged:!0 }),e=this.finishNode(it,'TaggedTemplateExpression')}return e};He.parseExprAtom=function (e,t,r){this.type===f.slash&&this.readRegexp();let i,n=this.potentialArrowAt===this.start;switch(this.type){case f._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),i=this.startNode(),this.next(),this.type===f.parenL&&!this.allowDirectSuper&&this.raise(i.start,'super() call outside constructor of a subclass'),this.type!==f.dot&&this.type!==f.bracketL&&this.type!==f.parenL&&this.unexpected(),this.finishNode(i,'Super');case f._this:return i=this.startNode(),this.next(),this.finishNode(i,'ThisExpression');case f.name:var o=this.start,u=this.startLoc,m=this.containsEsc,_=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!m&&_.name==='async'&&!this.canInsertSemicolon()&&this.eat(f._function))return this.overrideContext(ft.f_expr),this.parseFunction(this.startNodeAt(o,u),0,!1,!0,t);if(n&&!this.canInsertSemicolon()){if(this.eat(f.arrow))return this.parseArrowExpression(this.startNodeAt(o,u),[_],!1,t);if(this.options.ecmaVersion>=8&&_.name==='async'&&this.type===f.name&&!m&&(!this.potentialArrowInForAwait||this.value!=='of'||this.containsEsc))return _=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(f.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(o,u),[_],!0,t)}return _;case f.regexp:var P=this.value;return i=this.parseLiteral(P.value),i.regex={ pattern:P.pattern,flags:P.flags },i;case f.num:case f.string:return this.parseLiteral(this.value);case f._null:case f._true:case f._false:return i=this.startNode(),i.value=this.type===f._null?null:this.type===f._true,i.raw=this.type.keyword,this.next(),this.finishNode(i,'Literal');case f.parenL:var k=this.start,y=this.parseParenAndDistinguishExpression(n,t);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(y)&&(e.parenthesizedAssign=k),e.parenthesizedBind<0&&(e.parenthesizedBind=k)),y;case f.bracketL:return i=this.startNode(),this.next(),i.elements=this.parseExprList(f.bracketR,!0,!0,e),this.finishNode(i,'ArrayExpression');case f.braceL:return this.overrideContext(ft.b_expr),this.parseObj(!1,e);case f._function:return i=this.startNode(),this.next(),this.parseFunction(i,0);case f._class:return this.parseClass(this.startNode(),!1);case f._new:return this.parseNew();case f.backQuote:return this.parseTemplate();case f._import:return this.options.ecmaVersion>=11?this.parseExprImport(r):this.unexpected();default:return this.parseExprAtomDefault()}};He.parseExprAtomDefault=function (){this.unexpected()};He.parseExprImport=function (e){const t=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,'Escape sequence in keyword import'),this.next(),this.type===f.parenL&&!e)return this.parseDynamicImport(t);if(this.type===f.dot){const r=this.startNodeAt(t.start,t.loc&&t.loc.start);return r.name='import',t.meta=this.finishNode(r,'Identifier'),this.parseImportMeta(t)}else this.unexpected()};He.parseDynamicImport=function (e){if(this.next(),e.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(f.parenR)?e.options=null:(this.expect(f.comma),this.afterTrailingComma(f.parenR)?e.options=null:(e.options=this.parseMaybeAssign(),this.eat(f.parenR)||(this.expect(f.comma),this.afterTrailingComma(f.parenR)||this.unexpected())));else if(!this.eat(f.parenR)){const t=this.start;this.eat(f.comma)&&this.eat(f.parenR)?this.raiseRecoverable(t,'Trailing comma is not allowed in import()'):this.unexpected(t)}return this.finishNode(e,'ImportExpression')};He.parseImportMeta=function (e){this.next();const t=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=='meta'&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=='module'&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,'MetaProperty')};He.parseLiteral=function (e){const t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),t.raw.charCodeAt(t.raw.length-1)===110&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,'')),this.next(),this.finishNode(t,'Literal')};He.parseParenExpression=function (){this.expect(f.parenL);const e=this.parseExpression();return this.expect(f.parenR),e};He.shouldParseArrow=function (e){return!this.canInsertSemicolon()};He.parseParenAndDistinguishExpression=function (e,t){let r=this.start,i=this.startLoc,n,o=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();let u=this.start,m=this.startLoc,_=[],P=!0,k=!1,y=new ta,T=this.yieldPos,ie=this.awaitPos,Ae;for(this.yieldPos=0,this.awaitPos=0;this.type!==f.parenR;)if(P?P=!1:this.expect(f.comma),o&&this.afterTrailingComma(f.parenR,!0)){k=!0;break}else if(this.type===f.ellipsis){Ae=this.start,_.push(this.parseParenItem(this.parseRestBinding())),this.type===f.comma&&this.raiseRecoverable(this.start,'Comma is not permitted after the rest element');break}else _.push(this.parseMaybeAssign(!1,y,this.parseParenItem));const Q=this.lastTokEnd,Je=this.lastTokEndLoc;if(this.expect(f.parenR),e&&this.shouldParseArrow(_)&&this.eat(f.arrow))return this.checkPatternErrors(y,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=T,this.awaitPos=ie,this.parseParenArrowList(r,i,_,t);(!_.length||k)&&this.unexpected(this.lastTokStart),Ae&&this.unexpected(Ae),this.checkExpressionErrors(y,!0),this.yieldPos=T||this.yieldPos,this.awaitPos=ie||this.awaitPos,_.length>1?(n=this.startNodeAt(u,m),n.expressions=_,this.finishNodeAt(n,'SequenceExpression',Q,Je)):n=_[0]}else n=this.parseParenExpression();if(this.options.preserveParens){const it=this.startNodeAt(r,i);return it.expression=n,this.finishNode(it,'ParenthesizedExpression')}else return n};He.parseParenItem=function (e){return e};He.parseParenArrowList=function (e,t,r,i){return this.parseArrowExpression(this.startNodeAt(e,t),r,!1,i)};const Vd=[];He.parseNew=function (){this.containsEsc&&this.raiseRecoverable(this.start,'Escape sequence in keyword new');const e=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===f.dot){const t=this.startNodeAt(e.start,e.loc&&e.loc.start);t.name='new',e.meta=this.finishNode(t,'Identifier'),this.next();const r=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=='target'&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),r&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(e.start,"'new.target' can only be used in functions and class static block"),this.finishNode(e,'MetaProperty')}const i=this.start,n=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),i,n,!0,!1),this.eat(f.parenL)?e.arguments=this.parseExprList(f.parenR,this.options.ecmaVersion>=8,!1):e.arguments=Vd,this.finishNode(e,'NewExpression')};He.parseTemplateElement=function (e){const t=e.isTagged,r=this.startNode();return this.type===f.invalidTemplate?(t||this.raiseRecoverable(this.start,'Bad escape sequence in untagged template literal'),r.value={ raw:this.value.replace(/\r\n?/g,`
`),cooked:null }):r.value={ raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value },this.next(),r.tail=this.type===f.backQuote,this.finishNode(r,'TemplateElement')};He.parseTemplate=function (e){e===void 0&&(e={});let t=e.isTagged;t===void 0&&(t=!1);const r=this.startNode();this.next(),r.expressions=[];let i=this.parseTemplateElement({ isTagged:t });for(r.quasis=[i];!i.tail;)this.type===f.eof&&this.raise(this.pos,'Unterminated template literal'),this.expect(f.dollarBraceL),r.expressions.push(this.parseExpression()),this.expect(f.braceR),r.quasis.push(i=this.parseTemplateElement({ isTagged:t }));return this.next(),this.finishNode(r,'TemplateLiteral')};He.isAsyncProp=function (e){return!e.computed&&e.key.type==='Identifier'&&e.key.name==='async'&&(this.type===f.name||this.type===f.num||this.type===f.string||this.type===f.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===f.star)&&!Qt.test(this.input.slice(this.lastTokEnd,this.start))};He.parseObj=function (e,t){let r=this.startNode(),i=!0,n={};for(r.properties=[],this.next();!this.eat(f.braceR);){if(i)i=!1;else if(this.expect(f.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(f.braceR))break;const o=this.parseProperty(e,t);e||this.checkPropClash(o,n,t),r.properties.push(o)}return this.finishNode(r,e?'ObjectPattern':'ObjectExpression')};He.parseProperty=function (e,t){let r=this.startNode(),i,n,o,u;if(this.options.ecmaVersion>=9&&this.eat(f.ellipsis))return e?(r.argument=this.parseIdent(!1),this.type===f.comma&&this.raiseRecoverable(this.start,'Comma is not permitted after the rest element'),this.finishNode(r,'RestElement')):(r.argument=this.parseMaybeAssign(!1,t),this.type===f.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(r,'SpreadElement'));this.options.ecmaVersion>=6&&(r.method=!1,r.shorthand=!1,(e||t)&&(o=this.start,u=this.startLoc),e||(i=this.eat(f.star)));const m=this.containsEsc;return this.parsePropertyName(r),!e&&!m&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(r)?(n=!0,i=this.options.ecmaVersion>=9&&this.eat(f.star),this.parsePropertyName(r)):n=!1,this.parsePropertyValue(r,e,i,n,o,u,t,m),this.finishNode(r,'Property')};He.parseGetterSetter=function (e){const t=e.key.name;this.parsePropertyName(e),e.value=this.parseMethod(!1),e.kind=t;const r=e.kind==='get'?0:1;if(e.value.params.length!==r){const i=e.value.start;e.kind==='get'?this.raiseRecoverable(i,'getter should have no params'):this.raiseRecoverable(i,'setter should have exactly one param')}else e.kind==='set'&&e.value.params[0].type==='RestElement'&&this.raiseRecoverable(e.value.params[0].start,'Setter cannot use rest params')};He.parsePropertyValue=function (e,t,r,i,n,o,u,m){(r||i)&&this.type===f.colon&&this.unexpected(),this.eat(f.colon)?(e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,u),e.kind='init'):this.options.ecmaVersion>=6&&this.type===f.parenL?(t&&this.unexpected(),e.method=!0,e.value=this.parseMethod(r,i),e.kind='init'):!t&&!m&&this.options.ecmaVersion>=5&&!e.computed&&e.key.type==='Identifier'&&(e.key.name==='get'||e.key.name==='set')&&this.type!==f.comma&&this.type!==f.braceR&&this.type!==f.eq?((r||i)&&this.unexpected(),this.parseGetterSetter(e)):this.options.ecmaVersion>=6&&!e.computed&&e.key.type==='Identifier'?((r||i)&&this.unexpected(),this.checkUnreserved(e.key),e.key.name==='await'&&!this.awaitIdentPos&&(this.awaitIdentPos=n),t?e.value=this.parseMaybeDefault(n,o,this.copyNode(e.key)):this.type===f.eq&&u?(u.shorthandAssign<0&&(u.shorthandAssign=this.start),e.value=this.parseMaybeDefault(n,o,this.copyNode(e.key))):e.value=this.copyNode(e.key),e.kind='init',e.shorthand=!0):this.unexpected()};He.parsePropertyName=function (e){if(this.options.ecmaVersion>=6){if(this.eat(f.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(f.bracketR),e.key;e.computed=!1}return e.key=this.type===f.num||this.type===f.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=='never')};He.initFunction=function (e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)};He.parseMethod=function (e,t,r){const i=this.startNode(),n=this.yieldPos,o=this.awaitPos,u=this.awaitIdentPos;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=e),this.options.ecmaVersion>=8&&(i.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ks(t,i.generator)|Jn|(r?Al:0)),this.expect(f.parenL),i.params=this.parseBindingList(f.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1,!0,!1),this.yieldPos=n,this.awaitPos=o,this.awaitIdentPos=u,this.finishNode(i,'FunctionExpression')};He.parseArrowExpression=function (e,t,r,i){const n=this.yieldPos,o=this.awaitPos,u=this.awaitIdentPos;return this.enterScope(ks(r,!1)|Cs),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!r),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1,i),this.yieldPos=n,this.awaitPos=o,this.awaitIdentPos=u,this.finishNode(e,'ArrowFunctionExpression')};He.parseFunctionBody=function (e,t,r,i){let n=t&&this.type!==f.braceL,o=this.strict,u=!1;if(n)e.body=this.parseMaybeAssign(i),e.expression=!0,this.checkParams(e,!1);else{const m=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);(!o||m)&&(u=this.strictDirective(this.end),u&&m&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));const _=this.labels;this.labels=[],u&&(this.strict=!0),this.checkParams(e,!o&&!u&&!t&&!r&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLValSimple(e.id,kl),e.body=this.parseBlock(!1,void 0,u&&!o),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=_}this.exitScope()};He.isSimpleParamList=function (e){for(let t=0,r=e;t<r.length;t+=1){const i=r[t];if(i.type!=='Identifier')return!1}return!0};He.checkParams=function (e,t){for(let r=Object.create(null),i=0,n=e.params;i<n.length;i+=1){const o=n[i];this.checkLValInnerPattern(o,Ls,t?null:r)}};He.parseExprList=function (e,t,r,i){for(var n=[],o=!0;!this.eat(e);){if(o)o=!1;else if(this.expect(f.comma),t&&this.afterTrailingComma(e))break;let u=void 0;r&&this.type===f.comma?u=null:this.type===f.ellipsis?(u=this.parseSpread(i),i&&this.type===f.comma&&i.trailingComma<0&&(i.trailingComma=this.start)):u=this.parseMaybeAssign(!1,i),n.push(u)}return n};He.checkUnreserved=function (e){const t=e.start,r=e.end,i=e.name;if(this.inGenerator&&i==='yield'&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&i==='await'&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&ea)&&i==='arguments'&&this.raiseRecoverable(t,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(i==='arguments'||i==='await')&&this.raise(t,'Cannot use '+i+' in class static initialization block'),this.keywords.test(i)&&this.raise(t,"Unexpected keyword '"+i+"'"),!(this.options.ecmaVersion<6&&this.input.slice(t,r).indexOf('\\')!==-1)){const n=this.strict?this.reservedWordsStrict:this.reservedWords;n.test(i)&&(!this.inAsync&&i==='await'&&this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+i+"' is reserved"))}};He.parseIdent=function (e){const t=this.parseIdentNode();return this.next(!!e),this.finishNode(t,'Identifier'),e||(this.checkUnreserved(t),t.name==='await'&&!this.awaitIdentPos&&(this.awaitIdentPos=t.start)),t};He.parseIdentNode=function (){const e=this.startNode();return this.type===f.name?e.name=this.value:this.type.keyword?(e.name=this.type.keyword,(e.name==='class'||e.name==='function')&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=f.name):this.unexpected(),e};He.parsePrivateIdent=function (){const e=this.startNode();return this.type===f.privateId?e.name=this.value:this.unexpected(),this.next(),this.finishNode(e,'PrivateIdentifier'),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(e.start,"Private field '#"+e.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(e)),e};He.parseYield=function (e){this.yieldPos||(this.yieldPos=this.start);const t=this.startNode();return this.next(),this.type===f.semi||this.canInsertSemicolon()||this.type!==f.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(f.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,'YieldExpression')};He.parseAwait=function (e){this.awaitPos||(this.awaitPos=this.start);const t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0,!1,e),this.finishNode(t,'AwaitExpression')};const Hn=Tt.prototype;Hn.raise=function (e,t){const r=wl(this.input,e);t+=' ('+r.line+':'+r.column+')',this.sourceFile&&(t+=' in '+this.sourceFile);const i=new SyntaxError(t);throw i.pos=e,i.loc=r,i.raisedAt=this.pos,i};Hn.raiseRecoverable=Hn.raise;Hn.curPosition=function (){if(this.options.locations)return new Yi(this.curLine,this.pos-this.lineStart)};const Br=Tt.prototype,Ud=function (t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};Br.enterScope=function (e){this.scopeStack.push(new Ud(e))};Br.exitScope=function (){this.scopeStack.pop()};Br.treatFunctionsAsVarInScope=function (e){return e.flags&Si||!this.inModule&&e.flags&Ki};Br.declareName=function (e,t,r){let i=!1;if(t===Tr){const n=this.currentScope();i=n.lexical.indexOf(e)>-1||n.functions.indexOf(e)>-1||n.var.indexOf(e)>-1,n.lexical.push(e),this.inModule&&n.flags&Ki&&delete this.undefinedExports[e]}else if(t===Cl){const o=this.currentScope();o.lexical.push(e)}else if(t===Tl){const u=this.currentScope();this.treatFunctionsAsVar?i=u.lexical.indexOf(e)>-1:i=u.lexical.indexOf(e)>-1||u.var.indexOf(e)>-1,u.functions.push(e)}else for(let m=this.scopeStack.length-1;m>=0;--m){const _=this.scopeStack[m];if(_.lexical.indexOf(e)>-1&&!(_.flags&El&&_.lexical[0]===e)||!this.treatFunctionsAsVarInScope(_)&&_.functions.indexOf(e)>-1){i=!0;break}if(_.var.push(e),this.inModule&&_.flags&Ki&&delete this.undefinedExports[e],_.flags&ea)break}i&&this.raiseRecoverable(r,"Identifier '"+e+"' has already been declared")};Br.checkLocalExport=function (e){this.scopeStack[0].lexical.indexOf(e.name)===-1&&this.scopeStack[0].var.indexOf(e.name)===-1&&(this.undefinedExports[e.name]=e)};Br.currentScope=function (){return this.scopeStack[this.scopeStack.length-1]};Br.currentVarScope=function (){for(let e=this.scopeStack.length-1;;e--){const t=this.scopeStack[e];if(t.flags&(ea|Qi|Zr))return t}};Br.currentThisScope=function (){for(let e=this.scopeStack.length-1;;e--){const t=this.scopeStack[e];if(t.flags&(ea|Qi|Zr)&&!(t.flags&Cs))return t}};const ra=function (t,r,i){this.type='',this.start=r,this.end=0,t.options.locations&&(this.loc=new Zn(t,i)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[r,0])},Zi=Tt.prototype;Zi.startNode=function (){return new ra(this,this.start,this.startLoc)};Zi.startNodeAt=function (e,t){return new ra(this,e,t)};function Rl (e,t,r,i){return e.type=t,e.end=r,this.options.locations&&(e.loc.end=i),this.options.ranges&&(e.range[1]=r),e}Zi.finishNode=function (e,t){return Rl.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)};Zi.finishNodeAt=function (e,t,r,i){return Rl.call(this,e,t,r,i)};Zi.copyNode=function (e){const t=new ra(this,e.start,this.startLoc);for(const r in e)t[r]=e[r];return t};const zd='Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz',Pl='ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS',Ol=Pl+' Extended_Pictographic',Nl=Ol,Fl=Nl+' EBase EComp EMod EPres ExtPict',Bl=Fl,jd=Bl,Wd={ 9:Pl,10:Ol,11:Nl,12:Fl,13:Bl,14:jd },Hd='Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji',qd={ 9:'',10:'',11:'',12:'',13:'',14:Hd },Qu='Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu',Ml='Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb',Dl=Ml+' Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd',Gl=Dl+' Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho',Vl=Gl+' Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi',Ul=Vl+' Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith',$d=Ul+' '+zd,Xd={ 9:Ml,10:Dl,11:Gl,12:Vl,13:Ul,14:$d },zl={};function Yd (e){const t=zl[e]={ binary:Nr(Wd[e]+' '+Qu),binaryOfStrings:Nr(qd[e]),nonBinary:{ General_Category:Nr(Qu),Script:Nr(Xd[e]) } };t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}for(let hs=0,Zu=[9,10,11,12,13,14];hs<Zu.length;hs+=1){const Kd=Zu[hs];Yd(Kd)}const Re=Tt.prototype,qn=function (t,r){this.parent=t,this.base=r||this};qn.prototype.separatedFrom=function (t){for(let r=this;r;r=r.parent)for(let i=t;i;i=i.parent)if(r.base===i.base&&r!==i)return!0;return!1};qn.prototype.sibling=function (){return new qn(this.parent,this.base)};const hr=function (t){this.parser=t,this.validFlags='gim'+(t.options.ecmaVersion>=6?'uy':'')+(t.options.ecmaVersion>=9?'s':'')+(t.options.ecmaVersion>=13?'d':'')+(t.options.ecmaVersion>=15?'v':''),this.unicodeProperties=zl[t.options.ecmaVersion>=14?14:t.options.ecmaVersion],this.source='',this.flags='',this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue='',this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};hr.prototype.reset=function (t,r,i){const n=i.indexOf('v')!==-1,o=i.indexOf('u')!==-1;this.start=t|0,this.source=r+'',this.flags=i,n&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=o&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=o&&this.parser.options.ecmaVersion>=9)};hr.prototype.raise=function (t){this.parser.raiseRecoverable(this.start,'Invalid regular expression: /'+this.source+'/: '+t)};hr.prototype.at=function (t,r){r===void 0&&(r=!1);const i=this.source,n=i.length;if(t>=n)return-1;const o=i.charCodeAt(t);if(!(r||this.switchU)||o<=55295||o>=57344||t+1>=n)return o;const u=i.charCodeAt(t+1);return u>=56320&&u<=57343?(o<<10)+u-56613888:o};hr.prototype.nextIndex=function (t,r){r===void 0&&(r=!1);const i=this.source,n=i.length;if(t>=n)return n;let o=i.charCodeAt(t),u;return!(r||this.switchU)||o<=55295||o>=57344||t+1>=n||(u=i.charCodeAt(t+1))<56320||u>57343?t+1:t+2};hr.prototype.current=function (t){return t===void 0&&(t=!1),this.at(this.pos,t)};hr.prototype.lookahead=function (t){return t===void 0&&(t=!1),this.at(this.nextIndex(this.pos,t),t)};hr.prototype.advance=function (t){t===void 0&&(t=!1),this.pos=this.nextIndex(this.pos,t)};hr.prototype.eat=function (t,r){return r===void 0&&(r=!1),this.current(r)===t?(this.advance(r),!0):!1};hr.prototype.eatChars=function (t,r){r===void 0&&(r=!1);for(var i=this.pos,n=0,o=t;n<o.length;n+=1){const u=o[n],m=this.at(i,r);if(m===-1||m!==u)return!1;i=this.nextIndex(i,r)}return this.pos=i,!0};Re.validateRegExpFlags=function (e){for(var t=e.validFlags,r=e.flags,i=!1,n=!1,o=0;o<r.length;o++){const u=r.charAt(o);t.indexOf(u)===-1&&this.raise(e.start,'Invalid regular expression flag'),r.indexOf(u,o+1)>-1&&this.raise(e.start,'Duplicate regular expression flag'),u==='u'&&(i=!0),u==='v'&&(n=!0)}this.options.ecmaVersion>=15&&i&&n&&this.raise(e.start,'Invalid regular expression flag')};function Qd (e){for(const t in e)return!0;return!1}Re.validateRegExpPattern=function (e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&Qd(e.groupNames)&&(e.switchN=!0,this.regexp_pattern(e))};Re.regexp_pattern=function (e){e.pos=0,e.lastIntValue=0,e.lastStringValue='',e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames=Object.create(null),e.backReferenceNames.length=0,e.branchID=null,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise('Lone quantifier brackets')),e.maxBackReference>e.numCapturingParens&&e.raise('Invalid escape');for(let t=0,r=e.backReferenceNames;t<r.length;t+=1){const i=r[t];e.groupNames[i]||e.raise('Invalid named capture referenced')}};Re.regexp_disjunction=function (e){const t=this.options.ecmaVersion>=16;for(t&&(e.branchID=new qn(e.branchID,null)),this.regexp_alternative(e);e.eat(124);)t&&(e.branchID=e.branchID.sibling()),this.regexp_alternative(e);t&&(e.branchID=e.branchID.parent),this.regexp_eatQuantifier(e,!0)&&e.raise('Nothing to repeat'),e.eat(123)&&e.raise('Lone quantifier brackets')};Re.regexp_alternative=function (e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););};Re.regexp_eatTerm=function (e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise('Invalid quantifier'),!0):(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))?(this.regexp_eatQuantifier(e),!0):!1};Re.regexp_eatAssertion=function (e){const t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){let r=!1;if(this.options.ecmaVersion>=9&&(r=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise('Unterminated group'),e.lastAssertionIsQuantifiable=!r,!0}return e.pos=t,!1};Re.regexp_eatQuantifier=function (e,t){return t===void 0&&(t=!1),this.regexp_eatQuantifierPrefix(e,t)?(e.eat(63),!0):!1};Re.regexp_eatQuantifierPrefix=function (e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)};Re.regexp_eatBracedQuantifier=function (e,t){const r=e.pos;if(e.eat(123)){let i=0,n=-1;if(this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue),e.eat(125)))return n!==-1&&n<i&&!t&&e.raise('numbers out of order in {} quantifier'),!0;e.switchU&&!t&&e.raise('Incomplete quantifier'),e.pos=r}return!1};Re.regexp_eatAtom=function (e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)};Re.regexp_eatReverseSolidusAtomEscape=function (e){const t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1};Re.regexp_eatUncapturingGroup=function (e){const t=e.pos;if(e.eat(40)){if(e.eat(63)){if(this.options.ecmaVersion>=16){const r=this.regexp_eatModifiers(e),i=e.eat(45);if(r||i){for(let n=0;n<r.length;n++){const o=r.charAt(n);r.indexOf(o,n+1)>-1&&e.raise('Duplicate regular expression modifiers')}if(i){const u=this.regexp_eatModifiers(e);!r&&!u&&e.current()===58&&e.raise('Invalid regular expression modifiers');for(let m=0;m<u.length;m++){const _=u.charAt(m);(u.indexOf(_,m+1)>-1||r.indexOf(_)>-1)&&e.raise('Duplicate regular expression modifiers')}}}}if(e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise('Unterminated group')}}e.pos=t}return!1};Re.regexp_eatCapturingGroup=function (e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):e.current()===63&&e.raise('Invalid group'),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise('Unterminated group')}return!1};Re.regexp_eatModifiers=function (e){for(var t='',r=0;(r=e.current())!==-1&&Zd(r);)t+=Er(r),e.advance();return t};function Zd (e){return e===105||e===109||e===115}Re.regexp_eatExtendedAtom=function (e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)};Re.regexp_eatInvalidBracedQuantifier=function (e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise('Nothing to repeat'),!1};Re.regexp_eatSyntaxCharacter=function (e){const t=e.current();return jl(t)?(e.lastIntValue=t,e.advance(),!0):!1};function jl (e){return e===36||e>=40&&e<=43||e===46||e===63||e>=91&&e<=94||e>=123&&e<=125}Re.regexp_eatPatternCharacters=function (e){for(var t=e.pos,r=0;(r=e.current())!==-1&&!jl(r);)e.advance();return e.pos!==t};Re.regexp_eatExtendedPatternCharacter=function (e){const t=e.current();return t!==-1&&t!==36&&!(t>=40&&t<=43)&&t!==46&&t!==63&&t!==91&&t!==94&&t!==124?(e.advance(),!0):!1};Re.regexp_groupSpecifier=function (e){if(e.eat(63)){this.regexp_eatGroupName(e)||e.raise('Invalid group');const t=this.options.ecmaVersion>=16,r=e.groupNames[e.lastStringValue];if(r)if(t)for(let i=0,n=r;i<n.length;i+=1){const o=n[i];o.separatedFrom(e.branchID)||e.raise('Duplicate capture group name')}else e.raise('Duplicate capture group name');t?(r||(e.groupNames[e.lastStringValue]=[])).push(e.branchID):e.groupNames[e.lastStringValue]=!0}};Re.regexp_eatGroupName=function (e){if(e.lastStringValue='',e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise('Invalid capture group name')}return!1};Re.regexp_eatRegExpIdentifierName=function (e){if(e.lastStringValue='',this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=Er(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=Er(e.lastIntValue);return!0}return!1};Re.regexp_eatRegExpIdentifierStart=function (e){let t=e.pos,r=this.options.ecmaVersion>=11,i=e.current(r);return e.advance(r),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,r)&&(i=e.lastIntValue),Jd(i)?(e.lastIntValue=i,!0):(e.pos=t,!1)};function Jd (e){return Sr(e,!0)||e===36||e===95}Re.regexp_eatRegExpIdentifierPart=function (e){let t=e.pos,r=this.options.ecmaVersion>=11,i=e.current(r);return e.advance(r),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,r)&&(i=e.lastIntValue),em(i)?(e.lastIntValue=i,!0):(e.pos=t,!1)};function em (e){return bi(e,!0)||e===36||e===95||e===8204||e===8205}Re.regexp_eatAtomEscape=function (e){return this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e)?!0:(e.switchU&&(e.current()===99&&e.raise('Invalid unicode escape'),e.raise('Invalid escape')),!1)};Re.regexp_eatBackReference=function (e){const t=e.pos;if(this.regexp_eatDecimalEscape(e)){const r=e.lastIntValue;if(e.switchU)return r>e.maxBackReference&&(e.maxBackReference=r),!0;if(r<=e.numCapturingParens)return!0;e.pos=t}return!1};Re.regexp_eatKGroupName=function (e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise('Invalid named reference')}return!1};Re.regexp_eatCharacterEscape=function (e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)};Re.regexp_eatCControlLetter=function (e){const t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1};Re.regexp_eatZero=function (e){return e.current()===48&&!ia(e.lookahead())?(e.lastIntValue=0,e.advance(),!0):!1};Re.regexp_eatControlEscape=function (e){const t=e.current();return t===116?(e.lastIntValue=9,e.advance(),!0):t===110?(e.lastIntValue=10,e.advance(),!0):t===118?(e.lastIntValue=11,e.advance(),!0):t===102?(e.lastIntValue=12,e.advance(),!0):t===114?(e.lastIntValue=13,e.advance(),!0):!1};Re.regexp_eatControlLetter=function (e){const t=e.current();return Wl(t)?(e.lastIntValue=t%32,e.advance(),!0):!1};function Wl (e){return e>=65&&e<=90||e>=97&&e<=122}Re.regexp_eatRegExpUnicodeEscapeSequence=function (e,t){t===void 0&&(t=!1);const r=e.pos,i=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){const n=e.lastIntValue;if(i&&n>=55296&&n<=56319){const o=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){const u=e.lastIntValue;if(u>=56320&&u<=57343)return e.lastIntValue=(n-55296)*1024+(u-56320)+65536,!0}e.pos=o,e.lastIntValue=n}return!0}if(i&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&tm(e.lastIntValue))return!0;i&&e.raise('Invalid unicode escape'),e.pos=r}return!1};function tm (e){return e>=0&&e<=1114111}Re.regexp_eatIdentityEscape=function (e){if(e.switchU)return this.regexp_eatSyntaxCharacter(e)?!0:e.eat(47)?(e.lastIntValue=47,!0):!1;const t=e.current();return t!==99&&(!e.switchN||t!==107)?(e.lastIntValue=t,e.advance(),!0):!1};Re.regexp_eatDecimalEscape=function (e){e.lastIntValue=0;let t=e.current();if(t>=49&&t<=57){do e.lastIntValue=10*e.lastIntValue+(t-48),e.advance();while((t=e.current())>=48&&t<=57);return!0}return!1};const Hl=0,Ar=1,Kt=2;Re.regexp_eatCharacterClassEscape=function (e){const t=e.current();if(rm(t))return e.lastIntValue=-1,e.advance(),Ar;let r=!1;if(e.switchU&&this.options.ecmaVersion>=9&&((r=t===80)||t===112)){e.lastIntValue=-1,e.advance();let i;if(e.eat(123)&&(i=this.regexp_eatUnicodePropertyValueExpression(e))&&e.eat(125))return r&&i===Kt&&e.raise('Invalid property name'),i;e.raise('Invalid property name')}return Hl};function rm (e){return e===100||e===68||e===115||e===83||e===119||e===87}Re.regexp_eatUnicodePropertyValueExpression=function (e){const t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){const r=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){const i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,r,i),Ar}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){const n=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,n)}return Hl};Re.regexp_validateUnicodePropertyNameAndValue=function (e,t,r){wi(e.unicodeProperties.nonBinary,t)||e.raise('Invalid property name'),e.unicodeProperties.nonBinary[t].test(r)||e.raise('Invalid property value')};Re.regexp_validateUnicodePropertyNameOrValue=function (e,t){if(e.unicodeProperties.binary.test(t))return Ar;if(e.switchV&&e.unicodeProperties.binaryOfStrings.test(t))return Kt;e.raise('Invalid property name')};Re.regexp_eatUnicodePropertyName=function (e){let t=0;for(e.lastStringValue='';ql(t=e.current());)e.lastStringValue+=Er(t),e.advance();return e.lastStringValue!==''};function ql (e){return Wl(e)||e===95}Re.regexp_eatUnicodePropertyValue=function (e){let t=0;for(e.lastStringValue='';im(t=e.current());)e.lastStringValue+=Er(t),e.advance();return e.lastStringValue!==''};function im (e){return ql(e)||ia(e)}Re.regexp_eatLoneUnicodePropertyNameOrValue=function (e){return this.regexp_eatUnicodePropertyValue(e)};Re.regexp_eatCharacterClass=function (e){if(e.eat(91)){const t=e.eat(94),r=this.regexp_classContents(e);return e.eat(93)||e.raise('Unterminated character class'),t&&r===Kt&&e.raise('Negated character class may contain strings'),!0}return!1};Re.regexp_classContents=function (e){return e.current()===93?Ar:e.switchV?this.regexp_classSetExpression(e):(this.regexp_nonEmptyClassRanges(e),Ar)};Re.regexp_nonEmptyClassRanges=function (e){for(;this.regexp_eatClassAtom(e);){const t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){const r=e.lastIntValue;e.switchU&&(t===-1||r===-1)&&e.raise('Invalid character class'),t!==-1&&r!==-1&&t>r&&e.raise('Range out of order in character class')}}};Re.regexp_eatClassAtom=function (e){const t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){const r=e.current();(r===99||Yl(r))&&e.raise('Invalid class escape'),e.raise('Invalid escape')}e.pos=t}const i=e.current();return i!==93?(e.lastIntValue=i,e.advance(),!0):!1};Re.regexp_eatClassEscape=function (e){const t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)};Re.regexp_classSetExpression=function (e){let t=Ar,r;if(!this.regexp_eatClassSetRange(e))if(r=this.regexp_eatClassSetOperand(e)){r===Kt&&(t=Kt);for(var i=e.pos;e.eatChars([38,38]);){if(e.current()!==38&&(r=this.regexp_eatClassSetOperand(e))){r!==Kt&&(t=Ar);continue}e.raise('Invalid character in character class')}if(i!==e.pos)return t;for(;e.eatChars([45,45]);)this.regexp_eatClassSetOperand(e)||e.raise('Invalid character in character class');if(i!==e.pos)return t}else e.raise('Invalid character in character class');for(;;)if(!this.regexp_eatClassSetRange(e)){if(r=this.regexp_eatClassSetOperand(e),!r)return t;r===Kt&&(t=Kt)}};Re.regexp_eatClassSetRange=function (e){const t=e.pos;if(this.regexp_eatClassSetCharacter(e)){const r=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassSetCharacter(e)){const i=e.lastIntValue;return r!==-1&&i!==-1&&r>i&&e.raise('Range out of order in character class'),!0}e.pos=t}return!1};Re.regexp_eatClassSetOperand=function (e){return this.regexp_eatClassSetCharacter(e)?Ar:this.regexp_eatClassStringDisjunction(e)||this.regexp_eatNestedClass(e)};Re.regexp_eatNestedClass=function (e){const t=e.pos;if(e.eat(91)){const r=e.eat(94),i=this.regexp_classContents(e);if(e.eat(93))return r&&i===Kt&&e.raise('Negated character class may contain strings'),i;e.pos=t}if(e.eat(92)){const n=this.regexp_eatCharacterClassEscape(e);if(n)return n;e.pos=t}return null};Re.regexp_eatClassStringDisjunction=function (e){const t=e.pos;if(e.eatChars([92,113])){if(e.eat(123)){const r=this.regexp_classStringDisjunctionContents(e);if(e.eat(125))return r}else e.raise('Invalid escape');e.pos=t}return null};Re.regexp_classStringDisjunctionContents=function (e){for(var t=this.regexp_classString(e);e.eat(124);)this.regexp_classString(e)===Kt&&(t=Kt);return t};Re.regexp_classString=function (e){for(var t=0;this.regexp_eatClassSetCharacter(e);)t++;return t===1?Ar:Kt};Re.regexp_eatClassSetCharacter=function (e){const t=e.pos;if(e.eat(92))return this.regexp_eatCharacterEscape(e)||this.regexp_eatClassSetReservedPunctuator(e)?!0:e.eat(98)?(e.lastIntValue=8,!0):(e.pos=t,!1);const r=e.current();return r<0||r===e.lookahead()&&nm(r)||am(r)?!1:(e.advance(),e.lastIntValue=r,!0)};function nm (e){return e===33||e>=35&&e<=38||e>=42&&e<=44||e===46||e>=58&&e<=64||e===94||e===96||e===126}function am (e){return e===40||e===41||e===45||e===47||e>=91&&e<=93||e>=123&&e<=125}Re.regexp_eatClassSetReservedPunctuator=function (e){const t=e.current();return sm(t)?(e.lastIntValue=t,e.advance(),!0):!1};function sm (e){return e===33||e===35||e===37||e===38||e===44||e===45||e>=58&&e<=62||e===64||e===96||e===126}Re.regexp_eatClassControlLetter=function (e){const t=e.current();return ia(t)||t===95?(e.lastIntValue=t%32,e.advance(),!0):!1};Re.regexp_eatHexEscapeSequence=function (e){const t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise('Invalid escape'),e.pos=t}return!1};Re.regexp_eatDecimalDigits=function (e){let t=e.pos,r=0;for(e.lastIntValue=0;ia(r=e.current());)e.lastIntValue=10*e.lastIntValue+(r-48),e.advance();return e.pos!==t};function ia (e){return e>=48&&e<=57}Re.regexp_eatHexDigits=function (e){let t=e.pos,r=0;for(e.lastIntValue=0;$l(r=e.current());)e.lastIntValue=16*e.lastIntValue+Xl(r),e.advance();return e.pos!==t};function $l (e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function Xl (e){return e>=65&&e<=70?10+(e-65):e>=97&&e<=102?10+(e-97):e-48}Re.regexp_eatLegacyOctalEscapeSequence=function (e){if(this.regexp_eatOctalDigit(e)){const t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){const r=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=t*64+r*8+e.lastIntValue:e.lastIntValue=t*8+r}else e.lastIntValue=t;return!0}return!1};Re.regexp_eatOctalDigit=function (e){const t=e.current();return Yl(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)};function Yl (e){return e>=48&&e<=55}Re.regexp_eatFixedHexDigits=function (e,t){const r=e.pos;e.lastIntValue=0;for(let i=0;i<t;++i){const n=e.current();if(!$l(n))return e.pos=r,!1;e.lastIntValue=16*e.lastIntValue+Xl(n),e.advance()}return!0};const Rs=function (t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new Zn(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},tt=Tt.prototype;tt.next=function (e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,'Escape sequence in keyword '+this.type.keyword),this.options.onToken&&this.options.onToken(new Rs(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};tt.getToken=function (){return this.next(),new Rs(this)};typeof Symbol<'u'&&(tt[Symbol.iterator]=function (){const e=this;return{ next (){const t=e.getToken();return{ done:t.type===f.eof,value:t }} }});tt.nextToken=function (){const e=this.curContext();if((!e||!e.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(f.eof);if(e.override)return e.override(this);this.readToken(this.fullCharCodeAtPos())};tt.readToken=function (e){return Sr(e,this.options.ecmaVersion>=6)||e===92?this.readWord():this.getTokenFromCode(e)};tt.fullCharCodeAtPos=function (){const e=this.input.charCodeAt(this.pos);if(e<=55295||e>=56320)return e;const t=this.input.charCodeAt(this.pos+1);return t<=56319||t>=57344?e:(e<<10)+t-56613888};tt.skipBlockComment=function (){const e=this.options.onComment&&this.curPosition(),t=this.pos,r=this.input.indexOf('*/',this.pos+=2);if(r===-1&&this.raise(this.pos-2,'Unterminated comment'),this.pos=r+2,this.options.locations)for(let i=void 0,n=t;(i=bl(this.input,n,this.pos))>-1;)++this.curLine,n=this.lineStart=i;this.options.onComment&&this.options.onComment(!0,this.input.slice(t+2,r),t,this.pos,e,this.curPosition())};tt.skipLineComment=function (e){for(var t=this.pos,r=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!_i(i);)i=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,r,this.curPosition())};tt.skipSpace=function (){e:for(;this.pos<this.input.length;){const e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(e>8&&e<14||e>=5760&&xl.test(String.fromCharCode(e)))++this.pos;else break e}}};tt.finishToken=function (e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());const r=this.type;this.type=e,this.value=t,this.updateContext(r)};tt.readToken_dot=function (){const e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);const t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&e===46&&t===46?(this.pos+=3,this.finishToken(f.ellipsis)):(++this.pos,this.finishToken(f.dot))};tt.readToken_slash=function (){const e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):e===61?this.finishOp(f.assign,2):this.finishOp(f.slash,1)};tt.readToken_mult_modulo_exp=function (e){let t=this.input.charCodeAt(this.pos+1),r=1,i=e===42?f.star:f.modulo;return this.options.ecmaVersion>=7&&e===42&&t===42&&(++r,i=f.starstar,t=this.input.charCodeAt(this.pos+2)),t===61?this.finishOp(f.assign,r+1):this.finishOp(i,r)};tt.readToken_pipe_amp=function (e){const t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12){const r=this.input.charCodeAt(this.pos+2);if(r===61)return this.finishOp(f.assign,3)}return this.finishOp(e===124?f.logicalOR:f.logicalAND,2)}return t===61?this.finishOp(f.assign,2):this.finishOp(e===124?f.bitwiseOR:f.bitwiseAND,1)};tt.readToken_caret=function (){const e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(f.assign,2):this.finishOp(f.bitwiseXOR,1)};tt.readToken_plus_min=function (e){const t=this.input.charCodeAt(this.pos+1);return t===e?t===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Qt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(f.incDec,2):t===61?this.finishOp(f.assign,2):this.finishOp(f.plusMin,1)};tt.readToken_lt_gt=function (e){let t=this.input.charCodeAt(this.pos+1),r=1;return t===e?(r=e===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+r)===61?this.finishOp(f.assign,r+1):this.finishOp(f.bitShift,r)):t===33&&e===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(t===61&&(r=2),this.finishOp(f.relational,r))};tt.readToken_eq_excl=function (e){const t=this.input.charCodeAt(this.pos+1);return t===61?this.finishOp(f.equality,this.input.charCodeAt(this.pos+2)===61?3:2):e===61&&t===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(f.arrow)):this.finishOp(e===61?f.eq:f.prefix,1)};tt.readToken_question=function (){const e=this.options.ecmaVersion;if(e>=11){const t=this.input.charCodeAt(this.pos+1);if(t===46){const r=this.input.charCodeAt(this.pos+2);if(r<48||r>57)return this.finishOp(f.questionDot,2)}if(t===63){if(e>=12){const i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(f.assign,3)}return this.finishOp(f.coalesce,2)}}return this.finishOp(f.question,1)};tt.readToken_numberSign=function (){let e=this.options.ecmaVersion,t=35;if(e>=13&&(++this.pos,t=this.fullCharCodeAtPos(),Sr(t,!0)||t===92))return this.finishToken(f.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+Er(t)+"'")};tt.getTokenFromCode=function (e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(f.parenL);case 41:return++this.pos,this.finishToken(f.parenR);case 59:return++this.pos,this.finishToken(f.semi);case 44:return++this.pos,this.finishToken(f.comma);case 91:return++this.pos,this.finishToken(f.bracketL);case 93:return++this.pos,this.finishToken(f.bracketR);case 123:return++this.pos,this.finishToken(f.braceL);case 125:return++this.pos,this.finishToken(f.braceR);case 58:return++this.pos,this.finishToken(f.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(f.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(t===120||t===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(t===111||t===79)return this.readRadixNumber(8);if(t===98||t===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(f.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+Er(e)+"'")};tt.finishOp=function (e,t){const r=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,r)};tt.readRegexp=function (){for(var e,t,r=this.pos;;){this.pos>=this.input.length&&this.raise(r,'Unterminated regular expression');const i=this.input.charAt(this.pos);if(Qt.test(i)&&this.raise(r,'Unterminated regular expression'),e)e=!1;else{if(i==='[')t=!0;else if(i===']'&&t)t=!1;else if(i==='/'&&!t)break;e=i==='\\'}++this.pos}const n=this.input.slice(r,this.pos);++this.pos;const o=this.pos,u=this.readWord1();this.containsEsc&&this.unexpected(o);const m=this.regexpState||(this.regexpState=new hr(this));m.reset(r,n,u),this.validateRegExpFlags(m),this.validateRegExpPattern(m);let _=null;try{_=new RegExp(n,u)}catch{}return this.finishToken(f.regexp,{ pattern:n,flags:u,value:_ })};tt.readInt=function (e,t,r){for(var i=this.options.ecmaVersion>=12&&t===void 0,n=r&&this.input.charCodeAt(this.pos)===48,o=this.pos,u=0,m=0,_=0,P=t??1/0;_<P;++_,++this.pos){let k=this.input.charCodeAt(this.pos),y=void 0;if(i&&k===95){n&&this.raiseRecoverable(this.pos,'Numeric separator is not allowed in legacy octal numeric literals'),m===95&&this.raiseRecoverable(this.pos,'Numeric separator must be exactly one underscore'),_===0&&this.raiseRecoverable(this.pos,'Numeric separator is not allowed at the first of digits'),m=k;continue}if(k>=97?y=k-97+10:k>=65?y=k-65+10:k>=48&&k<=57?y=k-48:y=1/0,y>=e)break;m=k,u=u*e+y}return i&&m===95&&this.raiseRecoverable(this.pos-1,'Numeric separator is not allowed at the last of digits'),this.pos===o||t!=null&&this.pos-o!==t?null:u};function om (e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,''))}function Kl (e){return typeof BigInt!='function'?null:BigInt(e.replace(/_/g,''))}tt.readRadixNumber=function (e){const t=this.pos;this.pos+=2;let r=this.readInt(e);return r==null&&this.raise(this.start+2,'Expected number in radix '+e),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(r=Kl(this.input.slice(t,this.pos)),++this.pos):Sr(this.fullCharCodeAtPos())&&this.raise(this.pos,'Identifier directly after number'),this.finishToken(f.num,r)};tt.readNumber=function (e){const t=this.pos;!e&&this.readInt(10,void 0,!0)===null&&this.raise(t,'Invalid number');let r=this.pos-t>=2&&this.input.charCodeAt(t)===48;r&&this.strict&&this.raise(t,'Invalid number');let i=this.input.charCodeAt(this.pos);if(!r&&!e&&this.options.ecmaVersion>=11&&i===110){const n=Kl(this.input.slice(t,this.pos));return++this.pos,Sr(this.fullCharCodeAtPos())&&this.raise(this.pos,'Identifier directly after number'),this.finishToken(f.num,n)}r&&/[89]/.test(this.input.slice(t,this.pos))&&(r=!1),i===46&&!r&&(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),(i===69||i===101)&&!r&&(i=this.input.charCodeAt(++this.pos),(i===43||i===45)&&++this.pos,this.readInt(10)===null&&this.raise(t,'Invalid number')),Sr(this.fullCharCodeAtPos())&&this.raise(this.pos,'Identifier directly after number');const o=om(this.input.slice(t,this.pos),r);return this.finishToken(f.num,o)};tt.readCodePoint=function (){let e=this.input.charCodeAt(this.pos),t;if(e===123){this.options.ecmaVersion<6&&this.unexpected();const r=++this.pos;t=this.readHexChar(this.input.indexOf('}',this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(r,'Code point out of bounds')}else t=this.readHexChar(4);return t};tt.readString=function (e){for(var t='',r=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,'Unterminated string constant');const i=this.input.charCodeAt(this.pos);if(i===e)break;i===92?(t+=this.input.slice(r,this.pos),t+=this.readEscapedChar(!1),r=this.pos):i===8232||i===8233?(this.options.ecmaVersion<10&&this.raise(this.start,'Unterminated string constant'),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(_i(i)&&this.raise(this.start,'Unterminated string constant'),++this.pos)}return t+=this.input.slice(r,this.pos++),this.finishToken(f.string,t)};const Ql={};tt.tryReadTemplateToken=function (){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e===Ql)this.readInvalidTemplateToken();else throw e}this.inTemplateElement=!1};tt.invalidStringToken=function (e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ql;this.raise(e,t)};tt.readTmplToken=function (){for(let e='',t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,'Unterminated template');const r=this.input.charCodeAt(this.pos);if(r===96||r===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===f.template||this.type===f.invalidTemplate)?r===36?(this.pos+=2,this.finishToken(f.dollarBraceL)):(++this.pos,this.finishToken(f.backQuote)):(e+=this.input.slice(t,this.pos),this.finishToken(f.template,e));if(r===92)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(_i(r)){switch(e+=this.input.slice(t,this.pos),++this.pos,r){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:e+=`
`;break;default:e+=String.fromCharCode(r);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}};tt.readInvalidTemplateToken=function (){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case'\\':++this.pos;break;case'$':if(this.input[this.pos+1]!=='{')break;case'`':return this.finishToken(f.invalidTemplate,this.input.slice(this.start,this.pos));case'\r':this.input[this.pos+1]===`
`&&++this.pos;case`
`:case'\u2028':case'\u2029':++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,'Unterminated template')};tt.readEscapedChar=function (e){let t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return`
`;case 114:return'\r';case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Er(this.readCodePoint());case 116:return'	';case 98:return'\b';case 118:return'\v';case 102:return'\f';case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),'';case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,'Invalid escape sequence'),e){const r=this.pos-1;this.invalidStringToken(r,'Invalid escape sequence in template string')}default:if(t>=48&&t<=55){let i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],n=parseInt(i,8);return n>255&&(i=i.slice(0,-1),n=parseInt(i,8)),this.pos+=i.length-1,t=this.input.charCodeAt(this.pos),(i!=='0'||t===56||t===57)&&(this.strict||e)&&this.invalidStringToken(this.pos-1-i.length,e?'Octal literal in template string':'Octal literal in strict mode'),String.fromCharCode(n)}return _i(t)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),''):String.fromCharCode(t)}};tt.readHexChar=function (e){const t=this.pos,r=this.readInt(16,e);return r===null&&this.invalidStringToken(t,'Bad character escape sequence'),r};tt.readWord1=function (){this.containsEsc=!1;for(var e='',t=!0,r=this.pos,i=this.options.ecmaVersion>=6;this.pos<this.input.length;){const n=this.fullCharCodeAtPos();if(bi(n,i))this.pos+=n<=65535?1:2;else if(n===92){this.containsEsc=!0,e+=this.input.slice(r,this.pos);const o=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,'Expecting Unicode escape sequence \\uXXXX'),++this.pos;const u=this.readCodePoint();(t?Sr:bi)(u,i)||this.invalidStringToken(o,'Invalid Unicode escape'),e+=Er(u),r=this.pos}else break;t=!1}return e+this.input.slice(r,this.pos)};tt.readWord=function (){let e=this.readWord1(),t=f.name;return this.keywords.test(e)&&(t=As[e]),this.finishToken(t,e)};const um='8.14.1';Tt.acorn={ Parser:Tt,version:um,defaultOptions:bs,Position:Yi,SourceLocation:Zn,getLineInfo:wl,Node:ra,TokenType:nt,tokTypes:f,keywordTypes:As,TokContext:ir,tokContexts:ft,isIdentifierChar:bi,isIdentifierStart:Sr,Token:Rs,isNewLine:_i,lineBreak:Qt,lineBreakG:Id,nonASCIIwhitespace:xl };const{ stringify:lm }=JSON;if(!String.prototype.repeat)throw new Error('String.prototype.repeat is undefined, see https://github.com/davidbonnet/astring#installation');if(!String.prototype.endsWith)throw new Error('String.prototype.endsWith is undefined, see https://github.com/davidbonnet/astring#installation');const On={ '||':2,'??':3,'&&':4,'|':5,'^':6,'&':7,'==':8,'!=':8,'===':8,'!==':8,'<':9,'>':9,'<=':9,'>=':9,in:9,instanceof:9,'<<':10,'>>':10,'>>>':10,'+':11,'-':11,'*':12,'%':12,'/':12,'**':13 },nr=17,fm={ ArrayExpression:20,TaggedTemplateExpression:20,ThisExpression:20,Identifier:20,PrivateIdentifier:20,Literal:18,TemplateLiteral:20,Super:20,SequenceExpression:20,MemberExpression:19,ChainExpression:19,CallExpression:19,NewExpression:19,ArrowFunctionExpression:nr,ClassExpression:nr,FunctionExpression:nr,ObjectExpression:nr,UpdateExpression:16,UnaryExpression:15,AwaitExpression:15,BinaryExpression:14,LogicalExpression:13,ConditionalExpression:4,AssignmentExpression:3,YieldExpression:2,RestElement:1 };function mi (e,t){const{ generator:r }=e;if(e.write('('),t!=null&&t.length>0){r[t[0].type](t[0],e);const{ length:i }=t;for(let n=1;n<i;n++){const o=t[n];e.write(', '),r[o.type](o,e)}}e.write(')')}function Zl (e,t,r,i){const n=e.expressionsPrecedence[t.type];if(n===nr)return!0;const o=e.expressionsPrecedence[r.type];return n!==o?!i&&n===15&&o===14&&r.operator==='**'||n<o:n!==13&&n!==14?!1:t.operator==='**'&&r.operator==='**'?!i:n===13&&o===13&&(t.operator==='??'||r.operator==='??')?!0:i?On[t.operator]<=On[r.operator]:On[t.operator]<On[r.operator]}function Nn (e,t,r,i){const{ generator:n }=e;Zl(e,t,r,i)?(e.write('('),n[t.type](t,e),e.write(')')):n[t.type](t,e)}function cm (e,t,r,i){const n=t.split(`
`),o=n.length-1;if(e.write(n[0].trim()),o>0){e.write(i);for(let u=1;u<o;u++)e.write(r+n[u].trim()+i);e.write(r+n[o].trim())}}function Nt (e,t,r,i){const{ length:n }=t;for(let o=0;o<n;o++){const u=t[o];e.write(r),u.type[0]==='L'?e.write('// '+u.value.trim()+`
`,u):(e.write('/*'),cm(e,u.value,r,i),e.write('*/'+i))}}function hm (e){let t=e;for(;t!=null;){const{ type:r }=t;if(r[0]==='C'&&r[1]==='a')return!0;if(r[0]==='M'&&r[1]==='e'&&r[2]==='m')t=t.object;else return!1}}function ps (e,t){const{ generator:r }=e,{ declarations:i }=t;e.write(t.kind+' ');const{ length:n }=i;if(n>0){r.VariableDeclarator(i[0],e);for(let o=1;o<n;o++)e.write(', '),r.VariableDeclarator(i[o],e)}}let Ju,el,tl,rl,il,nl;const pm={ Program (e,t){const r=t.indent.repeat(t.indentLevel),{ lineEnd:i,writeComments:n }=t;n&&e.comments!=null&&Nt(t,e.comments,r,i);const o=e.body,{ length:u }=o;for(let m=0;m<u;m++){const _=o[m];n&&_.comments!=null&&Nt(t,_.comments,r,i),t.write(r),this[_.type](_,t),t.write(i)}n&&e.trailingComments!=null&&Nt(t,e.trailingComments,r,i)},BlockStatement:nl=function (e,t){const r=t.indent.repeat(t.indentLevel++),{ lineEnd:i,writeComments:n }=t,o=r+t.indent;t.write('{');const u=e.body;if(u!=null&&u.length>0){t.write(i),n&&e.comments!=null&&Nt(t,e.comments,o,i);const{ length:m }=u;for(let _=0;_<m;_++){const P=u[_];n&&P.comments!=null&&Nt(t,P.comments,o,i),t.write(o),this[P.type](P,t),t.write(i)}t.write(r)}else n&&e.comments!=null&&(t.write(i),Nt(t,e.comments,o,i),t.write(r));n&&e.trailingComments!=null&&Nt(t,e.trailingComments,o,i),t.write('}'),t.indentLevel--},ClassBody:nl,StaticBlock (e,t){t.write('static '),this.BlockStatement(e,t)},EmptyStatement (e,t){t.write(';')},ExpressionStatement (e,t){const r=t.expressionsPrecedence[e.expression.type];r===nr||r===3&&e.expression.left.type[0]==='O'?(t.write('('),this[e.expression.type](e.expression,t),t.write(')')):this[e.expression.type](e.expression,t),t.write(';')},IfStatement (e,t){t.write('if ('),this[e.test.type](e.test,t),t.write(') '),this[e.consequent.type](e.consequent,t),e.alternate!=null&&(t.write(' else '),this[e.alternate.type](e.alternate,t))},LabeledStatement (e,t){this[e.label.type](e.label,t),t.write(': '),this[e.body.type](e.body,t)},BreakStatement (e,t){t.write('break'),e.label!=null&&(t.write(' '),this[e.label.type](e.label,t)),t.write(';')},ContinueStatement (e,t){t.write('continue'),e.label!=null&&(t.write(' '),this[e.label.type](e.label,t)),t.write(';')},WithStatement (e,t){t.write('with ('),this[e.object.type](e.object,t),t.write(') '),this[e.body.type](e.body,t)},SwitchStatement (e,t){const r=t.indent.repeat(t.indentLevel++),{ lineEnd:i,writeComments:n }=t;t.indentLevel++;const o=r+t.indent,u=o+t.indent;t.write('switch ('),this[e.discriminant.type](e.discriminant,t),t.write(') {'+i);const{ cases:m }=e,{ length:_ }=m;for(let P=0;P<_;P++){const k=m[P];n&&k.comments!=null&&Nt(t,k.comments,o,i),k.test?(t.write(o+'case '),this[k.test.type](k.test,t),t.write(':'+i)):t.write(o+'default:'+i);const{ consequent:y }=k,{ length:T }=y;for(let ie=0;ie<T;ie++){const Ae=y[ie];n&&Ae.comments!=null&&Nt(t,Ae.comments,u,i),t.write(u),this[Ae.type](Ae,t),t.write(i)}}t.indentLevel-=2,t.write(r+'}')},ReturnStatement (e,t){t.write('return'),e.argument&&(t.write(' '),this[e.argument.type](e.argument,t)),t.write(';')},ThrowStatement (e,t){t.write('throw '),this[e.argument.type](e.argument,t),t.write(';')},TryStatement (e,t){if(t.write('try '),this[e.block.type](e.block,t),e.handler){const{ handler:r }=e;r.param==null?t.write(' catch '):(t.write(' catch ('),this[r.param.type](r.param,t),t.write(') ')),this[r.body.type](r.body,t)}e.finalizer&&(t.write(' finally '),this[e.finalizer.type](e.finalizer,t))},WhileStatement (e,t){t.write('while ('),this[e.test.type](e.test,t),t.write(') '),this[e.body.type](e.body,t)},DoWhileStatement (e,t){t.write('do '),this[e.body.type](e.body,t),t.write(' while ('),this[e.test.type](e.test,t),t.write(');')},ForStatement (e,t){if(t.write('for ('),e.init!=null){const{ init:r }=e;r.type[0]==='V'?ps(t,r):this[r.type](r,t)}t.write('; '),e.test&&this[e.test.type](e.test,t),t.write('; '),e.update&&this[e.update.type](e.update,t),t.write(') '),this[e.body.type](e.body,t)},ForInStatement:Ju=function (e,t){t.write(`for ${e.await?'await ':''}(`);const{ left:r }=e;r.type[0]==='V'?ps(t,r):this[r.type](r,t),t.write(e.type[3]==='I'?' in ':' of '),this[e.right.type](e.right,t),t.write(') '),this[e.body.type](e.body,t)},ForOfStatement:Ju,DebuggerStatement (e,t){t.write('debugger;',e)},FunctionDeclaration:el=function (e,t){t.write((e.async?'async ':'')+(e.generator?'function* ':'function ')+(e.id?e.id.name:''),e),mi(t,e.params),t.write(' '),this[e.body.type](e.body,t)},FunctionExpression:el,VariableDeclaration (e,t){ps(t,e),t.write(';')},VariableDeclarator (e,t){this[e.id.type](e.id,t),e.init!=null&&(t.write(' = '),this[e.init.type](e.init,t))},ClassDeclaration (e,t){if(t.write('class '+(e.id?`${e.id.name} `:''),e),e.superClass){t.write('extends ');const{ superClass:r }=e,{ type:i }=r,n=t.expressionsPrecedence[i];(i[0]!=='C'||i[1]!=='l'||i[5]!=='E')&&(n===nr||n<t.expressionsPrecedence.ClassExpression)?(t.write('('),this[e.superClass.type](r,t),t.write(')')):this[r.type](r,t),t.write(' ')}this.ClassBody(e.body,t)},ImportDeclaration (e,t){t.write('import ');const{ specifiers:r,attributes:i }=e,{ length:n }=r;let o=0;if(n>0){for(;o<n;){o>0&&t.write(', ');const u=r[o],m=u.type[6];if(m==='D')t.write(u.local.name,u),o++;else if(m==='N')t.write('* as '+u.local.name,u),o++;else break}if(o<n){for(t.write('{');;){const u=r[o],{ name:m }=u.imported;if(t.write(m,u),m!==u.local.name&&t.write(' as '+u.local.name),++o<n)t.write(', ');else break}t.write('}')}t.write(' from ')}if(this.Literal(e.source,t),i&&i.length>0){t.write(' with { ');for(let u=0;u<i.length;u++)this.ImportAttribute(i[u],t),u<i.length-1&&t.write(', ');t.write(' }')}t.write(';')},ImportAttribute (e,t){this.Identifier(e.key,t),t.write(': '),this.Literal(e.value,t)},ImportExpression (e,t){t.write('import('),this[e.source.type](e.source,t),t.write(')')},ExportDefaultDeclaration (e,t){t.write('export default '),this[e.declaration.type](e.declaration,t),t.expressionsPrecedence[e.declaration.type]!=null&&e.declaration.type[0]!=='F'&&t.write(';')},ExportNamedDeclaration (e,t){if(t.write('export '),e.declaration)this[e.declaration.type](e.declaration,t);else{t.write('{');const{ specifiers:r }=e,{ length:i }=r;if(i>0)for(let n=0;;){const o=r[n],{ name:u }=o.local;if(t.write(u,o),u!==o.exported.name&&t.write(' as '+o.exported.name),++n<i)t.write(', ');else break}if(t.write('}'),e.source&&(t.write(' from '),this.Literal(e.source,t)),e.attributes&&e.attributes.length>0){t.write(' with { ');for(let n=0;n<e.attributes.length;n++)this.ImportAttribute(e.attributes[n],t),n<e.attributes.length-1&&t.write(', ');t.write(' }')}t.write(';')}},ExportAllDeclaration (e,t){if(e.exported!=null?t.write('export * as '+e.exported.name+' from '):t.write('export * from '),this.Literal(e.source,t),e.attributes&&e.attributes.length>0){t.write(' with { ');for(let r=0;r<e.attributes.length;r++)this.ImportAttribute(e.attributes[r],t),r<e.attributes.length-1&&t.write(', ');t.write(' }')}t.write(';')},MethodDefinition (e,t){e.static&&t.write('static ');const r=e.kind[0];(r==='g'||r==='s')&&t.write(e.kind+' '),e.value.async&&t.write('async '),e.value.generator&&t.write('*'),e.computed?(t.write('['),this[e.key.type](e.key,t),t.write(']')):this[e.key.type](e.key,t),mi(t,e.value.params),t.write(' '),this[e.value.body.type](e.value.body,t)},ClassExpression (e,t){this.ClassDeclaration(e,t)},ArrowFunctionExpression (e,t){t.write(e.async?'async ':'',e);const{ params:r }=e;r!=null&&(r.length===1&&r[0].type[0]==='I'?t.write(r[0].name,r[0]):mi(t,e.params)),t.write(' => '),e.body.type[0]==='O'?(t.write('('),this.ObjectExpression(e.body,t),t.write(')')):this[e.body.type](e.body,t)},ThisExpression (e,t){t.write('this',e)},Super (e,t){t.write('super',e)},RestElement:tl=function (e,t){t.write('...'),this[e.argument.type](e.argument,t)},SpreadElement:tl,YieldExpression (e,t){t.write(e.delegate?'yield*':'yield'),e.argument&&(t.write(' '),this[e.argument.type](e.argument,t))},AwaitExpression (e,t){t.write('await ',e),Nn(t,e.argument,e)},TemplateLiteral (e,t){const{ quasis:r,expressions:i }=e;t.write('`');const{ length:n }=i;for(let u=0;u<n;u++){const m=i[u],_=r[u];t.write(_.value.raw,_),t.write('${'),this[m.type](m,t),t.write('}')}const o=r[r.length-1];t.write(o.value.raw,o),t.write('`')},TemplateElement (e,t){t.write(e.value.raw,e)},TaggedTemplateExpression (e,t){Nn(t,e.tag,e),this[e.quasi.type](e.quasi,t)},ArrayExpression:il=function (e,t){if(t.write('['),e.elements.length>0){const{ elements:r }=e,{ length:i }=r;for(let n=0;;){const o=r[n];if(o!=null&&this[o.type](o,t),++n<i)t.write(', ');else{o==null&&t.write(', ');break}}}t.write(']')},ArrayPattern:il,ObjectExpression (e,t){const r=t.indent.repeat(t.indentLevel++),{ lineEnd:i,writeComments:n }=t,o=r+t.indent;if(t.write('{'),e.properties.length>0){t.write(i),n&&e.comments!=null&&Nt(t,e.comments,o,i);const u=','+i,{ properties:m }=e,{ length:_ }=m;for(let P=0;;){const k=m[P];if(n&&k.comments!=null&&Nt(t,k.comments,o,i),t.write(o),this[k.type](k,t),++P<_)t.write(u);else break}t.write(i),n&&e.trailingComments!=null&&Nt(t,e.trailingComments,o,i),t.write(r+'}')}else n?e.comments!=null?(t.write(i),Nt(t,e.comments,o,i),e.trailingComments!=null&&Nt(t,e.trailingComments,o,i),t.write(r+'}')):e.trailingComments!=null?(t.write(i),Nt(t,e.trailingComments,o,i),t.write(r+'}')):t.write('}'):t.write('}');t.indentLevel--},Property (e,t){e.method||e.kind[0]!=='i'?this.MethodDefinition(e,t):(e.shorthand||(e.computed?(t.write('['),this[e.key.type](e.key,t),t.write(']')):this[e.key.type](e.key,t),t.write(': ')),this[e.value.type](e.value,t))},PropertyDefinition (e,t){if(e.static&&t.write('static '),e.computed&&t.write('['),this[e.key.type](e.key,t),e.computed&&t.write(']'),e.value==null){e.key.type[0]!=='F'&&t.write(';');return}t.write(' = '),this[e.value.type](e.value,t),t.write(';')},ObjectPattern (e,t){if(t.write('{'),e.properties.length>0){const{ properties:r }=e,{ length:i }=r;for(let n=0;this[r[n].type](r[n],t),++n<i;)t.write(', ')}t.write('}')},SequenceExpression (e,t){mi(t,e.expressions)},UnaryExpression (e,t){if(e.prefix){const{ operator:r,argument:i,argument:{ type:n } }=e;t.write(r);const o=Zl(t,i,e);!o&&(r.length>1||n[0]==='U'&&(n[1]==='n'||n[1]==='p')&&i.prefix&&i.operator[0]===r&&(r==='+'||r==='-'))&&t.write(' '),o?(t.write(r.length>1?' (':'('),this[n](i,t),t.write(')')):this[n](i,t)}else this[e.argument.type](e.argument,t),t.write(e.operator)},UpdateExpression (e,t){e.prefix?(t.write(e.operator),this[e.argument.type](e.argument,t)):(this[e.argument.type](e.argument,t),t.write(e.operator))},AssignmentExpression (e,t){this[e.left.type](e.left,t),t.write(' '+e.operator+' '),this[e.right.type](e.right,t)},AssignmentPattern (e,t){this[e.left.type](e.left,t),t.write(' = '),this[e.right.type](e.right,t)},BinaryExpression:rl=function (e,t){const r=e.operator==='in';r&&t.write('('),Nn(t,e.left,e,!1),t.write(' '+e.operator+' '),Nn(t,e.right,e,!0),r&&t.write(')')},LogicalExpression:rl,ConditionalExpression (e,t){const{ test:r }=e,i=t.expressionsPrecedence[r.type];i===nr||i<=t.expressionsPrecedence.ConditionalExpression?(t.write('('),this[r.type](r,t),t.write(')')):this[r.type](r,t),t.write(' ? '),this[e.consequent.type](e.consequent,t),t.write(' : '),this[e.alternate.type](e.alternate,t)},NewExpression (e,t){t.write('new ');const r=t.expressionsPrecedence[e.callee.type];r===nr||r<t.expressionsPrecedence.CallExpression||hm(e.callee)?(t.write('('),this[e.callee.type](e.callee,t),t.write(')')):this[e.callee.type](e.callee,t),mi(t,e.arguments)},CallExpression (e,t){const r=t.expressionsPrecedence[e.callee.type];r===nr||r<t.expressionsPrecedence.CallExpression?(t.write('('),this[e.callee.type](e.callee,t),t.write(')')):this[e.callee.type](e.callee,t),e.optional&&t.write('?.'),mi(t,e.arguments)},ChainExpression (e,t){this[e.expression.type](e.expression,t)},MemberExpression (e,t){const r=t.expressionsPrecedence[e.object.type];r===nr||r<t.expressionsPrecedence.MemberExpression?(t.write('('),this[e.object.type](e.object,t),t.write(')')):this[e.object.type](e.object,t),e.computed?(e.optional&&t.write('?.'),t.write('['),this[e.property.type](e.property,t),t.write(']')):(e.optional?t.write('?.'):t.write('.'),this[e.property.type](e.property,t))},MetaProperty (e,t){t.write(e.meta.name+'.'+e.property.name,e)},Identifier (e,t){t.write(e.name,e)},PrivateIdentifier (e,t){t.write(`#${e.name}`,e)},Literal (e,t){e.raw!=null?t.write(e.raw,e):e.regex!=null?this.RegExpLiteral(e,t):e.bigint!=null?t.write(e.bigint+'n',e):t.write(lm(e.value),e)},RegExpLiteral (e,t){const{ regex:r }=e;t.write(`/${r.pattern}/${r.flags}`,e)} },dm={};class mm{constructor (t){const r=t??dm;this.output='',r.output!=null?(this.output=r.output,this.write=this.writeToStream):this.output='',this.generator=r.generator!=null?r.generator:pm,this.expressionsPrecedence=r.expressionsPrecedence!=null?r.expressionsPrecedence:fm,this.indent=r.indent!=null?r.indent:'  ',this.lineEnd=r.lineEnd!=null?r.lineEnd:`
`,this.indentLevel=r.startingIndentLevel!=null?r.startingIndentLevel:0,this.writeComments=r.comments?r.comments:!1,r.sourceMap!=null&&(this.write=r.output==null?this.writeAndMap:this.writeToStreamAndMap,this.sourceMap=r.sourceMap,this.line=1,this.column=0,this.lineEndSize=this.lineEnd.split(`
`).length-1,this.mapping={ original:null,generated:this,name:void 0,source:r.sourceMap.file||r.sourceMap._file })}write (t){this.output+=t}writeToStream (t){this.output.write(t)}writeAndMap (t,r){this.output+=t,this.map(t,r)}writeToStreamAndMap (t,r){this.output.write(t),this.map(t,r)}map (t,r){if(r!=null){const{ type:o }=r;if(o[0]==='L'&&o[2]==='n'){this.column=0,this.line++;return}if(r.loc!=null){const{ mapping:u }=this;u.original=r.loc.start,u.name=r.name,this.sourceMap.addMapping(u)}if(o[0]==='T'&&o[8]==='E'||o[0]==='L'&&o[1]==='i'&&typeof r.value=='string'){const{ length:u }=t;let{ column:m,line:_ }=this;for(let P=0;P<u;P++)t[P]===`
`?(m=0,_++):m++;this.column=m,this.line=_;return}}const{ length:i }=t,{ lineEnd:n }=this;i>0&&(this.lineEndSize>0&&(n.length===1?t[i-1]===n:t.endsWith(n))?(this.line+=this.lineEndSize,this.column=0):this.column+=i)}toString (){return this.output}}function vm (e,t){const r=new mm(t);return r.generator[e.type](e,r),r.output}let Fn={},Bn={},al;function Jl (){return al||(al=1,function (e){(function (t,r){r(e)})(Bn,function (t){t.__esModule=!0;function r (k,y){if(!(k instanceof y))throw new TypeError('Cannot call a class as a function')}let i=void 0,n=void 0,o=void 0,u=void 0,m=void 0,_=Function.prototype,P=function k (y,T){r(this,k),this.node=y,this.state=T};t.default={ go (y,T){this[y.type](y,T)},find (y,T,ie){const Ae=Object.create(this);Ae.go=function (Q,Je){if(y(Q,Je))throw new P(Q,Je);this[Q.type](Q,Je)};try{Ae.go(T,ie)}catch(Q){if(Q instanceof P)return Q;throw Q}},makeChild (){const y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},T=Object.create(this);T.super=this;for(const ie in y)T[ie]=y[ie];return T},Program (y,T){for(let ie=y.body,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},BlockStatement (y,T){const ie=y.body;if(ie!=null)for(let Ae=0,Q=ie.length;Ae<Q;Ae++)this.go(ie[Ae],T)},EmptyStatement:_,ExpressionStatement (y,T){this.go(y.expression,T)},IfStatement (y,T){this.go(y.test,T),this.go(y.consequent,T),y.alternate!=null&&this.go(y.alternate,T)},LabeledStatement (y,T){this.go(y.label,T),this.go(y.body,T)},BreakStatement (y,T){y.label&&this.go(y.label,T)},ContinueStatement (y,T){y.label&&this.go(y.label,T)},WithStatement (y,T){this.go(y.object,T),this.go(y.body,T)},SwitchStatement (y,T){this.go(y.discriminant,T);for(let ie=y.cases,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},SwitchCase (y,T){y.test!=null&&this.go(y.test,T);for(let ie=y.consequent,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},ReturnStatement (y,T){y.argument&&this.go(y.argument,T)},ThrowStatement (y,T){this.go(y.argument,T)},TryStatement (y,T){this.go(y.block,T),y.handler!=null&&this.go(y.handler,T),y.finalizer!=null&&this.go(y.finalizer,T)},CatchClause (y,T){y.param!=null&&this.go(y.param,T),this.go(y.body,T)},WhileStatement (y,T){this.go(y.test,T),this.go(y.body,T)},DoWhileStatement (y,T){this.go(y.body,T),this.go(y.test,T)},ForStatement (y,T){y.init!=null&&this.go(y.init,T),y.test!=null&&this.go(y.test,T),y.update!=null&&this.go(y.update,T),this.go(y.body,T)},ForInStatement:i=function (y,T){this.go(y.left,T),this.go(y.right,T),this.go(y.body,T)},DebuggerStatement:_,FunctionDeclaration:n=function (y,T){y.id!=null&&this.go(y.id,T);const ie=y.params;if(ie!=null)for(let Ae=0,Q=ie.length;Ae<Q;Ae++)this.go(ie[Ae],T);this.go(y.body,T)},VariableDeclaration (y,T){for(let ie=y.declarations,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},VariableDeclarator (y,T){this.go(y.id,T),y.init!=null&&this.go(y.init,T)},ArrowFunctionExpression (y,T){const ie=y.params;if(ie!=null)for(let Ae=0,Q=ie.length;Ae<Q;Ae++)this.go(ie[Ae],T);this.go(y.body,T)},ThisExpression:_,ArrayExpression:m=function (y,T){for(let ie=y.elements,Ae=ie.length,Q=0;Q<Ae;Q++){const Je=ie[Q];Je!=null&&this.go(ie[Q],T)}},ObjectExpression (y,T){for(let ie=y.properties,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},Property (y,T){this.go(y.key,T),y.shorthand||this.go(y.value,T)},FunctionExpression:n,SequenceExpression (y,T){for(let ie=y.expressions,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},UnaryExpression (y,T){this.go(y.argument,T)},UpdateExpression (y,T){this.go(y.argument,T)},AssignmentExpression (y,T){this.go(y.left,T),this.go(y.right,T)},BinaryExpression:u=function (y,T){this.go(y.left,T),this.go(y.right,T)},LogicalExpression:u,ConditionalExpression (y,T){this.go(y.test,T),this.go(y.consequent,T),this.go(y.alternate,T)},NewExpression (y,T){this.CallExpression(y,T)},CallExpression (y,T){this.go(y.callee,T);for(let ie=y.arguments,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},MemberExpression (y,T){this.go(y.object,T),this.go(y.property,T)},Identifier:_,Literal:_,ForOfStatement:i,ClassDeclaration (y,T){y.id&&this.go(y.id,T),y.superClass&&this.go(y.superClass,T),this.go(y.body,T)},ClassBody (y,T){for(let ie=y.body,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},ImportDeclaration (y,T){for(let ie=y.specifiers,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T);this.go(y.source,T)},ImportNamespaceSpecifier (y,T){this.go(y.local,T)},ImportDefaultSpecifier (y,T){this.go(y.local,T)},ImportSpecifier (y,T){this.go(y.imported,T),this.go(y.local,T)},ExportDefaultDeclaration (y,T){this.go(y.declaration,T)},ExportNamedDeclaration (y,T){y.declaration&&this.go(y.declaration,T);for(let ie=y.specifiers,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T);y.source&&this.go(y.source,T)},ExportSpecifier (y,T){this.go(y.local,T),this.go(y.exported,T)},ExportAllDeclaration (y,T){this.go(y.source,T)},MethodDefinition (y,T){this.go(y.key,T),this.go(y.value,T)},ClassExpression (y,T){this.ClassDeclaration(y,T)},Super:_,RestElement:o=function (y,T){this.go(y.argument,T)},SpreadElement:o,YieldExpression (y,T){y.argument&&this.go(y.argument,T)},TaggedTemplateExpression (y,T){this.go(y.tag,T),this.go(y.quasi,T)},TemplateLiteral (y,T){for(var ie=y.quasis,Ae=y.expressions,Q=0,Je=Ae.length;Q<Je;Q++)this.go(Ae[Q],T);for(let it=0,ze=ie.length;it<ze;it++)this.go(ie[it],T)},TemplateElement:_,ObjectPattern (y,T){for(let ie=y.properties,Ae=ie.length,Q=0;Q<Ae;Q++)this.go(ie[Q],T)},ArrayPattern:m,AssignmentPattern (y,T){this.go(y.left,T),this.go(y.right,T)},MetaProperty (y,T){this.go(y.meta,T),this.go(y.property,T)},AwaitExpression (y,T){this.go(y.argument,T)} }})}(Bn)),Bn}let Mn={},sl;function gm (){return sl||(sl=1,function (e){(function (t,r){r(e,Jl())})(Mn,function (t,r){t.__esModule=!0,t.default=function (_,P){return m[_.type](_,{ comments:P,index:0 }),_};const i=n(r);function n (_){return _&&_.__esModule?_:{ default:_ }}function o (_,P,k,y,T){let ie=y.index,Ae=y.comments,Q=Ae[ie],Je=void 0,it=void 0;if(Q!=null)if(P==null||P.length===0){for(Je=_.comments!=null?_.comments:[];Q!=null&&Q.end<_.end;)Je.push(Q),Q=Ae[++ie];y.index=ie,Je.length!==0&&_.comments==null&&(_.comments=Je)}else{if(k){Je=_.comments!=null?_.comments:[];for(let ze=P[0].start;Q!=null&&Q.type[0]==='B'&&Q.end<ze;)Je.push(Q),Q=Ae[++ie];Je.length!==0&&_.comments==null&&(_.comments=Je)}for(let ot=0,pr=P.length;Q!=null&&ot<pr;ot++){const wt=P[ot];for(Je=[];Q!=null&&Q.end<wt.start;)Je.push(Q),Q=Ae[++ie];Q!=null&&Q.type[0]==='L'&&Q.loc.start.line===wt.loc.end.line&&(Je.push(Q),Q=Ae[++ie]),Je.length!==0&&(wt.comments=Je),y.index=ie,T[wt.type](wt,y),ie=y.index,Q=Ae[ie]}for(it=[];Q!=null&&Q.end<_.end;)it.push(Q),Q=Ae[++ie];it.length!==0&&(_.trailingComments=it),y.index=ie}}var u=void 0,m=i.default.makeChild({ Program:u=function (P,k){o(P,P.body,!0,k,this)},BlockStatement:u,ObjectExpression (P,k){o(P,P.properties,!0,k,this)},ArrayExpression (P,k){o(P,P.elements,!0,k,this)},SwitchStatement (P,k){o(P,P.cases,!1,k,this)},SwitchCase (P,k){o(P,P.consequent,!1,k,this)} })})}(Mn)),Mn}let ol;function ym (){return ol||(ol=1,function (e){(function (t,r){r(e,Jl(),gm())})(Fn,function (t,r,i){t.__esModule=!0,t.makeTraveler=t.attachComments=t.defaultTraveler=void 0;const n=u(r),o=u(i);function u (_){return _&&_.__esModule?_:{ default:_ }}function m (_){return n.default.makeChild(_)}t.defaultTraveler=n.default,t.attachComments=o.default,t.makeTraveler=m})}(Fn)),Fn}const bm=ym();const xm=['time','fps'],_m=new Set(xm);function wm (e,t){const r=e.replace(/[\u200B-\u200D\uFEFF]/g,''),i=`async function* f() {
`+r+`
}`,n=bm.makeTraveler({ go (P,k){P.type==='Identifier'&&_m.has(P.name)&&k.refTab.push(P),this.super.go.call(this,P,k)} });const o=[];let u;try{u=Tt.parse(i,{ locations:!1,ecmaVersion:'latest',allowReserved:!0,allowAwaitOutsideFunction:!0,onComment:o })}catch(P){return console.log('Deglobalize err: '+P),console.log(r),r}const m={ refTab:[] };if(n.go(u,m),m.refTab.length===0)return r;for(let P=0;P<m.refTab.length;++P){const k=m.refTab[P],y=k.name;k.name=t+'.'+y}const _=vm(u);return Sm(_)}function Sm (e){const t=e.indexOf('{'),r=e.lastIndexOf('}');return t===-1||r===-1?e:e.substring(t+1,r)}class Em{constructor (t){this.webWorker=t,this.fft=[],this.opened=!1}async tick (){this.opened||(this.webWorker.openAudioProxy(),this.opened=!0)}setCutoff (t){this.cutoff=t,this.settings=this.settings.map(r=>(r.cutoff=t,r))}setSmooth (t){this.webWorker.setAudioValue('setSmooth',t)}setBins (t){this.numBins=t,this.fft=new Array(t),this.webWorker.setAudioValue('setBins',t)}setScale (t){this.webWorker.setAudioValue('setScale',t)}setMax (t){this.webWorker.setAudioValue('setMax',t)}hide (){this.webWorker.setAudioValue('hide',0)}show (){this.webWorker.setAudioValue('show',1)}}const Am=(function*(){}).constructor;let ws;typeof self<'u'&&self.constructor&&self.constructor.name==='DedicatedWorkerGlobalScope'?(ws={ x:0,y:0 },console.log('Running as a web worker')):(ws=jp(),console.log('Not running as a web worker'));class Tm{constructor ({ pb:t=null,width:r=1280,height:i=720,numSources:n=4,numOutputs:o=4,makeGlobal:u=!0,autoLoop:m=!0,detectAudio:_=!0,enableStreamCapture:P=!0,useWGSL:k=!1,webWorker:y,canvas:T,precision:ie,regen:Ae=!1,resetOut:Q=!0,extendTransforms:Je={} }={}){if(ml.init(),this.pb=t,this.width=r,this.height=i,this.renderAll=!1,this.detectAudio=_,this.useWGSL=k,this.useWGSL&&console.log('Creating HydraRenderer with WGSL and WebGPU.'),this.webWorker=y,this.wgslReady=!1,this.useRAF=!1,this._initCanvas(T),this.synth={ time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{ fps:0 },speed:1,mouse:ws,render:this._render.bind(this),_destroy:this._destroy.bind(this),setResolution:this.setResolution.bind(this),update:ze=>{},hush:this.hush.bind(this),tick:this.tick.bind(this) },u&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,ie&&['lowp','mediump','highp'].includes(ie.toLowerCase()))this.precision=ie.toLowerCase();else{const ze=(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==='MacIntel'&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=ze?'highp':'mediump'}if(this.extendTransforms=Je,this.saveFrame=!1,this.captureStream=null,this.generatorFunction=void 0,this.generatorFunctionTimer=-1,this.numOutputs=o,this.regen=Ae,this.regenInfo=new Array(o),this.resetOut=Q,this.useWGSL)this.wgslHydra=new _d(this,this.canvas,4),this.wgslPromise=new Promise((ze,ot)=>{this._initOutputsWgsl(o),this.wgslHydra.setupHydra().then(()=>{this._initSources(n),this._generateGlslTransforms(),this.sandbox=new us(this.synth,u,['speed','update','bpm','fps']),m&&(this.useRAF=!1,this.looper=zu(this.tick.bind(this)).start()),ze(!0)})});else if(this._initRegl(),this._initOutputs(o),this._initSources(n),this._generateGlslTransforms(),this.sandbox=new us(this.synth,u,['speed','update','bpm','fps']),this.synth.screencap=()=>{this.saveFrame=!0},P)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new Xp(this.captureStream)}catch(ze){console.warn(`[hydra-synth warning]
new MediaSource() is not currently supported on iOS.`),console.error(ze)}_&&this._initAudio(),!this.useWGSL&&(m&&(this.looper=zu(this.tick.bind(this)).start()),this.sandbox=new us(this.synth,u,['speed','update','bpm','fps']))}async eval (t){this.resetOut&&this.synth.render(this.o[0]);const r=wm(t,'_h'),i=this.synth,n=Object.keys(i),o=[];for(let u=0;u<n.length;++u)o.push(i[n[u]]);n.push('h'),o.push(i),n.push('_h'),o.push(i);try{const u=new Am(...n,r);this.done=!1,this.generatorFunction=u(...o)}catch(u){console.log('Error compiling generator function'),console.log(u),this.generatorFunctionTimer=-1;return}this.generatorFunctionTimer=-1;try{const u=this.generatorFunction.next();this.planNext(u)}catch(u){console.log('Error calling initial generator function.next()'),console.log(u),delete this.generatorFunction;return}}generatorTick (){if(!this.generatorFunction||this.generatorFunctionTimer===-1||this.synth.time<this.generatorFunctionTimer)return;const t=this.generatorFunction;if(!t)this.generatorFunctionTimer=-1;else try{const r=t.next();this.planNext(r)}catch(r){console.log('Error calling generator function.next()'),console.log(r),this.generatorFunctionTimer=-1,delete this.generatorFunction}}planNext (t){if(t)if(t.done)this.done=!0,delete this.generatorFunction;else{let r=t.value;r===void 0&&(r=.01),this.generatorFunctionTimer=this.synth.time+r}}getScreenImage (t){this.imageCallback=t,this.saveFrame=!0}_destroy (){this.hush(),this.looper&&(this.looper.stop(),delete this.looper),this.regl&&(this.regl.destroy(),delete this.regl),this.synth&&this.synth.a&&this.synth.a.destroy()}hush (){this.regenInfo=[],this.s.forEach(t=>{t.clear()}),this.o.forEach(t=>{this.synth.solid(0,0,0,0).out(t)}),this.synth.render(this.o[0]),this.sandbox.set('update',t=>{})}loadScript (t=''){return new Promise((i,n)=>{const o=document.createElement('script');o.onload=function (){console.log(`loaded script ${t}`),i()},o.onerror=u=>{console.log(`error loading script ${t}`,'log-error'),i()},o.src=t,document.head.appendChild(o)})}noteRegenString (t,r){this.regenInfo[t]={ str:r,modTime:performance.now() }}activeFromBefore (t){const r=performance.timeOrigin,i=[];for(let n=0;n<this.s.length;++n){const o=this.s[n];o&&o.active&&o.modTime+r<=t&&(i.push(o.setupString()),i.push(`
`))}for(let n=0;n<this.regenInfo.length;++n){const o=this.regenInfo[n];if(o&&o.modTime+r<=t){const u=o.str.replaceAll('_h.','');i.push(u),i.push(`
`)}}return i.join('')}setResolution (t,r){this.canvas.width=t,this.canvas.height=r,this.width=t,this.height=r,this.sandbox.set('width',t),this.sandbox.set('height',r),console.log(this.width),this.o.forEach(i=>{i.resize(t,r)}),this.s.forEach(i=>{i.resize(t,r)}),this.useWGSL?this.wgslHydra.resizeOutputsTo(t,r):this.regl._refresh()}canvasToImage (t){const r=document.createElement('a');r.style.display='none';const i=new Date;r.download=`hydra-${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}-${i.getHours()}.${i.getMinutes()}.${i.getSeconds()}.png`,document.body.appendChild(r);const n=this;this.canvas.toBlob(o=>{n.imageCallback?(n.imageCallback(o),delete n.imageCallback):(r.href=URL.createObjectURL(o),console.log(r.href),r.click())},'image/png'),setTimeout(()=>{document.body.removeChild(r),window.URL.revokeObjectURL(r.href)},300)}_initAudio (){this.webWorker?this.synth.a=new Em(this.webWorker):this.synth.a=new dl({ numBins:4,parentEl:this.canvas.parentNode })}_initCanvas (t){t&&(this.canvas=t,this.width=t.width,this.height=t.height)}_initRegl (){this.regl=gd({ canvas:this.canvas,pixelRatio:1 }),this.regl.clear({ color:[0,0,0,1] }),this.renderAll=this.regl({ frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform sampler2D tex0;
      uniform sampler2D tex1;
      uniform sampler2D tex2;
      uniform sampler2D tex3;

      void main () {
        vec2 st = vec2(1.0 - uv.x, uv.y);
        st*= vec2(2);
        vec2 q = floor(st).xy*(vec2(2.0, 1.0));
        int quad = int(q.x) + int(q.y);
        st.x += step(1., mod(st.y,2.0));
        st.y += step(1., mod(st.x,2.0));
        st = fract(st);
        if(quad==0){
          gl_FragColor = texture2D(tex0, st);
        } else if(quad==1){
          gl_FragColor = texture2D(tex1, st);
        } else if (quad==2){
          gl_FragColor = texture2D(tex2, st);
        } else {
          gl_FragColor = texture2D(tex3, st);
        }

      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{ position:[[-2,0],[0,-2],[2,2]] },uniforms:{ tex0:this.regl.prop('tex0'),tex1:this.regl.prop('tex1'),tex2:this.regl.prop('tex2'),tex3:this.regl.prop('tex3') },count:3,depth:{ enable:!1 } }),this.renderFbo=this.regl({ frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform vec2 resolution;
      uniform sampler2D tex0;

      void main () {
        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));
      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{ position:[[-2,0],[0,-2],[2,2]] },uniforms:{ tex0:this.regl.prop('tex0'),resolution:this.regl.prop('resolution') },count:3,depth:{ enable:!1 } })}_initOutputs (t){const r=this;this.o=Array(t).fill().map((i,n)=>{const o=new Fr({ regl:this.regl,chanNum:n,hydraSynth:this,width:this.width,height:this.height,precision:this.precision,label:`o${n}` });return o.id=n,r.synth['o'+n]=o,o}),this.output=this.o[0]}_initOutputsWgsl (t){const r=this;this.o=Array(t).fill().map((i,n)=>{const o=new ll({ wgslHydra:this.wgslHydra,hydraSynth:this,width:this.width,height:this.height,chanNum:n,label:`o${n}` });return o.id=n,r.synth['o'+n]=o,o}),this.output=this.o[0]}_initSources (t){this.s=[];for(let r=0;r<t;r++)this.createSource(r)}createSource (t){const r=new pl({ regl:this.regl,hydraSynth:this,wgsl:this.wgslHydra,webWorker:this.webWorker,pb:this.pb,width:this.width,height:this.height,chanNum:t,label:`s${t}` });return this.synth['s'+this.s.length]=r,this.s.push(r),r}_generateGlslTransforms (){const t=this;this.generator=new ud({ genWGSL:this.useWGSL,defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener:({ type:r,method:i,synth:n })=>{r==='add'&&(t.synth[i]=n.generators[i],t.sandbox&&t.sandbox.add(i))} }),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render (t){t?(this.output=t,this.isRenderingAll=!1,this.wgslHydra&&(this.wgslHydra.showQuad=!1,t.chanNum<this.numOutputs&&(this.wgslHydra.outChannel=t.chanNum))):(this.isRenderingAll=!0,this.wgslHydra&&(this.wgslHydra.showQuad=!0))}tick (t){if(this.sandbox){if(this.sandbox.tick(),this.detectAudio&&this.synth&&this.synth.a&&this.synth.a.tick&&this.synth.a.tick(),this.sandbox.set('time',this.synth.time+=t*.001*this.synth.speed),this.timeSinceLastUpdate+=t,this.generatorTick(),!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps)if(this.useWGSL){for(let r=0;r<this.s.length;r++)this.s[r].tick(this.synth.time);this.wgslHydra.relayUniformInfo(this.synth.mouse),this.wgslHydra.animate(t)}else{if(this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate),this.synth.update)try{this.synth.update(this.timeSinceLastUpdate)}catch(r){console.log(r)}for(let r=0;r<this.s.length;r++)this.s[r].tick(this.synth.time);for(let r=0;r<this.o.length;r++)this.o[r].tick({ time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height] });this.isRenderingAll?this.renderAll({ tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height] }):this.renderFbo({ tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height] }),this.timeSinceLastUpdate=0}this.saveFrame===!0&&(this.canvasToImage(),this.saveFrame=!1)}}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ef=Symbol('Comlink.proxy'),Cm=Symbol('Comlink.endpoint'),km=Symbol('Comlink.releaseProxy'),ds=Symbol('Comlink.finalizer'),Un=Symbol('Comlink.thrown'),tf=e=>typeof e=='object'&&e!==null||typeof e=='function',Lm={ canHandle:e=>tf(e)&&e[ef],serialize (e){const{ port1:t,port2:r }=new MessageChannel;return nf(e,t),[r,[r]]},deserialize (e){return e.start(),Ps(e)} },Im={ canHandle:e=>tf(e)&&Un in e,serialize ({ value:e }){let t;return e instanceof Error?t={ isError:!0,value:{ message:e.message,name:e.name,stack:e.stack } }:t={ isError:!1,value:e },[t,[]]},deserialize (e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value} },rf=new Map([['proxy',Lm],['throw',Im]]);function Rm (e,t){for(const r of e)if(t===r||r==='*'||r instanceof RegExp&&r.test(t))return!0;return!1}function nf (e,t=globalThis,r=['*']){t.addEventListener('message',function i (n){if(!n||!n.data)return;if(!Rm(r,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{ id:o,type:u,path:m }=Object.assign({ path:[] },n.data),_=(n.data.argumentList||[]).map(Yr);let P;try{const k=m.slice(0,-1).reduce((T,ie)=>T[ie],e),y=m.reduce((T,ie)=>T[ie],e);switch(u){case'GET':P=y;break;case'SET':k[m.slice(-1)[0]]=Yr(n.data.value),P=!0;break;case'APPLY':P=y.apply(k,_);break;case'CONSTRUCT':{const T=new y(..._);P=Xi(T)}break;case'ENDPOINT':{const{ port1:T,port2:ie }=new MessageChannel;nf(e,ie),P=Os(T,[T])}break;case'RELEASE':P=void 0;break;default:return}}catch(k){P={ value:k,[Un]:0 }}Promise.resolve(P).catch(k=>({ value:k,[Un]:0 })).then(k=>{const[y,T]=Yn(k);t.postMessage(Object.assign(Object.assign({},y),{ id:o }),T),u==='RELEASE'&&(t.removeEventListener('message',i),af(t),ds in e&&typeof e[ds]=='function'&&e[ds]())}).catch(k=>{const[y,T]=Yn({ value:new TypeError('Unserializable return value'),[Un]:0 });t.postMessage(Object.assign(Object.assign({},y),{ id:o }),T)})}),t.start&&t.start()}function Pm (e){return e.constructor.name==='MessagePort'}function af (e){Pm(e)&&e.close()}function Ps (e,t){const r=new Map;return e.addEventListener('message',function (n){const{ data:o }=n;if(!o||!o.id)return;const u=r.get(o.id);if(u)try{u(o)}finally{r.delete(o.id)}}),Ss(e,r,[],t)}function Dn (e){if(e)throw new Error('Proxy has been released and is not useable')}function sf (e){return vi(e,new Map,{ type:'RELEASE' }).then(()=>{af(e)})}const $n=new WeakMap,Xn='FinalizationRegistry'in globalThis&&new FinalizationRegistry(e=>{const t=($n.get(e)||0)-1;$n.set(e,t),t===0&&sf(e)});function Om (e,t){const r=($n.get(t)||0)+1;$n.set(t,r),Xn&&Xn.register(e,t,e)}function Nm (e){Xn&&Xn.unregister(e)}function Ss (e,t,r=[],i=function (){}){let n=!1;const o=new Proxy(i,{ get (u,m){if(Dn(n),m===km)return()=>{Nm(o),sf(e),t.clear(),n=!0};if(m==='then'){if(r.length===0)return{ then:()=>o };const _=vi(e,t,{ type:'GET',path:r.map(P=>P.toString()) }).then(Yr);return _.then.bind(_)}return Ss(e,t,[...r,m])},set (u,m,_){Dn(n);const[P,k]=Yn(_);return vi(e,t,{ type:'SET',path:[...r,m].map(y=>y.toString()),value:P },k).then(Yr)},apply (u,m,_){Dn(n);const P=r[r.length-1];if(P===Cm)return vi(e,t,{ type:'ENDPOINT' }).then(Yr);if(P==='bind')return Ss(e,t,r.slice(0,-1));const[k,y]=ul(_);return vi(e,t,{ type:'APPLY',path:r.map(T=>T.toString()),argumentList:k },y).then(Yr)},construct (u,m){Dn(n);const[_,P]=ul(m);return vi(e,t,{ type:'CONSTRUCT',path:r.map(k=>k.toString()),argumentList:_ },P).then(Yr)} });return Om(o,e),o}function Fm (e){return Array.prototype.concat.apply([],e)}function ul (e){const t=e.map(Yn);return[t.map(r=>r[0]),Fm(t.map(r=>r[1]))]}const of=new WeakMap;function Os (e,t){return of.set(e,t),e}function Xi (e){return Object.assign(e,{ [ef]:!0 })}function Yn (e){for(const[t,r]of rf)if(r.canHandle(e)){const[i,n]=r.serialize(e);return[{ type:'HANDLER',name:t,value:i },n]}return[{ type:'RAW',value:e },of.get(e)||[]]}function Yr (e){switch(e.type){case'HANDLER':return rf.get(e.name).deserialize(e.value);case'RAW':return e.value}}function vi (e,t,r,i){return new Promise(n=>{const o=Bm();t.set(o,n),e.start&&e.start(),e.postMessage(Object.assign({ id:o },r),i)})}function Bm (){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join('-')}let ms;class Mm{constructor (t,r,i,n,o){this.kind=t,this.bgWorker=r,this.sourceX=i,this.mediaAddr=n,this.params=o,this.open=!1,this.updates=0,this.openSource()}openSource (){const t=this;if(this.kind==='webcam')cl(this.mediaAddr).then(r=>{t.src=r.video,t.dynamic=!0,t.offCan=new OffscreenCanvas(640,480),t.offCTX=t.offCan.getContext('2d'),t.open=!0}).catch(r=>console.log('could not get camera',r));else if(this.kind==='video'){const r=document.createElement('video');r.crossOrigin='anonymous',r.autoplay=!0,r.loop=!0,r.muted=!0,r.addEventListener('loadeddata',()=>{t.src=r,r.play(),t.offCan=new OffscreenCanvas(r.videoWidth,r.videoHeight),t.offCTX=t.offCan.getContext('2d'),t.dynamic=!0,t.open=!0}),r.src=this.mediaAddr}else if(this.kind==='image'){const r=document.createElement('img');r.crossOrigin='anonymous',r.src=this.mediaAddr,r.onload=()=>{t.src=r,t.dynamic=!1,t.offCan=new OffscreenCanvas(r.width,r.height),t.offCTX=t.offCan.getContext('2d'),t.dynamic=!1,t.open=!0}}else this.kind==='screen'&&hl().then(function (r){t.src=r.video,t.offCan=new OffscreenCanvas(vid.videoWidth,vid.videoHeight),t.offCTX=t.offCan.getContext('2d'),t.dynamic=!0,t.open=!0}).catch(r=>console.log('could not get screen',r))}sendFrame (){if(!this.open||!this.dynamic&&this.updates>0)return;this.offCTX.drawImage(this.src,0,0,this.offCan.width,this.offCan.height);const t=this.offCan.transferToImageBitmap();this.bgWorker.proxyFrameUpdate(this.sourceX,Os(t,[t])),this.updates++}}class Km{constructor (t,r=!1,i=!1,n=!1){this.useWGSL=!!r,this.frameTime=16,this.canvas=t,this.directToCanvas=i,this.mouseData={ x:0,y:0 },this.deliverFrameCallback,this.useAudio=n,this.trackMouse=this.trackMouse.bind(this),document.addEventListener('mousemove',this.trackMouse),this.activeSourceProxies=[]}destroy (){this.activeSourceProxies=[],this.audioProxy=void 0,this.destroyed=!0,this.bgWorker&&(this.bgWorker.destroy(),this.bgWorker=null)}trackMouse (t){this.mouseData.x=t.clientX,this.mouseData.y=t.clientY}async openWorker (){if(ms||(ms=Ps(new Worker(new URL(''+new URL('/hyg/assets/BGRWorker-4asC00Lv.js',import.meta.url).href,import.meta.url),{ type:'module' }))),this.bgWorker=await new ms(this.useWGSL,this.useAudio),this.directToCanvas){const t=this.canvas;await this.bgWorker.setTransferCanvas(Os(t,[t]))}await this.bgWorker.openHydra(),await this.bgWorker.registerCallback('frame',Xi(this.frameReadyFromWorker.bind(this))),await this.bgWorker.registerCallback('proxy',Xi(this.requestProxySource.bind(this))),await this.bgWorker.registerCallback('setaudio',Xi(this.setAudio.bind(this))),this.directToCanvas||(this.bmr=this.canvas.getContext('bitmaprenderer')),setTimeout(t=>{this.bgWorker.tick(this.frameTime,this.mouseData)},this.frameTime*2)}changeDestinationCanvas (t){this.canvas=t,this.setResolution(canvas.width,canvas.height)}setResolution (t,r){this.bgWorker.setResolution(t,r)}frameReadyFromWorker (t){this.destroyed||(t&&(this.deliverFrameCallback?this.deliverFrameCallback(t):(this.bmr||(this.bmr=this.canvas.getContext('bitmaprenderer')),this.bmr.transferFromImageBitmap(t))),this.tickSourceProxies(),setTimeout(r=>{this.bgWorker&&(this.audioProxy?this.fftData=this.audioProxy.a.fft:this.fftData=[],this.bgWorker.tick(this.frameTime,this.mouseData,this.fftData))},this.frameTime))}requestFrameCallbacks (t){this.deliverFrameCallback=t}async hush (){await this.bgWorker.hush()}async setSketch (t,r){this.activeSourceProxies=[],r&&await this.bgWorker.hush(),this.bgWorker.setSketch(t)}eval (t){return this.setSketch(t,!1)}requestProxySource (t,r,i,n){if(t='audio')this.audioProxy=new Dm(this.bgWorker,this.canvas);else{const o=new Mm(t,this.bgWorker,r,i,n);this.activeSourceProxies.push(o)}}tickSourceProxies (){for(let t=0;t<this.activeSourceProxies.length;++t)this.activeSourceProxies[t].sendFrame();this.audioProxy&&this.audioProxy.tick()}setAudio (t,r){this.audioProxy&&this.audioProxy.setValue(t,r)}}class Dm{constructor (t,r){this.bgWorker=t,this.canvas=r,this.a=new dl({ numBins:4,parentEl:this.canvas.parentNode })}tick (){this.a.tick()}setValue (t,r){t==='setBins'?this.a.setBins(r):t==='setCutoff'?this.a.setCutoff(r):t==='setScale'?this.a.setScale(r):t==='setSmooth'?this.a.setSmooth(r):t==='hide'?this.a.hide():t==='show'?this.a.show():console.log('Undefined audio proxy request: '+t)}}class Gm{constructor (){this.worker=new SharedWorker(new URL(''+new URL('/hyg/assets/MeetupWorker-DzB2kopF.js',import.meta.url).href,import.meta.url),{ type:'module' }),this.broker=Ps(this.worker.port)}async registerCallback (t,r){await this.broker.registerCallback(t,Xi(r))}async register (t,r,i){return this.myKind=t,this.otherKind=r,this.name=await this.broker.assignName(t),await this.registerCallback(this.name,i),this.name}async dropAndNotify (t){console.log(`drop and notify ${this.name} ${this.myKind} ${this.otherKind}`),await this.broker.dropAndNotify(this.name,this.myKind,t?this.otherKind:this.myKind)}async locateTarget (){const t=await this.broker.listForKind(this.otherKind);return t.length>0?(this.targetView=t[t.length-1],console.log('Target found: '+targetView)):console.log('Target not found'),this.targetView}async checkTarget (){const t=await this.broker.listForKind(this.otherKind);return t.length>0&&(this.targetView=t[t.length-1]),this.targetView}async lookForTarget (){if(console.log('lookForTarget'),this.targetView===void 0&&(await this.checkTarget(),this.targetView===void 0)){console.log('Target checking in 1 second.');const t=this;setTimeout(()=>t.lookForTarget(),1e3)}this.targetView===void 0&&console.log('Target undefined')}}async function Qm (e,t,r){const i=new Gm;return await i.register(e,t,r),i}const Vm=['width','height'],Zm=Kn({ __name:'Hydra',props:{ sketch:String,sketchInfo:Object,width:Number,height:Number,reportHydra:Function,evalDone:Function,wgsl:Boolean },setup (e){const t=e,r=vs(),i=vs();Ap(()=>{i.value=r.value,P(),Tp(()=>t.sketch,()=>P())}),Cp(()=>{m(),n._destroy(),n=void 0});let n,o=16.6,u;function m (){u!==void 0&&(clearInterval(u),u=void 0)}function _ (){n&&n.tick(o)}async function P (){if(!i.value)return;const k=t.sketch;n===void 0&&(console.log('New Hydra instance created.'),n=new Tm({ makeGlobal:!1,canvas:i.value,autoLoop:!1,genWGSL:t.wgsl,regen:!0 }),n.wgslPromise&&await n.wgslPromise,t.reportHydra&&t.reportHydra(n,i.value),m(),u=setInterval(_,o)),t.sketchInfo.key&&n.synth.hush();const y=performance.now();await n.eval(k),t.evalDone&&t.evalDone(n,k,y)}return(k,y)=>(wr(),_r(gi,null,[y[0]||(y[0]=Or('br',null,null,-1)),Or('canvas',{ ref_key:'canvasElement',ref:r,width:e.width,height:e.height },null,8,Vm),y[1]||(y[1]=Or('p',null,null,-1))],64))} }),br=Kn({ __name:'IconButton',props:{ icon:String,action:Function },setup (e){const t=e;function r (i){t.action&&t.action(i)}return(i,n)=>(wr(),_r('button',{ class:gs(e.icon),onClick:n[0]||(n[0]=o=>r(o)) },null,2))} });function Um (){return'showOpenFilePicker'in window?window.showOpenFilePicker().then(e=>e[0]):window.chooseFileSystemEntries()}function zm (){if('showSaveFilePicker'in window){const t={ types:[{ description:'Text file',accept:{ 'text/plain':['.txt'] } }] };return window.showSaveFilePicker(t)}const e={ type:'save-file',accepts:[{ description:'Text file',extensions:['txt'],mimeTypes:['text/plain'] }] };return window.chooseFileSystemEntries(e)}function jm (e){return e.text?e.text():Wm(e)}function Wm (e){return new Promise(t=>{const r=new FileReader;r.addEventListener('loadend',i=>{const n=i.srcElement.result;t(n)}),r.readAsText(e)})}async function Hm (e,t){if(e.createWriter){const i=await e.createWriter();await i.write(0,t),await i.close();return}const r=await e.createWritable();await r.write(t),await r.close()}class qm{constructor (t,r){this.playA=[],this.recordA=[],this.playerIndex=-1,this.defaultDuration=2,this.maxDuration=0,this.fastForwardDuration=15,this.realTimePlayback=!1,this.updateText=t,r?this.statusObj=r:this.statusObj={},this.blastOffTime=Date.now(),this.boundTimerHandler=this.timerHandler.bind(this),this.updateCountDownClock=this.updateCountDownClock.bind(this)}pushSketch (t){const r={ timeStamp:Date.now(),sketch:t };this.recordA.push(r),this.statusObj.hasrecord=!0}evalDone (t,r,i){const n=[],o=t.activeFromBefore(i+performance.timeOrigin);o!==''&&(n.push(`/*
`),n.push(o),n.push(`*/
`)),n.push(r);const u=n.join('');this.pushSketch(u)}doClear (t){this.recordA=[],this.statusObj.hasrecord=!1}doFileImport (){this.openFile()}doFileExport (t){this.saveFile(t)}doLoad (t){const r=this.recordingToText();this.loadPlayer(r)}doFastBackward (t){this.moveFast(t,-1)}doStepBackward (t){this.moveUp(t)}clearTimer (){this.activeTimer&&(clearTimeout(this.activeTimer),this.activeTimer=null)}startTimer (t){this.clearTimer();const r=t*1e3;this.blastOffTime=Date.now()+r,this.activeTimer=setTimeout(this.boundTimerHandler,r)}timerHandler (t){this.activeTimer=null,this.realTimePlayback&&this.moveDown(t,'play')}updateCountDownClock (){let r=Date.now()-this.blastOffTime;r>0&&(r=0);let i=Math.abs(r),n='',o=Math.trunc(i/1e3).toString(),u=(Math.trunc(i/100)%10).toString();n=(r<0?'-':' ')+o+'.'+u,this.statusObj.countdown=n}startCountdownClock (){this.countDownIntervalObject===void 0&&(this.countDownIntervalObject=setInterval(this.updateCountDownClock,100))}doPlay (t){this.realTimePlayback=!this.realTimePlayback,this.realTimePlayback?(this.statusObj.playing=!0,this.moveDown(t,'play'),this.startCountdownClock(),this.statusObj.playing=!0):(this.clearTimer(),this.statusObj.playing=!1)}doStepForward (t){this.moveDown(t,'step')}doFastForward (t){this.moveFast(t,1)}doMark (t){this.mark()}async saveFile (t){let r;try{r=await zm()}catch(i){if(i.name==='AbortError')return;const n='An error occured trying to open the file.';console.error(n,i),alert(n);return}try{const i=this.recordingToText();await Hm(r,i)}catch(i){const n='Unable to save file.';console.error(n,i),alert(n);return}}async openFile (t){const i=await(await Um()).getFile();const n=await jm(i);this.loadPlayer(n),this.statusObj.filename=i.name}recordingToText (){let t=[],r=this.recordA.length;for(let i=0;i<r;++i){let n=this.recordA[i],o=0;n.timeStamp?(i<r-1&&(o=this.recordA[i+1].timeStamp-n.timeStamp,o<0&&(o=0)),o=o/1e3):n.dur?o=n.dur:o=1,t.push('//+ '+o),n.key&&(t+=' key'),n.mark&&(t+=' mark'),n.timeStamp?t.push(' '+i+' '+new Date(n.timeStamp).toISOString()+`
`):t.push(' '+i+`
`),t.push(n.sketch),t.push(`



`)}return t.join('')}loadPlayer (t){this.playA=[],this.playerIndex=0;const r=t.split(/\r\n|\n/),i=r.length;if(i>0&&r[0].startsWith('{"code":'))return this.loadJSONBase64(r);let n=0,o=[],u=0,m=0,_=!1,P=!1;for(n=0;n<i;++n){const k=r[n];if(k.trim()===''||k.startsWith('----'))u++;else if(k.startsWith('//+')){let y=k.substring(3).trim();y.startsWith('dur=')&&(y=y.substring(4).trim());let T=y.split(' '),ie;P=!1,_=!1,T.length>0&&(ie=Number.parseFloat(T[0]),isNaN(ie)&&(ie=1));for(let Ae=1;Ae<T.length;++Ae){const Q=T[Ae];Q==='key'?P=!0:Q==='mark'&&(_=!0)}ie!==void 0&&ie>=0&&(m=ie)}else{if(u>=3&&o.length>0){const y=o.join(`
`);this.playA.push({ dur:m,mark:_,key:P,sketch:y }),o=[]}u=0,o.push(k),m=0,_=!1}}if(o.length>0){const k=o.join(`
`);this.playA.push({ dur:m,mark:_,key:P,sketch:k })}this.statusObj.hasplay=this.playA.length>0}loadJSONBase64 (t){for(let r=0;r<t.length;++r){let i;try{i=JSON.parse(t[r])}catch(n){console.log('Parse error in loadJSONBase64: '+n)}if(i!==void 0&&i.code!==void 0)try{const n=decodeURIComponent(atob(i.code));n.indexOf('initScreen')<0?this.playA.push({ sketch:n,dur:2 }):console.log('Skipped sketch with initScreen at line '+r)}catch(n){console.log('Error decoding URI Component in loadJSONBase64: '+n)}}this.playerIndex=0,this.statusObj.hasplay=this.playA.length>0}loadAtIndex (t,r){if(this.playA.length===0)return;console.log('Load at X: '+this.playerIndex);const i=this.playA[this.playerIndex];if(!i)return;const n={};if(n.key=i.key===!0,n.mark=i.mark===!0,n.dur=i.dur,this.updateText(i.sketch,n,t,r),this.realTimePlayback){this.clearTimer();let u=i.dur;u<=0&&(u=this.statusObj.defaultDur),this.statusObj.maxDur&&u>this.statusObj.maxDur&&(u=this.statusObj.maxDur),this.startTimer(u)}const o=this.playerIndex.toString();this.statusObj.playerIndex=o}moveUp (t){this.playA.length!==0&&(this.playerIndex--,this.playerIndex<0&&(this.playerIndex=this.playA.length-1),this.loadAtIndex(t,'step'))}moveDown (t,r){this.playA.length!==0&&(this.playerIndex++,this.playerIndex>=this.playA.length&&(this.playerIndex=0),this.loadAtIndex(t,r))}moveFast (t,r){if(this.playA.length===0)return;let i=this.playA.length,n=this.playerIndex;for(;i>0;){this.playerIndex+=r,this.playerIndex<0&&(this.playerIndex=this.playA.length-1),this.playerIndex>=this.playA.length&&(this.playerIndex=0);const u=this.playA[this.playerIndex];if(u.mark!==void 0&&u.mark||u.dur!==void 0&&u.dur>=this.fastForwardDuration){this.loadAtIndex(t,'fast');return}i--}this.playerIndex=n;let o=16;this.playA.length<=o&&(o=4),r<0&&n>0&&o>n?this.playerIndex=0:this.playerIndex+=o*r,this.playerIndex<0?this.playerIndex=this.playA.length-1:this.playerIndex>=this.playA.length&&(this.playerIndex=0),this.loadAtIndex(t,'fast')}mark (t){this.recordA.length!==0&&(this.recordA[this.recordA.length-1].mark=!0)}openSettings (t){this.maxDuration=1}}const $m=Kn({ __name:'IconToggleButton',props:{ onicon:String,officon:String,action:Function,onstate:Boolean },setup (e){const t=e;function r (n){t.action&&t.action(n,!0)}function i (n){t.action&&t.action(n,!1)}return(n,o)=>(wr(),_r(gi,null,[e.onstate?(wr(),_r('button',{ key:0,class:gs(e.onicon),onClick:o[0]||(o[0]=u=>r(u)) },null,2)):yi('',!0),e.onstate?yi('',!0):(wr(),_r('button',{ key:1,class:gs(e.officon),onClick:o[1]||(o[1]=u=>i(u)) },null,2))],64))} }),Xm={ class:'panelborder' },Jm=Kn({ __name:'InActorPanel',props:{ script:String,updateScript:Function,reportInActorState:Function,hidden:Boolean },setup (e){const t=e;const r=kp({ countdown:' 0.0',playerIndex:'',defaultDur:2,maxDur:0 }),i=new qm(t.updateScript,r);t.reportInActorState&&t.reportInActorState(i);const n=vs(!1);function o (u,m){n.value=!n.value}return(u,m)=>e.hidden?yi('',!0):(wr(),_r(gi,{ key:0 },[Or('div',Xm,[fr(br,{ icon:'fa-solid--trash-alt icon',action:_=>_t(i).doClear(_) },null,8,['action']),fr(br,{ icon:'fa-solid--file-import icon',action:_=>_t(i).doFileImport(_) },null,8,['action']),_t(r).hasrecord?(wr(),_r(gi,{ key:0 },[fr(br,{ icon:'fa-solid--file-export icon',action:_=>_t(i).doFileExport(_) },null,8,['action']),fr(br,{ icon:'lets-icons--box-refresh-alt-right icon',action:_=>_t(i).doLoad(_) },null,8,['action']),m[2]||(m[2]=Rn('   '))],64)):yi('',!0),_t(r).hasplay?(wr(),_r(gi,{ key:1 },[fr(br,{ icon:'fa6-solid--backward-fast icon',action:_=>_t(i).doFastBackward(_) },null,8,['action']),fr(br,{ icon:'fa--step-backward icon',action:_=>_t(i).doStepBackward(_) },null,8,['action']),fr($m,{ onicon:'fa6-regular--circle-pause icon',officon:'fa--play icon',onstate:_t(r).playing,action:_=>{_t(i).doPlay(_)} },null,8,['onstate','action']),fr(br,{ icon:'fa--step-forward icon',action:_=>_t(i).doStepForward(_) },null,8,['action']),fr(br,{ icon:'fa6-solid--forward-fast icon',action:_=>_t(i).doFastForward(_) },null,8,['action']),fr(br,{ icon:'fa--cog icon',action:_=>o(_t(i)) },null,8,['action'])],64)):yi('',!0)]),_t(n)?(wr(),_r(gi,{ key:0 },[m[3]||(m[3]=Or('br',null,null,-1)),m[4]||(m[4]=Rn(' Default: ')),Mu(Or('input',{ type:'number',min:'0',max:'60','onUpdate:modelValue':m[0]||(m[0]=_=>_t(r).defaultDur=_) },null,512),[[Du,_t(r).defaultDur]]),m[5]||(m[5]=Rn('   Max: ')),Mu(Or('input',{ type:'number',min:'0',max:'300','onUpdate:modelValue':m[1]||(m[1]=_=>_t(r).maxDur=_) },null,512),[[Du,_t(r).maxDur]]),m[6]||(m[6]=Or('br',null,null,-1))],64)):yi('',!0),Rn('  '+ns(_t(r).playerIndex)+' '+ns(_t(r).countdown)+' '+ns(_t(r).filename),1)],64))} });export{ Km as B,Zm as _,br as a,Jm as b,Qm as o };
