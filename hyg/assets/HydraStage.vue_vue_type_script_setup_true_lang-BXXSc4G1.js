import{ B as E,_ as J,b as P,o as Q }from'./InActorPanel.vue_vue_type_style_index_0_lang-CA10Obwi.js';import{ aw as _,aB as B,L as b,a7 as d,ar as D,V as K,au as L,M,a as T,b as u,G as V,o as v,c as W,F as w,a2 as Y,ao as y,J as Z }from'./index-BISJuDPG.js';const ee=D({ __name:'StagePanel',props:{ params:Object,reportInActorState:Function,updateScript:Function,sketch:String },setup (x){const o=x;function f (){window.open('/index.html?edit=t','editor','width=500,height=1080,left=20')}return(m,e)=>(v(),L(M,null,[u('button',{ type:'button',id:'HydraNxt',onClick:f },'Edit'),e[3]||(e[3]=y('  ')),b(u('input',{ type:'checkbox',id:'fx','onUpdate:modelValue':e[0]||(e[0]=s=>o.params.fx=s) },null,512),[[B,o.params.fx]]),e[4]||(e[4]=u('label',{ for:'fx' },'Fx',-1)),e[5]||(e[5]=y('   ')),b(u('input',{ type:'checkbox',id:'wgsl','onUpdate:modelValue':e[1]||(e[1]=s=>o.params.wgsl=s) },null,512),[[B,o.params.wgsl]]),e[6]||(e[6]=u('label',{ for:'wgsl' },'wgsl',-1)),e[7]||(e[7]=y('   ')),b(u('input',{ type:'checkbox',id:'show4','onUpdate:modelValue':e[2]||(e[2]=s=>o.params.quad=s) },null,512),[[B,o.params.quad]]),e[8]||(e[8]=u('label',{ for:'quad' },'Quad',-1)),e[9]||(e[9]=y('   ')),T(P,{ script:o.sketch,updateScript:o.updateScript,reportInActorState:o.reportInActorState },null,8,['script','updateScript','reportInActorState'])],64))} }),oe=D({ __name:'HydraStage',props:{ show:Boolean },setup (x){const o=x;let f,m,e,s;const l=w('');let I={},g=!1,c=!1,A=w(window.innerWidth),F=w(window.innerHeight);w(!1);let r=Y({ fx:!1,wgsl:!1,quad:!1 }),S=!1,i=0;function C (){i?i=0:i=1}let n=new Array(2);function j (t,a,p){t==='update'&&N(a,p)}async function z (t){m=await Q('stage','editor',j),f=m.name,console.log('Created: '+f)}async function H (){console.log('notify drop sent: '+f),await m.dropAndNotify(!0),console.log('notify drop done: '+f)}K(()=>{z(),window.addEventListener('resize',q)}),Z(()=>{window.removeEventListener('resize',q),H()}),document.addEventListener('mousemove',function (t){t.clientX,t.clientY}),window.addEventListener('unload',function (t){H()});async function N (t,a,p,te){if(!c)l.value=t,I=a,S=!0;else{if(C(),!n[i]){console.log('BGWorker not set up');return}if(a.key&&await n[i].hush(),await n[i].setSketch(t),S){i?l.value='src(s3).out()':l.value='src(s2).out()',S=!1;return}i?l.value='let t0 = time;src(s2).blend(s3, ()=>{return Math.min((time-t0) * 2.0, 1.0) }).out()':l.value='let t0 = time;src(s3).blend(s2, ()=>{return Math.min((time-t0) * 2.0, 1.0)}).out()'}}async function G (t,a){e=t.synth,s=a,console.log('New Hydra instance reported.'),g&&(n[0].setResolution(a.width,a.height),n[1].setResolution(a.width,a.height))}async function R (){g||(n[0]=await new E(s,r.wgsl,!1,!0),n[1]=await new E(s,r.wgsl,!1,!0),await n[0].openWorker(),await n[1].openWorker(),n[0].requestFrameCallbacks(t=>{e.s2.injectImage(t)}),n[1].requestFrameCallbacks(t=>{e.s3.injectImage(t)}),g=!0,c=!0)}const h=w(0);function q (){const t=window.innerWidth,a=window.innerHeight;A.value=t,F.value=a,console.log('Resized: '+t+' + '+a+' keyctr: '+h.value),h.value++}async function U (){c=r.fx,c?(await R(),n[0]&&await n[0].setSketch('hush()'),n[1]&&await n[1].setSketch('hush()')):(n[0]&&n[0].destroy(),n[1]&&n[1].destroy(),n=new Array(2),c=!1,g=!1)}let k;function $ (t){k=t}function X (t,a,p){console.log(`Stage evalDone ${p}`),k&&k.evalDone&&k.evalDone(t,a,p),r.quad&&t.synth.render()}async function O (){h.value++}return V(()=>r.fx,U),V(()=>r.wgsl,O),(t,a)=>(v(),L(M,null,[o.show?(v(),W(ee,{ key:0,params:d(r),sketch:l.value,reportInActorState:$,updateScript:N },null,8,['params','sketch'])):_('',!0),(v(),W(J,{ sketch:l.value,wgsl:d(r).wgsl,sketchInfo:d(I),width:d(A),height:d(F),key:d(h),reportHydra:G,evalDone:X },null,8,['sketch','wgsl','sketchInfo','width','height']))],64))} });export{ oe as _ };
